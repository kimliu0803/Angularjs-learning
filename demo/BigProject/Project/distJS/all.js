'use strict';
var SMS = {};
SMS.CONFIG = angular.module("SMS.config", []);
SMS.CONTROLLERS = angular.module('SMS.controllers', ['SMS.services', 'SMS.filters', 'ngMaterial', 'material.svgAssetsCache', 'ngMessages', 'bsTable']);
SMS.SERVICES = angular.module('SMS.services', ['SMS.common', 'SMS.backend', 'SMS.filters']);
SMS.BACKEND = angular.module('SMS.backend', []);
SMS.COMMON = angular.module('SMS.common', ['SMS.config']);
SMS.FILTERS = angular.module('SMS.filters', []);
SMS.DIRECTIVES = angular.module('SMS.directives', []);
angular.module('SMS', ['ngAnimate', 'ngRoute', 'ui.router', 'SMS.controllers', 'SMS.filters', 'SMS.directives', 'ngCookies'])
    .config(['$stateProvider', '$urlRouterProvider', '$routeProvider', '$httpProvider', '$mdThemingProvider', '$mdDateLocaleProvider', 'ENV',
        function ($stateProvider, $urlRouterProvider, $routeProvider, $httpProvider, $mdThemingProvider, $mdDateLocaleProvider, ENV) {
            $stateProvider
                .state('login', {
                    url: '/login',
                    controller: 'loginCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/login/login.html'
                })
                .state('main', {
                    url: '/main',
                    controller: 'mainCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/main.html',
                    naviPath:'/main'
                })
                .state('main.doctor', {
                    url: '/doctor',
                    template: '<div ui-view></div>',
                    abstract: true
                })
                .state('main.resident', {
                    url: '/resident',
                    template: '<div ui-view></div>',
                    abstract: true
                })
                .state('main.baseData', {
                    url: '/baseData',
                    template: '<div ui-view></div>',
                    abstract: true
                })
                .state('main.report', {
                    url: '/report',
                    template: '<div ui-view></div>',
                    abstract: true
                })
                .state('main.followupTemplate', {
                    url: '/followupTemplate',
                    template: '<div ui-view></div>',
                    abstract: true
                })
                //组织机构管理
                .state('main.baseData.organizationList', {
                    url: '/organizationList',
                    controller: 'organizationListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/baseData/organization/list.html',
                    naviPath:'/main/baseData/organizationList'
                })
                .state('main.baseData.organizationAdd', {
                    url: '/organizationAdd',
                    controller: 'organizationAddCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/baseData/organization/detail.html',
                    naviPath:'/main/baseData/organizationList'
                })
                .state('main.baseData.organizationEdit', {
                    url: '/organizationEdit/:ORGANIZATION_KEY_ID/:ORGANIZATION_TYPE_CODE',
                    controller: 'organizationEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/baseData/organization/detail.html',
                    naviPath:'/main/baseData/organizationList'
                })
                //系统角色管理
                .state('main.baseData.roleList', {
                    url: '/roleList',
                    controller: 'roleListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/baseData/role/list.html',
                    naviPath:'/main/baseData/roleList'
                })
                .state('main.baseData.roleAdd', {
                    url: '/roleAdd',
                    controller: 'roleAddCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/baseData/role/detail.html',
                    naviPath:'/main/baseData/roleList'
                })
                .state('main.baseData.roleEdit', {
                    url: '/roleEdit/:ROLE_KEY_ID/:ROLE_NAME',
                    controller: 'roleEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/baseData/role/detail.html',
                    naviPath:'/main/baseData/roleList'
                })
                //系统用户管理
                .state('main.baseData.userList', {
                    url: '/userList',
                    controller: 'userListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/baseData/user/list.html',
                    naviPath:'/main/baseData/userList'
                })
                .state('main.baseData.userAdd', {
                    url: '/userAdd',
                    controller: 'userAddCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/baseData/user/detail.html',
                    naviPath:'/main/baseData/userList'
                })
                .state('main.baseData.userEdit', {
                    url: '/userEdit/:USER_KEY_ID',
                    controller: 'userEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/baseData/user/detail.html',
                    naviPath:'/main/baseData/userList'
                })
                //医院科室管理
                .state('main.baseData.hospitalDeptList', {
                    url: '/hospitalDeptList',
                    controller: 'hospitalListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/baseData/hospitalDept/hospitalList.html',
                    naviPath:'/main/baseData/hospitalDeptList'
                })
                .state('main.baseData.deptList', {
                    url: '/deptList/:HOSPITAL_ID/:HOSPITAL_NAME',
                    controller: 'deptListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/baseData/hospitalDept/deptList.html',
                    naviPath:'/main/baseData/hospitalDeptList'
                })
                .state('main.baseData.deptAdd', {
                    url: '/deptAdd/:HOSPITAL_ID/:HOSPITAL_NAME',
                    controller: 'deptAddCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/baseData/hospitalDept/deptDetail.html',
                    naviPath:'/main/baseData/hospitalDeptList'
                })
                .state('main.baseData.deptEdit', {
                    url: '/deptEdit/:HOSPITAL_ID/:HOSPITAL_NAME/:DEPT_ID',
                    controller: 'deptEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/baseData/hospitalDept/deptDetail.html',
                    naviPath:'/main/baseData/hospitalDeptList'
                })
                //居民档案管理
                .state('main.resident.residentArchivesList', {
                    url: '/residentArchivesList',
                    controller: 'residentArchivesListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/residentArchives/list.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesListReturn', {
                    url: '/residentArchivesList/:TYPE',
                    controller: 'residentArchivesListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/residentArchives/list.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-添加
                .state('main.resident.residentArchivesAdd', {
                    url: '/residentArchivesAdd',
                    controller: 'residentArchivesAddCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/residentArchives/detail.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-编辑
                .state('main.resident.residentArchivesSidebar', {
                    url: '/residentArchivesSidebar/:RESIDENT_KEY_ID',
                    controller: 'residentArchivesSidebarCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/residentArchives/sidebar.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesSidebar.detail', {
                    url: '/detail',
                    template: '<div ui-view></div>',
                    abstract: true
                })
                //居民档案-基本信息
                .state('main.resident.residentArchivesSidebar.detail.residentArchivesEdit', {
                    url: '/residentArchivesEdit/:RESIDENT_KEY_ID',
                    controller: 'residentArchivesEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/residentArchives/detail.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-就诊记录
                .state('main.resident.residentArchivesSidebar.detail.medical', {
                    url: '/medical/:RESIDENT_KEY_ID',
                    controller: 'residentMedicalListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/residentArchives/medicalRecord/list.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-健康行为记录
                .state('main.resident.residentArchivesSidebar.detail.healthBehavior', {
                    url: '/healthBehavior/:RESIDENT_KEY_ID',
                    controller: 'residentBehaviorListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/residentArchives/healthBehaviorRecord/list.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-体检记录列表
                .state('main.resident.residentArchivesSidebar.detail.physicalExamination', {
                    url: '/physicalExamination/:RESIDENT_KEY_ID',
                    controller: 'residentExaminationListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/residentArchives/physicalExaminationRecord/list.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-体检记录修改
                .state('main.resident.residentArchivesSidebar.detail.physicalExaminationEdit', {
                    url: '/physicalExaminationEdit/:RESIDENT_KEY_ID/:PHYSICAL_RECORD_KEY_ID',
                    controller: 'physicalExaminationEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/residentArchives/physicalExaminationRecord/detail.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-中医体质辨识列表
                .state('main.resident.residentArchivesSidebar.detail.physicalIdentification', {
                    url: '/physicalIdentification/:RESIDENT_KEY_ID',
                    controller: 'residentIdentificationListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/residentArchives/physicalIdentificationRecord/list.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-中医体质辨识修改
                .state('main.resident.residentArchivesSidebar.detail.physicalIdentificationEdit', {
                    url: '/physicalIdentificationEdit/:RESIDENT_KEY_ID/:TCM_CONSTITUTION_RECORD_KEY_ID',
                    controller: 'physicalIdentificationEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/residentArchives/physicalIdentificationRecord/detail.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-家庭信息
                .state('main.resident.residentArchivesSidebar.detail.familyArchivesEdit', {
                    url: '/familyArchivesEdit/:FAMILY_KEY_ID',
                    controller: 'familyArchivesEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/familyArchives/detail.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-家庭成员
                .state('main.resident.residentArchivesSidebar.detail.familyMember', {
                    url: '/familyMember/:FAMILY_KEY_ID',
                    controller: 'familyFamilyMemberCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/residentArchives/familyMember/list.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-高血压专项
                .state('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar', {
                    url: '/hypertensionHead/:RESIDENT_KEY_ID/:HYPERTENSION_RECORD_KEY_ID',
                    controller: 'hypertensionHeadBarCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/residentArchives/special/hyHeadbar.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail', {
                    url: '/detail',
                    template: '<div ui-view></div>',
                    abstract: true
                })
                //居民档案-高血压专项-确诊信息
                .state('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.hypertensionEdit', {
                    url: '/hypertensionEdit/:RESIDENT_KEY_ID/:HYPERTENSION_RECORD_KEY_ID',
                    controller: 'hypertensionEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/hypertension/detail.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-高血压专项-血压记录
                .state('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.bloodPressureList', {
                    url: '/bloodPressureList/:HYPERTENSION_RECORD_KEY_ID',
                    controller: 'hypertensionBloodPressureListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/hypertension/bloodPressureRecord/list.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.bloodPressureAdd', {
                    url: '/bloodPressureAdd/:HYPERTENSION_RECORD_KEY_ID',
                    controller: 'hypertensionBloodPressureAddCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/hypertension/bloodPressureRecord/add.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.bloodPressureEdit', {
                    url: '/bloodPressureEdit/:HYPERTENSION_RECORD_KEY_ID/:BLOOD_PRESSURE_RECORD_KEY_ID',
                    controller: 'hypertensionBloodPressureEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/hypertension/bloodPressureRecord/add.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.bloodPressureReport', {
                    url: '/bloodPressureReport/:BLOOD_PRESSURE_RECORD_KEY_ID',
                    controller: 'hypertensionBloodPressureReportCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/hypertension/bloodPressureRecord/report.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-高血压专项-随访记录
                .state('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.followupList', {
                    url: '/followupList/:RESIDENT_KEY_ID/:HYPERTENSION_RECORD_KEY_ID',
                    controller: 'hypertensionFollowupListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/hypertension/followupRecord/list.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.followupEdit', {
                    url: '/followupEdit/:RESIDENT_KEY_ID/:HYPERTENSION_RECORD_KEY_ID/:FOLLOW_UP_RECORD_KEY_ID',
                    controller: 'hypertensionFollowupEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/hypertension/followupRecord/add.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.followupAdd', {
                    url: '/followupAdd/:RESIDENT_KEY_ID/:HYPERTENSION_RECORD_KEY_ID',
                    controller: 'hypertensionFollowupAddCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/hypertension/followupRecord/add.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-高血压专项-评估记录
                .state('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.evaluationList', {
                    url: '/evaluationList/:HYPERTENSION_RECORD_KEY_ID',
                    controller: 'hypertensionEvaluationListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/hypertension/evaluationRecord/list.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.evaluationAdd', {
                    url: '/evaluationAdd/:HYPERTENSION_RECORD_KEY_ID',
                    controller: 'hypertensionEvaluationAddCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/hypertension/evaluationRecord/add.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.evaluationEdit', {
                    url: '/evaluationEdit/:HYPERTENSION_RECORD_KEY_ID/:ASSESS_RECORD_KEY_ID',
                    controller: 'hypertensionEvaluationEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/hypertension/evaluationRecord/add.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-糖尿病专项
                .state('main.resident.residentArchivesSidebar.detail.diabetesHeadBar', {
                    url: '/diabetesHead/:RESIDENT_KEY_ID/:DIABETES_RECORD_KEY_ID',
                    controller: 'diabetesHeadBarCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/residentArchives/special/diHeadbar.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail', {
                    url: '/detail',
                    template: '<div ui-view></div>',
                    abstract: true
                })
                //居民档案-糖尿病专项-确诊信息
                .state('main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.diabetesEdit', {
                    url: '/diabetesEdit/:RESIDENT_KEY_ID',
                    controller: 'diabetesEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/diabetes/detail.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-糖尿病专项-血糖记录
                .state('main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.bloodGlucoseList', {
                    url: '/bloodGlucoseList/:RESIDENT_KEY_ID/:DIABETES_RECORD_KEY_ID',
                    controller: 'diabetesBloodGlucoseListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/diabetes/bloodGlucoseRecord/list.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.bloodGlucoseAdd', {
                    url: '/bloodGlucoseAdd/:RESIDENT_KEY_ID/:DIABETES_RECORD_KEY_ID',
                    controller: 'diabetesBloodGlucoseAddCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/diabetes/bloodGlucoseRecord/add.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.bloodGlucoseEdit', {
                    url: '/bloodGlucoseEdit/:RESIDENT_KEY_ID/:DIABETES_RECORD_KEY_ID/:RECORD_KEY_ID',
                    controller: 'diabetesBloodGlucoseEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/diabetes/bloodGlucoseRecord/add.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.bloodGlucoseReport', {
                    url: '/bloodGlucoseReport/:RESIDENT_KEY_ID/:DIABETES_RECORD_KEY_ID',
                    controller: 'diabetesBloodGlucoseReportCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/diabetes/bloodGlucoseRecord/report.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //居民档案-糖尿病专项-随访记录
                .state('main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.followupList', {
                    url: '/followupList/:RESIDENT_KEY_ID/:DIABETES_RECORD_KEY_ID',
                    controller: 'diabetesFollowupListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/diabetes/followupRecord/list.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.followupAdd', {
                    url: '/followupAdd/:RESIDENT_KEY_ID/:DIABETES_RECORD_KEY_ID',
                    controller: 'diabetesFollowupAddCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/diabetes/followupRecord/add.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                .state('main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.followupEdit', {
                    url: '/followupEdit/:RESIDENT_KEY_ID/:DIABETES_RECORD_KEY_ID/:FOLLOW_UP_RECORD_KEY_ID',
                    controller: 'diabetesFollowupEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/special/diabetes/followupRecord/add.html',
                    naviPath:'/main/resident/residentArchivesList'
                })
                //家庭档案管理
                .state('main.resident.familyArchivesList', {
                    url: '/familyArchivesList',
                    controller: 'familyArchivesListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/familyArchives/list.html',
                    naviPath:'/main/resident/familyArchivesList'
                })
                .state('main.resident.familyArchivesListReturn', {
                    url: '/familyArchivesList/:TYPE',
                    controller: 'familyArchivesListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/familyArchives/list.html',
                    naviPath:'/main/resident/familyArchivesList'
                })
                //家庭档案-添加
                .state('main.resident.familyArchivesAdd', {
                    url: '/familyArchivesAdd',
                    controller: 'familyArchivesAddCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/familyArchives/detail.html',
                    naviPath:'/main/resident/familyArchivesList'
                })
                //家庭档案-基本信息
                .state('main.resident.familyArchivesSidebar', {
                    url: '/familyArchivesSidebar/:FAMILY_KEY_ID',
                    controller: 'familyArchivesSidebarCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/familyArchives/sidebar.html',
                    naviPath:'/main/resident/familyArchivesList'
                })
                .state('main.resident.familyArchivesSidebar.detail', {
                    url: '/detail',
                    template: '<div ui-view></div>',
                    abstract: true
                })
                //家庭档案-编辑
                .state('main.resident.familyArchivesSidebar.detail.familyArchivesEdit', {
                    url: '/familyArchivesEdit/:FAMILY_KEY_ID',
                    controller: 'familyArchivesEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/familyArchives/detail.html',
                    naviPath:'/main/resident/familyArchivesList'
                })
                //家庭档案-家庭成员
                .state('main.resident.familyArchivesSidebar.detail.familyMember', {
                    url: '/familyMember/:FAMILY_KEY_ID',
                    controller: 'familyFamilyMemberCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/familyArchives/familyMember/list.html',
                    naviPath:'/main/resident/familyArchivesList'
                })
                //家庭档案-签约医生
                .state('main.resident.familyArchivesSidebar.detail.signDoctor', {
                    url: '/signDoctor/:FAMILY_KEY_ID',
                    controller: 'familySignDoctorCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/resident/familyArchives/signDoctor/detail.html',
                    naviPath:'/main/resident/familyArchivesList'
                })
                //医生信息管理
                .state('main.doctor.doctorIndividualList', {
                    url: '/doctorIndividualList',
                    controller: 'doctorIndividualListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/doctor/doctorIndividual/list.html',
                    naviPath:'/main/doctor/doctorIndividualList'
                })
                .state('main.doctor.doctorIndividualAdd', {
                    url: '/doctorIndividualAdd',
                    controller: 'doctorIndividualAddCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/doctor/doctorIndividual/detail.html',
                    naviPath:'/main/doctor/doctorIndividualList'
                })
                .state('main.doctor.doctorIndividualSidebar', {
                    url: '/doctorIndividualSidebar/:DOCTOR_NAME/:FAMILY_DOCTOR_KEY_ID',
                    controller: 'doctorIndividualSidebarCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/doctor/doctorIndividual/sidebar.html',
                    naviPath:'/main/doctor/doctorIndividualList'
                })
                .state('main.doctor.doctorIndividualSidebar.detail', {
                    url: '/detail',
                    template: '<div ui-view></div>',
                    abstract: true
                })
                //基本信息
                .state('main.doctor.doctorIndividualSidebar.detail.doctorIndividualEdit', {
                    url: '/doctorIndividualEdit/:FAMILY_DOCTOR_KEY_ID',
                    controller: 'doctorIndividualEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/doctor/doctorIndividual/detail.html',
                    naviPath:'/main/doctor/doctorIndividualList'
                })
                //签约管理
                .state('main.doctor.doctorIndividualSidebar.detail.signedFamilyList',{
                    url: '/signedFamilyList/:DOCTOR_NAME/:FAMILY_DOCTOR_KEY_ID',
                    controller: 'signedFamilyListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/doctor/doctorIndividual/signManage/list.html',
                    naviPath:'/main/doctor/doctorIndividualList'
                })
                //签约记录
                .state('main.doctor.doctorIndividualSidebar.detail.signRecord',{
                    url: '/signRecord/:FAMILY_DOCTOR_KEY_ID',
                    controller: 'doctorIndividualSignRecordCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/doctor/doctorIndividual/signRecord/detail.html',
                    naviPath:'/main/doctor/doctorIndividualList'
                })
                //医生团队管理
                .state('main.doctor.doctorTeamList', {
                    url: '/doctorTeamList',
                    controller: 'doctorTeamListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/doctor/doctorTeam/list.html',
                    naviPath:'/main/doctor/doctorTeamList'
                })
                .state('main.doctor.doctorTeamAdd', {
                    url: '/doctorTeamAdd',
                    controller: 'doctorTeamAddCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/doctor/doctorTeam/detail.html',
                    naviPath:'/main/doctor/doctorTeamList'
                })
                .state('main.doctor.doctorTeamEdit', {
                    url: '/doctorTeamEdit',
                    controller: 'doctorTeamEditCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/doctor/doctorTeam/detail.html',
                    naviPath:'/main/doctor/doctorTeamList'
                })
                //统计分析-签约人数统计
                .state('main.report.contractReport', {
                    url: '/contractReport',
                    controller: 'contractReportCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/report/contractNum/contractReport.html',
                    naviPath:'/main/report/contractReport'
                })
                .state('main.report.contractDetailReport', {
                    url: '/contractDetailReport',
                    controller: 'contractDetailReportCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/report/contractNum/contractDetailReport.html',
                    naviPath:'/main/report/contractReport'
                })
                //统计分析-重点人群统计
                .state('main.report.keyPopulationReport', {
                    url: '/keyPopulationReport',
                    controller: 'keyPopulationReportCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/report/keyPopulation/keyPopulationReport.html',
                    naviPath:'/main/report/keyPopulationReport'
                })
                .state('main.report.keyPopulationReportReturnBack', {
                    url: '/keyPopulationReport/:TYPE',
                    controller: 'keyPopulationReportCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/report/keyPopulation/keyPopulationReport.html',
                    naviPath:'/main/report/keyPopulationReport'
                })
                .state('main.report.keyPopulationDetailReport', {
                    url: '/keyPopulationDetailReport/:DETAIL_CHART_TYPE/:DETAIL_CHART_VALUE',
                    controller: 'keyPopulationDetailReportCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/report/keyPopulation/keyPopulationDetailReport.html',
                    naviPath:'/main/report/keyPopulationDetailReport'
                })
                //统计分析-随访次数统计
                .state('main.report.followupTimesReport', {
                    url: '/followupTimesReport',
                    controller: 'followupTimesReportCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/report/followupTimes/followupTimesReport.html',
                    naviPath:'/main/report/followupTimesReport'
                })
                //随访模板
                .state('main.followupTemplate.templateList', {
                    url: '/templateList',
                    controller: 'templateListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/followupTemplate/template/list.html',
                    naviPath:'/main/followupTemplate/templateList'
                })
                .state('main.followupTemplate.templatePreview', {
                    url: '/templatePreview/:TEMPLATE_KEY_ID',
                    controller: 'templatePreviewCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/followupTemplate/template/preview.html',
                    naviPath:'/main/followupTemplate/templateList'
                })
                //随访字段库
                .state('main.followupTemplate.fieldsList', {
                    url: '/fieldsList',
                    controller: 'fieldsListCtrl as vm',
                    controllerAs: 'vm',
                    templateUrl: 'template/followupTemplate/fields/list.html',
                    naviPath:'/main/followupTemplate/fieldsList'
                });

            $urlRouterProvider.otherwise('login');

            // Can change week display to start on Monday.
            $mdDateLocaleProvider.firstDayOfWeek = 1;

            // Example uses moment.js to parse and format dates.
            $mdDateLocaleProvider.parseDate = function(dateString) {
                var m = moment(dateString, 'YYYY-MM-DD', true);
                return m.isValid() ? m.toDate() : new Date(NaN);
            };

            $mdDateLocaleProvider.formatDate = function(date) {
                if (!date) {
                    return '';
                }
                var m = moment(date);
                return m.isValid() ? m.format('YYYY-MM-DD') : '';
            };

            //跨域CORS
            $httpProvider.defaults.withCredentials = true;

            $mdThemingProvider.definePalette('gpcolors', {
                '50': '#3d93fe',
                '100': '#ff4747',
                '200': 'ef9a9a',
                '300': 'e57373',
                '400': 'ef5350',
                '500': 'f44336',
                '600': '#3176cb',
                '700': 'd32f2f',
                '800': 'c62828',
                '900': 'b71c1c',
                'A100': 'ff8a80',
                'A200': 'ff5252',
                'A400': 'ff1744',
                'A700': 'd50000',
                'contrastDefaultColor': 'light',    // whether, by default, text (contrast)
                                                    // on this palette should be dark or light

                'contrastDarkColors': ['50', '100', //hues which contrast should be 'dark' by default
                    '200', '300', '400', 'A100'],
                'contrastLightColors': undefined    // could also specify this if default was 'dark'
            });


            $mdThemingProvider.theme('default')
                .primaryPalette('gpcolors', {
                    default: '50'
                })
                .accentPalette('light-blue', {
                    default: '500'
                })
                .warnPalette('gpcolors', {
                    default: '100'
                });
            /**
             * 主题蓝色 #2a9dff
             * 报错红色 ＃ff4747
             * 文字颜色 黑＃333333   深灰＃666666  浅灰＃999999
             */
        }
    ])
    .run(['$rootScope', '$state', '$stateParams', 'SessionStorage', 'ENV', '$mdDialog', '$document',
        function ($rootScope, $state, $stateParams, SessionStorage, ENV, $mdDialog, $document) {
            $rootScope.$state = $state;
            $rootScope.$stateParams = $stateParams;
            $rootScope.$on("$stateChangeSuccess", function (event, toState, toParams, fromState, fromParams) {
                if (fromState.name) {
                    $rootScope.previousState_name = fromState.name;
                    $rootScope.previousState_params = fromParams;
                }
                $rootScope.$emit('url-change', toState['name']);
            });
            //back button function called from back button's ng-click="back()"
            $rootScope.back = function () {
                $rootScope.previousState_name&&$state.go($rootScope.previousState_name, $rootScope.previousState_params);
                !$rootScope.previousState_name&&window.history.back();
            };
            //监听stateChange事件
            $rootScope.$on('$stateChangeStart', function (event, toState, toParams, fromState) {
                $rootScope.naviIndex=toState.naviIndex;
                $rootScope.naviPath=toState.naviPath;
                if (angular.element($document[0].body).hasClass('md-dialog-is-showing')) {//如果有对话框存在
                    $mdDialog.cancel();
                    event.preventDefault();
                    return;
                }
                if(angular.element('.md-panel-is-showing').length>0) {//如果有Panel对话框存在
                    $rootScope.$broadcast('panelClose');
                    event.preventDefault();
                    return;
                }
                if ((toState.name+'') === 'login') {// 如果是进入登录界面则允许
                    return;
                }
                // 如果用户不存在
                if (ENV.runMode !== 'debug' && !SessionStorage.get('loginInfo')) {
                    $rootScope.previousState_name = toState.name;
                    $rootScope.previousState_params = toParams;
                    $rootScope.lastUserName='gproot001';
                    event.preventDefault();// 取消默认跳转行为
                    $state.go("login", {from: fromState.name, w: 'notLogin'});//跳转到登录界面
                }
            });
            // 跳转到登录界面，这里我记录了一个from，这样可以在登录后自动跳转到未登录之前的那个界面
            $rootScope.$on('commonInterceptor', function (errorType) {
                $state.go("login", {from: $state.current.name, w: errorType});
            });
        }
    ]);


(function (window, angular) {
    'use strict';
    var module = angular.module('SMS.backend', ['ngResource', 'SMS.config']);
    module
        .config(['$httpProvider', function ($httpProvider) {
            $httpProvider.interceptors.push('commonInterceptor');
            $httpProvider.interceptors.push('smsInterceptor');
        }])
        .factory('commonInterceptor', ['$q', 'LocalStorage', '$rootScope', function ($q, LocalStorage, $rootScope) {
            var requestInterceptor = {
                request: function (config) {
                    var deferred = $q.defer();

                    var regStr = /.*\.html/;
                    if (!regStr.test(config.url) && !config.params) {
                            config.params = {};
                    }

                    //新版token
                    //var oauthToken = LocalStorage.get("HMSToken");
                    //if (oauthToken) {
                    //    config.headers['Authorization'] = "Bearer " + oauthToken;
                    //}

                    //设置请求超时
                    if (!config.timeout) {
                        config.timeout = 30000;
                    }

                    deferred.resolve(config);
                    return deferred.promise;
                },
                response: function (response) {
                    if (response && response.data.message && response.data.message === 'unauthorized' && !response.data.success) {
                        var deferred = $q.defer();
                        $rootScope.$broadcast('auth-loginRequired', response);
                        return deferred.promise;
                    }
                    return response;
                },
                responseError: function (response) {
                    switch (response.status) {
                        case 401:
                            var deferred = $q.defer();
                            $rootScope.$broadcast('auth-loginRequired', response);
                            return deferred.promise;
                        case 403:
                            $rootScope.$broadcast('auth-forbidden', response);
                            break;
                        case -1:
                            $rootScope.$broadcast('offline');
                            break;
                        default:
                            break;
                    }
                    return $q.reject(response);
                }
            };
            return requestInterceptor;
        }])
        //Ajax-aop
        .factory('smsInterceptor', ['$q', '$rootScope', function ($q, $rootScope) {
            if ($rootScope.ajaxCalls === undefined) {
                $rootScope.ajaxCalls = 0;
            }
            var smsInterceptor = {
                request: function (config) {
                    $rootScope.ajaxCalls += 1;
                    return config;
                },
                requestError: function (rejection) {
                    $rootScope.ajaxCalls -= 1;
                    return rejection;
                },
                response: function (response) {
                    $rootScope.ajaxCalls -= 1;
                    return response;
                },
                responseError: function (rejection) {
                    $rootScope.ajaxCalls -= 1;
                    return rejection;
                }
            };
            return smsInterceptor;
        }])
        .factory('Common', ['$resource', 'ENV', function ($resource, ENV) {
            return $resource("", "", {
                getCurrentTime: {
                    method: 'GET',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/getSysDate",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getDictList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/common/getDictList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getOrganizationLevelList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getOrganizationLevelList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getProvinceList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/common/getProvinceList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getCityListOfCertainProvince: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/common/getCityListOfCertainProvince",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getCountyListOfCertainCity: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/common/getCountyListOfCertainCity",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getSubdistrictListOfCertainCounty: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/common/getSubdistrictListOfCertainCounty",
                    isArray: false,
                    timeout: ENV.timeout
                }
            })
        }])
        .factory('Account', ['$resource', 'ENV', function ($resource, ENV) {
            return $resource("", "", {
                debugTable: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    withCredentials: false,
                    url: "http://hcrmtest.kyee.com.cn:40080/hcrmcloudnew/view/currentTask/interview/listAllPatientsByCusId",
                    isArray: false,
                    timeout: ENV.timeout
                },
                debugLogin: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    withCredentials: false,
                    url: "http://hcrmtest.kyee.com.cn:40080/hcrmcloudnew/public/weChat/doc/getPatientInfoByIdCard",
                    isArray: false,
                    timeout: ENV.timeout
                },
                login: {
                    method: "POST",
                    headers: {
                        //"content-type": "multipart/form-data"
                        "content-type": "application/x-www-form-urlencoded"
                        //"content-type": "application/json"
                    },
                    url: ENV.urlBase + "/login",
                    //url: ENV.urlBase + "/account/login",
                    isArray: false,
                    timeout: ENV.timeout
                },
                logout: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/logout",
                    //url: ENV.urlBase + "/account/logout",
                    isArray: false,
                    timeout: ENV.timeout
                },
                modifyPass: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/user/modifyPass",
                    //url: ENV.urlBase + "/account/modifyPass",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getCode: {
                    method: "GET",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/getcode",
                    isArray: false,
                    timeout: ENV.timeout
                },
                checkCode: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/checkCode",
                    isArray: false,
                    timeout: ENV.timeout
                }
            })
        }])
        .factory('Organization', ['$resource', 'ENV', function ($resource, ENV) {
            return $resource('', '', {
                getOrganizationLevelList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getOrganizationLevelListConstraint",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getCertainLevelOrganization: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getCertainLevelOrganization",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getProvinceList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getProvinceConstraint",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getCityListOfCertainProvince: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getCityConstraint",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getCountyListOfCertainCity: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getCountyConstraint",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getSubdistrictListOfCertainCounty: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getSubdistrictConstraint",
                    isArray: false,
                    timeout: ENV.timeout
                },
                isOrganizationExist: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/isOrganizationExist",
                    isArray: false,
                    timeout: ENV.timeout
                },
                createOrganization: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/createOrganization",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getOrganizationList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getOrganizationList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getParentOrganizationList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getParentOrganizationList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getOrganizationNameList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getOrganizationNameList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getOrganizationInfo: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getOrganizationInfo",
                    isArray: false,
                    timeout: ENV.timeout
                },
                updateOrganization: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/updateOrganization",
                    isArray: false,
                    timeout: ENV.timeout
                },
                downloadOrganizationList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/downloadOrganizationList",
                    isArray: false,
                    timeout: ENV.timeout
                }
            });
        }])
        .factory('Role', ['$resource', 'ENV', function ($resource, ENV) {
            return $resource('', '', {
                getRoleList: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/role/getRoleList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                downloadRoleList: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/role/exportRoleList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getJurisdictionsOfRole: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/role/getJurisdictionsOfRole",
                    isArray: false,
                    timeout: ENV.timeout
                },
                createRole: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/role/createRole",
                    isArray: false,
                    timeout: ENV.timeout
                },
                updateRole: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/role/updateRole",
                    isArray: false,
                    timeout: ENV.timeout
                },
                deleteRole: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/role/deleteRole",
                    isArray: false,
                    timeout: ENV.timeout
                },
                checkUser: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/role/checkUser",
                    isArray: false,
                    timeout: ENV.timeout
                }
            });
        }])
        .factory('User', ['$resource', 'ENV', function ($resource, ENV) {
            return $resource('', '', {
                getAllAccountRole: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/user/getRoleList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                checkUserNameDuplicate: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/user/checkUserName",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getOrganizationList: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/user/getOrganizationList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                createNewUser: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/user/createNewUser",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getUserList: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/user/getUserList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getUserInfoByKeyId: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/user/getUserInfoByKeyId",
                    isArray: false,
                    timeout: ENV.timeout
                },
                deleteUser: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/user/deleteUser",
                    isArray: false,
                    timeout: ENV.timeout
                },
                editUser: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/user/editUser",
                    isArray: false,
                    timeout: ENV.timeout
                },
                downloadUserList: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/user/downloadUserList",
                    isArray: false,
                    timeout: ENV.timeout
                }
            });
        }])
        .factory('Doctor', ['$resource', 'ENV', function ($resource, ENV) {
            return $resource('', '', {
                checkPhoneNumber: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/checkPhoneNumber",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getSexType: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/getSexType",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getDoctorTitle: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/getDoctorTitle",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getOrganizationList: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/selectOrganization",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getHospitalList: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/selectHospital",
                    isArray: false,
                    timeout: ENV.timeout
                },
                createDoctorAndUser: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/createDoctorAndUser",
                    isArray: false,
                    timeout: ENV.timeout
                },
                searchDoctorList: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/selectDoctor",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getDoctorInfoById: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/selectDoctorById",
                    isArray: false,
                    timeout: ENV.timeout
                },
                editDoctorInfo: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/updateDoctorMessage",
                    isArray: false,
                    timeout: ENV.timeout
                },
                downloadDoctorList: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/exportDoctorList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                searchSigningHomeList: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/selectSignedFamiliesData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                searchUnsigningHomeList: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/getfamilyStatusMsg",
                    isArray: false,
                    timeout: ENV.timeout
                },
                ensureSign: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/insertFamilyDoctorRel",
                    isArray: false,
                    timeout: ENV.timeout
                },
                changeSign: {
                    method: "POST",
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/updateFamilyDoctorRel",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getFamilyMemberById: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/getFamilyMember",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getDeptList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/getDeptList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                updateFamilyDoctorBatch: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/updateFamilyDoctorBatch",
                    isArray: false,
                    timeout: ENV.timeout
                },
                terminateBatch: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/doctor/terminateBatch",
                    isArray: false,
                    timeout: ENV.timeout
                }
            });
        }])
        .factory('FamilyArchives', ['$resource', 'ENV', function ($resource, ENV) {
            return $resource('', '', {
                getSignedDoctorList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/getSignedDoctorList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                showSignedFamily: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/showSignedFamily",
                    isArray: false,
                    timeout: ENV.timeout
                },
                showUnsignedFamily: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/showUnsignedFamily",
                    isArray: false,
                    timeout: ENV.timeout
                },
                exportSignedFamily: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/exportSignedFamily",
                    isArray: false,
                    timeout: ENV.timeout
                },
                exportUnsignedFamily: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/exportUnsignedFamily",
                    isArray: false,
                    timeout: ENV.timeout
                },
                searchFamilyDetail: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/searchFamilyDetail",
                    isArray: false,
                    timeout: ENV.timeout
                },
                searchSignFamilyMember: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/searchSignFamilyMember",
                    isArray: false,
                    timeout: ENV.timeout
                },
                searchResident: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/searchResident",
                    isArray: false,
                    timeout: ENV.timeout
                },
                searchSignDoctor: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/searchSignDoctor",
                    isArray: false,
                    timeout: ENV.timeout
                },
                addFamily: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/addFamily",
                    isArray: false,
                    timeout: ENV.timeout
                },
                editFamily: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/editFamily",
                    isArray: false,
                    timeout: ENV.timeout
                },
                searchFamilyMemberDetail: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/searchFamilyMemberDetail",
                    isArray: false,
                    timeout: ENV.timeout
                },
                addFamilyMember: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/addFamilyMember",
                    isArray: false,
                    timeout: ENV.timeout
                },
                editFamilyMember: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/editFamilyMember",
                    isArray: false,
                    timeout: ENV.timeout
                },
                deleteFamilyMember: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/deleteFamilyMember",
                    isArray: false,
                    timeout: ENV.timeout
                },
                setFamilyHolder: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/setFamilyHolder",
                    isArray: false,
                    timeout: ENV.timeout
                },
                searchSignDoctorDetail: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/searchSignDoctorDetail",
                    isArray: false,
                    timeout: ENV.timeout
                },
                addSignDoctor: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/addSignDoctor",
                    isArray: false,
                    timeout: ENV.timeout
                },
                editSignDoctor: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/editSignDoctor",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getSignedRecordList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/family/getSignedRecordList",
                    isArray: false,
                    timeout: ENV.timeout
                }
            });
        }])
        .factory('ResidentArchives', ['$resource', 'ENV', function ($resource, ENV) {
            return $resource('', '', {
                getResidentSexList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getResidentSexList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getDoctorListOrganizationConstraint: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getDoctorListOrganizationConstraint",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getResidentList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getResidentList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                exportResidentListExcel: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/exportResidentListExcel",
                    isArray: false,
                    timeout: ENV.timeout
                },
                checkIdNo: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/checkIdNo",
                    isArray: false,
                    timeout: ENV.timeout
                },
                createResident: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/createResident",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getResidentDetailInfo: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getResidentDetailInfo",
                    isArray: false,
                    timeout: ENV.timeout
                },
                editResidentInfo: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/editResidentInfo",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getSignedDoctor: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getSignedDoctor",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getResidentDiseaseFlag: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/user/getResidentDiseaseFlag",
                    isArray: false,
                    timeout: ENV.timeout
                },
                //查看居民中医体质辨识详情
                getResidentTCMConstitutionDetail: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getTCMConstitutionInfo",
                    isArray: false,
                    timeout: ENV.timeout
                },
                //查看居民中医体质辨识列表
                getResidentTCMConstitutionList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getResidentTCMConstitutionList",
                    isArray: false,
                    timeout: ENV.timeout
                }
            });
        }])
        .factory('PhysicalExamination', ['$resource', 'ENV', function ($resource, ENV) {
            return $resource('', '', {
                //根据居民ID查看体检记录列表
                getPhysicalExaminationListByResident: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getResidentPhysicalList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getDetail: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getPhysicalDetailInfo",
                    isArray: false,
                    timeout: ENV.timeout
                }
            });
        }])
        .factory('Diabetes', ['$resource', 'ENV', function ($resource, ENV) {
            return $resource('', '', {
                getDetailedArchives: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getDiabetesDetailedArchivesMsg",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getBloodGlucoseList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getDiabetesBloodGlucoseList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getBloodGlucoseCurveList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getDiabetesBloodGlucoseCurveList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getDetailById: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getDiabetesBloodGlucoseDetailById",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getFollowUpRecordList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getDiabetesFollowUpRecordList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getFollowUpRecordInfo: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getFollowUpTemplateByCode",
                    isArray: false,
                    timeout: ENV.timeout
                }
            });
        }])
        .factory('Hypertension', ['$resource', 'ENV', function ($resource, ENV) {
            return $resource('', '', {
                getDetailedArchives: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getDetailedArchivesMsg",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getBloodPressureList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getBloodPressureList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getBloodPressureMeasureType: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/doctorPlatform/common/getBloodPressureMeasureType",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getBloodPressureDetailById:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getBloodPressureDetailById",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getBloodPressureCurveList:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getBloodPressureCurveList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getFollowUpRecordList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getFollowUpRecordList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getFollowUpRecordInfo: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getFollowUpTemplateByCode",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getEvaluationRecordList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/getAssessRecordDisplay",
                    isArray: false,
                    timeout: ENV.timeout
                },
                searchEvaluationRecord: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/resident/searchBPAssessRecord",
                    isArray: false,
                    timeout: ENV.timeout
                }
            });
        }])
        .factory('HospitalDept', ['$resource', 'ENV', function ($resource, ENV) {
            return $resource('', '', {
                getProvinceList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getProvinceConstraint",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getCityListOfCertainProvince: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getCityConstraint",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getCountyListOfCertainCity: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getCountyConstraint",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getSubdistrictListOfCertainCounty: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getSubdistrictConstraint",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getHospitalNameList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/hospital/getHospitalNameList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getHospitalLevelList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/common/getSubdistrictListOfCertainCounty",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getHospitalList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/hospital/getHospitalList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getDeptList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/dept/getDeptList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                downloadHospitalList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/dept/deptExport",
                    isArray: false,
                    timeout: ENV.timeout
                },
                downloadDeptList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/dept/deptExport",
                    isArray: false,
                    timeout: ENV.timeout
                },
                addDept: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/dept/addDept",
                    isArray: false,
                    timeout: ENV.timeout
                },
                updateDept: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/dept/updateDept",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getDeptById: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/dept/displayDept",
                    isArray: false,
                    timeout: ENV.timeout
                }
            });
        }])
        .factory('Template', ['$resource', 'ENV', function ($resource, ENV) {
            return $resource('', '', {
                getTemplateList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/followUpTemplate/getFollowUpTemplateList",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getFollowUpTemplateById: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/followUpTemplate/getFollowUpTemplateById",
                    isArray: false,
                    timeout: ENV.timeout
                }
            });
        }])
        .factory('Report', ['$resource', 'ENV', function ($resource, ENV) {
            return $resource('', '', {
                getOrganizationLevel: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getOrganizationLevelListConstraint",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getOrganizationByLevel: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/organization/getCertainLevelOrganization",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getDoctorByOrganization: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getDoctorByOrganization",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getAllSignedData: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getAllSignedData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getOrganizationORDoctor: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getOrganizationORDoctor",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getMoreSignedData: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getMoreSignedData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getPageSignedData: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getPageSignedData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getAllFollowUpData:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getAllFollowUpData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getAllDiabetesData:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getAllDiabetesData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getGlucoseAndWarningData:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getGlucoseAndWarningData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getHBPGlucoseAndWarningData:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getHBPGlucoseAndWarningData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getPerMonthDiabetesData:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getPerMonthDiabetesData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getAllHypertensionData:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getAllHypertensionData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getSysDate:{
                    method: 'GET',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/getSysDate",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getPerMonthHypertensionData:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getPerMonthHypertensionData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getMoreGlucoseAndWarningData:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getMoreGlucoseAndWarningData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getMoreHBPGlucoseAndWarningData:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getMoreHBPGlucoseAndWarningData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getPageGlucoseAndWarningData:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getPageGlucoseAndWarningData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getPageHBPGlucoseAndWarningData:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getPageHBPGlucoseAndWarningData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getMoreODPDistributionData:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getMoreODPDistributionData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getMoreOHPDistributionData:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getMoreOHPDistributionData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getPageODPDistributionData:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getPageODPDistributionData",
                    isArray: false,
                    timeout: ENV.timeout
                },
                getPageOHPDistributionData:{
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/statisticsReport/getPageOHPDistributionData",
                    isArray: false,
                    timeout: ENV.timeout
                }
            });
        }])
        .factory('Fields', ['$resource', 'ENV', function ($resource, ENV) {
            return $resource('', '', {
                getFieldList: {
                    method: 'POST',
                    headers: {
                        "content-type": "application/json"
                    },
                    url: ENV.urlBase + "/signManagement/followUpTemplate/getFieldList",
                    isArray: false,
                    timeout: ENV.timeout
                }
            });
        }]);
})(window, window.angular);
(function (window, angular) {
    'use strict';
    angular.module('SMS.common', [])
        .factory('LocalStorage', function () {
            return {
                set: function (key, data) {
                    return window.localStorage.setItem(key, window.JSON.stringify(data));
                },
                get: function (key) {
                    return window.JSON.parse(window.localStorage.getItem(key));
                },
                remove: function (key) {
                    return window.localStorage.removeItem(key);
                }
            };
        })
        .factory('SessionStorage', function () {
            return {
                set: function (key, data) {
                    return window.sessionStorage.setItem(key, window.JSON.stringify(data));
                },
                get: function (key) {
                    return window.JSON.parse(window.sessionStorage.getItem(key));
                },
                remove: function (key) {
                    return window.sessionStorage.removeItem(key);
                }
            };
        })
        .factory('cacheService', ['$cacheFactory', function ($cacheFactory) {
            var cache = $cacheFactory('rootCache');
            return {
                put: function (key, value) {
                    return cache.put(key, value);
                },
                get: function (key) {
                    return cache.get(key);
                },
                remove: function (key) {
                    return cache.remove(key);
                },
                removeAll: function () {
                    return cache.removeAll();
                }
            }
        }])
        .factory('bootstrapTable', function () {
            return {
                initOption: function (params) {
                    var rootOption = {
                        dataFunction: function () {
                            return {
                                rows: [],
                                total: 0
                            }
                        },
                        columns: [{
                            field: 'NAME',
                            title: '默认数据',
                            sortable: true,
                            align: 'center'
                        }],
                        pagination: true, // 开启分页功能
                        search: false, // 关闭搜索功能
                        sidePagination: 'server',
                        pageSize: 10, // 设置默认分页为 10
                        pageList: [10, 20, 50],
                        dataField: 'rows',
                        minimumCountColumns: 1 // 设置最少显示列个数
                    };
                    return angular.extend(rootOption, params);
                }
            }
        })
        .factory('downloadCommon', ['ENV', function (ENV) {
            return {
                downloadFile: function (url, filename) {

                    function r(e, t, n) {
                        var r = function () {
                            n.apply(e, arguments)
                        };
                        if (e.addEventListener) {
                            e.addEventListener(t, r, false)
                        } else {
                            e.attachEvent("on" + t, r)
                        }
                        return r
                    }

                    function i(e, t) {
                        var n = arguments.length > 2 ? Array.prototype.slice.call(arguments, 1) : [];
                        var r;
                        for (var s = 0; s < n.length; s++) {
                            r = n[s];
                            for (var o in r) {
                                if (typeof r[o] === "object") {
                                    e[o] = i({}, r[o])
                                } else if (o != null && r.hasOwnProperty(o) && typeof r[o] !== "undefined") {
                                    e[o] = r[o]
                                }
                            }
                        }
                        return e
                    }

                    function s(t, n) {
                        var r = document.createElementNS("http://www.w3.org/1999/xhtml", "a");
                        r.download = t;
                        r.href = URL.createObjectURL(n);
                        var i = document.createEvent("MouseEvents");
                        i.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
                        r.dispatchEvent(i)
                    }

                    function o(e, t, n) {
                        var r;
                        t = t || "GET";
                        if (window.XMLHttpRequest) {
                            r = new XMLHttpRequest
                        } else {
                            r = new ActiveXObject("Microsoft.XMLHTTP")
                        }
                        r.open(t, e, true);
                        r.responseType = "blob";
                        r.onreadystatechange = function () {
                            if (r.readyState == r.DONE && n) {
                                n.call(r, r.response);
                            }
                        };
                        r.send();
                        return r
                    }

                    var t = {
                        url: "",
                        filename: "",
                        type: "GET",
                        progress: function () {
                        },
                        done: function () {
                        }
                    };
                    var FileDownloader = function (e) {
                        function h(e) {
                            var t = e.total;
                            var r = e.loaded;
                            var i = r / t;
                            var s = (new Date).getTime();
                            var o = (s - l) / 1e3;
                            var u = r - c;
                            var a = u / o;
                            c = r;
                            l = s;
                            e.per = i;
                            e.speed = a;
                            n.progress.call(f, e)
                        }

                        function p(e) {
                            var t = n.done();
                            if (typeof t === "boolean" && !t) return t;
                            s(a, e)
                        }

                        var n = i({}, t, e);
                        var u = n.url;
                        var a = n.filename;
                        var f = o(u, n.type, p);
                        var l = (new Date).getTime();
                        var c = 0;
                        r(f, "progress", h)
                    };

                    FileDownloader({
                        url: encodeURI(ENV.urlBase + url),
                        filename: filename
                    });
                }
            }
        }]);
})(window, window.angular);
(function (angular) {
    "use strict";
    var module = angular.module('SMS.directives', []);
    module
        .directive('rpwCheck', function () {
            return {
                require: "ngModel",
                link: function (scope, elem, attrs, ctrl) {
                    var otherInput = elem.inheritedData("$formController")[attrs['rpwCheck']];

                    ctrl.$parsers.push(function (value) {
                        ctrl.$setValidity("repeat", value === otherInput.$viewValue);
                        return value;
                    });

                    otherInput.$parsers.push(function (value) {
                        ctrl.$setValidity("repeat", value === ctrl.$viewValue);
                        return value;
                    });
                }
            };
        })
        .directive('idcardCheck', function () {
            return {
                require: "ngModel",
                link: function (scope, elem, attrs, ctrl) {
                    var customValidator = function (input) {
                        if (input === undefined || input === null || input === '') {//为空不做判断
                            ctrl.$setValidity('idCard', true);
                            ctrl.$setValidity('idCardAdress', true);
                            ctrl.$setValidity('idCardCheckCode', true);
                            return input;
                        }
                        var value = angular.copy(input);
                        var city = {11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "};
                        var validity = true;
                        if (!value || !/^[1-9]\d{5}((1[89]|20)\d{2})(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dx]$/i.test(value)) {
                            validity = false;
                            ctrl.$setValidity('idCard', false);
                        } else if (!city[value.substr(0, 2)]) {
                            validity = false;
                            ctrl.$setValidity('idCard', true);
                            ctrl.$setValidity('idCardAdress', false);
                        } else {
                            //18位身份证需要验证最后一位校验位
                            if (value.length === 18) {
                                value = value.split('');
                                //∑(ai×Wi)(mod 11)
                                //加权因子
                                var factor = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2, 1];
                                //校验位
                                var parity = ['1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2'];
                                var sum = 0;
                                var ai = 0;
                                var wi = 0;
                                for (var i = 0; i < 17; i++) {
                                    ai = value[i];
                                    wi = factor[i];
                                    sum += ai * wi;
                                }
                                var last = parity[sum % 11];
                                if (last !== value[17].toUpperCase()) {
                                    validity = false;
                                    ctrl.$setValidity('idCard', true);
                                    ctrl.$setValidity('idCardAdress', true);
                                    ctrl.$setValidity('idCardCheckCode', false);
                                } else {
                                    ctrl.$setValidity('idCard', true);
                                    ctrl.$setValidity('idCardAdress', true);
                                    ctrl.$setValidity('idCardCheckCode', true);
                                }
                            }
                        }
                        return validity ? input : undefined;
                    };
                    ctrl.$formatters.push(customValidator);
                    ctrl.$parsers.push(customValidator);
                }
            };
        })
        .directive('ngClear', function () {
            return {
                link: function (scope, elem, attrs) {
                    scope.$watch(
                        attrs['ngClear'],
                        function (newValue) {
                            var element = elem[0];
                            if (newValue) {
                                if (element['tagName'] === 'INPUT'){
                                    element['value'] = "";
                                    elem.triggerHandler('input');
                                } else if(element['tagName'] === 'MD-RADIO-GROUP'){
                                    scope[attrs.ngModel.split(".")[0]][attrs.ngModel.split(".")[1]] = undefined;
                                    elem.triggerHandler('change');
                                }
                            }
                        }
                    );
                }
            }
        })
        .directive('ngEnter', function () {
            return {
                restrict: 'A',
                require: '?ngModel',
                link: function (scope, elem, attrs) {
                    elem.bind("keydown keypress", function (event) {
                        if (event.which === 13) {
                            scope.$apply(function () {
                                scope.$eval(attrs['ngEnter']);
                            });
                            event.preventDefault();
                        }
                    });
                }
            }
        })
        .directive('eChart', function () {
            function link(scope, element, attrs) {
                var myChart = echarts.init(element[0]);
                scope.$watch(attrs['eData'], function () {
                    //监视e-data改变则刷新图表
                    var option = scope.$eval(attrs.eData);
                    if (angular.isObject(option)) {
                        //true改false则与上一图表数据合并
                        myChart.setOption(option, true);
                    }
                }, true);
                scope.getDom = function () {
                    return {
                        'height': element[0].offsetHeight,
                        'width': element[0].offsetWidth
                    };
                };
                scope.$watch(scope.getDom, function () {
                    // resize echarts图表
                    myChart.resize();
                }, true);
            }

            return {
                restrict: 'A',
                link: link
            };
        })
        .directive('textChange', ['$timeout',function ($timeout) {
            return {
                restrict: 'A',
                link: function (scope, elem, attrs) {
                    scope.$on('textChanged', function () {
                        $timeout(function () {
                            elem.triggerHandler('input');
                        });
                    });//可以通过$scope.$broadcast('textChanged');来触发textChanged事件
                    scope.$watch(attrs.ngModel, function () {
                        $timeout(function () {
                            elem.triggerHandler('input');
                        });
                    });
                }
            }
        }]);
}(angular));
(function (angular) {
    "use strict";
    var module = angular.module('SMS.filters', []);
    module.filter('age', [function () {
        return function (input) {
            var birth = +new Date(input);
            var now = +new Date();
            return ~~((now - birth) / 365 / 24 / 60 / 60 / 1000);
        };
    }]);

    module.filter('sex', [function () {
        return function (input) {
            if (input === 1 || input === '1') {
                return '男';
            }
            if (input === 0 || input === '0') {
                return '女';
            }
            return '未知';
        };
    }]);

    module.filter('isEmptyObject', [function () {
        return function (input) {
            for (var n in input) {
                return false
            }
            return true;
        };
    }]);

    module.filter('isEmptyArray', [function () {
        return function (input) {
            if(input === undefined
                || input === null
                || input.length === 0){
                return true;
            }
            return false;
        };
    }]);

    module.filter('selected', [function () {
        return function (input) {
            if (input === 1 || input === '1') {
                return true;
            }
            if (input === 0 || input === '0') {
                return false;
            }
            return false;
        };
    }]);

    module.filter('commonDate', ['$filter', function ($filter) {
        return function (input, str) {
            if (!str) {
                str = 'yyyy-MM-dd';
            }
            if (typeof input === 'string') {
                input = input.replace(/-/g, '\/');
            }
            var timestamp = +new Date(input);
            return $filter('date')(timestamp, str);
        };
    }]);

    module.filter('logMessage', [function () {
        var logMessageMap = {
            "login failed. reason: Bad credentials": "密码错误。",
            "login failed. reason: User account has expired": "用户账号过期。",
            "login failed. reason: User account is locked": "用户账号被锁。",
            "login failed. reason: User credentials have expired": "用户账号证书过期。",
            "This session has been expired (possibly due to multiple concurrent logins being attempted as the same user).": "登录过期，您的账号在其他地方登录",
            "access denied": "您没有权限，访问被拒绝。",
            "unauthorized": "您还没有登录，请登录后尝试访问！",
            "login success": "登录成功。",
            "logout success": "注销成功。",
            "invalid logout": "过期注销。",
            "login failed. reason: Username not found": "该用户不存在。",
            "login failed. reason: Authority not found": "用户基础数据获取异常。",
            "login failed. reason: Authorityfunc not found": "用户基础数据获取异常。",
            "login failed. reason: Bad code": "验证码错误。",
            "login failed. reason: System exception": "系统登录异常。",
            "login failed. reason: User not role": "该用户没有配置角色",
            "login failed. reason: role not authority": "该用户的角色没有配置权限。",
            "login failed. reason: role not menus": "该用户的角色没有配置菜单。"
        };
        return function (input) {
            return logMessageMap[input] || input;
        };
    }]);
}(angular));
(function () {
    var assetMap = {
        'img/icons/ic_euro_24px.svg': '<svg viewBox="0 0 24 24" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns"><g id="euro" sketch:type="MSLayerGroup" transform="translate(4.928571, 3.000000)"><path d="M13.3295171,13.848956 C12.7717614,14.1408877 11.5268981,14.5372503 10.3117026,14.5372503 C8.98732947,14.5372503 7.74127945,14.1408877 6.89515215,13.1855827 C6.49641614,12.7381914 6.20567113,12.1258468 6.0205437,11.3319349 L12.6685173,11.3319349 L12.6685173,9.45217947 L5.65147555,9.45217947 L5.65147555,9.02852246 C5.65147555,8.73659074 5.65147555,8.47432688 5.67639655,8.20731616 L12.669704,8.20731616 L12.669704,6.32756069 L6.07513256,6.32756069 C6.26263342,5.63926639 6.52371057,5.03048195 6.92363329,4.60682495 C7.74246616,3.62541221 8.91019304,3.17564749 10.1550564,3.17564749 C11.3168497,3.17564749 12.4311744,3.52098135 13.1194687,3.81172636 L13.8587917,0.793911872 C12.9046734,0.371441579 11.4770561,0 9.88685892,0 C7.3722113,0 5.25273954,1.00514702 3.77172009,2.7282562 C2.92559278,3.68118779 2.2634062,4.89994338 1.94418005,6.32874741 L0.168855444,6.32874741 L0.168855444,8.20731616 L1.65343504,8.20731616 C1.65343504,8.47432688 1.62614062,8.73777745 1.62614062,9.00241475 L1.62614062,9.45217947 L0.168855444,9.45217947 L0.168855444,11.3331216 L1.89196462,11.3331216 C2.1304942,12.7393781 2.65858206,13.8750637 3.37417079,14.7745931 C4.85875039,16.7338585 7.21319158,17.7935943 9.83345677,17.7935943 C11.5292715,17.7935943 13.0660666,17.2904275 13.965596,16.789634 L13.3295171,13.848956 L13.3295171,13.848956 Z" id="Shape" sketch:type="MSShapeGroup"></path></g></svg>',
        'img/icons/ic_card_giftcard_24px.svg': '<svg viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',
        'img/icons/addShoppingCart.svg': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g id="addShoppingCart"><g id="add-shopping-cart"><path d="M11 9h2V6h3V4h-3V1h-2v3H8v2h3v3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zm-9.83-3.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.86-7.01L19.42 4h-.01l-1.1 2-2.76 5H8.53l-.13-.27L6.16 6l-.95-2-.94-2H1v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.13 0-.25-.11-.25-.25z"/></g></svg>',
        'img/icons/android.svg': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g id="android"><path d="M6 18c0 .55.45 1 1 1h1v3.5c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5V19h2v3.5c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5V19h1c.55 0 1-.45 1-1V8H6v10zM3.5 8C2.67 8 2 8.67 2 9.5v7c0 .83.67 1.5 1.5 1.5S5 17.33 5 16.5v-7C5 8.67 4.33 8 3.5 8zm17 0c-.83 0-1.5.67-1.5 1.5v7c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5v-7c0-.83-.67-1.5-1.5-1.5zm-4.97-5.84l1.3-1.3c.2-.2.2-.51 0-.71-.2-.2-.51-.2-.71 0l-1.48 1.48C13.85 1.23 12.95 1 12 1c-.96 0-1.86.23-2.66.63L7.85.15c-.2-.2-.51-.2-.71 0-.2.2-.2.51 0 .71l1.31 1.31C6.97 3.26 6 5.01 6 7h12c0-1.99-.97-3.75-2.47-4.84zM10 5H9V4h1v1zm5 0h-1V4h1v1z"/></g></svg>',
        'img/icons/angular-logo.svg': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="-10 -10 120 120"> <defs> <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%"> <feOffset result="offOut" in="SourceAlpha" dx="0" dy="0"></feOffset> <feGaussianBlur result="blurOut" in="offOut" stdDeviation="3"></feGaussianBlur> <feComponentTransfer in="blurOut" result="opacityOut"> <feFuncA type="linear" slope="0.5"></feFuncA> </feComponentTransfer> <feBlend in="SourceGraphic" in2="opacityOut" mode="normal"></feBlend> </filter> </defs> <path d=" M 5 18.25 L 50 2.25 L 96 18 L 88.5 77 L 50 98.25 L 12 77.25 Z" fill="black" filter="url(#shadow)" class="outline"></path> <path d=" M 5 18.25 L 50 2.25 L 50 98.25 L 12 77.25 Z" fill="#de3641" class="left"></path> <path d=" M 50 2.25 L 96 18 L 88.5 77 L 50 98.25 Z" fill="#b13138" class="right"></path> <path d=" M 50 13 L 79.25 75.5 L 69.25 75.5 L 63 61.25 L 50 61.25 L 50 52.75 L 59.5 52.75 L 50 33.1 L 42 52.75 L 50 52.75 L 50 61.25 L 38.1 61.25 L 32.5 75.5 L 21.75 75.5 Z" fill="white" class="letter"></path></svg>',
        'img/icons/bower-logo.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="512px" height="512px" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><g> <g id="leaf"> <path fill="#00ACEE" d="M434.625,63.496c-67.822,0-118.399,71.68-95.018,123.167C435.596,186.664,396.518,98.058,434.625,63.496z" /> </g> <path id="body" fill="#FFCC2F" d="M456.534,256.992c0-22.79-108.627-34.129-169.139-37.663 c-60.511-3.533-281.592,38.389-255.42,93.813c26.173,55.426,92.581,114.358,167.313,114.358c38.716,0,83.584-27.284,86.053-77.38 C330.121,335.163,456.534,334.371,456.534,256.992z"/> <path id="wing_tip" fill="#2BAF2B" d="M400.981,272.143c7.02,7.104-15.222,26.295-34.606,17.262 c8.731,19.688-29.676,36.064-48.336,22.026c1.998,15.865-36.122,24.996-48.285,7.292c3.136,8.441,5.757,14.898,8.229,20.209 c-0.029-0.09-0.046-0.149-0.046-0.149c6.324,8.279,14.929,14.939,52.394,14.939c57.727,0,150.97-43.849,150.97-76.039 c0-26.643-9.992-29.14-27.196-27.198c-17.208,1.942-107.17,11.291-126.306,7.534C338.182,260.229,390.54,270.259,400.981,272.143z" /> <path id="head" fill="#EF5734" d="M198.51,48.82c-110.382,0-221.179,109.721-168.451,261.056 c35.817,21.53,83.576,12.995,94.278,1.532c16.178,5.171,30.612,7.347,43.513,7.347c67.047,0,124.34-71.235,124.34-160.257 C292.189,67.196,231.93,48.82,198.51,48.82z"/> <path id="eye_rim" fill="#FFCC2F" d="M153.308,146.522c0,24.632,19.969,44.603,44.603,44.603c24.633,0,44.603-19.971,44.603-44.603 c0-24.633-19.97-44.603-44.603-44.603C173.277,101.92,153.308,121.89,153.308,146.522z"/> <path id="eye" fill="#543729" d="M171.207,146.522c0,14.747,11.956,26.704,26.704,26.704c14.748,0,26.703-11.957,26.703-26.704 c0-14.748-11.955-26.704-26.703-26.704C183.163,119.819,171.207,131.774,171.207,146.522z"/> <ellipse id="pupil_highlight" fill="#FFFFFF" cx="197.91" cy="134.674" rx="15.56" ry="9.675"/> <path id="beak" fill="#CECECE" d="M289.401,123.675c-20.275,11.807-19.604,50.03-10.595,68.681 c17.445-6.466,41.752-19.291,45.527-21.585c3.773-2.293-2.088-10.989,12.559-10.989c20.315,0,38.684,6.348,43.956,8.634 C377.511,161.547,335.758,123.675,289.401,123.675z"/> <path id="outline" fill="#543729" d="M502.214,250.797c-26.335-25.305-158.017-41.1-199.568-45.698 c2.014-4.754,3.726-9.669,5.142-14.731c5.665-2.481,11.776-4.789,18.101-6.716c0.77,2.272,4.397,10.98,6.465,15.112 c83.553,2.305,87.844-62.09,91.24-79.732c3.323-17.25,3.154-33.917,31.812-64.388C412.709,42.201,351.31,73.928,330.742,121.15 c-7.728-2.896-15.474-5.035-23.136-6.357c-5.488-22.146-34.077-83.845-109.097-83.845c-48.585,0-97.581,20.063-134.421,55.045 c-19.852,18.85-35.445,41.234-46.344,66.53C5.97,179.851,0,209.94,0,241.957C0,353.462,76.126,451.18,119.139,451.18 c18.784,0,34.943-14.067,38.736-26.675c3.181,8.645,12.938,35.522,16.142,42.364c4.737,10.117,26.642,18.872,36.229,8.373 c12.326,6.849,34.943,10.973,47.27-7.289c23.739,5.022,44.728-9.135,45.184-26.026c11.649-0.622,17.363-16.978,14.819-30.001 c-1.875-9.591-21.904-44-29.719-55.877c15.468,12.58,54.644,16.142,59.401,0.008c24.936,19.571,63.797,9.301,66.879-6.619 c30.301,7.874,65.054-9.417,59.348-30.359C522.102,315.711,515.872,263.921,502.214,250.797z M375.456,164.958 c-12.821-5.033-29.084-8.217-40.482-8.217c-16.164,0-26.009,9.16-41.218,9.16c-3.193,0-10.812,0.016-16.926-2.162 c4.021,4.217,9.025,6.505,18.725,6.505c5.793,0,17.263-2.958,26.553-5.752c0.129,1.956,0.334,3.898,0.61,5.826 c-17.402,4.161-35.664,15.231-40.949,18.105c-11.755-25.958-1.65-50.505,7.697-61.837 C331.331,126.686,365.144,155.433,375.456,164.958z M393.557,163.001l-6.406-5.979c-6.575-6.159-13.43-11.731-20.469-16.678 c10.483-20.801,23.658-43.514,40.298-57.565c-18.314,7.381-36.397,29.445-47.089,53.03c-5.448-3.464-10.98-6.554-16.561-9.255 c14.913-31.834,49.568-58.42,87.762-60.497C405.509,89.257,415.114,135.563,393.557,163.001z M341.006,184.7 c-2.821-6.114-5.677-16.27-5.328-22.239c4.753-0.112,13.868,1.67,15.335,2.016c-0.557,2.803-0.855,8.944-0.866,9.739 c0.903-1.556,3.41-6.922,4.43-9.029c9.127,1.744,21.126,4.659,28.161,7.938C374.478,178.473,360.439,184.293,341.006,184.7z M283.971,112.911c-33.381,33.832-20.199,76.63-8.046,95.976c-17.29,28.761-51.28,48.437-90.765,57.389 c44.328,0,70.397-11.409,85.563-22.586c9.677-7.131,14.928-14.17,17.608-18.088c65.72,4.251,169.783,25.423,179.935,32.281 c4.074,2.753,8.278,8.842,8.895,14.668c-49.387-6.914-138.407-14.188-161.719-15.424c16.549,2.347,137.241,25.202,158.163,30.552 c-6.368,10.384-20.872,17.715-42.733,12.621c11.812,16.093-11.125,35.399-43.071,24.766c7.032,15.799-21.413,30.021-53.741,13.555 c0.411,15.805-40.105,17.626-56.123,0.162c0.306,2.082,2.207,6.066,3.028,7.809c-5.162,46.15-42.961,74.783-81.677,74.783 c-94.794,0-177.375-76.989-177.375-179.417c0-108.292,80.03-189.096,176.597-189.096 C253.842,52.861,278.836,96.412,283.971,112.911z"/></g></svg>',
        'img/icons/cake.svg': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g id="cake"><path d="M12 6c1.11 0 2-.9 2-2 0-.38-.1-.73-.29-1.03L12 0l-1.71 2.97c-.19.3-.29.65-.29 1.03 0 1.1.9 2 2 2zm4.6 9.99l-1.07-1.07-1.08 1.07c-1.3 1.3-3.58 1.31-4.89 0l-1.07-1.07-1.09 1.07C6.75 16.64 5.88 17 4.96 17c-.73 0-1.4-.23-1.96-.61V21c0 .55.45 1 1 1h16c.55 0 1-.45 1-1v-4.61c-.56.38-1.23.61-1.96.61-.92 0-1.79-.36-2.44-1.01zM18 9h-5V7h-2v2H6c-1.66 0-3 1.34-3 3v1.54c0 1.08.88 1.96 1.96 1.96.52 0 1.02-.2 1.38-.57l2.14-2.13 2.13 2.13c.74.74 2.03.74 2.77 0l2.14-2.13 2.13 2.13c.37.37.86.57 1.38.57 1.08 0 1.96-.88 1.96-1.96V12C21 10.34 19.66 9 18 9z"/></g></svg>',
        'img/icons/codepen-logo.svg': '<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500"><path d="M250 0C111.928 0 0 111.927 0 250c0 138.077 111.927 250 250 250 138.073 0 250-111.923 250-250C500 111.928 388.073 0 250 0zm0 458.943C134.79 458.943 41.06 365.21 41.06 250c0-115.207 93.73-208.94 208.94-208.94S458.94 134.793 458.94 250c0 115.21-93.73 208.943-208.94 208.943z"/><path d="M404.462 201.172c-.028-.195-.076-.382-.11-.577-.064-.374-.134-.748-.23-1.114-.058-.22-.14-.43-.207-.64-.106-.327-.212-.652-.342-.97-.09-.22-.196-.438-.297-.65-.14-.3-.285-.593-.452-.877-.122-.212-.25-.416-.377-.618-.18-.277-.362-.546-.562-.806-.146-.195-.3-.39-.454-.578-.21-.243-.43-.487-.663-.716-.174-.178-.346-.357-.528-.52-.245-.22-.497-.432-.753-.634-.198-.155-.395-.31-.602-.456-.078-.05-.146-.114-.22-.163L257.37 97.656c-4.465-2.976-10.275-2.976-14.74 0l-141.294 94.196c-.073.05-.142.114-.22.163-.207.146-.402.3-.597.456-.26.204-.513.416-.753.634-.187.164-.357.342-.533.52-.23.23-.45.474-.658.717-.16.19-.313.384-.46.578-.194.26-.382.53-.556.806-.134.203-.26.406-.382.618-.163.284-.31.577-.45.877-.103.21-.21.43-.298.65-.13.317-.236.642-.34.968-.07.21-.147.422-.21.642-.096.366-.16.74-.23 1.114-.032.195-.08.382-.106.577-.077.57-.122 1.147-.122 1.733V297.1c0 .585.044 1.162.122 1.74.025.188.074.382.106.568.07.374.134.748.23 1.114.063.22.14.432.21.643.104.324.21.65.34.975.09.222.195.433.297.645.143.3.29.592.45.885.123.204.25.406.383.61.174.276.362.545.557.806.146.203.3.39.46.577.207.243.426.488.657.716.175.177.346.356.533.52.24.22.492.43.752.634.194.155.39.31.597.454.077.05.146.115.22.163L242.63 402.35c2.232 1.487 4.803 2.236 7.372 2.236 2.566 0 5.135-.75 7.368-2.236l141.295-94.197c.074-.047.142-.112.22-.162.207-.145.403-.3.602-.454.256-.203.508-.414.752-.635.182-.163.353-.343.527-.52.232-.23.452-.474.664-.717.155-.187.31-.374.455-.577.2-.26.383-.53.562-.806.126-.204.255-.406.377-.61.167-.293.312-.585.452-.885.1-.212.206-.423.297-.645.13-.324.235-.65.342-.975.068-.21.15-.423.206-.643.1-.366.168-.74.233-1.114.033-.187.08-.38.11-.568.072-.578.118-1.155.118-1.74v-94.197c0-.585-.045-1.162-.118-1.73zm-141.176-67.64l104.088 69.388-46.493 31.103-57.594-38.527v-61.963zm-26.57 0v61.964l-57.593 38.527-46.497-31.103 104.09-69.387zm-114.726 94.24L155.228 250l-33.238 22.233V227.77zm114.725 138.7l-104.088-69.39 46.497-31.093 57.592 38.52v61.96zM250 281.43L203.014 250 250 218.574l46.986 31.428L250 281.432zm13.286 85.04v-61.963l57.595-38.52 46.494 31.093-104.088 69.388zm114.724-94.238L344.777 250l33.233-22.23v44.464z"/></svg>',
        'img/icons/copy.svg': '<svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g><g><rect fill="none" width="24" height="24"/><path fill="#7d7d7d" d="M16,1H4C2.9,1,2,1.9,2,3v14h2V3h12V1z M19,5H8C6.9,5,6,5.9,6,7v14c0,1.1,0.9,2,2,2h11c1.1,0,2-0.9,2-2V7C21,5.9,20.1,5,19,5z M19,21H8V7h11V21z"/></g></g></svg>',
        'img/icons/copy2.svg': '<svg version="1.1" x="0px" y="0px" width="48px" height="48px" viewBox="0 0 48 48" enable-background="new 0 0 48 48" xml:space="preserve"><g><g><rect fill="none" width="48" height="48"/><path fill="#7d7d7d" d="M32,2H8C5.8,2,4,3.8,4,6v28h4V6h24V2z M38,10H16c-2.2,0-4,1.8-4,4v28c0,2.2,1.8,4,4,4h22c2.2,0,4-1.8,4-4V14C42,11.8,40.2,10,38,10z M38,42H16V14h22V42z"/></g></g></svg>',
        'img/icons/facebook.svg': '<svg version="1.1" x="0px" y="0px" width="48px" height="48px" viewBox="0 0 48 48" enable-background="new 0 0 48 48" xml:space="preserve"><g><g><g><path fill="#7d7d7d" d="M40,4H8C5.8,4,4,5.8,4,8l0,32c0,2.2,1.8,4,4,4h32c2.2,0,4-1.8,4-4V8C44,5.8,42.2,4,40,4z M38,8v6h-4c-1.1,0-2,0.9-2,2v4h6v6h-6v14h-6V26h-4v-6h4v-5c0-3.9,3.1-7,7-7H38z"/></g><g><rect fill="none" width="48" height="48"/></g></g></g></svg>',
        'img/icons/favorite.svg': '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"> <path d="M0 0h24v24h-24z" fill="none"/> <path d="M12 21.35l-1.45-1.32c-5.15-4.67-8.55-7.75-8.55-11.53 0-3.08 2.42-5.5 5.5-5.5 1.74 0 3.41.81 4.5 2.09 1.09-1.28 2.76-2.09 4.5-2.09 3.08 0 5.5 2.42 5.5 5.5 0 3.78-3.4 6.86-8.55 11.54l-1.45 1.31z"/></svg>',
        'img/icons/github-icon.svg': '<svg height="1024" width="1024" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"> <path d="M512 0C229.252 0 0 229.25199999999995 0 512c0 226.251 146.688 418.126 350.155 485.813 25.593 4.686 34.937-11.125 34.937-24.626 0-12.188-0.469-52.562-0.718-95.314-128.708 23.46-161.707-31.541-172.469-60.373-5.525-14.809-30.407-60.249-52.398-72.263-17.988-9.828-43.26-33.237-0.917-33.735 40.434-0.476 69.348 37.308 78.471 52.75 45.938 77.749 119.876 55.627 148.999 42.5 4.654-32.999 17.902-55.627 32.501-68.373-113.657-12.939-233.22-56.875-233.22-253.063 0-55.94 19.968-101.561 52.658-137.404-5.22-12.999-22.844-65.095 5.063-135.563 0 0 42.937-13.749 140.811 52.501 40.811-11.406 84.594-17.031 128.124-17.22 43.499 0.188 87.314 5.874 128.188 17.28 97.689-66.311 140.686-52.501 140.686-52.501 28 70.532 10.375 122.564 5.124 135.499 32.811 35.844 52.626 81.468 52.626 137.404 0 196.686-119.751 240-233.813 252.686 18.439 15.876 34.748 47.001 34.748 94.748 0 68.437-0.686 123.627-0.686 140.501 0 13.625 9.312 29.561 35.25 24.562C877.436 929.998 1024 738.126 1024 512 1024 229.25199999999995 794.748 0 512 0z" /></svg>',
        'img/icons/github.svg': '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="8 11 33 28"><path fill="#333" d="M11.828,18.179c0,0-3.344,3.499-2.763,9.192 c0.581,5.694,4.186,10.392,16.208,10.392c12.021,0,15.045-6.275,15.116-11.436c0.071-5.159-2.253-7.46-3.344-8.243 c0,0,0.007-3.704-0.343-5.661c0,0-1.85-0.219-5.845,2.07c0,0-5.454-0.533-12.722,0.065c0,0-3.053-2.04-6.129-2.574 C12.006,11.984,11.496,15.196,11.828,18.179z"/><path fill="#E2B89F" d="M17.211,23.815h14.916c0,0,4.227-0.475,4.227,6.44 c0.034,6.086-11.139,5.693-11.139,5.693s-12.236,0.486-12.243-6.269C12.956,23.579,17.211,23.815,17.211,23.815z"/><g> <g> <path fill="#9C584F" d="M30.767,26.591c0.959,0,1.737,1.25,1.737,2.787 c0,1.54-0.778,2.788-1.737,2.788c-0.958,0-1.736-1.248-1.736-2.788C29.03,27.841,29.809,26.591,30.767,26.591z"/> <path fill="#FFFFFF" d="M30.767,32.666c-1.254,0-2.236-1.444-2.236-3.288c0-1.843,0.982-3.287,2.236-3.287 c1.255,0,2.237,1.444,2.237,3.287C33.004,31.222,32.021,32.666,30.767,32.666z M30.767,27.091c-0.585,0-1.236,0.939-1.236,2.287 c0,1.349,0.651,2.288,1.236,2.288s1.237-0.939,1.237-2.288C32.004,28.03,31.352,27.091,30.767,27.091z"/> </g></g><g> <g> <path fill="#9C584F" d="M18.767,26.591c0.959,0,1.737,1.25,1.737,2.787 c0,1.54-0.778,2.788-1.737,2.788c-0.958,0-1.736-1.248-1.736-2.788C17.03,27.841,17.809,26.591,18.767,26.591z"/> <path fill="#FFFFFF" d="M18.767,32.666c-1.254,0-2.236-1.444-2.236-3.288c0-1.843,0.982-3.287,2.236-3.287 c1.254,0,2.237,1.444,2.237,3.287C21.004,31.222,20.021,32.666,18.767,32.666z M18.767,27.091c-0.585,0-1.236,0.939-1.236,2.287 c0,1.349,0.651,2.288,1.236,2.288c0.585,0,1.237-0.939,1.237-2.288C20.004,28.03,19.352,27.091,18.767,27.091z"/> </g></g><path fill="#9C584F" d="M24.076,32.705c0,0,0.499-1.418,1.109-0.089 c0,0-0.457,0.297-0.285,0.996l1.428,0.546h-3.23l1.28-0.575C24.378,33.583,24.562,32.527,24.076,32.705z"/></svg>',
        'img/icons/hangout.svg': '<svg version="1.1" x="0px" y="0px" width="48px" height="48px" viewBox="0 0 48 48" enable-background="new 0 0 48 48" xml:space="preserve"><g><g><path fill="#159F5C" d="M23,4C13.6,4,6,11.6,6,21s7.6,17,17,17h1v7c9.7-4.7,16-15,16-24C40,11.6,32.4,4,23,4z M22,22l-2,4h-3l2-4h-3v-6h6V22zM30,22l-2,4h-3l2-4h-3v-6h6V22z"/><rect x="0" fill="none" width="48" height="48"/></g></g></svg>',
        'img/icons/ic_access_time_24px.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 17.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g id="Header"> <g> <rect x="-618" y="-440" fill="none" width="1400" height="3600"/> </g></g><g id="Labels"></g><g id="Icon"> <g> <g> <path fill-opacity="0.9" d="M12,2C6.5,2,2,6.5,2,12s4.5,10,10,10c5.5,0,10-4.5,10-10S17.5,2,12,2z M12,20c-4.4,0-8-3.6-8-8 s3.6-8,8-8c4.4,0,8,3.6,8,8S16.4,20,12,20z"/> </g> <rect fill="none" width="24" height="24"/> <polygon fill-opacity="0.9" points="12.5,7 11,7 11,13 16.2,16.2 17,14.9 12.5,12.2 "/> </g></g><g id="Grid" display="none"> <g display="inline"> </g></g></svg>',
        'img/icons/ic_arrow_back_24px.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 17.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g id="Header"> <g> <rect x="-618" y="-568" fill="none" width="1400" height="3600"/> </g></g><g id="Label"></g><g id="Icon"> <g> <rect fill="none" width="24" height="24"/> <path d="M20,11H7.8l5.6-5.6L12,4l-8,8l8,8l1.4-1.4L7.8,13H20V11z"/> </g></g><g id="Grid" display="none"> <g display="inline"> </g></g></svg>',
        'img/icons/ic_build_24px.svg': '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"> <path fill-rule="evenodd" clip-rule="evenodd" fill="none" d="M0 0h24v24H0z"/> <path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>',
        'img/icons/ic_chevron_right_24px.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 17.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g id="Header"> <g> <rect x="-618" y="-1336" fill="none" width="1400" height="3600"/> </g></g><g id="Label"></g><g id="Icon"> <g> <polygon points="10,6 8.6,7.4 13.2,12 8.6,16.6 10,18 16,12 "/> <rect fill="none" width="24" height="24"/> </g></g><g id="Grid" display="none"> <g display="inline"> </g></g></svg>',
        'img/icons/ic_close_24px.svg': '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>',
        'img/icons/ic_code_24px.svg': '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"> <path fill="none" d="M0 0h24v24H0V0z"/> <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg>',
        'img/icons/ic_comment_24px.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 17.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g id="Header"> <g> <rect x="-618" y="-1464" fill="none" width="1400" height="3600"/> </g></g><g id="Labels"></g><g id="Icon"> <g> <path d="M22,4c0-1.1-0.9-2-2-2H4C2.9,2,2,2.9,2,4v12c0,1.1,0.9,2,2,2h14l4,4L22,4z M18,14H6v-2h12V14z M18,11H6V9h12V11z M18,8H6 V6h12V8z"/> <rect x="0" fill="none" width="24" height="24"/> </g></g><g id="Grid" display="none"> <g display="inline"> </g></g></svg>',
        'img/icons/ic_email_24px.svg': '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"> <path d="M20 4h-16c-1.1 0-1.99.9-1.99 2l-.01 12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-12c0-1.1-.9-2-2-2zm0 4l-8 5-8-5v-2l8 5 8-5v2z"/> <path d="M0 0h24v24h-24z" fill="none"/></svg>',
        'img/icons/ic_insert_drive_file_24px.svg': '<svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24"><g> <path d="M6,2C4.9,2,4,2.9,4,4l0,16c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2V8l-6-6H6z M13,9V3.5L18.5,9H13z"/></g></svg>',
        'img/icons/ic_label_24px.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 17.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g id="Header"> <g> <rect x="-618" y="-568" fill="none" width="1400" height="3600"/> </g></g><g id="Label"></g><g id="Icon"> <g> <rect fill="none" width="24" height="24"/> <path d="M17.6,5.8C17.3,5.3,16.7,5,16,5L5,5C3.9,5,3,5.9,3,7v10c0,1.1,0.9,2,2,2l11,0c0.7,0,1.3-0.3,1.6-0.8L22,12L17.6,5.8z"/> </g></g><g id="Grid" display="none"> <g display="inline"> </g></g></svg>',
        'img/icons/ic_launch_24px.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 17.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g id="Header"> <g> <rect x="-618" y="-824" fill="none" width="1400" height="3600"/> </g></g><g id="Label"></g><g id="Icon"> <g> <rect fill="none" width="24" height="24"/> <path d="M19,19H5V5h7V3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2v-7h-2V19z M14,3v2h3.6l-9.8,9.8l1.4,1.4L19,6.4 V10h2V3H14z" /> </g></g><g id="Grid" display="none"> <g display="inline"> </g></g></svg>',
        'img/icons/ic_menu_24px.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 17.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g id="Header"> <g> <rect x="-618" y="-2232" fill="none" width="1400" height="3600"/> </g></g><g id="Label"></g><g id="Icon"> <g> <rect fill="none" width="24" height="24"/> <path d="M3,18h18v-2H3V18z M3,13h18v-2H3V13z M3,6v2h18V6H3z"/> </g></g><g id="Grid" display="none"> <g display="inline"> </g></g></svg>',
        'img/icons/ic_more_vert_24px.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 17.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g id="Header"> <g> <rect x="-618" y="-2488" fill="none" width="1400" height="3600"/> </g></g><g id="Label"></g><g id="Icon"> <g> <rect fill="none" width="24" height="24"/> <path d="M12,8c1.1,0,2-0.9,2-2s-0.9-2-2-2c-1.1,0-2,0.9-2,2S10.9,8,12,8z M12,10c-1.1,0-2,0.9-2,2s0.9,2,2,2c1.1,0,2-0.9,2-2 S13.1,10,12,10z M12,16c-1.1,0-2,0.9-2,2s0.9,2,2,2c1.1,0,2-0.9,2-2S13.1,16,12,16z"/> </g></g><g id="Grid" display="none"> <g display="inline"> </g></g></svg>',
        'img/icons/ic_ondemand_video_24px.svg': '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"> <path fill="none" d="M0 0h24v24H0V0z"/> <path d="M21 3H3c-1.11 0-2 .89-2 2v12c0 1.1.89 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.11-.9-2-2-2zm0 14H3V5h18v12zm-5-6l-7 4V7z"/></svg>',
        'img/icons/ic_people_24px.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 17.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g id="Header"> <g> <rect x="-618" y="-2616" fill="none" width="1400" height="3600"/> </g></g><g id="Label"></g><g id="Icon"> <g> <g> <rect fill="none" width="24" height="24"/> </g> <path d="M16,11c1.7,0,3-1.3,3-3c0-1.7-1.3-3-3-3c-1.7,0-3,1.3-3,3C13,9.7,14.3,11,16,11z M8,11c1.7,0,3-1.3,3-3c0-1.7-1.3-3-3-3 C6.3,5,5,6.3,5,8C5,9.7,6.3,11,8,11z M8,13c-2.3,0-7,1.2-7,3.5V19h14v-2.5C15,14.2,10.3,13,8,13z M16,13c-0.3,0-0.6,0-1,0.1 c1.2,0.8,2,2,2,3.4V19h6v-2.5C23,14.2,18.3,13,16,13z"/> </g></g><g id="Grid" display="none"> <g display="inline"> </g></g></svg>',
        'img/icons/ic_person_24px.svg': '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"> <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/> <path d="M0 0h24v24h-24z" fill="none"/></svg>',
        'img/icons/ic_phone_24px.svg': '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"> <path d="M0 0h24v24h-24z" fill="none"/> <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1v3.49c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>',
        'img/icons/ic_photo_24px.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 17.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g id="Header"> <g> <rect x="-618" y="-2616" fill="none" width="1400" height="3600"/> </g></g><g id="Label"></g><g id="Icon"> <g> <rect x="0" fill="none" width="24" height="24"/> <path d="M21,19V5c0-1.1-0.9-2-2-2H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14C20.1,21,21,20.1,21,19z M8.5,13.5l2.5,3l3.5-4.5l4.5,6 H5L8.5,13.5z"/> </g></g><g id="Grid" display="none"> <g display="inline"> </g></g></svg>',
        'img/icons/ic_place_24px.svg': '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"> <path d="M12 2c-3.87 0-7 3.13-7 7 0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/> <path d="M0 0h24v24h-24z" fill="none"/></svg>',
        'img/icons/ic_play_arrow_24px.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 17.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g id="Header"> <g> <rect x="-618" y="-2232" fill="none" width="1400" height="3600"/> </g></g><g id="Label"></g><g id="Icon"> <g> <polygon points="8,5 8,19 19,12 " style="fill:#f3f3f3;" /> <rect fill="none" width="24" height="24"/> </g></g><g id="Grid" display="none"> <g display="inline"> </g></g></svg>',
        'img/icons/ic_play_circle_fill_24px.svg': '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"> <path d="M0 0h24v24H0z" fill="none"/> <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/></svg>',
        'img/icons/ic_refresh_24px.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 17.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g id="Header"> <g> <rect x="-618" y="-2616" fill="none" width="1400" height="3600"/> </g></g><g id="Label"></g><g id="Icon"> <g> <path d="M17.6,6.4C16.2,4.9,14.2,4,12,4c-4.4,0-8,3.6-8,8s3.6,8,8,8c3.7,0,6.8-2.6,7.7-6h-2.1c-0.8,2.3-3,4-5.6,4 c-3.3,0-6-2.7-6-6s2.7-6,6-6c1.7,0,3.1,0.7,4.2,1.8L13,11h7V4L17.6,6.4z"/> <rect fill="none" width="24" height="24"/> </g></g><g id="Grid" display="none"> <g display="inline"> </g></g></svg>',
        'img/icons/ic_school_24px.svg': '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"> <path d="M0 0h24v24H0z" fill="none"/> <path d="M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82zM12 3L1 9l11 6 9-4.91V17h2V9L12 3z"/></svg>',
        'img/icons/ic_visibility_24px.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 17.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g id="Header"> <g> <rect x="-618" y="-1592" fill="none" width="1400" height="3600"/> </g></g><g id="Label"></g><g id="Icon"> <g> <rect fill="none" width="24" height="24"/> <path d="M12,4.5C7,4.5,2.7,7.6,1,12c1.7,4.4,6,7.5,11,7.5c5,0,9.3-3.1,11-7.5C21.3,7.6,17,4.5,12,4.5z M12,17c-2.8,0-5-2.2-5-5 s2.2-5,5-5c2.8,0,5,2.2,5,5S14.8,17,12,17z M12,9c-1.7,0-3,1.3-3,3s1.3,3,3,3c1.7,0,3-1.3,3-3S13.7,9,12,9z"/> </g></g><g id="Grid" display="none"> <g display="inline"> </g></g></svg>',
        'img/icons/launch.svg': '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"> <path d="M0 0h24v24h-24z" fill="none"/> <path d="M19 19h-14v-14h7v-2h-7c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zm-5-16v2h3.59l-9.83 9.83 1.41 1.41 9.83-9.83v3.59h2v-7h-7z"/></svg>',
        'img/icons/mail.svg': '<svg version="1.1" x="0px" y="0px" width="48px" height="48px" viewBox="0 0 48 48" enable-background="new 0 0 48 48" xml:space="preserve"><g><g><path fill="#7d7d7d" d="M40,8H8c-2.2,0-4,1.8-4,4l0,24c0,2.2,1.8,4,4,4h32c2.2,0,4-1.8,4-4V12C44,9.8,42.2,8,40,8z M40,16L24,26L8,16v-4l16,10l16-10V16z"/><rect fill="none" width="48" height="48"/></g></g></svg>',
        'img/icons/menu.svg': '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"> <path d="M0 0h18v18h-18z" fill="none"/> <path d="M2 13.5h14v-1.5h-14v1.5zm0-4h14v-1.5h-14v1.5zm0-5.5v1.5h14v-1.5h-14z"/></svg>',
        'img/icons/message.svg': '<svg version="1.1" x="0px" y="0px" width="48px" height="48px" viewBox="0 0 48 48" enable-background="new 0 0 48 48" xml:space="preserve"><g><g><path fill="#7d7d7d" d="M40,4H8C5.8,4,4,5.8,4,8l0,36l8-8h28c2.2,0,4-1.8,4-4V8C44,5.8,42.2,4,40,4z M36,28H12v-4h24V28z M36,22H12v-4h24V22zM36,16H12v-4h24V16z"/><rect x="0" fill="none" width="48" height="48"/></g></g></svg>',
        'img/icons/more_vert.svg': '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"> <path d="M0 0h18v18h-18z" fill="none"/> <path d="M9 5.5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5-1.5.67-1.5 1.5.67 1.5 1.5 1.5zm0 2c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"/></svg>',
        'img/icons/npm-logo.svg': '<?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="540px" height="210px" viewBox="0 0 18 7"><path fill="#CB3837" d="M0,0h18v6H9v1H5V6H0V0z M1,5h2V2h1v3h1V1H1V5z M6,1v5h2V5h2V1H6z M8,2h1v2H8V2z M11,1v4h2V2h1v3h1V2h1v3h1V1H11z"/><polygon fill="#FFFFFF" points="1,5 3,5 3,2 4,2 4,5 5,5 5,1 1,1 "/><path fill="#FFFFFF" d="M6,1v5h2V5h2V1H6z M9,4H8V2h1V4z"/><polygon fill="#FFFFFF" points="11,1 11,5 13,5 13,2 14,2 14,5 15,5 15,2 16,2 16,5 17,5 17,1 "/></svg>',
        'img/icons/octicon-repo.svg': '<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 48 48"><path d="M21,12h-3v3h3V12z M21,6h-3v3h3V6z M39,0C37.5,0,10.5,0,9,0S6,1.5,6,3s0,34.5,0,36s1.5,3,3,3s6,0,6,0v6l4.5-4.5L24,48v-6 c0,0,13.5,0,15,0s3-1.5,3-3s0-34.5,0-36S40.5,0,39,0z M39,37.5c0,0.75-0.703,1.5-1.5,1.5S24,39,24,39v-3h-9v3c0,0-3.703,0-4.5,0 S9,38.203,9,37.5S9,33,9,33h30C39,33,39,36.75,39,37.5z M39,30H15V3h24.047L39,30z M21,24h-3v3h3V24z M21,18h-3v3h3V18z"/></svg>',
        'img/icons/print.svg': '<svg version="1.1" x="0px" y="0px" width="24px"height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g><g><g><path d="M19,8H5c-1.7,0-3,1.3-3,3v6h4v4h12v-4h4v-6C22,9.3,20.7,8,19,8z M16,19H8v-5h8V19z M19,12c-0.6,0-1-0.4-1-1s0.4-1,1-1c0.6,0,1,0.4,1,1S19.6,12,19,12z M18,3H6v4h12V3z" fill="#7d7d7d"/></g><rect fill="none" width="24" height="24"/></g></g></svg>',
        'img/icons/separator.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 16.0.4, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 4 6" enable-background="new 0 0 4 6" xml:space="preserve"><g> <polygon fill="#FFFFFF" points="3.719,3 0.968,0.25 0.281,0.938 2.344,3 0.281,5.062 0.968,5.75 "/></g></svg>',
        'img/icons/sets/communication-icons.svg': '<svg><defs><g id="business"><path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/></g><g id="call"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></g><g id="call-end"><path d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"/></g><g id="call-made"><path d="M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5z"/></g><g id="call-merge"><path d="M17 20.41L18.41 19 15 15.59 13.59 17 17 20.41zM7.5 8H11v5.59L5.59 19 7 20.41l6-6V8h3.5L12 3.5 7.5 8z"/></g><g id="call-missed"><path d="M19.59 7L12 14.59 6.41 9H11V7H3v8h2v-4.59l7 7 9-9z"/></g><g id="call-received"><path d="M20 5.41L18.59 4 7 15.59V9H5v10h10v-2H8.41z"/></g><g id="call-split"><path d="M14 4l2.29 2.29-2.88 2.88 1.42 1.42 2.88-2.88L20 10V4zm-4 0H4v6l2.29-2.29 4.71 4.7V20h2v-8.41l-5.29-5.3z"/></g><g id="chat"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"/></g><g id="clear-all"><path d="M5 13h14v-2H5v2zm-2 4h14v-2H3v2zM7 7v2h14V7H7z"/></g><g id="comment"><path d="M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4-.01-18zM18 14H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/></g><g id="contacts"><path d="M20 0H4v2h16V0zM4 24h16v-2H4v2zM20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 2.75c1.24 0 2.25 1.01 2.25 2.25s-1.01 2.25-2.25 2.25S9.75 10.24 9.75 9 10.76 6.75 12 6.75zM17 17H7v-1.5c0-1.67 3.33-2.5 5-2.5s5 .83 5 2.5V17z"/></g><g id="dialer-sip"><path d="M17 3h-1v5h1V3zm-2 2h-2V4h2V3h-3v3h2v1h-2v1h3V5zm3-2v5h1V6h2V3h-3zm2 2h-1V4h1v1zm0 10.5c-1.25 0-2.45-.2-3.57-.57-.35-.11-.74-.03-1.01.24l-2.2 2.2c-2.83-1.44-5.15-3.75-6.59-6.59l2.2-2.21c.27-.26.35-.65.24-1C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.5c0-.55-.45-1-1-1z"/></g><g id="dialpad"><path d="M12 19c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM6 1c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12-8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm-6 8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></g><g id="dnd-on"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"/></g><g id="email"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></g><g id="forum"><path d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z"/></g><g id="import-export"><path d="M9 3L5 6.99h3V14h2V6.99h3L9 3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99h-3z"/></g><g id="invert-colors-off"><path d="M20.65 20.87l-2.35-2.35-6.3-6.29-3.56-3.57-1.42-1.41L4.27 4.5 3 5.77l2.78 2.78c-2.55 3.14-2.36 7.76.56 10.69C7.9 20.8 9.95 21.58 12 21.58c1.79 0 3.57-.59 5.03-1.78l2.7 2.7L21 21.23l-.35-.36zM12 19.59c-1.6 0-3.11-.62-4.24-1.76C6.62 16.69 6 15.19 6 13.59c0-1.32.43-2.57 1.21-3.6L12 14.77v4.82zM12 5.1v4.58l7.25 7.26c1.37-2.96.84-6.57-1.6-9.01L12 2.27l-3.7 3.7 1.41 1.41L12 5.1z"/></g><g id="invert-colors-on"><path d="M17.66 7.93L12 2.27 6.34 7.93c-3.12 3.12-3.12 8.19 0 11.31C7.9 20.8 9.95 21.58 12 21.58c2.05 0 4.1-.78 5.66-2.34 3.12-3.12 3.12-8.19 0-11.31zM12 19.59c-1.6 0-3.11-.62-4.24-1.76C6.62 16.69 6 15.19 6 13.59s.62-3.11 1.76-4.24L12 5.1v14.49z"/></g><g id="live-help"><path d="M19 2H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h4l3 3 3-3h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-6 16h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 11.9 13 12.5 13 14h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></g><g id="location-off"><path d="M12 6.5c1.38 0 2.5 1.12 2.5 2.5 0 .74-.33 1.39-.83 1.85l3.63 3.63c.98-1.86 1.7-3.8 1.7-5.48 0-3.87-3.13-7-7-7-1.98 0-3.76.83-5.04 2.15l3.19 3.19c.46-.52 1.11-.84 1.85-.84zm4.37 9.6l-4.63-4.63-.11-.11L3.27 3 2 4.27l3.18 3.18C5.07 7.95 5 8.47 5 9c0 5.25 7 13 7 13s1.67-1.85 3.38-4.35L18.73 21 20 19.73l-3.63-3.63z"/></g><g id="location-on"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></g><g id="message"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/></g><g id="messenger"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></g><g id="no-sim"><path d="M18.99 5c0-1.1-.89-2-1.99-2h-7L7.66 5.34 19 16.68 18.99 5zM3.65 3.88L2.38 5.15 5 7.77V19c0 1.1.9 2 2 2h10.01c.35 0 .67-.1.96-.26l1.88 1.88 1.27-1.27L3.65 3.88z"/></g><g id="phone"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></g><g id="portable-wifi-off"><path d="M17.56 14.24c.28-.69.44-1.45.44-2.24 0-3.31-2.69-6-6-6-.79 0-1.55.16-2.24.44l1.62 1.62c.2-.03.41-.06.62-.06 2.21 0 4 1.79 4 4 0 .21-.02.42-.05.63l1.61 1.61zM12 4c4.42 0 8 3.58 8 8 0 1.35-.35 2.62-.95 3.74l1.47 1.47C21.46 15.69 22 13.91 22 12c0-5.52-4.48-10-10-10-1.91 0-3.69.55-5.21 1.47l1.46 1.46C9.37 4.34 10.65 4 12 4zM3.27 2.5L2 3.77l2.1 2.1C2.79 7.57 2 9.69 2 12c0 3.7 2.01 6.92 4.99 8.65l1-1.73C5.61 17.53 4 14.96 4 12c0-1.76.57-3.38 1.53-4.69l1.43 1.44C6.36 9.68 6 10.8 6 12c0 2.22 1.21 4.15 3 5.19l1-1.74c-1.19-.7-2-1.97-2-3.45 0-.65.17-1.25.44-1.79l1.58 1.58L10 12c0 1.1.9 2 2 2l.21-.02.01.01 7.51 7.51L21 20.23 4.27 3.5l-1-1z"/></g><g id="quick-contacts-dialer"><path d="M22 3H2C.9 3 0 3.9 0 5v14c0 1.1.9 2 2 2h20c1.1 0 1.99-.9 1.99-2L24 5c0-1.1-.9-2-2-2zM8 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm6 12H2v-1c0-2 4-3.1 6-3.1s6 1.1 6 3.1v1zm3.85-4h1.64L21 16l-1.99 1.99c-1.31-.98-2.28-2.38-2.73-3.99-.18-.64-.28-1.31-.28-2s.1-1.36.28-2c.45-1.62 1.42-3.01 2.73-3.99L21 8l-1.51 2h-1.64c-.22.63-.35 1.3-.35 2s.13 1.37.35 2z"/></g><g id="quick-contacts-mail"><path d="M21 8V7l-3 2-3-2v1l3 2 3-2zm1-5H2C.9 3 0 3.9 0 5v14c0 1.1.9 2 2 2h20c1.1 0 1.99-.9 1.99-2L24 5c0-1.1-.9-2-2-2zM8 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm6 12H2v-1c0-2 4-3.1 6-3.1s6 1.1 6 3.1v1zm8-6h-8V6h8v6z"/></g><g id="ring-volume"><path d="M23.71 16.67C20.66 13.78 16.54 12 12 12 7.46 12 3.34 13.78.29 16.67c-.18.18-.29.43-.29.71 0 .28.11.53.29.71l2.48 2.48c.18.18.43.29.71.29.27 0 .52-.11.7-.28.79-.74 1.69-1.36 2.66-1.85.33-.16.56-.5.56-.9v-3.1c1.45-.48 3-.73 4.6-.73s3.15.25 4.6.72v3.1c0 .39.23.74.56.9.98.49 1.87 1.12 2.66 1.85.18.18.43.28.7.28.28 0 .53-.11.71-.29l2.48-2.48c.18-.18.29-.43.29-.71 0-.27-.11-.52-.29-.7zM21.16 6.26l-1.41-1.41-3.56 3.55 1.41 1.41s3.45-3.52 3.56-3.55zM13 2h-2v5h2V2zM6.4 9.81L7.81 8.4 4.26 4.84 2.84 6.26c.11.03 3.56 3.55 3.56 3.55z"/></g><g id="stay-current-landscape"><path d="M1.01 7L1 17c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2H3c-1.1 0-1.99.9-1.99 2zM19 7v10H5V7h14z"/></g><g id="stay-current-portrait"><path d="M17 1.01L7 1c-1.1 0-1.99.9-1.99 2v18c0 1.1.89 2 1.99 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"/></g><g id="stay-primary-landscape"><path d="M1.01 7L1 17c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2H3c-1.1 0-1.99.9-1.99 2zM19 7v10H5V7h14z"/></g><g id="stay-primary-portrait"><path d="M17 1.01L7 1c-1.1 0-1.99.9-1.99 2v18c0 1.1.89 2 1.99 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"/></g><g id="swap-calls"><path d="M18 4l-4 4h3v7c0 1.1-.9 2-2 2s-2-.9-2-2V8c0-2.21-1.79-4-4-4S5 5.79 5 8v7H2l4 4 4-4H7V8c0-1.1.9-2 2-2s2 .9 2 2v7c0 2.21 1.79 4 4 4s4-1.79 4-4V8h3l-4-4z"/></g><g id="textsms"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM9 11H7V9h2v2zm4 0h-2V9h2v2zm4 0h-2V9h2v2z"/></g><g id="voicemail"><path d="M18.5 6C15.46 6 13 8.46 13 11.5c0 1.33.47 2.55 1.26 3.5H9.74c.79-.95 1.26-2.17 1.26-3.5C11 8.46 8.54 6 5.5 6S0 8.46 0 11.5 2.46 17 5.5 17h13c3.04 0 5.5-2.46 5.5-5.5S21.54 6 18.5 6zm-13 9C3.57 15 2 13.43 2 11.5S3.57 8 5.5 8 9 9.57 9 11.5 7.43 15 5.5 15zm13 0c-1.93 0-3.5-1.57-3.5-3.5S16.57 8 18.5 8 22 9.57 22 11.5 20.43 15 18.5 15z"/></g><g id="vpn-key"><path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></g></defs></svg>',
        'img/icons/sets/core-icons.svg': '<svg><defs><g id="3d-rotation"><path d="M7.52 21.48C4.25 19.94 1.91 16.76 1.55 13H.05C.56 19.16 5.71 24 12 24l.66-.03-3.81-3.81-1.33 1.32zm.89-6.52c-.19 0-.37-.03-.52-.08-.16-.06-.29-.13-.4-.24-.11-.1-.2-.22-.26-.37-.06-.14-.09-.3-.09-.47h-1.3c0 .36.07.68.21.95.14.27.33.5.56.69.24.18.51.32.82.41.3.1.62.15.96.15.37 0 .72-.05 1.03-.15.32-.1.6-.25.83-.44s.42-.43.55-.72c.13-.29.2-.61.2-.97 0-.19-.02-.38-.07-.56-.05-.18-.12-.35-.23-.51-.1-.16-.24-.3-.4-.43-.17-.13-.37-.23-.61-.31.2-.09.37-.2.52-.33.15-.13.27-.27.37-.42.1-.15.17-.3.22-.46.05-.16.07-.32.07-.48 0-.36-.06-.68-.18-.96-.12-.28-.29-.51-.51-.69-.2-.19-.47-.33-.77-.43C9.1 8.05 8.76 8 8.39 8c-.36 0-.69.05-1 .16-.3.11-.57.26-.79.45-.21.19-.38.41-.51.67-.12.26-.18.54-.18.85h1.3c0-.17.03-.32.09-.45s.14-.25.25-.34c.11-.09.23-.17.38-.22.15-.05.3-.08.48-.08.4 0 .7.1.89.31.19.2.29.49.29.86 0 .18-.03.34-.08.49-.05.15-.14.27-.25.37-.11.1-.25.18-.41.24-.16.06-.36.09-.58.09H7.5v1.03h.77c.22 0 .42.02.6.07s.33.13.45.23c.12.11.22.24.29.4.07.16.1.35.1.57 0 .41-.12.72-.35.93-.23.23-.55.33-.95.33zm8.55-5.92c-.32-.33-.7-.59-1.14-.77-.43-.18-.92-.27-1.46-.27H12v8h2.3c.55 0 1.06-.09 1.51-.27.45-.18.84-.43 1.16-.76.32-.33.57-.73.74-1.19.17-.47.26-.99.26-1.57v-.4c0-.58-.09-1.1-.26-1.57-.18-.47-.43-.87-.75-1.2zm-.39 3.16c0 .42-.05.79-.14 1.13-.1.33-.24.62-.43.85-.19.23-.43.41-.71.53-.29.12-.62.18-.99.18h-.91V9.12h.97c.72 0 1.27.23 1.64.69.38.46.57 1.12.57 1.99v.4zM12 0l-.66.03 3.81 3.81 1.33-1.33c3.27 1.55 5.61 4.72 5.96 8.48h1.5C23.44 4.84 18.29 0 12 0z"/></g><g id="accessibility"><path d="M12 2c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm9 7h-6v13h-2v-6h-2v6H9V9H3V7h18v2z"/></g><g id="account-balance"><path d="M4 10v7h3v-7H4zm6 0v7h3v-7h-3zM2 22h19v-3H2v3zm14-12v7h3v-7h-3zm-4.5-9L2 6v2h19V6l-9.5-5z"/></g><g id="account-balance-wallet"><path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></g><g id="account-box"><path d="M3 5v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2H5c-1.11 0-2 .9-2 2zm12 4c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3zm-9 8c0-2 4-3.1 6-3.1s6 1.1 6 3.1v1H6v-1z"/></g><g id="account-child"><circle cx="12" cy="13.49" r="1.5"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 2.5c1.24 0 2.25 1.01 2.25 2.25S13.24 9 12 9 9.75 7.99 9.75 6.75 10.76 4.5 12 4.5zm5 10.56v2.5c-.45.41-.96.77-1.5 1.05v-.68c0-.34-.17-.65-.46-.92-.65-.62-1.89-1.02-3.04-1.02-.96 0-1.96.28-2.65.73l-.17.12-.21.17c.78.47 1.63.72 2.54.82l1.33.15c.37.04.66.36.66.75 0 .29-.16.53-.4.66-.28.15-.64.09-.95.09-.35 0-.69-.01-1.03-.05-.5-.06-.99-.17-1.46-.33-.49-.16-.97-.38-1.42-.64-.22-.13-.44-.27-.65-.43l-.31-.24c-.04-.02-.28-.18-.28-.23v-4.28c0-1.58 2.63-2.78 5-2.78s5 1.2 5 2.78v1.78z"/></g><g id="account-circle"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></g><g id="add"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></g><g id="add-box"><path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/></g><g id="add-circle"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/></g><g id="add-circle-outline"><path d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></g><g id="add-shopping-cart"><path d="M11 9h2V6h3V4h-3V1h-2v3H8v2h3v3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zm-9.83-3.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.86-7.01L19.42 4h-.01l-1.1 2-2.76 5H8.53l-.13-.27L6.16 6l-.95-2-.94-2H1v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.13 0-.25-.11-.25-.25z"/></g><g id="alarm"><path d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></g><g id="alarm-add"><path d="M7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7zm1-11h-2v3H8v2h3v3h2v-3h3v-2h-3V9z"/></g><g id="alarm-off"><path d="M12 6c3.87 0 7 3.13 7 7 0 .84-.16 1.65-.43 2.4l1.52 1.52c.58-1.19.91-2.51.91-3.92 0-4.97-4.03-9-9-9-1.41 0-2.73.33-3.92.91L9.6 6.43C10.35 6.16 11.16 6 12 6zm10-.28l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM2.92 2.29L1.65 3.57 2.98 4.9l-1.11.93 1.42 1.42 1.11-.94.8.8C3.83 8.69 3 10.75 3 13c0 4.97 4.02 9 9 9 2.25 0 4.31-.83 5.89-2.2l2.2 2.2 1.27-1.27L3.89 3.27l-.97-.98zm13.55 16.1C15.26 19.39 13.7 20 12 20c-3.87 0-7-3.13-7-7 0-1.7.61-3.26 1.61-4.47l9.86 9.86zM8.02 3.28L6.6 1.86l-.86.71 1.42 1.42.86-.71z"/></g><g id="alarm-on"><path d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7zm-1.46-5.47L8.41 12.4l-1.06 1.06 3.18 3.18 6-6-1.06-1.06-4.93 4.95z"/></g><g id="android"><path d="M6 18c0 .55.45 1 1 1h1v3.5c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5V19h2v3.5c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5V19h1c.55 0 1-.45 1-1V8H6v10zM3.5 8C2.67 8 2 8.67 2 9.5v7c0 .83.67 1.5 1.5 1.5S5 17.33 5 16.5v-7C5 8.67 4.33 8 3.5 8zm17 0c-.83 0-1.5.67-1.5 1.5v7c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5v-7c0-.83-.67-1.5-1.5-1.5zm-4.97-5.84l1.3-1.3c.2-.2.2-.51 0-.71-.2-.2-.51-.2-.71 0l-1.48 1.48C13.85 1.23 12.95 1 12 1c-.96 0-1.86.23-2.66.63L7.85.15c-.2-.2-.51-.2-.71 0-.2.2-.2.51 0 .71l1.31 1.31C6.97 3.26 6 5.01 6 7h12c0-1.99-.97-3.75-2.47-4.84zM10 5H9V4h1v1zm5 0h-1V4h1v1z"/></g><g id="announcement"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 9h-2V5h2v6zm0 4h-2v-2h2v2z"/></g><g id="apps"><path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/></g><g id="archive"><path d="M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 17.5L6.5 12H10v-2h4v2h3.5L12 17.5zM5.12 5l.81-1h12l.94 1H5.12z"/></g><g id="arrow-back"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></g><g id="arrow-drop-down"><path d="M7 10l5 5 5-5z"/></g><g id="arrow-drop-down-circle"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 12l-4-4h8l-4 4z"/></g><g id="arrow-drop-up"><path d="M7 14l5-5 5 5z"/></g><g id="cached"><path d="M19 8l-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z"/></g></defs></svg>',
        'img/icons/sets/device-icons.svg': '<svg><defs><g id="access-alarm"><path d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></g><g id="access-alarms"><path d="M22 5.7l-4.6-3.9-1.3 1.5 4.6 3.9L22 5.7zM7.9 3.4L6.6 1.9 2 5.7l1.3 1.5 4.6-3.8zM12.5 8H11v6l4.7 2.9.8-1.2-4-2.4V8zM12 4c-5 0-9 4-9 9s4 9 9 9 9-4 9-9-4-9-9-9zm0 16c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7z"/></g><g id="access-time"><path fill-opacity=".9" d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zM12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></g><g id="add-alarm"><path d="M7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7zm1-11h-2v3H8v2h3v3h2v-3h3v-2h-3V9z"/></g><g id="airplanemode-off"><path d="M13 9V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5v3.68l7.83 7.83L21 16v-2l-8-5zM3 5.27l4.99 4.99L2 14v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-3.73L18.73 21 20 19.73 4.27 4 3 5.27z"/></g><g id="airplanemode-on"><path d="M10.18 9"/><path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/></g><g id="battery-20"><path d="M7 17v3.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V17H7z"/><path fill-opacity=".3" d="M17 5.33C17 4.6 16.4 4 15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V17h10V5.33z"/></g><g id="battery-30"><path fill-opacity=".3" d="M17 5.33C17 4.6 16.4 4 15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V15h10V5.33z"/><path d="M7 15v5.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V15H7z"/></g><g id="battery-50"><path fill-opacity=".3" d="M17 5.33C17 4.6 16.4 4 15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V13h10V5.33z"/><path d="M7 13v7.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V13H7z"/></g><g id="battery-60"><path fill-opacity=".3" d="M17 5.33C17 4.6 16.4 4 15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V11h10V5.33z"/><path d="M7 11v9.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V11H7z"/></g><g id="battery-80"><path fill-opacity=".3" d="M17 5.33C17 4.6 16.4 4 15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V9h10V5.33z"/><path d="M7 9v11.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V9H7z"/></g><g id="battery-90"><path fill-opacity=".3" d="M17 5.33C17 4.6 16.4 4 15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V8h10V5.33z"/><path d="M7 8v12.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V8H7z"/></g><g id="battery-alert"><path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4zM13 18h-2v-2h2v2zm0-4h-2V9h2v5z"/></g><g id="battery-charging-20"><path d="M11 20v-3H7v3.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V17h-4.4L11 20z"/><path fill-opacity=".3" d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V17h4v-2.5H9L13 7v5.5h2L12.6 17H17V5.33C17 4.6 16.4 4 15.67 4z"/></g><g id="battery-charging-30"><path fill-opacity=".3" d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v9.17h2L13 7v5.5h2l-1.07 2H17V5.33C17 4.6 16.4 4 15.67 4z"/><path d="M11 20v-5.5H7v6.17C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V14.5h-3.07L11 20z"/></g><g id="battery-charging-50"><path d="M14.47 13.5L11 20v-5.5H9l.53-1H7v7.17C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V13.5h-2.53z"/><path fill-opacity=".3" d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v8.17h2.53L13 7v5.5h2l-.53 1H17V5.33C17 4.6 16.4 4 15.67 4z"/></g><g id="battery-charging-60"><path fill-opacity=".3" d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V11h3.87L13 7v4h4V5.33C17 4.6 16.4 4 15.67 4z"/><path d="M13 12.5h2L11 20v-5.5H9l1.87-3.5H7v9.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V11h-4v1.5z"/></g><g id="battery-charging-80"><path fill-opacity=".3" d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V9h4.93L13 7v2h4V5.33C17 4.6 16.4 4 15.67 4z"/><path d="M13 12.5h2L11 20v-5.5H9L11.93 9H7v11.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V9h-4v3.5z"/></g><g id="battery-charging-90"><path fill-opacity=".3" d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33V8h5.47L13 7v1h4V5.33C17 4.6 16.4 4 15.67 4z"/><path d="M13 12.5h2L11 20v-5.5H9L12.47 8H7v12.67C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V8h-4v4.5z"/></g><g id="battery-charging-full"><path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4zM11 20v-5.5H9L13 7v5.5h2L11 20z"/></g><g id="battery-full"><path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4z"/></g><g id="battery-std"><path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4z"/></g><g id="battery-unknown"><path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4zm-2.72 13.95h-1.9v-1.9h1.9v1.9zm1.35-5.26s-.38.42-.67.71c-.48.48-.83 1.15-.83 1.6h-1.6c0-.83.46-1.52.93-2l.93-.94c.27-.27.44-.65.44-1.06 0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5H9c0-1.66 1.34-3 3-3s3 1.34 3 3c0 .66-.27 1.26-.7 1.69z"/></g><g id="bluetooth"><path d="M17.71 7.71L12 2h-1v7.59L6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 11 14.41V22h1l5.71-5.71-4.3-4.29 4.3-4.29zM13 5.83l1.88 1.88L13 9.59V5.83zm1.88 10.46L13 18.17v-3.76l1.88 1.88z"/></g><g id="bluetooth-connected"><path d="M7 12l-2-2-2 2 2 2 2-2zm10.71-4.29L12 2h-1v7.59L6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 11 14.41V22h1l5.71-5.71-4.3-4.29 4.3-4.29zM13 5.83l1.88 1.88L13 9.59V5.83zm1.88 10.46L13 18.17v-3.76l1.88 1.88zM19 10l-2 2 2 2 2-2-2-2z"/></g><g id="bluetooth-disabled"><path d="M13 5.83l1.88 1.88-1.6 1.6 1.41 1.41 3.02-3.02L12 2h-1v5.03l2 2v-3.2zM5.41 4L4 5.41 10.59 12 5 17.59 6.41 19 11 14.41V22h1l4.29-4.29 2.3 2.29L20 18.59 5.41 4zM13 18.17v-3.76l1.88 1.88L13 18.17z"/></g><g id="bluetooth-searching"><path d="M14.24 12.01l2.32 2.32c.28-.72.44-1.51.44-2.33 0-.82-.16-1.59-.43-2.31l-2.33 2.32zm5.29-5.3l-1.26 1.26c.63 1.21.98 2.57.98 4.02s-.36 2.82-.98 4.02l1.2 1.2c.97-1.54 1.54-3.36 1.54-5.31-.01-1.89-.55-3.67-1.48-5.19zm-3.82 1L10 2H9v7.59L4.41 5 3 6.41 8.59 12 3 17.59 4.41 19 9 14.41V22h1l5.71-5.71-4.3-4.29 4.3-4.29zM11 5.83l1.88 1.88L11 9.59V5.83zm1.88 10.46L11 18.17v-3.76l1.88 1.88z"/></g><g id="brightness-auto"><path d="M10.85 12.65h2.3L12 9l-1.15 3.65zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zM14.3 16l-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9z"/></g><g id="brightness-high"><path d="M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm0-10c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4z"/></g><g id="brightness-low"><path d="M20 15.31L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6z"/></g><g id="brightness-medium"><path d="M20 15.31L23.31 12 20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69zM12 18V6c3.31 0 6 2.69 6 6s-2.69 6-6 6z"/></g><g id="data-usage"><path d="M13 2.05v3.03c3.39.49 6 3.39 6 6.92 0 .9-.18 1.75-.48 2.54l2.6 1.53c.56-1.24.88-2.62.88-4.07 0-5.18-3.95-9.45-9-9.95zM12 19c-3.87 0-7-3.13-7-7 0-3.53 2.61-6.43 6-6.92V2.05c-5.06.5-9 4.76-9 9.95 0 5.52 4.47 10 9.99 10 3.31 0 6.24-1.61 8.06-4.09l-2.6-1.53C16.17 17.98 14.21 19 12 19z"/></g><g id="developer-mode"><path d="M7 5h10v2h2V3c0-1.1-.9-1.99-2-1.99L7 1c-1.1 0-2 .9-2 2v4h2V5zm8.41 11.59L20 12l-4.59-4.59L14 8.83 17.17 12 14 15.17l1.41 1.42zM10 15.17L6.83 12 10 8.83 8.59 7.41 4 12l4.59 4.59L10 15.17zM17 19H7v-2H5v4c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2v-4h-2v2z"/></g><g id="devices"><path d="M4 6h18V4H4c-1.1 0-2 .9-2 2v11H0v3h14v-3H4V6zm19 2h-6c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V9c0-.55-.45-1-1-1zm-1 9h-4v-7h4v7z"/></g><g id="dvr"><path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12zm-2-9H8v2h11V8zm0 4H8v2h11v-2zM7 8H5v2h2V8zm0 4H5v2h2v-2z"/></g><g id="gps-fixed"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></g><g id="gps-not-fixed"><path d="M20.94 11c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></g><g id="gps-off"><path d="M20.94 11c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06c-1.13.12-2.19.46-3.16.97l1.5 1.5C10.16 5.19 11.06 5 12 5c3.87 0 7 3.13 7 7 0 .94-.19 1.84-.52 2.65l1.5 1.5c.5-.96.84-2.02.97-3.15H23v-2h-2.06zM3 4.27l2.04 2.04C3.97 7.62 3.25 9.23 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c1.77-.2 3.38-.91 4.69-1.98L19.73 21 21 19.73 4.27 3 3 4.27zm13.27 13.27C15.09 18.45 13.61 19 12 19c-3.87 0-7-3.13-7-7 0-1.61.55-3.09 1.46-4.27l9.81 9.81z"/></g><g id="location-disabled"><path d="M20.94 11c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06c-1.13.12-2.19.46-3.16.97l1.5 1.5C10.16 5.19 11.06 5 12 5c3.87 0 7 3.13 7 7 0 .94-.19 1.84-.52 2.65l1.5 1.5c.5-.96.84-2.02.97-3.15H23v-2h-2.06zM3 4.27l2.04 2.04C3.97 7.62 3.25 9.23 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c1.77-.2 3.38-.91 4.69-1.98L19.73 21 21 19.73 4.27 3 3 4.27zm13.27 13.27C15.09 18.45 13.61 19 12 19c-3.87 0-7-3.13-7-7 0-1.61.55-3.09 1.46-4.27l9.81 9.81z"/></g><g id="location-searching"><path d="M20.94 11c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></g><g id="multitrack-audio"><path d="M7 18h2V6H7v12zm4 4h2V2h-2v20zm-8-8h2v-4H3v4zm12 4h2V6h-2v12zm4-8v4h2v-4h-2z"/></g><g id="network-cell"><path fill-opacity=".3" d="M2 22h20V2z"/><path d="M17 7L2 22h15z"/></g><g id="network-wifi"><path fill-opacity=".3" d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z"/><path d="M3.53 10.95l8.46 10.54.01.01.01-.01 8.46-10.54C20.04 10.62 16.81 8 12 8c-4.81 0-8.04 2.62-8.47 2.95z"/></g><g id="nfc"><path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 18H4V4h16v16zM18 6h-5c-1.1 0-2 .9-2 2v2.28c-.6.35-1 .98-1 1.72 0 1.1.9 2 2 2s2-.9 2-2c0-.74-.4-1.38-1-1.72V8h3v8H8V8h2V6H6v12h12V6z"/></g><g id="now-wallpaper"><path d="M4 4h7V2H4c-1.1 0-2 .9-2 2v7h2V4zm6 9l-4 5h12l-3-4-2.03 2.71L10 13zm7-4.5c0-.83-.67-1.5-1.5-1.5S14 7.67 14 8.5s.67 1.5 1.5 1.5S17 9.33 17 8.5zM20 2h-7v2h7v7h2V4c0-1.1-.9-2-2-2zm0 18h-7v2h7c1.1 0 2-.9 2-2v-7h-2v7zM4 13H2v7c0 1.1.9 2 2 2h7v-2H4v-7z"/></g><g id="now-widgets"><path d="M13 13v8h8v-8h-8zM3 21h8v-8H3v8zM3 3v8h8V3H3zm13.66-1.31L11 7.34 16.66 13l5.66-5.66-5.66-5.65z"/></g><g id="screen-lock-landscape"><path d="M21 5H3c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-2 12H5V7h14v10zm-9-1h4c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1v-1c0-1.11-.9-2-2-2-1.11 0-2 .9-2 2v1c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1zm.8-6c0-.66.54-1.2 1.2-1.2.66 0 1.2.54 1.2 1.2v1h-2.4v-1z"/></g><g id="screen-lock-portrait"><path d="M10 16h4c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1v-1c0-1.11-.9-2-2-2-1.11 0-2 .9-2 2v1c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1zm.8-6c0-.66.54-1.2 1.2-1.2.66 0 1.2.54 1.2 1.2v1h-2.4v-1zM17 1H7c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zm0 18H7V5h10v14z"/></g><g id="screen-lock-rotation"><path d="M23.25 12.77l-2.57-2.57-1.41 1.41 2.22 2.22-5.66 5.66L4.51 8.17l5.66-5.66 2.1 2.1 1.41-1.41L11.23.75c-.59-.59-1.54-.59-2.12 0L2.75 7.11c-.59.59-.59 1.54 0 2.12l12.02 12.02c.59.59 1.54.59 2.12 0l6.36-6.36c.59-.59.59-1.54 0-2.12zM8.47 20.48C5.2 18.94 2.86 15.76 2.5 12H1c.51 6.16 5.66 11 11.95 11l.66-.03-3.81-3.82-1.33 1.33zM16 9h5c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1v-.5C21 1.12 19.88 0 18.5 0S16 1.12 16 2.5V3c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1zm.8-6.5c0-.94.76-1.7 1.7-1.7s1.7.76 1.7 1.7V3h-3.4v-.5z"/></g><g id="screen-rotation"><path d="M16.48 2.52c3.27 1.55 5.61 4.72 5.97 8.48h1.5C23.44 4.84 18.29 0 12 0l-.66.03 3.81 3.81 1.33-1.32zm-6.25-.77c-.59-.59-1.54-.59-2.12 0L1.75 8.11c-.59.59-.59 1.54 0 2.12l12.02 12.02c.59.59 1.54.59 2.12 0l6.36-6.36c.59-.59.59-1.54 0-2.12L10.23 1.75zm4.6 19.44L2.81 9.17l6.36-6.36 12.02 12.02-6.36 6.36zm-7.31.29C4.25 19.94 1.91 16.76 1.55 13H.05C.56 19.16 5.71 24 12 24l.66-.03-3.81-3.81-1.33 1.32z"/></g><g id="sd-storage"><path d="M18 2h-8L4.02 8 4 20c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-6 6h-2V4h2v4zm3 0h-2V4h2v4zm3 0h-2V4h2v4z"/></g><g id="settings-system-daydream"><path d="M9 16h6.5c1.38 0 2.5-1.12 2.5-2.5S16.88 11 15.5 11h-.05c-.24-1.69-1.69-3-3.45-3-1.4 0-2.6.83-3.16 2.02h-.16C7.17 10.18 6 11.45 6 13c0 1.66 1.34 3 3 3zM21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16.01H3V4.99h18v14.02z"/></g><g id="signal-cellular-0-bar"><path fill-opacity=".3" d="M2 22h20V2z"/></g><g id="signal-cellular-1-bar"><path fill-opacity=".3" d="M2 22h20V2z"/><path d="M12 12L2 22h10z"/></g><g id="signal-cellular-2-bar"><path fill-opacity=".3" d="M2 22h20V2z"/><path d="M14 10L2 22h12z"/></g><g id="signal-cellular-3-bar"><path fill-opacity=".3" d="M2 22h20V2z"/><path d="M17 7L2 22h15z"/></g><g id="signal-cellular-4-bar"><path d="M2 22h20V2z"/></g><g id="signal-cellular-connected-no-internet-0-bar"><path fill-opacity=".3" d="M22 8V2L2 22h16V8z"/><path d="M20 22h2v-2h-2v2zm0-12v8h2v-8h-2z"/></g><g id="signal-cellular-connected-no-internet-1-bar"><path fill-opacity=".3" d="M22 8V2L2 22h16V8z"/><path d="M20 10v8h2v-8h-2zm-8 12V12L2 22h10zm8 0h2v-2h-2v2z"/></g><g id="signal-cellular-connected-no-internet-2-bar"><path fill-opacity=".3" d="M22 8V2L2 22h16V8z"/><path d="M14 22V10L2 22h12zm6-12v8h2v-8h-2zm0 12h2v-2h-2v2z"/></g><g id="signal-cellular-connected-no-internet-3-bar"><path fill-opacity=".3" d="M22 8V2L2 22h16V8z"/><path d="M17 22V7L2 22h15zm3-12v8h2v-8h-2zm0 12h2v-2h-2v2z"/></g><g id="signal-cellular-connected-no-internet-4-bar"><path d="M20 18h2v-8h-2v8zm0 4h2v-2h-2v2zM2 22h16V8h4V2L2 22z"/></g><g id="signal-cellular-no-sim"><path d="M18.99 5c0-1.1-.89-2-1.99-2h-7L7.66 5.34 19 16.68 18.99 5zM3.65 3.88L2.38 5.15 5 7.77V19c0 1.1.9 2 2 2h10.01c.35 0 .67-.1.96-.26l1.88 1.88 1.27-1.27L3.65 3.88z"/></g><g id="signal-cellular-null"><path d="M20 6.83V20H6.83L20 6.83M22 2L2 22h20V2z"/></g><g id="signal-cellular-off"><path d="M21 1l-8.59 8.59L21 18.18V1zM4.77 4.5L3.5 5.77l6.36 6.36L1 21h17.73l2 2L22 21.73 4.77 4.5z"/></g><g id="signal-wifi-0-bar"><path fill-opacity=".3" d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z"/></g><g id="signal-wifi-1-bar"><path fill-opacity=".3" d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z"/><path d="M6.67 14.86L12 21.49v.01l.01-.01 5.33-6.63C17.06 14.65 15.03 13 12 13s-5.06 1.65-5.33 1.86z"/></g><g id="signal-wifi-2-bar"><path fill-opacity=".3" d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z"/><path d="M4.79 12.52l7.2 8.98H12l.01-.01 7.2-8.98C18.85 12.24 16.1 10 12 10s-6.85 2.24-7.21 2.52z"/></g><g id="signal-wifi-3-bar"><path fill-opacity=".3" d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z"/><path d="M3.53 10.95l8.46 10.54.01.01.01-.01 8.46-10.54C20.04 10.62 16.81 8 12 8c-4.81 0-8.04 2.62-8.47 2.95z"/></g><g id="signal-wifi-4-bar"><path d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z"/></g><g id="signal-wifi-off"><path d="M23.64 7c-.45-.34-4.93-4-11.64-4-1.5 0-2.89.19-4.15.48L18.18 13.8 23.64 7zm-6.6 8.22L3.27 1.44 2 2.72l2.05 2.06C1.91 5.76.59 6.82.36 7l11.63 14.49.01.01.01-.01 3.9-4.86 3.32 3.32 1.27-1.27-3.46-3.46z"/></g><g id="storage"><path d="M2 20h20v-4H2v4zm2-3h2v2H4v-2zM2 4v4h20V4H2zm4 3H4V5h2v2zm-4 7h20v-4H2v4zm2-3h2v2H4v-2z"/></g><g id="usb"><path d="M15 7v4h1v2h-3V5h2l-3-4-3 4h2v8H8v-2.07c.7-.37 1.2-1.08 1.2-1.93 0-1.21-.99-2.2-2.2-2.2-1.21 0-2.2.99-2.2 2.2 0 .85.5 1.56 1.2 1.93V13c0 1.11.89 2 2 2h3v3.05c-.71.37-1.2 1.1-1.2 1.95 0 1.22.99 2.2 2.2 2.2 1.21 0 2.2-.98 2.2-2.2 0-.85-.49-1.58-1.2-1.95V15h3c1.11 0 2-.89 2-2v-2h1V7h-4z"/></g><g id="wifi-lock"><path d="M20.5 9.5c.28 0 .55.04.81.08L24 6c-3.34-2.51-7.5-4-12-4S3.34 3.49 0 6l12 16 3.5-4.67V14.5c0-2.76 2.24-5 5-5zM23 16v-1.5c0-1.38-1.12-2.5-2.5-2.5S18 13.12 18 14.5V16c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1h5c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1zm-1 0h-3v-1.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5V16z"/></g><g id="wifi-tethering"><path d="M12 11c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 2c0-3.31-2.69-6-6-6s-6 2.69-6 6c0 2.22 1.21 4.15 3 5.19l1-1.74c-1.19-.7-2-1.97-2-3.45 0-2.21 1.79-4 4-4s4 1.79 4 4c0 1.48-.81 2.75-2 3.45l1 1.74c1.79-1.04 3-2.97 3-5.19zM12 3C6.48 3 2 7.48 2 13c0 3.7 2.01 6.92 4.99 8.65l1-1.73C5.61 18.53 4 15.96 4 13c0-4.42 3.58-8 8-8s8 3.58 8 8c0 2.96-1.61 5.53-4 6.92l1 1.73c2.99-1.73 5-4.95 5-8.65 0-5.52-4.48-10-10-10z"/></g></defs></svg>',
        'img/icons/sets/social-icons.svg': '<svg><defs><g id="cake"><path d="M12 6c1.11 0 2-.9 2-2 0-.38-.1-.73-.29-1.03L12 0l-1.71 2.97c-.19.3-.29.65-.29 1.03 0 1.1.9 2 2 2zm4.6 9.99l-1.07-1.07-1.08 1.07c-1.3 1.3-3.58 1.31-4.89 0l-1.07-1.07-1.09 1.07C6.75 16.64 5.88 17 4.96 17c-.73 0-1.4-.23-1.96-.61V21c0 .55.45 1 1 1h16c.55 0 1-.45 1-1v-4.61c-.56.38-1.23.61-1.96.61-.92 0-1.79-.36-2.44-1.01zM18 9h-5V7h-2v2H6c-1.66 0-3 1.34-3 3v1.54c0 1.08.88 1.96 1.96 1.96.52 0 1.02-.2 1.38-.57l2.14-2.13 2.13 2.13c.74.74 2.03.74 2.77 0l2.14-2.13 2.13 2.13c.37.37.86.57 1.38.57 1.08 0 1.96-.88 1.96-1.96V12C21 10.34 19.66 9 18 9z"/></g><g id="domain"><path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/></g><g id="group"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></g><g id="group-add"><path d="M8 10H5V7H3v3H0v2h3v3h2v-3h3v-2zm10 1c1.66 0 2.99-1.34 2.99-3S19.66 5 18 5c-.32 0-.63.05-.91.14.57.81.9 1.79.9 2.86s-.34 2.04-.9 2.86c.28.09.59.14.91.14zm-5 0c1.66 0 2.99-1.34 2.99-3S14.66 5 13 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm6.62 2.16c.83.73 1.38 1.66 1.38 2.84v2h3v-2c0-1.54-2.37-2.49-4.38-2.84zM13 13c-2 0-6 1-6 3v2h12v-2c0-2-4-3-6-3z"/></g><g id="location-city"><path d="M15 11V5l-3-3-3 3v2H3v14h18V11h-6zm-8 8H5v-2h2v2zm0-4H5v-2h2v2zm0-4H5V9h2v2zm6 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V9h2v2zm0-4h-2V5h2v2zm6 12h-2v-2h2v2zm0-4h-2v-2h2v2z"/></g><g id="mood"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/></g><g id="notifications"><path d="M11.5 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6.5-6v-5.5c0-3.07-2.13-5.64-5-6.32V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5v.68c-2.87.68-5 3.25-5 6.32V16l-2 2v1h17v-1l-2-2z"/></g><g id="notifications-none"><path d="M11.5 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6.5-6v-5.5c0-3.07-2.13-5.64-5-6.32V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5v.68c-2.87.68-5 3.25-5 6.32V16l-2 2v1h17v-1l-2-2zm-2 1H7v-6.5C7 8.01 9.01 6 11.5 6S16 8.01 16 10.5V17z"/></g><g id="notifications-off"><path d="M11.5 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zM18 10.5c0-3.07-2.13-5.64-5-6.32V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5v.68c-.51.12-.99.32-1.45.56L18 14.18V10.5zm-.27 8.5l2 2L21 19.73 4.27 3 3 4.27l2.92 2.92C5.34 8.16 5 9.29 5 10.5V16l-2 2v1h14.73z"/></g><g id="notifications-on"><path d="M6.58 3.58L5.15 2.15C2.76 3.97 1.18 6.8 1.03 10h2c.15-2.65 1.51-4.97 3.55-6.42zM19.97 10h2c-.15-3.2-1.73-6.03-4.13-7.85l-1.43 1.43c2.05 1.45 3.41 3.77 3.56 6.42zm-1.97.5c0-3.07-2.13-5.64-5-6.32V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5v.68c-2.87.68-5 3.25-5 6.32V16l-2 2v1h17v-1l-2-2v-5.5zM11.5 22c.14 0 .27-.01.4-.04.65-.13 1.19-.58 1.44-1.18.1-.24.16-.5.16-.78h-4c0 1.1.9 2 2 2z"/></g><g id="notifications-paused"><path d="M11.5 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6.5-6v-5.5c0-3.07-2.13-5.64-5-6.32V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5v.68c-2.87.68-5 3.25-5 6.32V16l-2 2v1h17v-1l-2-2zm-4-6.2l-2.8 3.4H14V15H9v-1.8l2.8-3.4H9V8h5v1.8z"/></g><g id="pages"><path d="M3 5v6h5L7 7l4 1V3H5c-1.1 0-2 .9-2 2zm5 8H3v6c0 1.1.9 2 2 2h6v-5l-4 1 1-4zm9 4l-4-1v5h6c1.1 0 2-.9 2-2v-6h-5l1 4zm2-14h-6v5l4-1-1 4h5V5c0-1.1-.9-2-2-2z"/></g><g id="party-mode"><path d="M20 4h-3.17L15 2H9L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 3c1.63 0 3.06.79 3.98 2H12c-1.66 0-3 1.34-3 3 0 .35.07.69.18 1H7.1c-.06-.32-.1-.66-.1-1 0-2.76 2.24-5 5-5zm0 10c-1.63 0-3.06-.79-3.98-2H12c1.66 0 3-1.34 3-3 0-.35-.07-.69-.18-1h2.08c.07.32.1.66.1 1 0 2.76-2.24 5-5 5z"/></g><g id="people"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></g><g id="people-outline"><path d="M16.5 13c-1.2 0-3.07.34-4.5 1-1.43-.67-3.3-1-4.5-1C5.33 13 1 14.08 1 16.25V19h22v-2.75c0-2.17-4.33-3.25-6.5-3.25zm-4 4.5h-10v-1.25c0-.54 2.56-1.75 5-1.75s5 1.21 5 1.75v1.25zm9 0H14v-1.25c0-.46-.2-.86-.52-1.22.88-.3 1.96-.53 3.02-.53 2.44 0 5 1.21 5 1.75v1.25zM7.5 12c1.93 0 3.5-1.57 3.5-3.5S9.43 5 7.5 5 4 6.57 4 8.5 5.57 12 7.5 12zm0-5.5c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm9 5.5c1.93 0 3.5-1.57 3.5-3.5S18.43 5 16.5 5 13 6.57 13 8.5s1.57 3.5 3.5 3.5zm0-5.5c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2z"/></g><g id="person"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></g><g id="person-add"><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></g><g id="person-outline"><path d="M12 5.9c1.16 0 2.1.94 2.1 2.1s-.94 2.1-2.1 2.1S9.9 9.16 9.9 8s.94-2.1 2.1-2.1m0 9c2.97 0 6.1 1.46 6.1 2.1v1.1H5.9V17c0-.64 3.13-2.1 6.1-2.1M12 4C9.79 4 8 5.79 8 8s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 9c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4z"/></g><g id="plus-one"><path d="M10 8H8v4H4v2h4v4h2v-4h4v-2h-4zm4.5-1.92V7.9l2.5-.5V18h2V5z"/></g><g id="poll"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></g><g id="public"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></g><g id="school"><path d="M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82zM12 3L1 9l11 6 9-4.91V17h2V9L12 3z"/></g><g id="share"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></g><g id="whatshot"><path d="M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29.59 2.65.59 4.04 0 2.65-2.15 4.8-4.8 4.8z"/></g></defs></svg>',
        'img/icons/share-arrow.svg': '<svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g><g><path fill="#7d7d7d" d="M21,11l-7-7v4C7,9,4,14,3,19c2.5-3.5,6-5.1,11-5.1V18L21,11z"/><rect fill="none" width="24" height="24"/></g></g></svg>',
        'img/icons/tabs-arrow.svg': '<?xml version="1.0" encoding="utf-8"?><!-- Generator: Adobe Illustrator 17.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0) --><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g id="Header"> <g> <rect x="-618" y="-1208" fill="none" width="1400" height="3600"/> </g></g><g id="Label"></g><polygon points="15.4,7.4 14,6 8,12 14,18 15.4,16.6 10.8,12 "/><g id="Grid" display="none"></g></svg>',
        'img/icons/twitter.svg': '<svg version="1.1" x="0px" y="0px" width="48px" height="48px" viewBox="0 0 48 48" enable-background="new 0 0 48 48" xml:space="preserve"><g><g><g><path fill="#7d7d7d" d="M40,4H8C5.8,4,4,5.8,4,8l0,32c0,2.2,1.8,4,4,4h32c2.2,0,4-1.8,4-4V8C44,5.8,42.2,4,40,4z M35.4,18.7c-0.1,9.2-6,15.6-14.8,16c-3.6,0.2-6.3-1-8.6-2.5c2.7,0.4,6-0.6,7.8-2.2c-2.6-0.3-4.2-1.6-4.9-3.8c0.8,0.1,1.6,0.1,2.3-0.1c-2.4-0.8-4.1-2.3-4.2-5.3c0.7,0.3,1.4,0.6,2.3,0.6c-1.8-1-3.1-4.7-1.6-7.2c2.6,2.9,5.8,5.3,11,5.6c-1.3-5.6,6.1-8.6,9.2-4.9c1.3-0.3,2.4-0.8,3.4-1.3c-0.4,1.3-1.2,2.2-2.2,2.9c1.1-0.1,2.1-0.4,2.9-0.8C37.5,16.9,36.4,17.9,35.4,18.7z"/></g><g><rect fill="none" width="48" height="48"/></g></g></g></svg>',
        'img/icons/upload.svg': '<svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g><g><rect x="-618" y="-2232" fill="none" width="1400" height="3600"/></g></g><g><g><rect fill="none" width="24" height="24"/><path fill="#7d7d7d" d="M19.4,10c-0.7-3.4-3.7-6-7.4-6C9.1,4,6.6,5.6,5.4,8C2.3,8.4,0,10.9,0,14c0,3.3,2.7,6,6,6h13c2.8,0,5-2.2,5-5C24,12.4,21.9,10.2,19.4,10z M14,13v4h-4v-4H7l5-5l5,5H14z"/></g></g></svg>',
        'icons/avatar-icons.svg': '<svg><defs> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-1" x="128"> <path fill="#FF8A80" d="M0 0h128v128H0z"/> <path fill="#FFE0B2" d="M36.3 94.8c6.4 7.3 16.2 12.1 27.3 12.4 10.7-.3 20.3-4.7 26.7-11.6l.2.1c-17-13.3-12.9-23.4-8.5-28.6 1.3-1.2 2.8-2.5 4.4-3.9l13.1-11c1.5-1.2 2.6-3 2.9-5.1.6-4.4-2.5-8.4-6.9-9.1-1.5-.2-3 0-4.3.6-.3-1.3-.4-2.7-1.6-3.5-1.4-.9-2.8-1.7-4.2-2.5-7.1-3.9-14.9-6.6-23-7.9-5.4-.9-11-1.2-16.1.7-3.3 1.2-6.1 3.2-8.7 5.6-1.3 1.2-2.5 2.4-3.7 3.7l-1.8 1.9c-.3.3-.5.6-.8.8-.1.1-.2 0-.4.2.1.2.1.5.1.6-1-.3-2.1-.4-3.2-.2-4.4.6-7.5 4.7-6.9 9.1.3 2.1 1.3 3.8 2.8 5.1l11 9.3c1.8 1.5 3.3 3.8 4.6 5.7 1.5 2.3 2.8 4.9 3.5 7.6 1.7 6.8-.8 13.4-5.4 18.4-.5.6-1.1 1-1.4 1.7-.2.6-.4 1.3-.6 2-.4 1.5-.5 3.1-.3 4.6.4 3.1 1.8 6.1 4.1 8.2 3.3 3 8 4 12.4 4.5 5.2.6 10.5.7 15.7.2 4.5-.4 9.1-1.2 13-3.4 5.6-3.1 9.6-8.9 10.5-15.2M76.4 46c.9 0 1.6.7 1.6 1.6 0 .9-.7 1.6-1.6 1.6-.9 0-1.6-.7-1.6-1.6-.1-.9.7-1.6 1.6-1.6zm-25.7 0c.9 0 1.6.7 1.6 1.6 0 .9-.7 1.6-1.6 1.6-.9 0-1.6-.7-1.6-1.6-.1-.9.7-1.6 1.6-1.6z"/> <path fill="#E0F7FA" d="M105.3 106.1c-.9-1.3-1.3-1.9-1.3-1.9l-.2-.3c-.6-.9-1.2-1.7-1.9-2.4-3.2-3.5-7.3-5.4-11.4-5.7 0 0 .1 0 .1.1l-.2-.1c-6.4 6.9-16 11.3-26.7 11.6-11.2-.3-21.1-5.1-27.5-12.6-.1.2-.2.4-.2.5-3.1.9-6 2.7-8.4 5.4l-.2.2s-.5.6-1.5 1.7c-.9 1.1-2.2 2.6-3.7 4.5-3.1 3.9-7.2 9.5-11.7 16.6-.9 1.4-1.7 2.8-2.6 4.3h109.6c-3.4-7.1-6.5-12.8-8.9-16.9-1.5-2.2-2.6-3.8-3.3-5z"/> <circle fill="#444" cx="76.3" cy="47.5" r="2"/> <circle fill="#444" cx="50.7" cy="47.6" r="2"/> <path fill="#444" d="M48.1 27.4c4.5 5.9 15.5 12.1 42.4 8.4-2.2-6.9-6.8-12.6-12.6-16.4C95.1 20.9 92 10 92 10c-1.4 5.5-11.1 4.4-11.1 4.4H62.1c-1.7-.1-3.4 0-5.2.3-12.8 1.8-22.6 11.1-25.7 22.9 10.6-1.9 15.3-7.6 16.9-10.2z"/> </svg> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-10" x="256" y="256"> <path fill="#FFCC80" d="M41.6 123.8s0 .1-.1.1l.3-.4c-.1.2-.1.2-.2.3z"/> <path fill="#8C9EFF" d="M0 0h128v128H0z"/> <path fill="#C2C2C2" d="M34.8 79.5c-2.5-3.4-5.9-6.4-6.9-10.3v-.1l-.6-.5c-.3-1.2.6-2 .5-3l-2.4-1h-6.9s0 17 17.4 17.3c-.9-.9-.7-1.8-1.1-2.4z"/> <path fill="#CFD8DC" d="M21.9 64.2l-.1-.3c0-.1 0-.2-.1-.4v-1l.1-.3c.1-.1.1-.2.1-.3.1-.1.1-.2.1-.2.2-.4.1-.8-.2-1.1-.4-.4-1-.4-1.3 0l-.2.2-.2.2c-.1.1-.2.2-.3.4l-.3.6-.3.6c-.1.2-.2.4-.2.7 0 .2-.1.5-.1.8v.5h3c.2-.2.1-.3 0-.4z"/> <path fill="#eee" d="M116.5 65.2c.1.1.2.1.2.2 0-.1-.1-.2-.2-.2zm8.2 6.1l.6.3c-.3-.1-.4-.2-.6-.3zm1.7 1l.6.3c-.2 0-.4-.1-.6-.3zm-3.4-2.1l.5.3c-.2 0-.4-.2-.5-.3zm-8-6.5zm-.1 64.1c-12-17.2-7.6-52-3.1-67.6v-.1c-3.5-4.2-7.8-11.7-10.2-18.7-1.7-5-4-8.8-6.4-11.8l-1.6-2-10.7 11.8c-1.5 2.1-3.3 1.8-4.1-.6l-7.1-17.3c-.3-.9-.3-1.9 0-2.7.3-1.1-.1-2.1.7-3l-2-.1c-1.3 0-2.5.1-3.7.3-1.7-.3-3.4-.5-5.1-.5-11.9 0-21.9 8.1-24.8 19.2-.5 1.8-.7 3.7-.8 5.6-1.2 3.6-4.2 7.7-11.5 8.4 1.3.4 2.2 1.9 2 3.6l-.5 2.8c-.3 2-1.2 2.4-2.2.9l1.6 8.6.2.9c.1 1.1.3 2.2.6 3.4 1 4 3.2 8.2 7.8 10.9.3.6 1 1.3 2 2.1 8.2 6.7 36 20.7 27.8 46.1h51.3c0-.1-.1-.1-.2-.2zM34.5 59.3c.5 0 1 .4 1 1 0 .5-.4 1-1 1-.5 0-1-.4-1-1s.4-1 1-1zm7.4 3.9c.5 0 1 .4 1 1 0 .5-.4 1-1 1-.5 0-1-.4-1-1 0-.5.5-1 1-1zm-1-8.5c-.5 0-1-.4-1-1 0-.5.4-1 1-1 .5 0 1 .4 1 1s-.5 1-1 1zm3.9-10.9c-.9 0-1.6-.7-1.6-1.6 0-.9.7-1.6 1.6-1.6.9 0 1.6.7 1.6 1.6 0 .9-.7 1.6-1.6 1.6zm73.3 22.7c.1.1.2.2.4.3-.2-.1-.3-.2-.4-.3zm3.2 2.6l.5.3-.5-.3zm-1.6-1.3l.4.3c-.1 0-.3-.1-.4-.3z"/> <path fill="#C2C2C2" d="M114.9 127.8l.2.2H128V73.2l-1-.6-.6-.3-1.2-.7-.6-.3-1.2-.7-.5-.3-1.2-.8-.5-.3-1.2-.9-.4-.3-1.2-1c-.1-.1-.2-.2-.4-.3l-1.3-1.2c-.1-.1-.2-.1-.2-.2l-1.5-1.5c-1.5-1.6-3-3.3-4.4-5.1-4.6 15.4-13 52.7 4.3 69.1z"/> <path fill="#646464" d="M26 55.1l.4-2.8c.2-1.8-.6-3.2-2-3.6-.3-.1-.7-.2-1.1-.1-2 .1-2.7 1.9-1.6 3.8l1.8 3.3c.1.2.2.3.3.4 1 1.3 1.9 1 2.2-1z"/> <circle fill="#444" cx="44.8" cy="42.2" r="2"/> <circle fill="#CFD8DC" cx="34.5" cy="60.3" r="1"/> <circle fill="#CFD8DC" cx="40.9" cy="53.7" r="1"/> <circle fill="#CFD8DC" cx="41.9" cy="64.2" r="1"/> <path fill="#646464" d="M70.7 18.8c-.3.8-.3 1.8 0 2.7l8.1 19.3c.8 2.5 2.6 2.7 4.1.6l12.3-11.8 1.4-1.3c.3-.4.5-.9.6-1.3.4-1.2.3-2.4-.1-3.6-1.1-4.3-5.6-8.9-11.2-10.3-5.6-1.4-10.9-.2-13.6 2.7-.8.8-1.3 1.8-1.6 3z"/> </svg> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-11" y="128"> <path fill="#FFCC80" d="M41.6 123.8s0 .1-.1.1l.3-.4c-.1.2-.1.2-.2.3z"/> <path fill="#FFFF8D" d="M0 0h128v128H0z"/> <path fill="#F4B400" d="M110.3 91.4l-.5-.5c.1.2.3.4.5.5zm-4.4-4.5l.4.5c-.1-.2-.3-.4-.4-.5zm9.8 9.5c.2.2.4.4.7.6-.3-.2-.5-.4-.7-.6zM104.3 85c.2.2.3.4.5.5-.2-.1-.4-.3-.5-.5zm3.7 4.1zm16.9 14l.9.6c-.3-.3-.6-.4-.9-.6zm-28.5-29l.1.2c-.1 0-.1-.1-.1-.2zm15.2 18.6c.2.2.4.4.7.6l-.7-.6zm10 8.2l.9.6-.9-.6zm-18.8-17.7l.4.5c-.1-.1-.3-.3-.4-.5zm-1.4-1.7c.1.1.1.2.2.2-.1 0-.1-.1-.2-.2zm12.2 13l.7.6c-.2-.1-.5-.4-.7-.6zm-15-16.8c.1.1.1.2.2.2l-.2-.2zm-1.2-1.8l.2.3c0-.1-.1-.2-.2-.3zm28.4 27.7l-.9-.6-2.4-1.5-.9-.6c-1-.7-2.1-1.4-3.1-2.2l-2.2-1.8c-.2-.2-.4-.4-.7-.6-.5-.4-1-.8-1.4-1.2l-.7-.6-1.3-1.2-.7-.6c-.5-.4-.9-.9-1.3-1.3l-.5-.5-1.8-1.8c-.6-.6-1.1-1.2-1.6-1.8l-.4-.5-1.2-1.3c-.2-.2-.3-.4-.5-.5l-1.1-1.3-.4-.5-1.2-1.5c-.1-.1-.1-.2-.2-.2-.9-1.2-1.8-2.4-2.6-3.6-.1-.1-.1-.2-.2-.2l-1-1.5-.2-.3c-.3-.5-.6-1-1-1.5l-.1-.2c-1.1-1.8-2-3.5-2.9-5.2-3.1-6-4.8-11.4-5.7-15.9-.2-.9-.3-1.7-.4-2.6L85 13l-8 10.2c-3.7-2.6-8.2-4.2-13.1-4.2s-9.4 1.5-13.1 4.1L42.7 13l-1.8 29-7.7 71.8h.2c-.1 1-.2 2-.2 3 0 4 .8 7.7 2.1 11.2H128v-23.1c-.7-.4-1.5-.8-2.2-1.3zM55 38.4c-.9 0-1.6-.7-1.6-1.6 0-.9.7-1.6 1.6-1.6.9 0 1.6.7 1.6 1.6 0 .8-.7 1.6-1.6 1.6zm17.9 0c-.9 0-1.6-.7-1.6-1.6 0-.9.7-1.6 1.6-1.6.9 0 1.6.7 1.6 1.6 0 .8-.7 1.6-1.6 1.6z"/> <circle fill="#444" cx="72.9" cy="36.7" r="2"/> <circle fill="#444" cx="55" cy="36.7" r="2"/> <path fill="#444" d="M61.6 39.5c-.5 1-.1 1.7 1 1.7h4.6c1.1 0 1.6-.8 1-1.7l-2.3-4c-.5-1-1.4-1-2 0l-2.3 4z"/> <path fill="#FF5722" d="M92.5 102.7c8.3 11.3 23.6 14.4 35.5 7.8v-5.6l-2.2-1.3-.9-.6-2.4-1.5-.9-.6c-1-.7-2.1-1.4-3.1-2.2l-2.2-1.8c-.2-.2-.4-.4-.7-.6-.5-.4-1-.8-1.4-1.2l-.7-.6-1.3-1.2-.7-.6c-.5-.4-.9-.9-1.3-1.3l-.5-.5-1.8-1.8c-.6-.6-1.1-1.2-1.6-1.8l-.4-.5-1.2-1.3c-.2-.2-.3-.4-.5-.5l-1.1-1.3-.4-.5-1.2-1.5c-.1-.1-.1-.2-.2-.2-.9-1.2-1.8-2.4-2.6-3.6-.1-.1-.1-.2-.2-.2l-1-1.5-.2-.3c-.3-.5-.6-1-1-1.5l-.1-.2c-1.1-1.8-2-3.5-2.9-5.2-7.7 9.4-8.4 23.4-.8 33.7z"/> </svg> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-12" x="128" y="128"> <path fill="#B9F6CA" d="M0 0h128v128H0z"/> <path fill="#444" d="M50.4 75.7c-1.6-1.6-3.2-2.9-4.7-4-.9-.6-1-1.7-1.7-2.2-1.8-1-3.2-5.9-5.3-3.4l-.5.8-.4-.9c-1.3-1.2-1-.4-1.3-2.3-.5-4.2 1.2-7.2 5.1-7.8 1-.1 2-.1 2.9.2 9.5-1.8 13.7-7.4 15.2-10 4 5.7 14.3 11.4 38.3 7.8 2.8-4.7 4.5-10.2 4.5-16C102.4 20.8 88.6 7 71.6 7c-6.7 0-12.8 2.1-17.9 5.7L27.9 31C16.3 36.6 8.3 48.5 8.3 62.2c0 19.1 15.5 34.6 34.6 34.6 4.6 0 9-.9 13-2.5.2-8.4-1.4-14.5-5.5-18.6zm-5.9-21.6z"/> <path fill="#8D6E63" d="M73.7 122c6.1.5 13.4-.3 22-3.5-.1-.7-.3-1.4-.5-2.1-.3-1.3-3.8-21.4-4-28.1-.1-7.3.8-11.9 2-14.7h8.7l-2.5-10.1c-.2-2.4-.4-4.7-.7-6.6-.2-1.8-.3-2.3-.8-3.9-24 3.6-34.2-3.7-38.2-9.4-1.4 2.5-5.7 8.8-15.3 10.5-.9-.3-1.9-.3-2.9-.2-3.9.6-6.7 4.5-6.1 8.8.3 2 1.2 3.6 2.5 4.8.2.1 1.5.6 3.3 1.7.7.4 1.6.9 2.4 1.6 1.5 1.1 3.1 2.4 4.7 4 4 4.1 7.6 10.2 7.4 18.5-.1 4.9-1.6 10.6-5.1 17.2.1 0 7.3 10.2 23.1 11.5zM44.5 54.1z"/> <path fill="#FFCC80" d="M41.6 123.8s.1-.2.2-.3c-.1.2-.1.2-.2.3z"/> <circle fill="#444" cx="83.5" cy="63.1" r="2"/> <path fill="#0097A7" d="M73.7 122c-15.9-1.3-23-11.5-23-11.5-2.1 4-5.1 8.4-8.9 13.1l-.3.4c-.5.6-1.1 1.3-1.7 2-.5.6-1 1.3-1.6 2.1h59.7c-.7-3.2-1.5-6.4-2.1-9.5-8.7 3.1-16 3.9-22.1 3.4z"/> </svg> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-13" x="256"> <path fill="#448AFF" d="M0 0h128v128H0z"/> <g fill="#00BFA5"> <path d="M73 18.7c-4.8 0-9.7.8-14 2.3-.1.1-.2.2-.4.3l-7.3 4.6c-.6.4-1.4.4-2 .1-.3-.2-.6-.4-.8-.7l-.7-1.1c-.6-1-.3-2.2.6-2.8l7.3-4.6c.4-.2.8-.3 1.2-.3-5.5-3-23.7-10.7-33.7 10.7-11.8 25.4 11 50.2-14.4 62.6 0 0 26.2 13.7 40.9-24.8 3.7 3.2 8.8 5.8 16 7.4-.6-5.6.8-9.8-2.1-12.8-1.3-1.4-2.7-1.5-4-2.4-.7-.5-1.4-.9-2-1.3-1.5-.9-2.6-1.3-2.8-1.4-1.1-1-1.9-2.4-2.1-4.1-.5-3.6-2.2-6.9 1.1-7.4.8-.1 1.6-.1 2.4.2 8-1.5 11.6-6.7 12.8-8.9 3.4 4.8 11.7 9.8 31.9 6.8.3 1.1.6 1.2.8 2.4l.5-1.3c-.1-13-13.2-23.5-29.2-23.5zM56.1 43.2zm5.3 46.5s6 8.6 19.4 9.7c5.1.4 11.3-.3 18.6-2.9-.1-.6-.3-1.2-.4-1.7-.2-1.1-3.2-18-3.4-23.6-.2-6.2.6-10 1.6-12.4h7.3l-2.1-8.5c-.1-2-.4-3.9-.6-5.6 0-.3-.1-.7-.2-1-.2-1.1-.4-2.3-.8-3.4-20.2 3-28.5-2-31.9-6.8-1.2 2.1-4.8 7.4-12.8 8.9-.8-.2-1.6-.3-2.4-.2-3.3.5-5.6 3.8-5.1 7.4.2 1.7 1 3.1 2.1 4.1.2.1 1.3.5 2.8 1.4.6.4 1.3.8 2 1.3 1.3.9 2.6 2 4 3.4 2.9 3 5.6 7.2 6.1 12.8.5 4.5-.6 10.2-4.2 17.1zm27.5-41.2c.7 0 1.3.6 1.3 1.3s-.6 1.3-1.3 1.3-1.3-.6-1.3-1.3.6-1.3 1.3-1.3zm-32.8-5.3c.1-.1 0-.1 0 0zm-2.4 57.7l.2-.2-.2.2z"/> <circle cx="88.9" cy="49.8" r="2"/> <path d="M80.8 99.3c-13.3-1.1-19.4-9.7-19.4-9.7-1.8 3.4-4.3 7.1-7.5 11l-.3.3c-.4.5-.9 1.1-1.4 1.7-.7.9-1.6 2.1-2.8 3.7-2.3 3.2-5.4 7.8-8.8 13.5-1.4 2.4-2.9 5.1-4.4 8 0 0 0 .1-.1.1h71.3c-.6-1.6-1.3-3.2-1.7-4.8-2.2-8.6-4.6-17.9-6.5-26.8-7.2 2.8-13.3 3.5-18.4 3zM55.7 16.7l-7.3 4.6c-1 .6-1.3 1.9-.6 2.8l.7 1.1c.2.3.5.6.8.7.6.3 1.4.3 2-.1l7.3-4.6.4-.3c.7-.7.8-1.7.3-2.5l-.7-1.1c-.4-.6-1-.9-1.6-1-.5 0-1 .1-1.3.4z"/> </g> <path fill="#444" d="M73 18.7c-4.8 0-9.7.8-14 2.3-.1.1-.2.2-.4.3l-7.3 4.6c-.6.4-1.4.4-2 .1-.3-.2-.6-.4-.8-.7l-.7-1.1c-.6-1-.3-2.2.6-2.8l7.3-4.6c.4-.2.8-.3 1.2-.3-5.5-3-23.7-10.7-33.7 10.7-11.8 25.4 11 50.2-14.4 62.6 0 0 26.2 13.7 40.9-24.8 3.7 3.2 8.8 5.8 16 7.4-.6-5.6.8-9.8-2.1-12.8-1.3-1.4-2.7-1.5-4-2.4-.7-.5-1.4-.9-2-1.3-1.5-.9-2.6-1.3-2.8-1.4-1.1-1-1.9-2.4-2.1-4.1-.5-3.6-2.2-6.9 1.1-7.4.8-.1 1.6-.1 2.4.2 8-1.5 11.6-6.7 12.8-8.9 3.4 4.8 11.7 9.8 31.9 6.8.3 1.1.6 1.2.8 2.4l.5-1.3c-.1-13-13.2-23.5-29.2-23.5zM56.1 43.2z"/> <path fill="#FFE0B2" d="M61.4 89.7s6 8.6 19.4 9.7c5.1.4 11.3-.3 18.6-2.9-.1-.6-.3-1.2-.4-1.7-.2-1.1-3.2-18-3.4-23.6-.2-6.2.6-10 1.6-12.4h7.3l-2.1-8.5c-.1-2-.4-3.9-.6-5.6 0-.3-.1-.7-.2-1-.2-1.1-.4-2.3-.8-3.4-20.2 3-28.5-2-31.9-6.8-1.2 2.1-4.8 7.4-12.8 8.9-.8-.2-1.6-.3-2.4-.2-3.3.5-5.6 3.8-5.1 7.4.2 1.7 1 3.1 2.1 4.1.2.1 1.3.5 2.8 1.4.6.4 1.3.8 2 1.3 1.3.9 2.6 2 4 3.4 2.9 3 5.6 7.2 6.1 12.8.5 4.5-.6 10.2-4.2 17.1zm27.5-41.2c.7 0 1.3.6 1.3 1.3s-.6 1.3-1.3 1.3-1.3-.6-1.3-1.3.6-1.3 1.3-1.3zm-32.8-5.3c.1-.1 0-.1 0 0z"/> <path fill="#FFCC80" d="M53.7 100.9l.2-.2-.2.2z"/> <circle fill="#444" cx="88.9" cy="49.8" r="2"/> <path fill="#FF5722" d="M80.8 99.3c-13.3-1.1-19.4-9.7-19.4-9.7-1.8 3.4-4.3 7.1-7.5 11l-.3.3c-.4.5-.9 1.1-1.4 1.7-.7.9-1.6 2.1-2.8 3.7-2.3 3.2-5.4 7.8-8.8 13.5-1.4 2.4-2.9 5.1-4.4 8 0 0 0 .1-.1.1h71.3c-.6-1.6-1.3-3.2-1.7-4.8-2.2-8.6-4.6-17.9-6.5-26.8-7.2 2.8-13.3 3.5-18.4 3z"/> <path fill="#00BFA5" d="M55.7 16.7l-7.3 4.6c-1 .6-1.3 1.9-.6 2.8l.7 1.1c.2.3.5.6.8.7.6.3 1.4.3 2-.1l7.3-4.6.4-.3c.7-.7.8-1.7.3-2.5l-.7-1.1c-.4-.6-1-.9-1.6-1-.5 0-1 .1-1.3.4z"/> </svg> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-14" x="256" y="128"> <path fill="#B388FF" d="M0 0h128v128H0z"/> <path fill="#1C3AA9" d="M70.5 128h12.4c-5.1-15.8-6.6-23.9-7.2-28.4-1.9 8.8-4 19.3-5.2 28.4z"/> <path d="M92.9 32.8l-.2.1c.1 0 .2 0 .2-.1zm-1.2.5l-.7.1.7-.1zm.6-.2l-.3.1.3-.1zm-52 .3c-.2 0-.5 0-.7-.1.3 0 .5.1.7.1zm-.9-.2l-.5-.1.5.1zm-.7-.2c-.2-.1-.4-.2-.5-.3.1.1.3.2.5.3z" fill="none"/> <path fill="#2A56C6" d="M82.9 90.8v.2-.2z"/> <path fill="#FFE0B2" d="M31.2 47.2zM45.8 93c5.8 5.5 13.6 9.1 22.3 9.3 2.8-.1 5.4-.5 8-1.2l.8-3.8c4.3-19.3 9.7-37.4 15-52.9h6.9L94 36.2c-.2-1.2-.4-2.5-.7-3.6l-.4.3-.2.1-.4.2-.3.1-.3.1-.7.1H40.3c-.2 0-.5 0-.7-.1-.1 0-.1 0-.2-.1l-.5-.1-.2-.1c-.2-.1-.4-.2-.5-.3 0 0-.1 0-.1-.1-.1.2-.1.4-.1.7-1-.3-2-.4-3-.3-4.1.6-6.9 4.7-6.3 9.1.3 2 1.2 3.8 2.6 5 .3.1 1.6.7 3.4 1.7.8.4 1.6 1 2.5 1.6 1.5 1.1 3.2 2.5 4.9 4.1 0 0 16.3 12.3 3.4 38 .1.2.2.3.3.4zm34.1-51.9c.8 0 1.5.7 1.5 1.6 0 .9-.7 1.6-1.5 1.6s-1.5-.7-1.5-1.6.6-1.6 1.5-1.6z"/> <path fill="#2A56C6" d="M68.1 102.3c-8.7-.2-16.5-3.8-22.3-9.3-.1-.1-.2-.2-.4-.3-3-.2-7.6.2-10.8.6-4.6.6-9.6 1.3-15 2.4-3.6.7-8.1 1.9-19.7 5.3v27h71.4c1.3-9.1 2.9-18.1 4.7-26.9-2.5.7-5.1 1.1-7.9 1.2z"/> <path fill="#6D4C41" d="M61.8 9.8c-7.3 1.1-13.6 5.1-17.9 10.8h43.7C81.5 12.7 71.9 8.3 61.8 9.8z"/> <path fill="#E65100" d="M38.7 33l.2.1c.2.1.3.1.5.1.1 0 .1 0 .2.1l.7.1H91c.2 0 .5 0 .7-.1l.3-.1.3-.1c.1 0 .3-.1.4-.2l.2-.1.4-.3c1-.7 1.6-1.9 1.6-3.2v-4.8c0-2.2-1.8-4-4-4H40.4c-2.2 0-4 1.8-4 4v4.8c0 1.4.7 2.6 1.8 3.3 0 0 .1 0 .1.1s.2.2.4.3z"/> <ellipse fill="#444" cx="79.9" cy="42.7" rx="2" ry="2.2"/> </svg> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-15" y="256"> <path fill="#FF80AB" d="M0 0h128v128H0z"/> <path fill="#5D4037" d="M87.3 11.7c-7.6 0-14.1 4.9-16.4 11.7-2.8-1.6-5.9-2.7-9.1-3.1-13.9-2.1-26.9 7.1-31.1 21.1 5 .8 9.5 3.1 13.4 3.1 1.4-.6 3-.9 4.6-.9 1.1 0 2.2.2 3.3.5 10-1.3 15.2-5.2 17.9-9 .3.5.6 1 1 1.6v.1c2.1 3.1 6.6 7.7 14.7 9.2.9-.3 1.9-.4 3-.2 1.5.2 2.8-1.1 3.8-.1 7-2.2 12.2-8.8 12.2-16.5 0-9.7-7.8-17.5-17.3-17.5z"/> <path d="M70.9 36.6c-.4-.6-.8-1.2-1-1.6.2.5.5 1 1 1.6z" fill="none"/> <path fill="#5D4037" d="M85.6 45.9z"/> <path fill="#FFCC80" d="M48.6 63.8c5.6 0 10.1-4.5 10.1-10.1s-4.5-10.1-10.1-10.1-10.1 4.5-10.1 10.1c.1 5.5 4.6 10.1 10.1 10.1zm-1.7-10.5c0 .9-.7 1.6-1.6 1.6-.9 0-1.6-.7-1.6-1.6 0-.9.7-1.6 1.6-1.6.9-.1 1.6.7 1.6 1.6zm38.7-7.4z"/> <path fill="#F9A825" d="M35.6 117.3c0 2.5 2.1 4.6 4.6 4.6s4.6-2.1 4.6-4.6c0-1.7-.9-3.2-2.3-4-.8-.2-1.8-.3-2.7-.6-2.3.3-4.2 2.2-4.2 4.6z"/> <circle fill="#F9A825" cx="64.3" cy="117.1" r="4.6"/> <path fill="#F9A825" d="M83.4 117.3c0 2.5 2.1 4.6 4.6 4.6 1.5 0 2.8-.7 3.7-1.8l-.7-.9-.6-.8c-.6-.7-1.3-1.5-1.8-2.1l-.3-.4c-.4-.5-.8-.9-1.2-1.5-.3-.4-.6-.8-.9-1.3-1.7.8-2.8 2.4-2.8 4.2z"/> <path fill="#FFEE58" d="M91.6 119.8c-.8 1-2.1 1.7-3.5 1.7-2.4 0-4.4-2-4.4-4.4 0-1.8 1-3.3 2.5-4-3-3.9-5.3-7.5-7.2-11 .2.1-7.3 10.6-23.7 12-3.8.3-8 .1-12.8-.8 1.3.8 2.2 2.2 2.2 3.8 0 2.4-2 4.4-4.4 4.4s-4.4-2-4.4-4.4c0-2.3 1.8-4.2 4-4.4-2.4-.6-4.8-1.3-7.4-2.2-1.2 5.7-2.6 11.6-4.1 17.5h69c-1.4-2-2.6-3.8-3.7-5.3m-29.4-1.2c-2.4 0-4.4-2-4.4-4.4s2-4.4 4.4-4.4 4.4 2 4.4 4.4c0 2.4-2 4.4-4.4 4.4z"/> <path fill="#FFCC80" d="M92.4 45.6c-1-1-2.4-1.7-3.8-1.9-1-.2-2-.1-3 .2-8.1-1.5-12.6-6.1-14.7-9.2-.5-.7-.8-1.2-1.1-1.7-2.7 3.8-7.9 7.7-17.9 9l.9.3-9.4.4.6-.3c-3.9 0-8.3-.4-13.4-1.1-.5 1.7-.9 3.5-1.2 5.3-.2 1.8-.5 3.8-.6 6l-.3 2-2.3 9.4h9c1.2 3 2.1 7.7 1.9 15.3-.2 6.9-3.9 27.7-4.2 29-.1.7-.3 1.4-.5 2.1 2.6.9 5 2 7.3 2.5l2.7.5c4.8.9 9.2 1.4 13 1.1 16.4-1.3 24-12 24-12-9.8-18.4-4.6-30.7 2.1-37.5 1.6-1.7 3.3-3 4.9-4.1.9-.6 1.7-1.2 2.5-1.6 1.8-1.1 3.2-1.6 3.4-1.7 1.3-1.2 2.3-3 2.6-5 .3-2.6-.7-5.3-2.5-7zm-32.9 2.7c.5 1 .8 2 1 3.1l-1-3.1z"/> <path fill="#DB4437" d="M36.6 54.7c.5 6.2 5.7 11.1 12 11.1 6.7 0 12.1-5.4 12.1-12.1 0-5.5-3.7-10.2-8.8-11.6-1-.3-2.1-.5-3.3-.5-1.6 0-3.2.3-4.6.9-4.1 1.7-7.1 5.6-7.4 10.2h-7.7l-.1.9-.3 1.1h8.1zm12-11.1c5.6 0 10.1 4.5 10.1 10.1s-4.5 10.1-10.1 10.1-10.1-4.5-10.1-10.1c.1-5.6 4.6-10.1 10.1-10.1z"/> <circle fill="#444" cx="45.3" cy="53.3" r="2"/> </svg> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-16" x="128" y="256"> <path fill="#B388FF" d="M0 0h128v128H0z"/> <path fill="#444" d="M58.4 24c4.2 5.9 23.9 10.2 38.9 4.6-4.2-14-17.1-23.2-31.1-21.1-11.7 1.8-20.8 11.2-23.7 22.9 7 3.2 14.5-3.8 15.9-6.4z"/> <path fill="#689F38" d="M72.7 101.3C56.3 100 48.8 89.4 48.8 89.4c-2.2 4.2-5.2 8.7-9.2 13.5l-.3.4-1.7 2c-.9 1.1-2 2.6-3.4 4.5-2.8 3.9-6.6 9.5-10.8 16.6l-.8 1.4h80.1c-2.5-9.8-5.1-20.3-7.3-30.2-8.9 3.4-16.5 4.3-22.7 3.7z"/> <path fill="#FFCC80" d="M101.8 51.3l-2.6-10.4c-.2-2.5-.5-4.9-.7-6.9-.2-1.9-.6-3.6-1.2-5.3-24.8 3.7-35-2.5-39.1-8.4-1.5 2.6-5.8 8.4-15.6 10.2-.1.2-.1.5-.1.7-.9-.3-1.9-.4-3-.2-4.1.6-6.9 4.7-6.3 9.1.3 2 1.2 3.8 2.6 5 .3.1 1.6.7 3.4 1.7.8.4 1.6 1 2.5 1.6 1.5 1.1 3.2 2.5 4.9 4.1 6.6 6.8 12.1 18.6 2.4 37 0 0 7.4 10.6 23.8 11.9 6.3.5 13.8-.3 22.8-3.6l-.5-2.1c-.3-1.4-4-22.1-4.2-29-.2-7.6.7-12.3 1.9-15.3h9zM81.1 40.5c0-.9.7-1.6 1.6-1.6.9 0 1.6.7 1.6 1.6 0 .9-.7 1.6-1.6 1.6-.9.1-1.6-.7-1.6-1.6zm-41.7 62.8s0 .1-.1.1l.3-.4c0 .1-.1.2-.2.3z"/> <circle fill="#444" cx="82.7" cy="40.5" r="2"/> </svg> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-2"> <path fill="#B9F6CA" d="M0 0h128v128H0z"/> <path fill="#FFCC80" d="M70.1 122.5l.6-.1c6.1-.8 12-2.4 17.7-4.8 1.2-.5 2.4-1.1 3.2-2.1 1.3-1.7-.1-5.6-.5-7.7-.7-3.8-1.3-7.7-1.9-11.5-.7-4.5-1.5-9.1-1.6-13.7-.2-7.6.7-12.3 1.9-15.3h9l-2.6-10.4c-.2-2.4-.4-4.8-.7-6.8-.2-1.9-.6-3.6-1.2-5.3-14.9 2.2-24.5.9-30.7-1.8l-23.1 4.5-.7.1h-.7c-.4-.1-.9-.2-1.2-.4-.4 0-.9 0-1.4.1-4.1.6-6.9 4.7-6.3 9.1.3 2 1.2 3.8 2.6 5 .3.1 1.6.7 3.4 1.7.8.4 1.6 1 2.5 1.6 1.5 1.1 3.2 2.5 4.9 4.1 5.8 5.9 8.4 13.8 7.4 22-.6 4.7-2.2 9.4-4.4 13.6-.5 1-1 1.6-1.1 2.8-.1 1.1-.1 2.3.1 3.4.4 2.3 1.5 4.4 3 6.2 2.6 3.1 6.4 5 10.4 5.8 3.8.4 7.6.3 11.4-.1zm9.5-67.6c.9 0 1.6.7 1.6 1.6 0 .9-.7 1.6-1.6 1.6s-1.6-.7-1.6-1.6c-.1-.8.7-1.6 1.6-1.6zM128 97.7c-3.3 1.9-6.6 3.7-9.9 5.3-3.2 1.5-6.3 2.9-9.6 4.2-.9.4-2.1.5-2.9 1.1-1.1.8-1.9 2.5-2.3 3.7-.6 1.6-.6 3.4.3 4.8.8 1.2 2.1 2 3.5 2.6 5.9 2.9 12.2 5.1 18.6 6.5 1.4.3 2.3 1.8 2.4.1V97.9c-.1.1-.1-.1-.1-.2z"/> <path d="M38.9 47.4zm.7 0z" fill="none"/> <path fill="#444" d="M94.2 44.9c-.8-2.6-1.8-5-3.2-7.2l-7.2 1.4-20.4 4c6.3 2.7 15.9 4 30.8 1.8z"/> <path fill="#E65100" d="M38.9 48.4h.7c.2 0 .5 0 .7-.1l23.1-4.5 20.4-4 23.3-4.5c1.9-.4 3.2-2 2.9-3.6-.3-1.6-2.1-2.6-4.1-2.3l-19.6 3.8-1.3-6.8C83 15.5 70 8.7 55.9 11.5c-14 2.7-23.7 13.9-21.6 24.9h.1l1.7 9v.7c.2.8.7 1.4 1.4 1.9.5.1 1 .3 1.4.4z"/> <circle fill="#444" cx="79.6" cy="56.5" r="2"/> <path fill="#689F38" d="M128 128v-1.8L106.3 108l-.4.2-2.9 1.3c-3 1.3-6 2.6-9.2 3.8l-1.4.5c-9 3.3-16.5 4.1-22.8 3.6-16.4-1.3-23.8-11.9-23.8-11.9-2.2 4.2-5.2 8.7-9.2 13.5l-.3.4-1.7 2c-.9 1.1-2 2.6-3.4 4.5-.4.6-.9 1.3-1.4 2l98.2.1z"/> <path fill="#FFCC80" d="M36.3 119.3s.1-.2.2-.3c-.1.1-.2.2-.2.3z"/> </svg> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-3" x="384"> <path fill="#80D8FF" d="M0 0h128v128H0z"/> <path fill="#5D4037" d="M53.7 68.3c.9-.1 1.7-.3 2-.9.1-.2.2-.4.2-.6.2-1-.2-2-.5-3-1.2-3.2-2-6.4-2.2-9.8-.3-3.9.4-7.8 1-11.6l12.7-8.1c.8-.5 1.8-1.5 2.7-1.7.9-.3 2.4.6 3.3.8 1.3.4 2.6.6 4 .9 5.4.9 10.9.7 16.2-.6 1.3-.3 2.7-1.1 4-1.3-.3-2.1-1.5-4.3-2.5-6.1-1-1.9-2.2-3.7-3.6-5.3-2.7-3.2-6-5.8-9.8-7.5-3.3-1.5-6.8-2.4-10.4-2.5 0 0-50.8-8.1-42.4 56.4l12.8.5 8.7.3c.9-.1 2.5.2 3.8.1z"/> <path d="M59.5 25.7l-.3-.4c0 .2.1.3.3.4zm-1-1.2c-.2-.2-.3-.4-.4-.6.1.2.2.4.4.6zm.4.6l-.3-.4.3.4zm1.1 1.2l-.4-.4c.2.1.3.3.4.4zM46.3 56.2zm.5.4l.3.3-.3-.3zm-.2-.2l.2.2-.2-.2zm-.2-.2l.1.1-.1-.1zm14.3-29.3l-.4-.4c.1.1.2.3.4.4zm8.6 4.7l-1-.3c.3 0 .6.2 1 .3zm1.3.3c-.4-.1-.8-.2-1.1-.3.3.1.7.2 1.1.3zm-23.4 25l.4.4c-.2-.1-.3-.3-.4-.4zm27-24.2l-.9-.2c.3.1.6.2.9.2zm-12.8-5.2l-.5-.4c.1.1.3.2.5.4zm6.7 3.7c-.3-.1-.6-.2-.9-.4.2.1.6.2.9.4zm-5.9-3.1l-.6-.5.6.5zm3.7 2.2c-1.4-.6-2.6-1.3-3.6-2.1 1 .7 2.2 1.4 3.6 2.1zm1.1.4l-.9-.4c.2.2.5.3.9.4zm20.1 2.7h-.8.8zm-3.2 0h1.4-1.4zm-3.9 0l1.9.1c-.6 0-1.1 0-1.7-.1H80zm2 0h1.6H82zm6.1-.1c.3 0 .7 0 1-.1h-.2c-.2.1-.5.1-.8.1zm6.2-.6l-.7.1c1.2-.1 2.4-.3 3.6-.5l-2.2.3c-.2.1-.5.1-.7.1zm-3.4.4c-.3 0-.6 0-.8.1.9-.1 1.9-.2 2.9-.3l-.8.1c-.5 0-.9 0-1.3.1zM51.1 61.9c.2.3.4.6.5 1-.2-.4-.3-.7-.5-1zm-3.5-4.6c.8.8 1.8 1.9 2.8 3.5-1-1.5-2-2.7-2.8-3.5zm2.9 3.6l.6.9c-.3-.3-.5-.6-.6-.9zm1.2 2.1l.6 1.1c-.3-.4-.4-.8-.6-1.1zm26.5-29.8l-.9-.1c-.2 0-.3 0-.5-.1l-.9-.1h-.2c1.3.2 2.6.3 4 .4-.3 0-.6 0-.9-.1-.2.1-.4.1-.6 0zm-3.8-.4l1.1.2-.9-.1c-.1-.1-.2-.1-.2-.1zm-3.7-.8c.7.2 1.5.4 2.3.5l-.9-.2-1.4-.3zM52.2 64.1c.6 1.2 1.1 2.6 1.5 4.1-.4-1.5-.9-2.9-1.5-4.1z" fill="none"/> <path fill="#E65100" d="M101.3 128h.3c-2.4-9.5-4.8-19.4-6.8-28.7-7.6 2.7-39.3.6-45.1-5.1-2.5 4.9-6 10.3-10.8 16.2H97l4.3 17.6z"/> <path fill="#2A56C6" d="M97.2 92.5v-.2.2z"/> <path fill="#00838F" d="M39.2 107.1l.3-.4-.3.3v.1z"/> <path fill="#EE8100" d="M101.6 128c-1.5-5.8-3-11.8-4.3-17.7H38.9c-.9 1.1-2.1 2.2-3.1 3.3-.2.2-.3.4-.5.5-4 4.6-7.5 9.2-10.4 13.8h76.7z"/> <path fill="#FFE0B2" d="M72.4 103.8c5.9-.2 14.8-1.8 22.4-4.5-.3-1.4-.6-2.7-.8-4.1-1.9-9.4-3.2-18.1-3.4-25-.5-19.6 6.6-20.2 6.6-20.2h2.1c0-4.2-.5-8.8-.9-12.3-.2-1.9-.6-3.6-1.2-5.3l-3.6.5-.6.1-2.9.3c-.3 0-.6 0-.9.1-.3 0-.7 0-1 .1-.3 0-.7 0-1 .1h-5.1c-.7 0-1.3 0-1.9-.1h-.3c-1.4-.1-2.8-.2-4-.4h-.2l-1.1-.2h-.2l-.9-.2c-.1 0-.2 0-.3-.1l-2.3-.5h-.1c-.4-.1-.8-.2-1.1-.3-.1 0-.1 0-.2-.1l-1-.3c-.1 0-.1 0-.2-.1-.3-.1-.6-.2-.9-.4-.1 0-.1 0-.2-.1l-.9-.4s-.1 0-.1-.1c-1.4-.6-2.6-1.3-3.6-2.1l-.1-.1-.6-.5-.2-.2-.5-.4-.2-.2-.4-.4-.2-.2-.4-.4-.2-.2-.3-.4-.2-.2-.3-.4-.1-.2c-.2-.2-.3-.4-.4-.6l-8 24.9-11.2-14.1c-4.1.6-6.9 4.7-6.3 9.1.3 2 1.2 3.8 2.6 5 .3.1 1.6.7 3.4 1.7.8.4 1.6 1 2.5 1.6 1.5 1.1 3.2 2.5 4.9 4.1h.1l.1.1.2.2.1.1.3.3.1.1.4.4c.8.8 1.8 1.9 2.8 3.5v.1l.6.9s0 .1.1.1c.2.3.4.6.5 1 0 0 0 .1.1.1l.6 1.1c.6 1.2 1.1 2.6 1.5 4.1 1.7 6.2 1.6 14.8-4 25.9 5.6 5.8 13.6 9.4 22.5 9.7z"/> <circle fill="#444" cx="84.2" cy="44.1" r="2"/> </svg> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-4" x="384" y="128"> <path fill="#84FFFF" d="M0 0h128v128H0z"/> <path fill="#444" d="M28 54.2c1-.2 1.5.5 2.8.8 1.3.3 2.7.2 4-.2 2.2-.7 4.1-2.1 6.1-3.4 12.6-8.2 28.9-10.4 43.2-5.8 3 1 6 2.3 8 4.7.9 1.1 1.6 2.4 2.5 3.6s2.1 2.2 3.5 2.4c5.2.8 4.9-8.6 4.9-11.8 0-21.3-17.3-38.6-38.6-38.6S25.8 23.2 25.8 44.5c0 3.2.2 7 1.4 10 .3-.1.6-.2.8-.3z"/> <path fill="#8D6E63" d="M44.3 103.5c0 .2-.1.4-.1.5-.5 3.9.3 7.9 2.3 11.3 2.1 3.7 5.4 6.6 9.2 8.3 3.1 1.4 6.5 2.1 10 2.1 5.3-.1 10.6-2 14.2-5.9 1.9-2.1 3.2-4.6 4.5-7.1.9-1.7 1.8-3.4 2.5-5.2.6-1.7.6-2.3-.5-3.6-2.2-2.6-4.1-5.7-4.9-9.1-.9-4.1.3-9.7 3.5-12.6 1.3-1.2 2.8-2.5 4.4-3.9l13.1-11c1.5-1.2 2.6-3 2.9-5.1.4-3.2-1.1-6.3-3.7-7.9-.5-.3-.9-.5-1.5-.7h-.1c-.2-.1-.5-.2-.7-.2h-.1c-.3-.1-.6-.1-.8-.2-1.4-.2-2.8 0-4 .5-.8-14-13.9-11-29.9-11-14.6 0-26.8-2.5-29.4 7.8-.2.9-.5 2-.8 3.1-1.2-.4-2.4-.6-3.8-.4-.3 0-.6.1-.9.2l-.3.1-.6.2-.3.1-.6.3-.2.1-.8.5c-2.3 1.7-3.6 4.5-3.2 7.6.3 2.1 1.3 3.8 2.8 5.1 0 0 10.9 9.3 11 9.3 4.6 3.9 8.2 10.7 8.6 16.7.1 1.8 0 3.7-.5 5.5-.1 1.5-1 3-1.3 4.6z"/> <path d="M100.4 53.6zm-.8-.3h-.1.1zm-70.5.3l-.3.1c.1 0 .2 0 .3-.1zm-.9.4l-.2.1s.1 0 .2-.1zm1.7-.7l-.3.1c.2 0 .3-.1.3-.1z" fill="none"/> <path fill="#8D6E63" d="M39.3 109.5c-.1.1-.1.2-.1.2l.5-.6c-.1.1-.2.3-.4.4z"/> <path fill="#FFEB3B" d="M62.8 128h6.8l-3.4-5zm-23.6-18.3c-.1.2-.2.4-.2.5-3.1.9-6 2.7-8.4 5.4l-.2.2s-.5.6-1.5 1.7c-.9 1.1-2.2 2.6-3.7 4.5-1.3 1.6-2.8 3.6-4.4 5.8h28.6l-10.2-18.1zm72.3 16.6c-1.3-2.2-2.3-3.9-3.1-5.1-.9-1.3-1.3-2-1.3-2l-.2-.3c-.6-.9-1.2-1.7-1.9-2.4-3.1-3.4-7-5.2-10.9-5.7l-.3.4L83.6 128h28.9c-.3-.6-.7-1.2-1-1.7z"/> <circle fill="#444" cx="79.5" cy="62.7" r="2"/> <circle fill="#444" cx="53.8" cy="62.8" r="2"/> <path fill="#F57F17" d="M65.7 122.3l.5-.4L44 103.5l-4.3 5.6-.5.6L49.4 128h13.4l3.4-5zm0 0l.5.7 3.4 5h14l10.1-16.8.3-.4-6.4-6.2-.4.3-21 17z"/> </svg> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-5" x="384" y="256"> <path fill="#FFFF8D" d="M0 0h128v128H0z"/> <path fill="#C2C2C2" d="M51.7 31.4v-22s-19.6 2.5-15.8 29.9c11 0 14.8-4.3 15.8-7.9z"/> <path fill="#848484" d="M94.1 39.8c.1-1 0-2-.1-3 0-1-.1-1.9-.2-2.9-.2-1.8-.4-3.5-.8-5.2-.6-2.9-1.5-5.8-2.9-8.4-1.1-2.2-2.6-4.2-4.3-6-1.6-1.6-3.3-2.9-5.3-3.9-1.8-1-3.8-1.7-5.8-2.2-2-.5-4-.8-6-.9-1.9-.1-3.8-.1-5.7 0-1.7.1-3.3.3-5 .6-1.3.2-2.5.5-3.8.8l-2.2.6-.4.1v20.8c0 1-.1 1.8.4 2.7.2.3.5.6.6.9.3.9.7 1.8 1.2 2.7 1.1 1.8 2.7 3.4 4.7 4.3 2.4 1.1 5.1 1.4 7.8 1.6 4.8.3 9.6.4 14.3.3 2.2 0 4.3-.3 6.4-.9 1.2-.3 2.4-.6 3.6-1 .6-.2 1.2-.4 1.8-.5.6-.2 1.2-.5 1.7-.5z"/> <path fill="#FFE0B2" d="M66.8 116.8l17.9-8.7 3.1-8.2c-15.1-17 1.2-31.6 2.3-32.5h.1l13.2-11.1c1.5-1.2 2.5-3 2.8-5 .6-4.4-2.5-8.4-6.9-9.1-1.5-.2-3 0-4.3.6-.2-1-.5-1.9-.8-2.9-26.9 3.7-37.9-2.5-42.4-8.4-1.6 2.6-5.1 6.1-15.8 7.9-.2.9-.5 2-.8 3.1-1.2-.4-2.4-.6-3.8-.4-4.4.6-7.5 4.7-6.9 9.1.3 2 1.3 3.8 2.8 5l7.5 6.4c4.2 4.5 18.4 21.7 9 37l.7 3.7 4.7 4.6 17.6 8.9z"/> <path fill="#055524" d="M39.8 104.7zm54.3-.4l-.8 1.5-6.8 12.1V128H128v-2.3z"/> <path fill="#FFE0B2" d="M40.4 103.9c-.2.2-.3.4-.5.5 0 0-.1.1-.1.2v.1l.6-.8z"/> <circle fill="#444" cx="80" cy="51.7" r="2"/> <circle fill="#444" cx="54.3" cy="51.7" r="2"/> <path fill="#055524" d="M39.8 104.7c-3.2.9-6.1 2.7-8.6 5.5l-.2.2s-.5.6-1.5 1.7c-.9 1.1-2.2 2.6-3.7 4.5-2.3 2.9-5.1 6.7-8.3 11.4h31v-7.8l-8.7-15.5z"/> <path fill="#848484" d="M65.3 67.3s2.7 9.8 14.5 9.8c0 0 3.9-18.5-14.5-18.5v8.7z"/> <path fill="#C2C2C2" d="M65.3 67.3v-8.7C46.9 58.6 50.8 77 50.8 77c11.8 0 14.5-9.7 14.5-9.7z"/> <path fill="#A7FFEB" d="M80.9 128h5.6v-10.1zm-21 0h13.8l-6.9-10zm-11.5 0h4.3l-4.3-7.8z"/> <path fill="#1DE9B6" d="M66.8 118l-.5-.8.5-.4-22.9-17.3h-.1l-3.4 4.4-.6.8 8.6 15.5 4.3 7.8h7.2zm26.5-12.2l.8-1.5-6.4-4.4-20.9 16.9-.5.4.5.8 6.9 10h7.2l5.6-10.1z"/> </svg> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-6" y="384"> <path fill="#FF8A80" d="M0 0h128v128H0z"/> <path fill="#F2A600" d="M30.3 43.7c3.1-.4 6.1 1 7.7 3.4 10.3-2 11-11.5 12.6-14.1 4.5 5.8 13.3 17.8 39.5 14.5 1.6-2.7 4.7-4.3 8-3.8.4 0 .7-1.9 1-1.8-.1-2.2-.3-4.4-.8-6.4v-.1C94.9 19.6 80.8 7.8 64 7.8c-15 0-27.8 9.4-32.8 22.6C29.8 34 29 38 28.9 42.1l.7 1.8.7-.2z"/> <path d="M89.1 102.8l.4-.3c-.1 0-.3.1-.4.3zm2.2-1.9l-.5.4c.2-.2.3-.3.5-.4zm-18 9.2c-.1 0-.2 0-.3.1.1-.1.2-.1.3-.1zm-2.4.4h-.2.2zm16.1-6.2l.3-.2-.3.2zm-9 4.5l.5-.2-.5.2zm4.9-2.1l.2-.1c-.1.1-.1.1-.2.1zm2-1.1l.5-.3-.5.3zm-4.6 2.3l.4-.2c-.1.1-.2.2-.4.2zm12.6-8.6zM30.3 41.7c-.3 0-.5.1-.7.1.2 0 .5 0 .7-.1zm35.9 69.2c-.6 0-1.2 0-1.9-.1.6 0 1.2.1 1.9.1z" fill="none"/> <path fill="#F2A600" d="M41.5 101.3l.8.7c-.3-.3-.5-.5-.8-.7zm1.4 1.1c.2.2.5.4.8.6-.3-.2-.6-.4-.8-.6zm1.3 1.1c.2.2.5.4.8.5-.2-.1-.5-.3-.8-.5zm54.1-68.1zM38.7 98.3c.4.4.8.8 1.1 1.3-.4-.4-.8-.8-1.1-1.3zm-7.6-67.9zm15.4 74.7l.5.3-.5-.3zm4.6 2.4l.3.1c-.1 0-.2 0-.3-.1zm-3.1-1.6l.5.3c-.2-.1-.4-.2-.5-.3zm13.6 4.6l-.9-.1.9.1zM88.9 67c-1.6 1.4-3.1 2.7-4.4 3.9-3.3 3.8-6.3 10.3-1 18.7 5.7-8.1 10.6-17.7 13.2-29.1L88.9 67zM41 100.8l-.8-.8.8.8zm8.5 6l.4.2c-.1-.1-.2-.2-.4-.2zm9.5 3.3h.1-.1zm-46.1 17.3c4.5-7.1 8.6-12.7 11.7-16.6 1.5-2 2.8-3.5 3.7-4.5 1-1.1 1.5-1.7 1.5-1.7l.2-.2c2.4-2.7 5.3-4.5 8.4-5.4.1-.2.2-.4.2-.5 0-.1 0-.2.1-.2 13.6-13.3 4.7-26.5-1.5-32.9l-4.4-3.8c-2.6 8.7-8.5 18.2-20.1 26.9-6.4 4.1-10.6 11.4-10.6 19.7 0 8.2 4.1 15.4 10.4 19.8l.4-.6z"/> <path fill="#FFE0B2" d="M67.1 110.9h-2 2zM38.8 98.1c-.4.3 2.1 5.6 2.5 5.9 1.8 1.8 4.1 2.2 6.3 3.5 4.8 2.7 10.2 3.6 15.6 4.2 5.7.6 11.5-.5 16.8-2.6 2.5-1 4.8-2.3 7-3.8 1.2-.8 2.2-1.6 3.3-2.6.4-.3 2.4-3.6 2.7-3.3-4-3.3-8-6.9-10.4-11.6-2.2-4.2-2.6-9.1-.5-13.4 1.7-3.3 4.5-5.6 7.3-7.9 2.2-1.8 4.3-3.6 6.5-5.5l4.7-3.9c1-.8 2.1-1.6 2.8-2.7 1.5-2 1.9-4.6 1.2-7-1.4-4.8-7.1-7.2-11.5-4.9-1 .5-1.9 1.3-2.6 2.2l-.5.7-1.1.1c-.8.1-1.6.2-2.4.2-2.6.2-5.3.3-7.9.1-6.8-.3-13.5-2.1-19.1-6-3.6-2.4-6.3-5.6-8.9-9-.5.9-.8 1.9-1.1 2.8-.5 1.4-1 2.7-1.6 4-1.7 3.3-4.5 5.8-8.2 6.9-.5.2-1.1.3-1.7.4-.3-.5-.7-.9-1.1-1.3-.9-.6-2.1-1.3-3.3-1.6-2.5-.7-5.2-.2-7.2 1.4-3.9 3.1-4 9.2-.1 12.5l10.5 8.9c2.4 2 4.3 4.8 5.9 7.4 2.1 3.5 3.4 7.6 3.2 11.7-.3 5.6-3.3 10.4-7.1 14.2-.1.1 13.6-13.3 0 0z"/> <path fill="#80DEEA" d="M93 99.4l-.2-.1-1.5 1.5-.5.4c-.4.4-.9.8-1.3 1.1l-.4.3c-.6.5-1.2.9-1.8 1.3l-.3.2c-.5.4-1.1.7-1.6 1l-.5.3-1.8 1-.2.1c-.7.4-1.4.7-2.1 1l-.4.2-1.8.7-.5.2c-.8.3-1.5.5-2.3.7l-2.4.6c-.1 0-.2 0-.3.1l-2.1.4h-.2c-1.5.2-3 .3-4.5.4h2-1.9c-.6 0-1.2 0-1.9-.1l-2.7-.3-.9-.1-1.6-.3h-.1c-2.7-.6-5.2-1.4-7.6-2.4l-.3-.1c-.4-.2-.8-.4-1.2-.5l-.4-.2c-.4-.2-.7-.4-1-.5l-.5-.3-1-.6-.5-.3c-.5-.3-1-.6-1.5-1-.3-.2-.5-.4-.8-.5l-.6-.5-.8-.6-.6-.5c-.3-.2-.5-.4-.8-.7l-.5-.5-.8-.8-.4-.4c-.4-.4-.8-.8-1.1-1.3-.1.2-.2.4-.2.5-3.1.9-6 2.7-8.4 5.4l-.2.2s-.5.6-1.5 1.7c-.9 1.1-2.2 2.6-3.7 4.5-3.1 3.9-7.2 9.5-11.7 16.6-.1.2-.2.4-.4.6H118c-2.7-5.4-5.1-9.8-7.1-13.1-1.3-2.2-2.3-3.9-3.1-5.1-.9-1.3-1.3-2-1.3-2l-.2-.3c-.6-.9-1.2-1.7-1.9-2.4-3.3-3.3-7.4-5.2-11.4-5.5z"/> <circle fill="#444" cx="78.9" cy="51.3" r="2"/> <circle fill="#444" cx="53.2" cy="51.3" r="2"/> </svg> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-7" x="128" y="384"> <path fill="#FFCC80" d="M41.6 123.8s0 .1-.1.1l.3-.4c-.1.2-.1.2-.2.3z"/> <path fill="#80D8FF" d="M0 0h128v128H0z"/> <path fill="#5D4037" d="M29.3 123.1c4.1-6.9 7.8-12.4 10.5-16.2 1.4-1.9 2.5-3.4 3.3-4.4l1.7-2s0-.1.1-.1l.3-.3C49 95.4 51.9 91 54.1 87c9.5-17.8 6.1-29.3-.3-35.9-1.6-1.6-3.2-2.9-4.7-4-.9-.6-1.7-1.1-2.4-1.6-1.8-1-3.1-1.6-3.3-1.7-1.3-1.2-2.2-2.9-2.5-4.9-.5-4.3 2.2-6.2 6.1-6.8 1-.1 2-.1 2.9.2 9.6-1.8 11.9-8 13.3-10.6 4 5.7 13.9 9.8 38 6.1C97.1 14.3 84.5 5.4 71 7.4c-4.4.7-8.3 2.4-11.8 4.9l-.1.1c-1.1.8-2.1 1.6-3 2.6l-35 30C12.9 49.8 7.3 58.8 7.3 69.1c0 2.7.4 5.3 1.1 7.8.3 4.9-.1 11.7-2.9 18.6-.2.5-.5 1-.7 1.6-1.2 3.2-1.9 6.6-1.9 10.2 0 8.2 3.5 15.6 9.1 20.7h14.5c1-1.7 1.9-3.4 2.8-4.9zm20.5-90.8z"/> <path fill="#FFCC80" d="M63.1 19.8c-1.4 2.6-5.7 8.8-15.3 10.6-.9-.3-1.9-.3-2.9-.2-3.9.6-6.7 4.5-6.1 8.8.3 2 1.2 3.7 2.5 4.9.2.1 1.5.6 3.3 1.7.7.4 1.6 1 2.4 1.6 1.5 1.1 3.1 2.4 4.7 4 6.4 6.6 11.8 18.1 2.3 35.9 0 0 7.3 15.5 23.2 16.9 6.1.5 13.3-5.6 22.1-8.8-.1-.7-.3-1.4-.5-2.1-.3-1.3-3.9-21.5-4.1-28.2-.2-7.4.7-11.9 1.9-14.8h8.8L103 39.7c-.2-2.4-.4-4.7-.7-6.7-.2-1.8-.6-3.5-1.1-5.2-24.2 3.7-34-2.3-38.1-8zm22.3 19.6c0-.9.7-1.6 1.6-1.6.9 0 1.6.7 1.6 1.6 0 .9-.7 1.6-1.6 1.6-.9 0-1.6-.7-1.6-1.6zm-35.6-7.1zm-4.9 68.1s0 .1-.1.1l.3-.4-.2.3z"/> <circle fill="#444" cx="86.9" cy="39.4" r="2"/> <path fill="#00BFA5" d="M77.2 98.5C61.3 97.2 54.1 87 54.1 87c-2.2 4-5.1 8.4-8.9 13.1l-.3.4c-.5.7-1.1 1.3-1.7 2-.8 1-2 2.5-3.3 4.4-2.8 3.8-6.5 9.2-10.5 16.2-.9 1.6-1.8 3.2-2.8 4.9h80.8l-.3-1c-2.6-10.3-5.4-21.4-7.7-31.9-8.8 3.1-16.1 3.9-22.2 3.4z"/> </svg> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-8" x="256" y="384"> <path fill="#FFCC80" d="M41.6 123.8s.1-.2.2-.3c-.1.2-.1.2-.2.3z"/> <path fill="#B388FF" d="M0 0h128v128H0z"/> <path d="M64.1 34.5c-.1.1-.2.2-.3.2.1-.1.2-.2.3-.2zm.9-.7c-.1.1-.2.1-.2.2l.2-.2zm-1.9 1.3c-.1.1-.2.2-.4.2.2 0 .3-.1.4-.2zm-5.4 2.6l-.5.2c.2-.1.4-.2.5-.2zm2.8-1.1l-.2.1s.1-.1.2-.1zm-1.3.5l-.4.2c.1 0 .2-.1.4-.2zm8.8-6.3l-.2.3c.1-.1.2-.2.2-.3zm-1.9 2.1l-.3.2.3-.2zm1.4-1.4l-.3.3c.1-.2.2-.3.3-.3zm-.7.6l-.3.3c.2-.1.3-.2.3-.3zM62 35.8l-.3.2.3-.2zm5 47l-.3 1.6.3-1.6zM56.2 38.1l-.5.1c.1 0 .3 0 .5-.1zm10.4 46.5c-.1.5-.2 1.1-.4 1.6.2-.5.3-1 .4-1.6zm.6-3.6l-.2 1.6c.1-.5.1-1 .2-1.6zm-5.6-20.8c.1.1.2.3.4.4l-.4-.4zm7.5-30.9l-.6.9c.5-.7.9-1.3 1.2-1.8-.1.2-.3.5-.5.7 0 .1 0 .2-.1.2zM67.2 81c1-10.6-2.4-17.3-5.2-20.4 2.7 3.1 6.2 9.8 5.2 20.4zm-1 5.5c-.1.6-.3 1.1-.5 1.7.2-.6.4-1.2.5-1.7zm-5.6-27.4l.2.2c-.1 0-.2-.1-.2-.2zm-.3-.2s.1.1.2.1c-.1 0-.1 0-.2-.1zm-.2-.1zm-.1-.1zm1.7 38.2c-.1-.1-.2-.2-.4-.3l.1.1.3.2zm-.5-37.1l.3.3-.3-.3zm-.3-.4l.3.3c-.2-.1-.2-.2-.3-.3z" fill="none"/> <path fill="#2A56C6" d="M98.8 94.8v.2-.2z"/> <path fill="#FFE0B2" d="M2.8 109.6L0 110.8V128h15.5L2.8 109.6z"/> <path fill="#DD2C00" d="M91.9 128h5.6c-3.8-12-4.4-16-4.9-20.1-.1-.5-.5-2.4-.5-2.9-2.6.7-5.2 1.1-8 1.2-8.7-.2-16.5-3.8-22.3-9.3l-.2-.2-.1-.1c-2.9.2-7.6.2-10.8.6-4.6.6-9.6 1.3-15 2.4-4.7.9-11.2 2.7-33.3 9.3l.5.7L15.5 128h70.2"/> <path fill="#FFEB3B" d="M66.2 86.5c0-.1 0-.1.1-.2.1-.6.3-1.1.4-1.6v-.2l.3-1.6v-.1l.2-1.6c1-10.6-2.4-17.3-5.2-20.4-.1-.1-.2-.3-.4-.4l-.1-.1-.3-.3-.1-.1-.3-.3-.1-.1-.2-.2-.1-.1c-.1-.1-.1-.1-.2-.1 0 0-.1 0-.1-.1l-.1-.1s-.1 0-.1-.1c-1.6-1.7-3.3-3-4.9-4.1-.9-.6-1.7-1.2-2.5-1.6-1.8-1.1-3.2-1.6-3.4-1.7-1.3-1.2-2.3-3-2.6-5-.6-4.4.3-6.4 4.3-7.1 1-.2 2-.1 3 .2l.1-.7c.6-.1 1.1-.2 1.6-.4l.5-.1 1.1-.3.5-.2 1-.3.4-.2c.4-.1.7-.3 1.1-.5l.2-.1 1.2-.6.3-.2c.3-.1.5-.3.8-.5.1-.1.3-.2.4-.2.2-.1.4-.3.7-.4.1-.1.2-.2.3-.2l.7-.5c.1-.1.2-.1.2-.2.3-.2.5-.4.8-.7.1-.1.2-.1.2-.2l.5-.5.3-.3.4-.4.3-.3.3-.4c.1-.1.2-.2.2-.3.2-.2.3-.4.4-.6l.6-.9.1-.2c.2-.3.3-.5.5-.7 4.2 5.9 14.5 10.4 39.3 6.7-4.2-14-17.3-23.5-31.3-21.4-5.3.8-10.1 3.2-14 6.6l-.2.2c-.5.4-1 .9-1.4 1.4-5.3 4.8-23.3 19.8-52.2 26.5-3.9 0-7.4 1.6-9.9 4.2v19.3c.3.3.6.6.9.8l-.3.9S30.9 96.4 64 90.3l1.6-1.8c0-.1 0-.1.1-.2.2-.7.4-1.3.5-1.8z"/> <path fill="#FFE0B2" d="M84 106.2c2.8-.1 5.4-.5 8-1.2l.8-3.8c4.3-19.3 9.7-37.4 15-52.9h6.9l-4.8-8.2c-.2-1.9-.6-3.6-1.2-5.3-24.8 3.7-35-2.5-39.1-8.4-.3.5-.7 1.1-1.2 1.8l-.4.6-.2.3-.3.4-.3.3-.4.4-.3.3-.5.5s-.1 0-.2.1c-.3.2-.5.4-.8.7-.1.1-.2.1-.2.2-.2.2-.4.3-.7.5-.1.1-.2.2-.3.2-.2.1-.4.3-.7.4-.1.1-.2.2-.4.2l-.8.5-.3.2-1.2.6-.2.1-1.1.5-.4.2c-.3.1-.6.2-1 .3l-.5.2c-.3.1-.7.2-1.1.3l-.5.1-1.6.4c-.1.2-.1.5-.1.7-.9-.3-1.9-.4-3-.2-4.1.6-6.9 4.7-6.3 9.1.3 2 1.2 3.8 2.6 5 .3.1 1.6.7 3.4 1.7.8.4 1.6 1 2.5 1.6 1.5 1.1 3.2 2.5 4.9 4.1l.1.1.1.1.1.1s.1.1.2.1c0 0 .1 0 .1.1l.2.2.1.1.3.3.1.1.3.3.1.1s.2.3.4.4c2.7 3.1 7.2 9.8 6.2 20.4l-.2 1.6v.1l-.3 1.6v.2c-.1.5-.2 1.1-.4 1.6 0 .1 0 .1-.1.2-.1.6-.3 1.1-.5 1.7 0 .1 0 .1-.1.2-.8 2.6-1.8 5.3-3.3 8.3.1.1.2.2.4.3 5.7 5.6 13.5 9.1 22.2 9.3z"/> <path fill="#DD2C00" d="M85.6 128h5.1"/> <circle fill="#444" cx="95.8" cy="46.5" r="2"/> </svg> <svg viewBox="0 0 128 128" height="128" width="128" id="svg-9" x="384" y="384"> <path fill="#FFCC80" d="M41.6 123.8s0 .1-.1.1l.3-.4c-.1.2-.1.2-.2.3z"/> <path fill="#FFFF8D" d="M0 0h128v128H0z"/> <path fill="#C2C2C2" d="M83.2 26.6c.1-.9.2-1.8.2-2.7C83.4 13.5 75 5 64.6 5s-18.8 8.4-18.8 18.8c0 1.4.2 2.7.4 4 5.4-4 12.2-6.4 19.4-6.4 6.5.1 12.5 2 17.6 5.2z"/> <path fill="#848484" d="M41.4 58.4c9.6-1.9 10.3-10.7 11.7-13.2 4.2 5.4 12.4 16.6 36.8 13.5 1.5-2.5 4.4-6 7.4-5.6.3 0 .6.1 1 .2C98 42 92 32.1 83.1 26.5 78 23.3 72 21.4 65.6 21.4c-7.3 0-14 2.4-19.4 6.4-7.9 5.9-13.1 15.2-13.3 25.7.4-.1.9 1.7 1.4 1.7 2.8-.4 5.6 1 7.1 3.2z"/> <path fill="#FF5722" d="M109.6 121.5c-1.2-2-2.2-3.6-2.9-4.8l-1.2-1.8-.2-.3c-.5-.8-1.1-1.6-1.8-2.3-3.1-3.3-6.9-5.1-10.8-5.3 0 0 .1 0 .1.1l-.2-.1c-3.4 3.7-7.8 6.6-12.7 8.5V128h33.4c-1.4-2.5-2.6-4.7-3.7-6.5zM42 106l-.2.5c-2.9.8-5.6 2.5-7.8 5.1l-.2.2s-.5.6-1.4 1.6c-.9 1-2 2.4-3.5 4.2-2.1 2.6-4.7 6.1-7.5 10.4h28v-15.7c-2.8-1.7-5.3-3.8-7.4-6.3z"/> <path fill="#E0F7FA" d="M67.7 117.7c-6.8-.2-13.1-2.1-18.3-5.4V128h30.5v-12.6c-3.8 1.4-7.9 2.2-12.2 2.3z"/> <path fill="#FFE0B2" d="M42 106c2.1 2.4 4.6 4.5 7.4 6.3 5.2 3.3 11.5 5.3 18.3 5.4 4.3-.1 8.4-.9 12.1-2.3 5-1.9 9.3-4.8 12.7-8.5l.2.1s-.1 0-.1-.1c-15.7-12.3-12-21.7-7.8-26.6 1.3-1.1 2.6-2.3 4.1-3.6l12.2-10.3c1.4-1.2 2.4-2.8 2.7-4.8.5-3.8-1.9-7.3-5.4-8.2-.3-.1-.6-.2-1-.2-3.1-.4-5.9 1.1-7.4 3.6-24.4 3.1-32.7-8.1-36.8-13.5-1.5 2.4-2.1 11.3-11.7 13.2-1.6-2.3-4.3-3.6-7.2-3.2l-1.4.3c-3.4 1.1-5.5 4.5-5 8.1.3 1.9 1.3 3.6 2.6 4.7l10.2 8.7c5.8 6 14.1 18.3 1.4 30.7-.1.1-.1.2-.1.2zm37.6-45.3c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5c-.1-.9.6-1.5 1.5-1.5zm-24 0c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5c-.1-.9.6-1.5 1.5-1.5z"/> <circle fill="#444" cx="79.6" cy="62.2" r="2"/> <circle fill="#444" cx="55.6" cy="62.2" r="2"/> </svg> </defs></svg>'
    };

    // Note: 'material.svgAssetsCache' is used with Angular Material docs
    // when launching code pen demos; @see codepen.js

    angular.module('material.svgAssetsCache', [])
        .run(['$templateCache', function ($templateCache) {
            angular.forEach(assetMap, function (value, key) {
                $templateCache.put(key, value);
            });
        }]);
})();
"use strict";
SMS.CONTROLLERS.controller('Controller', Controller);
Controller.$inject = ['$rootScope', '$state', '$filter', '$location', '$anchorScroll', '$mdDialog', '$mdToast', 'SessionStorage', 'Common', 'ENV'];
function Controller($rootScope, $state, $filter, $location, $anchorScroll, $mdDialog, $mdToast, SessionStorage, Common, ENV) {
    var vm = this;
    //处理后端返回的数据
    $rootScope.handleMessage = function (response, successFunction, failedFunction) {
        if (response.success) {
            successFunction(response.value);
        } else {
            if (response['errCode'] && response['message']) {
                console.info("errCode:" + response['errCode'] + "," + response['message'] + ".");
            } else if (response['errCode']) {
                console.info("errCode:" + response['errCode'] + ".");
            } else {
                console.info(response['message'] + ".");
            }
            failedFunction(response);
        }
    };
    //判断权限
    $rootScope.isShow = function (JURISDICTION_CODE) {
        var b = true;
        if (ENV.runMode !== 'debug') {
            b = false;
            var loginInfo = SessionStorage.get('loginInfo');
            if (loginInfo
                && loginInfo['authorities']
                && loginInfo['authorities'].length > 0) {
                angular.forEach(loginInfo['authorities'], function (item) {
                    if (item['jurisdictionCode'] === JURISDICTION_CODE) {
                        b = true;
                        return false;
                    }
                });
            }
        }
        return b;
    };
    //判断页面权限
    $rootScope.checkAuth = function (url) {
        if (ENV.runMode === 'debug') {
            return true;
        }
        var urlNew='/'+url.replace(/\./g,'/');//将路径中所有的.替换为斜杠
        var loginInfo = SessionStorage.get('loginInfo');
        for(var i=0;i<loginInfo.resources.length;i++){
            if(loginInfo.resources[i].resourcePath===urlNew){
                return true;
            }
            if(loginInfo.resources[i].hcrmGpDetailResource) {
                for (var j = 0; j < loginInfo.resources[i].hcrmGpDetailResource.length; j++) {
                    if(loginInfo.resources[i].hcrmGpDetailResource[j].resourcePath===urlNew){
                        return true;
                    }
                }
            }
        }
        return false;
    };
    $rootScope.isContains=function(str, substr) {
        return str.indexOf(substr) >= 0;
    };
    //判断是否是detail页面
    $rootScope.isDetailView = function () {
        return $state.current.name.indexOf('detail') !== -1;
    };
    $rootScope.isEmptyObject = function (obj) {
        for (var n in obj) {
            return false
        }
        return true;
    };
    //查询list中是否包含某个字段为key属性为value的对象,返回index
    $rootScope.selectIndex = function (list, key, value) {
        var index = -1, l = list.length;
        for (var i = 0; i < l; i++) {
            if (list[i][key] === value) {
                index = i;
                return index;
            }
        }
        return index;
    };
    //查询list中是否包含某个字段为key值为value的对象,返回item
    $rootScope.selectItem = function (list, key, value) {
        var l = list.length;
        for (var i = 0; i < l; i++) {
            if (list[i][key] === value) {
                return list[i];
            }
        }
        return undefined;
    };
    //根据value删除数组中的值
    $rootScope.removeByValue=function(arr, val) {
        for(var i=0; i<arr.length; i++) {
            if(arr[i] == val) {
                arr.splice(i, 1);
                break;
            }
        }
    };
    //弹出提示
    $rootScope.alertDialog = function (text) {
        return $mdDialog.show(
            $mdDialog.alert()
                .clickOutsideToClose(true)
                .title('提示')
                .textContent(text)
                .ok('确定')
        );
    };
    //弹出提示
    $rootScope.confirmDialog = function (text, successFunction, failedFunction) {
        var confirm = $mdDialog.confirm()
            .title('提示')
            .textContent(text)
            .ok('确定')
            .cancel('取消');
        $mdDialog.show(confirm).then(successFunction, failedFunction);
    };
    $rootScope.showToast = function (message, vertical, horizonal, actionText, theme) {
        var position = {
            vertical: vertical || 'v-center',
            horizonal: horizonal || 'h-center'
        };
        var toast = $mdToast.simple()
            .textContent(message)
            .action(actionText)
            .hideDelay(1500)
            .theme(theme)
            .position(position.vertical + ' ' + position.horizonal);
        $mdToast.show(toast);
    };
    //获取服务器当前时间
    //日期格式 2016-08-08
    $rootScope.getCurrentDate = function (successFunction) {
        return $rootScope.getCurrentTime(function (data) {
            successFunction($filter('commonDate')(data));
        });
    };
    //new Date 格式
    $rootScope.getCurrentDateTime = function (successFunction) {
        return $rootScope.getCurrentTime(function (data) {
            successFunction(new Date(data));
        });
    };
    //时间戳格式 1475130600000
    $rootScope.getCurrentTime = function (successFunction) {
        Common.getCurrentTime({}).$promise.then(
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        successFunction(data);
                    },
                    function () {
                        $rootScope.alertDialog("获取服务器时间失败");
                    }
                )
            },
            function () {
                $rootScope.alertDialog("获取服务器时间失败");
            }
        );
    };
    //调用公共的service方法
    $rootScope.commonService = function (functionName, params, successFunction, failedFunction) {
        return Common[functionName](JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    //高血压评估
    $rootScope.calculateHypertensionEvaluation = function (params) {
        var bloodPressureGradingList = ['0028000010', '0028000020', '0028000030', '0028000040', '0028000050'];
        var gradingManagementList = ['0029000010', '0029000020', '0029000030', '0029000040', '0029000050'];
        var criticalityGradingList = ['0030000010', '0030000020', '0030000030', '0030000040'];

        var riskFactorsCount = 0;
        var bloodPressureGradingCount;
        var criticalityGradingCount;
        var gradingManagementCount;
        //计算血压分级
        function bloodPressureGrading(SYSTOLIC_PRESSURE, DIASTOLIC_PRESSURE) {
            //血压正常：收缩压<120且舒张压<80
            //血压偏高：收缩压120-139或舒张压80-89
            //1级高血压：收缩压140-159或舒张压90-99
            //2级高血压：收缩压160～179或舒张压100～109
            //3级高血压：收缩压>=180或舒张压>=110
            if (SYSTOLIC_PRESSURE >= 180 || DIASTOLIC_PRESSURE >= 110) {
                bloodPressureGradingCount = bloodPressureGradingList[4];
            } else if ((SYSTOLIC_PRESSURE >= 160 && SYSTOLIC_PRESSURE <= 179) || (DIASTOLIC_PRESSURE >= 100 && DIASTOLIC_PRESSURE <= 109)) {
                bloodPressureGradingCount = bloodPressureGradingList[3];
            } else if ((SYSTOLIC_PRESSURE >= 140 && SYSTOLIC_PRESSURE <= 159) || (DIASTOLIC_PRESSURE >= 90 && DIASTOLIC_PRESSURE <= 99)) {
                bloodPressureGradingCount = bloodPressureGradingList[2];
            } else if ((SYSTOLIC_PRESSURE >= 120 && SYSTOLIC_PRESSURE <= 139) || (DIASTOLIC_PRESSURE >= 80 && DIASTOLIC_PRESSURE <= 89)) {
                bloodPressureGradingCount = bloodPressureGradingList[1];
            } else if (SYSTOLIC_PRESSURE < 120 && DIASTOLIC_PRESSURE < 80) {
                bloodPressureGradingCount = bloodPressureGradingList[0];
            }
        }

        //统计危险因素个数,[心血管病危险因素、靶器官损害、并存相关疾病]三个多选字段中选中的选项数目之和
        function riskFactors(array) {
            angular.forEach(array, function (item) {
                riskFactorsCount += item;
            });
        }

        //计算危险程度分层和分级管理
        function criticalityGradingAndGradingManagement() {
            //一般人群，无危险：血压正常或(血压偏高&0危险因素)
            //高危人群，无危险：血压偏高&>=1危险因素
            //一级管理，低危：1级高血压&0危险因素
            //二级管理，中危：(2级高血压&0-2个危险因素)或(1级高血压&1-2个危险因素)
            //三级管理，高危：3级高血压或(2级高血压&>2个危险因素)或(1级高血压&>2个危险因素)
            if (bloodPressureGradingCount === bloodPressureGradingList[0]
                || (bloodPressureGradingCount === bloodPressureGradingList[1] && riskFactorsCount === 0)) {
                criticalityGradingCount = criticalityGradingList[0];
                gradingManagementCount = gradingManagementList[0];
            } else if (bloodPressureGradingCount === bloodPressureGradingList[1] && riskFactorsCount >= 1) {
                criticalityGradingCount = criticalityGradingList[0];
                gradingManagementCount = gradingManagementList[1];
            } else if (bloodPressureGradingCount === bloodPressureGradingList[2] && riskFactorsCount === 0) {
                criticalityGradingCount = criticalityGradingList[1];
                gradingManagementCount = gradingManagementList[2];
            } else if ((bloodPressureGradingCount === bloodPressureGradingList[3] && (riskFactorsCount >= 0 && riskFactorsCount <= 2))
                || (bloodPressureGradingCount === bloodPressureGradingList[2] && (riskFactorsCount >= 1 && riskFactorsCount <= 2))) {
                criticalityGradingCount = criticalityGradingList[2];
                gradingManagementCount = gradingManagementList[3];
            } else if (bloodPressureGradingCount === bloodPressureGradingList[4]
                || (bloodPressureGradingCount === bloodPressureGradingList[3] && riskFactorsCount >= 3)
                || (bloodPressureGradingCount === bloodPressureGradingList[2] && riskFactorsCount >= 3)) {
                criticalityGradingCount = criticalityGradingList[3];
                gradingManagementCount = gradingManagementList[4];
            }
        }

        bloodPressureGrading(params['SYSTOLIC_PRESSURE'], params['DIASTOLIC_PRESSURE']);
        riskFactors(params['lengthArray']);
        criticalityGradingAndGradingManagement();
        return {
            "bloodPressureGradingCount": bloodPressureGradingCount,
            "criticalityGradingCount": criticalityGradingCount,
            "gradingManagementCount": gradingManagementCount
        };
    };
    //判断是否超级管理员
    $rootScope.isSuperManager = function () {
        if (SessionStorage.get('loginInfo').organizationKeyId) {
            return false;
        }
        return true;
    };

    //提交前校验表单
    $rootScope.check = function (form) {
        function checkSubForm(form){
            if (form.$invalid) {
                for (var s in form) {
                    if (form[s]!==undefined && form[s].$invalid!==undefined && form[s].$invalid) {
                        var name = form[s].$name;
                        //判断子表单
                        if (form[s]['$$renameControl'] && s !== '$$parentForm') {
                            if (checkSubForm(form[s])) {
                                continue;
                            } else {
                                return false;
                            }
                        }
                        if(s === '$$parentForm'){
                            continue;
                        }
                        //前提id和name相同，以便通过id跳转锚点
                        var element = document.querySelector('#' + name);
                        $rootScope.scrollTo(name);
                        if (element.tagName === 'INPUT' || element.tagName === 'MD-SELECT' || element.tagName === 'MD-DATEPICKER' || element.tagName === 'TEXTAREA') {
                            form[name].$setTouched(true);
                        } else {
                            $rootScope.alertDialog('请选择相应的选项');
                        }
                        break;
                    }
                }
                return false;
            } else {
                return true;
            }
        }
        return checkSubForm(form);
    };

    //锚点跳转
    $rootScope.scrollTo = function (target) {
        $location.hash(target);
        $anchorScroll();
    };

    function watchEvent() {

        window.onscroll = function () {
            if (document.getElementsByTagName("md-sidenav").length === 0) {
                return;
            }
            var top = document.documentElement.scrollTop || document.body.scrollTop;
            var left = document.getElementsByTagName("md-sidenav")[0].offsetLeft;
            var len=document.getElementsByTagName('md-sidenav').length;
            if (top > 204) {
                for (var i = 0; i < len; i++) {
                    document.getElementsByClassName("sidenavDiv")[i].style.display = 'block';
                    document.getElementsByTagName('md-sidenav')[i].style.position = 'fixed';
                    document.getElementsByTagName('md-sidenav')[i].style.top = '0';
                    document.getElementsByTagName('md-sidenav')[i].style.marginTop = '0';
                    document.getElementsByTagName('md-sidenav')[i].style.left = (left + 300 * i) + "px";
                }
            } else {
                for (var i = 0; i < len; i++) {
                    document.getElementsByClassName("sidenavDiv")[i].style.display = 'none';
                    document.getElementsByTagName("md-sidenav")[i].removeAttribute('style');
                }
            }
        };
    }
    watchEvent();

    return vm;
}

"use strict";
SMS.CONTROLLERS.controller('loginCtrl', loginCtrl);
loginCtrl.$inject = ['$rootScope', '$state', '$location', '$filter', 'SessionStorage', 'loginService', 'ENV'];
function loginCtrl($rootScope, $state, $location, $filter, SessionStorage, loginService, ENV) {
    var vm = this;
    vm.random = 0;
    //清除用户登录信息
    SessionStorage.remove('loginInfo');

    vm.getCode = function () {
        vm.codeUrl = ENV.urlBase + "/getcode" + "?" + vm.random;
        vm.random = vm.random + 1;
    };
    vm.login = function () {
        vm.username = vm.name + '#' + '0003000010';//+ vm.code;
        if (ENV.runMode === "debug") {
            vm.params = {
                "HOSPITAL_ID": "1",
                "ID_NO": "310102195407043250"
            };
        } else {
            vm.params = "username=" + vm.username + "&" + "password=" + vm.password;
        }
        //执行登录
        function accountLogin() {
            loginService.login(
                vm.params,
                function (response) {
                    $rootScope.handleMessage(
                        response,
                        function (data) {
                            //缓存用户登录信息
                            SessionStorage.set('loginInfo', data);
                            if($rootScope.previousState_name&&$rootScope.lastUserName===data.username&&$rootScope.checkAuth($rootScope.previousState_name)){
                                $rootScope.back();
                            }
                            else {
                                $rootScope.lastUserName = data.username;
                                $state.go('main');
                            }
                        },
                        function (response) {
                            var message = $filter('logMessage')(response.message);
                            $rootScope.alertDialog(message);
                        }
                    );
                },
                function () {
                    $rootScope.alertDialog("登录失败");
                    //$state.go('login');
                }
            );
        }

        //检查验证码
        loginService.checkCode(
            {
                "code": vm.code
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        if (data) {
                            accountLogin();
                        } else {
                            $rootScope.alertDialog("验证码错误。");
                            vm.getCode();
                        }
                    },
                    function () {
                        $rootScope.alertDialog("验证码错误。");
                        vm.getCode();
                    }
                );
            },
            function () {
                $rootScope.alertDialog("验证码校验失败");
            }
        );
    };
    vm.getCode();
    return vm;
}
"use strict";
SMS.SERVICES.service('loginService', loginService);
loginService.$inject = ['Account', 'ENV'];
function loginService(Account, ENV) {
    var vm = this;
    if (ENV.runMode === "debug") {
        vm.login = function (params, successFunction, failedFunction) {
            return Account.debugLogin(JSON.stringify(params)).$promise
                .then(successFunction, failedFunction);
        };
    } else {
        vm.login = function (params, successFunction, failedFunction) {
            return Account.login(params).$promise
                .then(successFunction, failedFunction);
        };
    }
    vm.logout = function (params, successFunction, failedFunction) {
        return Account.logout(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    vm.modifyPass = function (params, successFunction, failedFunction) {
        return Account.modifyPass(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    vm.getCode = function (params, successFunction, failedFunction) {
        return Account.getCode().$promise
            .then(successFunction, failedFunction);
    };
    vm.checkCode = function (params, successFunction, failedFunction) {
        return Account.checkCode(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('mainCtrl', mainCtrl);
mainCtrl.$inject = ['$rootScope', '$scope', '$state', '$mdDialog', '$mdPanel', 'SessionStorage', 'mainService', 'loginService', 'ENV'];
function mainCtrl($rootScope, $scope, $state, $mdDialog, $mdPanel, SessionStorage, mainService, loginService, ENV) {
    var vm = this;
    vm.runMode = (ENV.runMode === 'debug');
    vm.loginInfo = SessionStorage.get('loginInfo');
    vm.showModifyPass = function () {
        SMS.CONTROLLERS.controller('DialogController', DialogController);
        DialogController.$inject = ['$rootScope', '$scope', 'mdPanelRef'];
        function DialogController($rootScope, $scope, mdPanelRef) {
            $scope.$on('panelClose',
                function(){
                    mdPanelRef.close();
                }
            );
            $scope.cancel = function () {
                mdPanelRef.close();
            };
            $scope.answer = function () {
                var params = {
                    "OLDPASSWORD": $scope.oldPassword,
                    "NEWPASSWORD": $scope.newPassword,
                    "REPASSWORD": $scope.rePassword
                };
                loginService.modifyPass(
                    params,
                    function (response) {
                        $rootScope.handleMessage(
                            response,
                            function () {
                                vm.logout(mdPanelRef);
                            },
                            function (response) {
                                $rootScope.alertDialog(response['message']);
                            }
                        );
                    },
                    function () {
                        $rootScope.alertDialog("修改密码失败");
                        //$state.go('main');
                    }
                );
            };
        }

        var position = $mdPanel.newPanelPosition().absolute().center();
        var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
        var config = {
            animation: animation,
            attachTo: angular.element(document.body),
            controller: DialogController,
            templateUrl: 'template/login/edit.html',
            position: position,
            trapFocus: true,
            disableParentScroll: true,
            clickOutsideToClose: false,
            clickEscapeToClose: true,
            hasBackdrop: true,
            fullscreen: vm['customFullscreen']
        };
        $mdPanel.open(config);
    };
    vm.showLogout = function () {
        $rootScope.confirmDialog(
            '您确定要退出登录吗?',
            function () {
                vm.logout();
            },
            function () {

            }
        );
    };
    vm.logout = function (mdPanelRef) {
        loginService.logout(
            {},
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        mdPanelRef && mdPanelRef.close();
                        //清除用户登录信息
                        SessionStorage.remove('loginInfo');
                        $state.go('login');
                    },
                    function () {
                        $rootScope.alertDialog("退出登录失败");
                    }
                );

            },
            function () {
                $rootScope.alertDialog("退出登录失败");
                //$state.go('main');
            }
        );
    };

    vm.stateGo = function (state) {
        $state.go(state);
    };
    vm.isSelectedMenu = function (menuResourcePath) {
        if (menuResourcePath === '/main') {
            return $state.current.naviPath === '/main';
        } else {
            return $state.current.naviPath.indexOf(menuResourcePath) >= 0;
        }
    };
    $scope.$on('auth-loginRequired', loginRequired);
    $scope.$on('auth-forbidden', loginRequired);
    function loginRequired() {
        $rootScope.alertDialog('登陆超时，请重新登陆').then(
            function(){
                $state.go("login");
            }
        );
    }

    return vm;
}
SMS.SERVICES.service('mainService', mainService);
mainService.$inject = [];
function mainService() {
    var vm = this;
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('organizationAddCtrl', organizationAddCtrl);
organizationAddCtrl.$inject = ['$rootScope', '$state', 'organizationService', '$mdDialog', 'SessionStorage'];
function organizationAddCtrl($rootScope, $state, organizationService, $mdDialog, SessionStorage) {
    var vm = this;

    var lastProvince = null;
    var lastCity = null;
    var lastCounty = null;
    var lastParentOrder = null;

    vm.organization_level = '-1';
    vm.organizParentOrder = '-1';
    vm.organizParent = '-1';
    vm.organizAddressProvince = '-1';
    vm.organizAddressCity = '-1';
    vm.organizAddressCounty = '-1';
    vm.organizAddressStreet = '-1';
    vm.isOnlin = '1';
    vm.editOranginze = true;
    vm.showHospitalLevel = true;
    vm.required = true;

    var dict_type_code_list = [{
        "DICT_TYPE_CODE": "0019",//机构性质
        "LIST_NAME": "organizationTypeArr"
    }, {
        "DICT_TYPE_CODE": "0004",//医院等级
        "LIST_NAME": "hospital_level_arr"
    }];

    //获取字典列表
    $rootScope.commonService(
        "getDictList",
        {"DICT_TYPE_CODE_LIST": dict_type_code_list},
        function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    eachDictValue(data);
                    vm.organizationType = vm.organizationTypeArr[0];
                },
                function () {
                    $rootScope.alertDialog('获取字典列表失败');
                }
            );
        },
        function () {
            $rootScope.alertDialog('获取字典列表失败');
        }
    );

    //单个赋值
    function eachDictValue(data) {
        angular.forEach(dict_type_code_list, function (item) {
            vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
        });
    }

    vm.organizationTypeChange = function () {
        if (vm.organizationType.DICT_VALUE_CODE === "0019000010") {
            vm.showHospitalLevel = true;
            vm.required = true;
        } else {
            vm.showHospitalLevel = false;
            vm.required = false;
            vm.hospital_level = undefined;
        }
    };

    vm.closeAddOrangize = function (form) {
        organizationService.closeAddOrangize(form, $mdDialog, function () {
            $state.go('main.baseData.organizationList');
        }, function () {

        });
        return;
    };

    vm.returnToOrganiz = function () {
        $state.go('main.baseData.organizationList');
    };

    vm.initParentOrder = function (isTouched) {
        if (isTouched) return;
        organizationService.getOrganizationLevelList('', function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.organizParentOrders = data;
                },
                function () {
                    vm.organizParentOrders = [];
                    $rootScope.alertDialog('获取机构等级失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取机构等级失败');
        });
    };

    vm.initProvinceList = function (isTouched) {
        if (isTouched) return;
        if (SessionStorage.get('loginInfo').organizationKeyId) {
            organizationService.getProvinceList('', function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressProvinces = data;
                    },
                    function () {
                        vm.organizAddressProvinces = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        } else {
            $rootScope.commonService('getProvinceList', '', function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressProvinces = data;
                    },
                    function () {
                        vm.organizAddressProvinces = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        }
    };

    vm.initCertainLevelOrganization = function () {
        if (vm.organizParentOrder === '-1' || vm.organizParentOrder === '0') {
            vm.organizParents = [];
            return;
        }
        if (lastParentOrder && lastParentOrder === vm.organizParentOrder.LEVEL) {
            return;
        }
        var params = {
            ORGANIZATION_LEVEL: vm.organizParentOrder.LEVEL
        };
        lastParentOrder = vm.organizParentOrder.LEVEL;
        organizationService.getCertainLevelOrganization(params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.organizParents = data;
                },
                function () {
                    vm.organizParents = [];
                    $rootScope.alertDialog('获取上级机构失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取上级机构失败');
        });
    };

    vm.initCityListOfCertainProvince = function (form) {
        if (!form.organizAddressProvince.$dirty) {
            return;
        }
        if (!vm.organizAddressProvince) {
            vm.organizAddressCitys = [];
            return;
        }
        if (lastProvince && lastCity === vm.organizAddressProvince.PROVINCE_CODE) {
            return;
        }
        var params = {
            PROVINCE_CODE: vm.organizAddressProvince.PROVINCE_CODE
        };
        lastProvince = vm.organizAddressProvince.PROVINCE_CODE;
        if (!SessionStorage.get('loginInfo').organizationKeyId) {
            $rootScope.commonService('getCityListOfCertainProvince', params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressCitys = data;
                    },
                    function () {
                        vm.organizAddressCitys = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        } else {
            organizationService.getCityListOfCertainProvince(params, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.organizAddressCitys = data;
                }, function () {
                    vm.organizAddressCitys = [];
                    $rootScope.alertDialog("获取市列表失败");
                });
            }, function () {
                $rootScope.alertDialog("获取市列表失败");
            });
        }
    };

    vm.initCountyListOfCertainCity = function (form) {
        if (!form.organizAddressCity.$dirty) {
            return;
        }
        if (vm.organizAddressCity === '-1') {
            vm.organizAddressCountys = [];
            return;
        }
        if (lastCity && lastCity === vm.organizAddressCity.CITY_CODE) {
            return;
        }
        var params = {
            CITY_CODE: vm.organizAddressCity.CITY_CODE
        };
        lastCity = vm.organizAddressCity.CITY_CODE;
        if (!SessionStorage.get('loginInfo').organizationKeyId) {
            $rootScope.commonService('getCountyListOfCertainCity', params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressCountys = data;
                    },
                    function () {
                        vm.organizAddressCountys = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        } else {
            organizationService.getCountyListOfCertainCity(params, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.organizAddressCountys = data;
                }, function () {
                    vm.organizAddressCountys = [];
                    $rootScope.alertDialog("获取区/县列表失败");
                });
            }, function () {
                $rootScope.alertDialog("获取区/县列表失败");
            });
        }

    };

    vm.initSubdistrictListOfCertainCounty = function (form) {
        if (!form.organizAddressCounty.$dirty) {
            return;
        }
        if (vm.organizAddressCounty === '-1') {
            vm.organizAddressStreets = [];
            return;
        }
        if (lastCounty && lastCounty === vm.organizAddressCounty.COUNTY_DISTRICT_CODE) {
            return;
        }
        var params = {
            COUNTY_DISTRICT_CODE: vm.organizAddressCounty.COUNTY_DISTRICT_CODE
        };
        lastCounty = vm.organizAddressCounty.COUNTY_DISTRICT_CODE;
        if (!SessionStorage.get('loginInfo').organizationKeyId) {
            $rootScope.commonService('getSubdistrictListOfCertainCounty', params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressStreets = data;
                    },
                    function () {
                        vm.organizAddressStreets = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        } else {
            organizationService.getSubdistrictListOfCertainCounty(params, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.organizAddressStreets = data;
                }, function () {
                    vm.organizAddressStreets = [];
                    $rootScope.alertDialog("获取街道列表失败");
                });
            }, function () {
                $rootScope.alertDialog("获取街道列表失败");
            });
        }

    };

    vm.saveAddOrangize = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }

        var params = {
            "PARENT_ORGANIZATION_ID": vm.organizParent === '-1' ? null : vm.organizParent.ORGANIZATION_KEY_ID,
            "ORGANIZATION_LEVEL": (vm.organizParentOrder === '-1' || vm.organizParentOrder === '0') ? 1 : (parseInt(vm.organizParentOrder.LEVEL) + 1),
            "PARENT_ORGANIZATION_CODE": vm.organizParent === '-1' ? null : vm.organizParent.ORGANIZATION_CODE,
            "ORGANIZATION_NAME": vm.organizName,
            "PARENT_ORGANIZATION_NAME": vm.organizParent === '-1' ? null : vm.organizParent.ORGANIZATION_NAME,
            "PROVINCE_CODE": vm.organizAddressProvince === '-1' ? null : vm.organizAddressProvince.PROVINCE_CODE,
            "PROVINCE_NAME": vm.organizAddressProvince === '-1' ? null : vm.organizAddressProvince.PROVINCE_NAME,
            "CITY_CODE": vm.organizAddressCity === '-1' ? null : vm.organizAddressCity.CITY_CODE,
            "CITY_NAME": vm.organizAddressCity === '-1' ? null : vm.organizAddressCity.CITY_NAME,
            "COUNTY_DISTRICT_CODE": vm.organizAddressCounty === '-1' ? null : vm.organizAddressCounty.COUNTY_DISTRICT_CODE,
            "COUNTY_DISTRICT_NAME": vm.organizAddressCounty === '-1' ? null : vm.organizAddressCounty.COUNTY_DISTRICT_NAME,
            "STREET_TOWNSHIP_CODE": vm.organizAddressStreet === '-1' ? null : vm.organizAddressStreet.STREET_TOWNSHIP_CODE,
            "STREET_TOWNSHIP_NAME": vm.organizAddressStreet === '-1' ? null : vm.organizAddressStreet.STREET_TOWNSHIP_NAME,
            "ORGANIZATION_ADDRESS": vm.organizAddressDetail || null,
            "ORGANIZATION_SUMMARY": vm.organizIntroduce || null,
            "OPERATOR_ID": 1,
            "OPERATOR_NAME": "OP",
            "IS_ONLINE": parseInt(vm.isOnlin),
            "ORGANIZATION_CONTACTS": vm.organization_contacts || null,
            "ORGANIZATION_CONTACTS_PHONE": vm.organization_contacts_phone || null,
            "HOSPITAL_LEVEL_CODE": vm.hospital_level ? vm.hospital_level.DICT_VALUE_CODE : null,
            "HOSPITAL_LEVEL_NAME": vm.hospital_level ? vm.hospital_level.DICT_VALUE_NAME : null,
            "ORGANIZATION_TYPE_CODE": vm.organizationType.DICT_VALUE_CODE,
            "ORGANIZATION_TYPE_NAME": vm.organizationType.DICT_VALUE_NAME
        };

        organizationService.isOrganizationExist(params, function (res) {
            if (res.value.IS_EXIST !== 0) {
                $rootScope.alertDialog("机构名已存在");
            } else {
                organizationService.saveAddOrangize(form, $mdDialog, params, function (response) {
                    $rootScope.handleMessage(
                        response,
                        function () {
                            $rootScope.alertDialog("保存成功");
                            $state.go('main.baseData.organizationList');
                        },
                        function () {
                            $rootScope.alertDialog("保存失败");
                        }
                    );
                }, function (tooltext) {
                    if (!tooltext) {
                        tooltext = '保存失败';
                    }
                    $rootScope.alertDialog(tooltext);
                });
            }
        }, function () {
            $rootScope.alertDialog("机构名查重失败，无法保存");
        });
    };

    vm.changeAddress = function (index) {
        switch (index) {
            case 1:
                vm.organizAddressCity = '-1';
                vm.organizAddressCounty = '-1';
                vm.organizAddressStreet = '-1';
                break;
            case 2:
                vm.organizAddressCounty = '-1';
                vm.organizAddressStreet = '-1';
                break;
            case 3:
                vm.organizAddressStreet = '-1';
                break;
            case 4:
                break;
            case 5:
                vm.organizParent = '-1';
                break;
            default:
                break;

        }
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('organizationEditCtrl', organizationEditCtrl);
organizationEditCtrl.$inject = ['$rootScope', '$state', '$stateParams', 'organizationService', '$mdDialog', 'SessionStorage'];
function organizationEditCtrl($rootScope, $state, $stateParams, organizationService, $mdDialog, SessionStorage) {
    var vm = this;

    vm.organizParentOrder = $rootScope.isSuperManager() ? '0' : '-1';
    vm.organizParent = '-1';
    vm.organizAddressProvince = '-1';
    vm.organizAddressCity = '-1';
    vm.organizAddressCounty = '-1';
    vm.organizAddressStreet = '-1';
    vm.editOranginze = false;
    vm.showHospitalLevel = true;
    vm.required = true;
    vm.isEdit = true;
    vm.isSelf=SessionStorage.get('loginInfo').organizationKeyId&&(SessionStorage.get('loginInfo').organizationKeyId+'')===$stateParams.ORGANIZATION_KEY_ID;


    var orangizationCode = null;//记录编辑的机构code。改变上级机构的时候不能选择其子集机构
    var orangizationName = null;//记录编辑前的机构名称，编辑完保存如果修改要查重。
    var parentOrangization = null;

    var lastParentOrder = null;
    var lastProvince = null;
    var lastCity = null;
    var lastCounty = null;

    vm.edit = function (form) {
        form.$setPristine();
        form.$setUntouched();
        vm.editOranginze = true;
    };

    var dict_type_code_list = [{
        "DICT_TYPE_CODE": "0019",//机构性质
        "LIST_NAME": "organizationTypeArr"
    }, {
        "DICT_TYPE_CODE": "0004",//医院等级
        "LIST_NAME": "hospital_level_arr"
    }];
    //获取字典列表
    $rootScope.commonService(
        "getDictList",
        {"DICT_TYPE_CODE_LIST": dict_type_code_list},
        function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    eachDictValue(data);
                    vm.organizationType = vm.organizationTypeArr[0];
                    getOrganizationInfo();
                },
                function () {
                    $rootScope.alertDialog('获取字典列表失败');
                }
            );
        },
        function () {
            $rootScope.alertDialog('获取字典列表失败');
        }
    );

    //单个赋值
    function eachDictValue(data) {
        angular.forEach(dict_type_code_list, function (item) {
            vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
        });
    }

    vm.organizationTypeChange = function () {
        if (vm.organizationType.DICT_VALUE_CODE && vm.organizationType.DICT_VALUE_CODE === "0019000010") {
            vm.showHospitalLevel = true;
            vm.required = true;
        } else {
            vm.showHospitalLevel = false;
            vm.required = false;
            vm.hospital_level = undefined;
        }
    };

    function getOrganizationInfo() {
        organizationService.getOrganizationInfo($stateParams, function (response) {
            $rootScope.handleMessage(response, function () {
                initOrganizationInfo(response);
            }, function () {
                $rootScope.alertDialog("获取机构信息失败");
            });
        }, function () {
            $rootScope.alertDialog("获取机构信息失败");
        });
    }

    vm.returnToOrganiz = function () {
        $state.go('main.baseData.organizationList');
    };


    vm.initCertainLevelOrganization = function (form) {
        if (!form.organizParentOrder.$dirty) {
            return;
        }
        if (vm.organizParentOrder === '-1' || vm.organizParentOrder === '0') {
            vm.organizParents = [];
            return;
        }
        if (lastParentOrder && lastParentOrder === vm.organizParentOrder.LEVEL) {
            return;
        }
        var params = {
            ORGANIZATION_LEVEL: vm.organizParentOrder.LEVEL,
            ORGANIZATION_KEY_ID: $stateParams.ORGANIZATION_KEY_ID,
            ORGANIZATION_CODE: orangizationCode
        };
        lastParentOrder = vm.organizParentOrder.LEVEL;
        organizationService.getCertainLevelOrganization(params, function (response) {
            $rootScope.handleMessage(response, function (data) {
                vm.organizParents = data;
            }, function () {
                vm.organizParents = [];
                $rootScope.alertDialog("获取机构列表失败");
            });
        }, function () {
            $rootScope.alertDialog("获取机构列表失败");
        });
    };

    vm.initCityListOfCertainProvince = function (form) {
        if (!form.organizAddressProvince.$dirty) {
            return;
        }
        if (!vm.organizAddressProvince) {
            vm.organizAddressCitys = [];
            return;
        }
        if (lastProvince && lastProvince === vm.organizAddressProvince.PROVINCE_CODE) {
            return;
        }
        var params = {
            PROVINCE_CODE: vm.organizAddressProvince.PROVINCE_CODE
        };
        lastProvince = vm.organizAddressProvince.PROVINCE_CODE;
        if (!SessionStorage.get('loginInfo').organizationKeyId) {
            $rootScope.commonService('getCityListOfCertainProvince', params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressCitys = data;
                    },
                    function () {
                        vm.organizAddressCitys = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        } else {
            organizationService.getCityListOfCertainProvince(params, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.organizAddressCitys = data;
                }, function () {
                    vm.organizAddressCitys = [];
                    $rootScope.alertDialog("获取市列表失败");
                });
            }, function () {
                $rootScope.alertDialog("获取市列表失败");
            });
        }
    };

    vm.initCountyListOfCertainCity = function (form) {
        if (!form.organizAddressCity.$dirty) {
            return;
        }
        if (vm.organizAddressCity === '-1') {
            vm.organizAddressCountys = [];
            return;
        }
        if (lastCity && lastCity === vm.organizAddressCity.CITY_CODE) {
            return;
        }
        var params = {
            CITY_CODE: vm.organizAddressCity.CITY_CODE
        };
        lastCity = vm.organizAddressCity.CITY_CODE;
        if (!SessionStorage.get('loginInfo').organizationKeyId) {
            $rootScope.commonService('getCountyListOfCertainCity', params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressCountys = data;
                    },
                    function () {
                        vm.organizAddressCountys = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        } else {
            organizationService.getCountyListOfCertainCity(params, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.organizAddressCountys = data;
                }, function () {
                    vm.organizAddressCountys = [];
                    $rootScope.alertDialog("获取区/县列表失败");
                });
            }, function () {
                $rootScope.alertDialog("获取区/县列表失败");
            });
        }

    };

    vm.initSubdistrictListOfCertainCounty = function (form) {
        if (!form.organizAddressCounty.$dirty) {
            return;
        }
        if (vm.organizAddressCounty === '-1') {
            vm.organizAddressStreets = [];
            return;
        }
        if (lastCounty && lastCounty === vm.organizAddressCounty.COUNTY_DISTRICT_CODE) {
            return;
        }
        var params = {
            COUNTY_DISTRICT_CODE: vm.organizAddressCounty.COUNTY_DISTRICT_CODE
        };
        lastCounty = vm.organizAddressCounty.COUNTY_DISTRICT_CODE;
        if (!SessionStorage.get('loginInfo').organizationKeyId) {
            $rootScope.commonService('getSubdistrictListOfCertainCounty', params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressStreets = data;
                    },
                    function () {
                        vm.organizAddressStreets = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        } else {
            organizationService.getSubdistrictListOfCertainCounty(params, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.organizAddressStreets = data;
                }, function () {
                    vm.organizAddressStreets = [];
                    $rootScope.alertDialog("获取街道列表失败");
                });
            }, function () {
                $rootScope.alertDialog("获取街道列表失败");
            });
        }

    };

    vm.changeAddress = function (index) {
        switch (index) {
            case 1:
                vm.organizAddressCity = '-1';
                vm.organizAddressCounty = '-1';
                vm.organizAddressStreet = '-1';
                break;
            case 2:
                vm.organizAddressCounty = '-1';
                vm.organizAddressStreet = '-1';
                break;
            case 3:
                vm.organizAddressStreet = '-1';
                break;
            case 4:
                break;
            case 5:
                vm.organizParent = '-1';
                break;
            default:
                break;

        }
    };

    vm.saveAddOrangize = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }

        var params = {
            "ORGANIZATION_KEY_ID": $stateParams.ORGANIZATION_KEY_ID,
            "ORGANIZATION_LEVEL": vm.organizParentOrder === '-1' || vm.organizParentOrder === '0' ? 1 : (parseInt(vm.organizParentOrder.LEVEL) + 1),
            "PROVINCE_CODE": vm.organizAddressProvince === '-1' ? null : vm.organizAddressProvince.PROVINCE_CODE,
            "PROVINCE_NAME": vm.organizAddressProvince === '-1' ? null : vm.organizAddressProvince.PROVINCE_NAME,
            "CITY_CODE": vm.organizAddressCity === '-1' ? null : vm.organizAddressCity.CITY_CODE,
            "CITY_NAME": vm.organizAddressCity === '-1' ? null : vm.organizAddressCity.CITY_NAME,
            "COUNTY_DISTRICT_CODE": vm.organizAddressCounty === '-1' ? null : vm.organizAddressCounty.COUNTY_DISTRICT_CODE,
            "COUNTY_DISTRICT_NAME": vm.organizAddressCounty === '-1' ? null : vm.organizAddressCounty.COUNTY_DISTRICT_NAME,
            "STREET_TOWNSHIP_CODE": vm.organizAddressStreet === '-1' ? null : vm.organizAddressStreet.STREET_TOWNSHIP_CODE,
            "STREET_TOWNSHIP_NAME": vm.organizAddressStreet === '-1' ? null : vm.organizAddressStreet.STREET_TOWNSHIP_NAME,
            "ORGANIZATION_ADDRESS": vm.organizAddressDetail || null,
            "ORGANIZATION_SUMMARY": vm.organizIntroduce || null,
            "OPERATOR_ID": 1,
            "OPERATOR_NAME": "OP",
            "IS_ONLINE": parseInt(vm.isOnlin),
            "ORGANIZATION_CONTACTS": vm.organization_contacts || null,
            "ORGANIZATION_CONTACTS_PHONE": vm.organization_contacts_phone || null,
            "HOSPITAL_LEVEL_CODE": vm.hospital_level ? vm.hospital_level.DICT_VALUE_CODE : null,
            "HOSPITAL_LEVEL_NAME": vm.hospital_level ? vm.hospital_level.DICT_VALUE_NAME : null,
            "ORGANIZATION_TYPE_CODE": vm.organizationType.DICT_VALUE_CODE,
            "ORGANIZATION_TYPE_NAME": vm.organizationType.DICT_VALUE_NAME,
            NON_RECURSION:true
        };
        params.PARENT_ORGANIZATION_ID = vm.organizParent === '-1' ? null : vm.organizParent.ORGANIZATION_KEY_ID;
        params.PARENT_ORGANIZATION_CODE = vm.organizParent === '-1' ? null : vm.organizParent.ORGANIZATION_CODE;
        params.PARENT_ORGANIZATION_NAME = vm.organizParent === '-1' ? null : vm.organizParent.ORGANIZATION_NAME;

        if (vm.organizName !== orangizationName) {
            params.ORGANIZATION_NAME = vm.organizName;
        }
        if ((vm.organizParent !== '-1' && (parentOrangization+'') !== vm.organizParent.ORGANIZATION_CODE) || (vm.organizParent === '-1' && parentOrangization !== null)) {
            params.IS_PARENT_CHANGED=true;
        }
        if (vm.organizName !== orangizationName) {
            organizationService.isOrganizationExist(params, function (res) {
                if (res.value.IS_EXIST !== 0) {
                    $rootScope.alertDialog("机构名已存在");
                } else {
                    organizationService.updateOrganization(form, $mdDialog, params, function (response) {
                        $rootScope.handleMessage(response, function () {
                                vm.editOranginze=false;
                               parentOrangization=vm.organizParent.ORGANIZATION_CODE?vm.organizParent.ORGANIZATION_CODE:null;
                        }, function () {
                            $rootScope.alertDialog("保存失败");
                        });
                    }, function (tooltext) {
                        if (!tooltext) {
                            tooltext = '保存失败';
                        }
                        $rootScope.alertDialog(tooltext);
                    });
                }
            }, function () {
                $rootScope.alertDialog("机构名查重失败，无法保存");
            });
        } else {
            organizationService.updateOrganization(form, $mdDialog, params, function (response) {
                $rootScope.handleMessage(response, function () {
                    vm.editOranginze=false;
                    parentOrangization=vm.organizParent.ORGANIZATION_CODE?vm.organizParent.ORGANIZATION_CODE:null;
                }, function () {
                    $rootScope.alertDialog("保存失败");
                });
            }, function (tooltext) {
                if (!tooltext) {
                    tooltext = '保存失败';
                }
                $rootScope.alertDialog(tooltext);
            });
        }
    };

    vm.closeAddOrangize = function (form) {
        organizationService.closeAddOrangize(form, $mdDialog, function () {
            getOrganizationInfo();
            vm.editOranginze=false;
        }, function () {
            vm.editOranginze=false;
        });
        return;
    };

    function getIndexOrAdd(selectValue, selectList, compareKey) {
        if (selectList) {
            for (var i = 0; i < selectList.length; i++) {
                if (selectList[i][compareKey] === selectValue[compareKey]) {
                    return selectList[i];
                }
            }
            selectList[selectList.length] = selectValue;
            return selectList[selectList.length-1];
        } else {
            selectList = [selectValue];
            return selectList[0];
        }
    }

    function initOrganizationInfo(OrganizationData) {
        vm.organizName = OrganizationData.value.ORGANIZATION_NAME;
        orangizationName = vm.organizName;
        parentOrangization = OrganizationData.value.PARENT_ORGANIZATION_CODE ? OrganizationData.value.PARENT_ORGANIZATION_CODE : null;
        vm.isOnlin = OrganizationData.value.IS_ONLINE;
        vm.organizIntroduce = OrganizationData.value.ORGANIZATION_SUMMARY || '';
        orangizationCode = OrganizationData.value.ORGANIZATION_CODE;
        initParentOrangiztion(OrganizationData);
        initOrangizationAddress(OrganizationData);
        vm.organization_contacts = OrganizationData.value.ORGANIZATION_CONTACTS || '';
        vm.organization_contacts_phone = OrganizationData.value.ORGANIZATION_CONTACTS_PHONE || '';
        vm.organizationType = $rootScope.selectItem(vm.organizationTypeArr, 'DICT_VALUE_CODE', OrganizationData.value.ORGANIZATION_TYPE_CODE);
        vm.hospital_level = $rootScope.selectItem(vm.hospital_level_arr, 'DICT_VALUE_NAME', OrganizationData.value.HOSPITAL_LEVEL_NAME);
        vm.organizationTypeChange();
    }

    function initParentOrangiztion(OrganizationData) {

        organizationService.getOrganizationLevelList('', function (res) {
            $rootScope.handleMessage(res, function () {
                vm.organizParentOrders = res.value;

                if (OrganizationData.value.ORGANIZATION_LEVEL !== 1) {
                    var selectData = {
                        LEVEL: OrganizationData.value.ORGANIZATION_LEVEL - 1,
                        LEVEL_CN: OrganizationData.value.PARENT_ORGANIZATION_LEVEL_CN
                    };
                    lastParentOrder = OrganizationData.value.ORGANIZATION_LEVEL - 1;
                    vm.organizParentOrder = getIndexOrAdd(selectData, vm.organizParentOrders, 'LEVEL');
                }
            }, function () {
                $rootScope.alertDialog("查询机构级别列表失败");
            });
        }, function () {
            $rootScope.alertDialog("查询机构级别列表失败");
        });


        if (OrganizationData.value.ORGANIZATION_LEVEL !== 1) {
            organizationService.getCertainLevelOrganization({
                ORGANIZATION_LEVEL: OrganizationData.value.ORGANIZATION_LEVEL - 1,
                ORGANIZATION_KEY_ID: $stateParams.ORGANIZATION_KEY_ID,
                ORGANIZATION_CODE: OrganizationData.value.ORGANIZATION_CODE
            }, function (res) {
                $rootScope.handleMessage(res, function () {
                    vm.organizParents = res.value;
                    var data = {
                        ORGANIZATION_CODE: OrganizationData.value.PARENT_ORGANIZATION_CODE,
                        ORGANIZATION_KEY_ID: OrganizationData.value.PARENT_ORGANIZATION_ID,
                        ORGANIZATION_NAME: OrganizationData.value.PARENT_ORGANIZATION_NAME
                    };
                    vm.organizParent = getIndexOrAdd(data, vm.organizParents, 'ORGANIZATION_KEY_ID');
                }, function () {
                    vm.organizParents = [];
                    $rootScope.alertDialog("查询上级机构列表失败");
                });
            }, function () {
                $rootScope.alertDialog("查询上级机构列表失败");
            });
        }
    }

    function initOrangizationAddress(OrganizationData) {
        if (OrganizationData.value.ORGANIZATION_ADDRESS) {

            lastProvince = OrganizationData.value.PROVINCE_CODE;
            lastCity = OrganizationData.value.CITY_CODE;
            lastCounty = OrganizationData.value.COUNTY_DISTRICT_CODE;
            if (SessionStorage.get('loginInfo').organizationKeyId) {
                organizationService.getProvinceList('', function (res) {
                    $rootScope.handleMessage(res, function () {
                        vm.organizAddressProvinces = res.value;
                        var data = {
                            PROVINCE_CODE: OrganizationData.value.PROVINCE_CODE,
                            PROVINCE_NAME: OrganizationData.value.PROVINCE_NAME
                        };
                        vm.organizAddressProvince = getIndexOrAdd(data, vm.organizAddressProvinces, 'PROVINCE_CODE');
                    }, function () {
                        vm.organizAddressProvinces = [];
                        $rootScope.alertDialog("查询省列表失败");
                    });
                }, function () {
                    $rootScope.alertDialog("查询省列表失败");
                });

                organizationService.getCityListOfCertainProvince({
                    PROVINCE_CODE: OrganizationData.value.PROVINCE_CODE
                }, function (res) {
                    $rootScope.handleMessage(res, function () {
                        vm.organizAddressCitys = res.value;
                        var cityData = {
                            CITY_CODE: OrganizationData.value.CITY_CODE,
                            CITY_NAME: OrganizationData.value.CITY_NAME
                        };
                        vm.organizAddressCity = getIndexOrAdd(cityData, vm.organizAddressCitys, 'CITY_CODE');
                    }, function () {
                        vm.organizAddressCitys = [];
                        $rootScope.alertDialog("查询市列表失败");
                    });
                }, function () {
                    $rootScope.alertDialog("查询市列表失败");
                });

                organizationService.getCountyListOfCertainCity({
                    CITY_CODE: OrganizationData.value.CITY_CODE
                }, function (res) {
                    $rootScope.handleMessage(res, function () {
                        vm.organizAddressCountys = res.value;
                        var data = {
                            COUNTY_DISTRICT_CODE: OrganizationData.value.COUNTY_DISTRICT_CODE,
                            COUNTY_DISTRICT_NAME: OrganizationData.value.COUNTY_DISTRICT_NAME
                        };
                        vm.organizAddressCounty = getIndexOrAdd(data, vm.organizAddressCountys, 'COUNTY_DISTRICT_CODE');
                    }, function () {
                        vm.organizAddressCountys = [];
                        $rootScope.alertDialog("查询区/县列表失败");
                    });
                }, function () {
                    $rootScope.alertDialog("查询区/县列表失败");
                });

                organizationService.getSubdistrictListOfCertainCounty({
                    COUNTY_DISTRICT_CODE: OrganizationData.value.COUNTY_DISTRICT_CODE
                }, function (res) {
                    $rootScope.handleMessage(res, function () {
                        vm.organizAddressStreets = res.value;
                        var data = {
                            STREET_TOWNSHIP_CODE: OrganizationData.value.STREET_TOWNSHIP_CODE,
                            STREET_TOWNSHIP_NAME: OrganizationData.value.STREET_TOWNSHIP_NAME
                        };
                        vm.organizAddressStreet = getIndexOrAdd(data, vm.organizAddressStreets, 'STREET_TOWNSHIP_CODE');
                    }, function () {
                        vm.organizAddressStreets = [];
                        $rootScope.alertDialog("查询街道列表失败");
                    });
                }, function () {
                    $rootScope.alertDialog("查询街道列表失败");
                });
            } else {
                $rootScope.commonService('getProvinceList', '', function (response) {
                    $rootScope.handleMessage(
                        response,
                        function (data) {
                            vm.organizAddressProvinces = data;
                            var provinceData = {
                                PROVINCE_CODE: OrganizationData.value.PROVINCE_CODE,
                                PROVINCE_NAME: OrganizationData.value.PROVINCE_NAME
                            };
                            vm.organizAddressProvince = getIndexOrAdd(provinceData, vm.organizAddressProvinces, 'PROVINCE_CODE');
                        },
                        function () {
                            vm.organizAddressProvinces = [];
                            $rootScope.alertDialog('查询省列表失败');
                        }
                    );
                }, function () {
                    $rootScope.alertDialog('查询省列表失败');
                });

                $rootScope.commonService('getCityListOfCertainProvince', {
                    PROVINCE_CODE: OrganizationData.value.PROVINCE_CODE
                }, function (response) {
                    $rootScope.handleMessage(
                        response,
                        function (data) {
                            vm.organizAddressCitys = data;
                            var cityData = {
                                CITY_CODE: OrganizationData.value.CITY_CODE,
                                CITY_NAME: OrganizationData.value.CITY_NAME
                            };
                            vm.organizAddressCity = getIndexOrAdd(cityData, vm.organizAddressCitys, 'CITY_CODE');
                        },
                        function () {
                            vm.organizAddressProvinces = [];
                            $rootScope.alertDialog('查询市列表失败');
                        }
                    );
                }, function () {
                    $rootScope.alertDialog('查询市列表失败');
                });

                $rootScope.commonService('getCountyListOfCertainCity', {
                    CITY_CODE: OrganizationData.value.CITY_CODE
                }, function (response) {
                    $rootScope.handleMessage(
                        response,
                        function (data) {
                            vm.organizAddressCountys = data;
                            var countyData = {
                                COUNTY_DISTRICT_CODE: OrganizationData.value.COUNTY_DISTRICT_CODE,
                                COUNTY_DISTRICT_NAME: OrganizationData.value.COUNTY_DISTRICT_NAME
                            };
                            vm.organizAddressCounty = getIndexOrAdd(countyData, vm.organizAddressCountys, 'COUNTY_DISTRICT_CODE');
                        },
                        function () {
                            vm.organizAddressProvinces = [];
                            $rootScope.alertDialog('查询区/县列表失败');
                        }
                    );
                }, function () {
                    $rootScope.alertDialog('查询区/县列表失败');
                });

                $rootScope.commonService('getSubdistrictListOfCertainCounty', {
                    COUNTY_DISTRICT_CODE: OrganizationData.value.COUNTY_DISTRICT_CODE
                }, function (response) {
                    $rootScope.handleMessage(
                        response,
                        function (data) {
                            vm.organizAddressStreets = data;
                            var streetData = {
                                STREET_TOWNSHIP_CODE: OrganizationData.value.STREET_TOWNSHIP_CODE,
                                STREET_TOWNSHIP_NAME: OrganizationData.value.STREET_TOWNSHIP_NAME
                            };
                            vm.organizAddressStreet = getIndexOrAdd(streetData, vm.organizAddressStreets, 'STREET_TOWNSHIP_CODE');
                        },
                        function () {
                            vm.organizAddressProvinces = [];
                            $rootScope.alertDialog('查询街道列表失败');
                        }
                    );
                }, function () {
                    $rootScope.alertDialog('查询街道列表失败');
                });
            }


            vm.organizAddressDetail = OrganizationData.value.ORGANIZATION_ADDRESS;
        } else {

            if (!SessionStorage.get('loginInfo').organizationKeyId) {
                $rootScope.commonService('getProvinceList', '', function (response) {
                    $rootScope.handleMessage(
                        response,
                        function (data) {
                            vm.organizAddressProvinces = data;
                        },
                        function () {
                            vm.organizAddressProvinces = [];
                            $rootScope.alertDialog('查询省列表失败');
                        }
                    );
                }, function () {
                    $rootScope.alertDialog('查询省列表失败');
                });
            } else {
                organizationService.getProvinceList('', function (res) {
                    $rootScope.handleMessage(res, function () {
                        vm.organizAddressProvinces = res.value;
                    }, function () {
                        vm.organizAddressProvinces = [];
                        $rootScope.alertDialog("查询省列表失败");
                    });
                }, function () {
                    $rootScope.alertDialog("查询省列表失败");
                });

            }
        }
    }

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('organizationListCtrl', organizationListCtrl);
organizationListCtrl.$inject = ['$rootScope', '$state', 'organizationService', '$q', 'downloadCommon', 'SessionStorage'];
function organizationListCtrl($rootScope, $state, organizationService, $q, downloadCommon, SessionStorage) {
    var vm = this;
    var downLoadParam = null;//信息导出是根据表格展示来的，所以要记录表格展示时的筛选条件

    var lastProvince = null;
    var lastCity = null;
    var lastCounty = null;

    vm.isDownloading = false;


    vm.initParentOrder = function (isTouched) {
        if (isTouched) return;
        if (SessionStorage.get('loginInfo').organizationKeyId) {
            organizationService.getOrganizationLevelList('', function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizParentOrders = data;
                    },
                    function () {
                        vm.organizParentOrders = [];
                        $rootScope.alertDialog('获取机构等级失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取机构等级失败');
            });
        } else {
            $rootScope.commonService('getOrganizationLevelList', '', function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizParentOrders = data;
                    },
                    function () {
                        vm.organizParentOrders = [];
                        $rootScope.alertDialog('获取机构等级失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取机构等级失败');
            });
        }
    };

    vm.initProvinceList = function (isTouched) {
        if (isTouched) return;
        if (SessionStorage.get('loginInfo').organizationKeyId) {
            organizationService.getProvinceList('', function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressProvinces = data;
                    },
                    function () {
                        vm.organizAddressProvinces = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        } else {
            $rootScope.commonService('getProvinceList', '', function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressProvinces = data;
                    },
                    function () {
                        vm.organizAddressProvinces = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        }
    };


    vm.initCityListOfCertainProvince = function () {
        if (vm.organizAddressProvince === '-1') {
            vm.organizAddressCitys = [];
            return;
        }
        if (lastProvince && lastProvince === vm.organizAddressProvince.PROVINCE_CODE) {
            return;
        }
        var params = {
            PROVINCE_CODE: vm.organizAddressProvince.PROVINCE_CODE
        };
        lastProvince = vm.organizAddressProvince.PROVINCE_CODE;
        if (!SessionStorage.get('loginInfo').organizationKeyId) {
            $rootScope.commonService('getCityListOfCertainProvince', params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressCitys = data;
                    },
                    function () {
                        vm.organizAddressCitys = [];
                        $rootScope.alertDialog('获取市列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取市列表失败');
            });
        } else {
            organizationService.getCityListOfCertainProvince(params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressCitys = data;
                    },
                    function () {
                        vm.organizAddressCitys = [];
                        $rootScope.alertDialog('获取市列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取市列表失败');
            });
        }
    };

    vm.initCountyListOfCertainCity = function () {
        if (vm.organizAddressCity === '-1') {
            vm.organizAddressCountys = [];
            return;
        }
        if (lastCity && lastCity === vm.organizAddressCity.CITY_CODE) {
            return;
        }
        var params = {
            CITY_CODE: vm.organizAddressCity.CITY_CODE
        };
        lastCity = vm.organizAddressCity.CITY_CODE;
        if (!SessionStorage.get('loginInfo').organizationKeyId) {
            $rootScope.commonService('getCountyListOfCertainCity', params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressCountys = data;
                    },
                    function () {
                        vm.organizAddressCountys = [];
                        $rootScope.alertDialog('获取区/县列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取区/县列表失败');
            });
        } else {
            organizationService.getCountyListOfCertainCity(params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressCountys = data;
                    },
                    function () {
                        vm.organizAddressCountys = [];
                        $rootScope.alertDialog('获取区/县失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取区/县失败');
            });
        }
    };

    vm.initSubdistrictListOfCertainCounty = function () {
        if (vm.organizAddressCounty === '-1') {
            vm.organizAddressStreets = [];
            return;
        }
        if (lastCounty && lastCounty === vm.organizAddressCounty.COUNTY_DISTRICT_CODE) {
            return;
        }
        var params = {
            COUNTY_DISTRICT_CODE: vm.organizAddressCounty.COUNTY_DISTRICT_CODE
        };
        lastCounty = vm.organizAddressCounty.COUNTY_DISTRICT_CODE;
        if (!SessionStorage.get('loginInfo').organizationKeyId) {
            $rootScope.commonService('getSubdistrictListOfCertainCounty', params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressStreets = data;
                    },
                    function () {
                        vm.organizAddressStreets = [];
                        $rootScope.alertDialog('获取街道列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取街道列表失败');
            });
        } else {
            organizationService.getSubdistrictListOfCertainCounty(params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organizAddressStreets = data;
                    },
                    function () {
                        vm.organizAddressStreets = [];
                        $rootScope.alertDialog('获取街道列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取街道列表失败');
            });
        }
    };


    vm.tabledataHtml = function () {
        var listPara = {
            "ORGANIZATION_LEVEL": !vm.organizParentOrder || vm.organizParentOrder === '-1' ? null : vm.organizParentOrder.LEVEL,
            "PARENT_ORGANIZATION_NAME": vm.searchParentText ? vm.searchParentText : null,
            "ORGANIZATION_NAME": vm.searchText ? vm.searchText : null,
            "PROVINCE_CODE": !vm.organizAddressProvince || vm.organizAddressProvince === '-1' ? null : vm.organizAddressProvince.PROVINCE_CODE,
            "CITY_CODE": !vm.organizAddressCity || vm.organizAddressCity === '-1' ? null : vm.organizAddressCity.CITY_CODE,
            "COUNTY_DISTRICT_CODE": !vm.organizAddressCounty || vm.organizAddressCounty === '-1' ? null : vm.organizAddressCounty.COUNTY_DISTRICT_CODE,
            "STREET_TOWNSHIP_CODE": !vm.organizAddressStreet || vm.organizAddressStreet === '-1' ? null : vm.organizAddressStreet.STREET_TOWNSHIP_CODE
        };
        downLoadParam = listPara;
        organizationService.getOrganizationListHtml(vm, listPara, $state);
    };
    vm.tabledataHtml();


    vm.addOrangization = function () {
        $state.go('main.baseData.organizationAdd');
    };

    vm.searchTextChange = function (search) {
        var searchParam = {
            ORGANIZATION_NAME: search
        };
        var result = $q.defer();
        organizationService.getOrganizationNameList(searchParam, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    result.resolve(data);
                },
                function () {
                    result.resolve([]);
                }
            );
        }, function () {

        });
        return result.promise;
    };

    vm.searchParentTextChange = function (search) {
        var searchParam = {
            PARENT_ORGANIZATION_NAME: search
        };
        var result = $q.defer();
        organizationService.getOrganizationNameList(searchParam, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    result.resolve(data);
                },
                function () {
                    result.resolve([]);
                }
            );
        }, function () {

        });
        return result.promise;
    };

    vm.changeAddress = function (index) {
        switch (index) {
            case 1:
                vm.organizAddressCity = '-1';
                vm.organizAddressCounty = '-1';
                vm.organizAddressStreet = '-1';
                break;
            case 2:
                vm.organizAddressCounty = '-1';
                vm.organizAddressStreet = '-1';
                break;
            case 3:
                vm.organizAddressStreet = '-1';
                break;
            default:
                break;

        }
    };

    vm.downLoadFile = function () {
        vm.isDownloading = true;
        organizationService.downloadOrganizationList(downLoadParam, function (response) {
            $rootScope.handleMessage(response, function (data) {
                downloadCommon.downloadFile(data['fileName'], "组织机构信息.xls");
                vm.isDownloading = false;
            }, function () {
                vm.isDownloading = false;
                $rootScope.alertDialog("信息导出失败");
            });
        }, function () {
            vm.isDownloading = false;
            $rootScope.alertDialog("信息导出失败");
        });
    };

    return vm;
}
"use strict";
SMS.SERVICES.service('organizationService', organizationService);
organizationService.$inject = ['$rootScope', 'Organization', 'bootstrapTable'];
function organizationService($rootScope, Organization, bootstrapTable) {
    var vm = this;
    vm.closeAddOrangize = function (form, $mdDialog, successFunction, failedFunction) {
        if (form.$dirty) {
            $rootScope.confirmDialog('如果取消则已输入内容会丢失？', successFunction, failedFunction);
        } else {
            successFunction();
            return;
        }
    };

    vm.saveAddOrangize = function (form, $mdDialog, param, successFunction, failedFunction) {
        if (form.organizName.$invalid) {
            failedFunction('组织机构名称不符合规范');
            return;
        }
        if (form.organizParentOrder.$viewValue === '-1') {
            failedFunction('请选择上级机构级别');
            return;
        }
        if (form.organizParentOrder.$viewValue !== '0' && form.organizParent.$viewValue === '-1') {
            failedFunction('请选择上级机构');
            return;
        }
        if ((form.organizationType.$viewValue.DICT_VALUE_CODE === "0019000010" && form.organizAddressProvince.$viewValue === '-1') ||
            (form.organizAddressProvince.$viewValue !== '-1' && (form.organizAddressCity.$viewValue === '-1' || form.organizAddressCounty.$viewValue === '-1' || form.organizAddressStreet.$viewValue === '-1' || !form.organizAddressDetail.$viewValue))) {
            failedFunction('请填写完整的机构位置');
            return;
        }
        if (form.organizIntroduce.$invalid) {
            failedFunction('机构简介输入不符合规范');
            return;
        }
        Organization.createOrganization(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
        return;
    };

    vm.getOrganizationLevelList = function (param, successFunction, failedFunction) {
        Organization.getOrganizationLevelList(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };


    vm.getCertainLevelOrganization = function (param, successFunction, failedFunction) {
        Organization.getCertainLevelOrganization(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getProvinceList = function (param, successFunction, failedFunction) {
        Organization.getProvinceList(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getCityListOfCertainProvince = function (param, successFunction, failedFunction) {
        Organization.getCityListOfCertainProvince(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getCountyListOfCertainCity = function (param, successFunction, failedFunction) {
        Organization.getCountyListOfCertainCity(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getSubdistrictListOfCertainCounty = function (param, successFunction, failedFunction) {
        Organization.getSubdistrictListOfCertainCounty(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getOrganizationListHtml = function ($vm, listPara, $state) {
        var list = {
            dataFunction: getOrganizationList,
            dataParams: listPara,
            columns: [{
                field: 'ORGANIZATION_NAME',
                title: '机构名称',
                align: 'center',
                width: 298,
                formatter: function (val) {
                    return "<div  style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click div': function (e, vlaue, row) {
                        $state.go('main.baseData.organizationEdit', {
                            "ORGANIZATION_KEY_ID": row.ORGANIZATION_KEY_ID,
                            "ORGANIZATION_TYPE_CODE": row.ORGANIZATION_TYPE_CODE
                        });
                    }
                }
            }, {
                field: 'ORGANIZATION_LEVEL',
                title: '机构级别',
                width: 238,
                align: 'center'
            }, {
                field: 'ADDRESS',
                title: '机构地址',
                width: 366,
                align: 'center'
            }, {
                field: 'PARENT_ORGANIZATION_NAME',
                title: '上级机构',
                width: 298,
                align: 'center'
            }, {
                field: 'ORGANIZATION_TYPE_NAME',
                title: '机构性质',
                width: 298,
                align: 'center'
            }]
        };

        function getOrganizationList(param, successFunction, failedFunction) {
            Organization.getOrganizationList(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.organizationTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };


    vm.getOrganizationNameList = function (param, successFunction, failedFunction) {
        Organization.getOrganizationNameList(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getOrganizationInfo = function (param, successFunction, failedFunction) {
        Organization.getOrganizationInfo(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.isOrganizationExist = function (param, successFunction, failedFunction) {
        Organization.isOrganizationExist(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.downloadOrganizationList = function (param, successFunction, failedFunction) {
        Organization.downloadOrganizationList(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.updateOrganization = function (form, $mdDialog, param, successFunction, failedFunction) {
        if (form.organizName.$invalid) {
            failedFunction('组织机构名称不符合规范');
            return;
        }
        if (form.organizParentOrder.$viewValue === '-1') {
            failedFunction('请选择上级机构级别');
            return;
        }
        if (form.organizParentOrder.$viewValue !== '0' && form.organizParent.$viewValue === '-1') {
            failedFunction('请选择上级机构');
            return;
        }
        if (form.organizAddressProvince.$viewValue !== '-1' && (form.organizAddressCity.$viewValue === '-1' || form.organizAddressCounty.$viewValue === '-1' || form.organizAddressStreet.$viewValue === '-1' || !form.organizAddressDetail.$viewValue)) {
            failedFunction('请填写完整的机构位置');
            return;
        }
        if (form.organizIntroduce.$invalid) {
            failedFunction('机构简介输入不符合规范');
            return;
        }
        Organization.updateOrganization(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
        return;
    };


    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('deptAddCtrl', deptAddCtrl);
deptAddCtrl.$inject = ['$rootScope', '$state', '$stateParams', 'hospitalDeptService'];
function deptAddCtrl($rootScope, $state, $stateParams, hospitalDeptService) {
    var vm = this;
    vm.add = true;
    vm.editable = true;
    vm['HOSPITAL_ID'] = $stateParams['HOSPITAL_ID'];
    vm['HOSPITAL_NAME'] = $stateParams['HOSPITAL_NAME'];
    vm['IS_ONLINE'] = '1';

    vm.createNewDept = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }

        var params = {
            "HOSPITAL_ID": vm['HOSPITAL_ID'],
            "DEPT_NAME": vm['DEPT_NAME'],
            "IS_ONLINE": vm['IS_ONLINE'],
            "DEPT_SUMMARY": vm['DEPT_SUMMARY'],
            "SKILLED_PROJECT": vm['SKILLED_PROJECT']
        };
        hospitalDeptService.addDept(
            params,
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        $state.go('main.baseData.deptList', {
                            "HOSPITAL_ID": vm['HOSPITAL_ID'],
                            "HOSPITAL_NAME": vm['HOSPITAL_NAME']
                        });
                    },
                    function (response) {
                        $rootScope.alertDialog(response.message);
                    }
                );
            },
            function () {
                $rootScope.alertDialog('创建科室失败');
            });
    };

    //返回
    vm.cancel = function (deptForm) {
        if (deptForm.$dirty) {
            $rootScope.confirmDialog(
                '您确定要放弃保存吗?',
                function () {
                    $state.go('main.baseData.deptList', {
                        "HOSPITAL_ID": vm['HOSPITAL_ID'],
                        "HOSPITAL_NAME": vm['HOSPITAL_NAME']
                    });
                },
                function () {

                }
            );
        } else {
            $state.go('main.baseData.deptList', {
                "HOSPITAL_ID": vm['HOSPITAL_ID'],
                "HOSPITAL_NAME": vm['HOSPITAL_NAME']
            });
        }
    };
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('deptEditCtrl', deptEditCtrl);
deptEditCtrl.$inject = ['$rootScope', '$state', '$stateParams', 'hospitalDeptService'];
function deptEditCtrl($rootScope, $state, $stateParams, hospitalDeptService) {
    var vm = this;
    vm.edit = true;
    vm.editable = false;
    vm['HOSPITAL_ID'] = $stateParams['HOSPITAL_ID'];
    vm['HOSPITAL_NAME'] = $stateParams['HOSPITAL_NAME'];
    vm['DEPT_ID'] = $stateParams['DEPT_ID'];

    //编辑前的暂存值
    var HOSPITAL_ID;
    var DEPT_NAME;
    var IS_ONLINE;
    var DEPT_SUMMARY;
    var SKILLED_PROJECT;

    function getDeptById() {
        hospitalDeptService.getDeptById(
            {
                "DEPT_ID": $stateParams['DEPT_ID']
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm['DEPT_NAME'] = data['DEPT_NAME'];
                        vm['IS_ONLINE'] = data['IS_ONLINE'];
                        vm['DEPT_SUMMARY'] = data['DEPT_SUMMARY'];
                        vm['SKILLED_PROJECT'] = data['SKILLED_PROJECT'];
                        vm['HAS_DOCTOR'] = data['HAS_DOCTOR'];
                    },
                    function () {
                        $rootScope.alertDialog("查询科室数据失败");
                    }
                );
            },
            function () {
                $rootScope.alertDialog("查询科室数据失败");
            }
        );
    }

    getDeptById();

    vm.edit = function (deptForm) {
        HOSPITAL_ID = angular.copy(vm['HOSPITAL_ID']);
        DEPT_NAME = angular.copy(vm['DEPT_NAME']);
        IS_ONLINE = angular.copy(vm['IS_ONLINE']);
        DEPT_SUMMARY = angular.copy(vm['DEPT_SUMMARY']);
        SKILLED_PROJECT = angular.copy(vm['SKILLED_PROJECT']);
        deptForm.$setPristine();
        deptForm.$setUntouched();
        vm.editable = true;
    };

    vm.createNewDept = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }

        var params = {
            "DEPT_ID": vm['DEPT_ID'],
            "HOSPITAL_ID": vm['HOSPITAL_ID'],
            "DEPT_NAME": vm['DEPT_NAME'],
            "IS_ONLINE": vm['IS_ONLINE'],
            "DEPT_SUMMARY": vm['DEPT_SUMMARY'],
            "SKILLED_PROJECT": vm['SKILLED_PROJECT']
        };
        hospitalDeptService.updateDept(
            params,
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        vm.editable = false;
                    },
                    function () {
                        $rootScope.alertDialog(response.message);
                    }
                );
            },
            function () {
                $rootScope.alertDialog('更新科室信息失败');
            }
        );
    };

    vm.changeOnline = function () {
        if ((vm['IS_ONLINE'] === 0 || vm['IS_ONLINE'] === '0') && (vm['HAS_DOCTOR'] === 1 || vm['HAS_DOCTOR'] === '1')) {
                $rootScope.alertDialog('科室下线前请更换该科室下的医生至其他科室');
                vm['IS_ONLINE'] = 1;
        }
    };

    //取消
    vm.cancel = function (deptForm) {
        if (deptForm.$dirty) {
            $rootScope.confirmDialog(
                '您确定要放弃保存吗?',
                function () {
                    resetData();
                    vm.editable = false;
                },
                function () {

                }
            );
        } else {
            vm.editable = false;
        }
        function resetData() {
            vm['HOSPITAL_ID'] = HOSPITAL_ID;
            vm['DEPT_NAME'] = DEPT_NAME;
            vm['IS_ONLINE'] = IS_ONLINE;
            vm['DEPT_SUMMARY'] = DEPT_SUMMARY;
            vm['SKILLED_PROJECT'] = SKILLED_PROJECT;
            deptForm.$setPristine();
            deptForm.$setUntouched();
        }
    };

    //返回
    vm.goBack = function () {
        $state.go('main.baseData.deptList', {
            "HOSPITAL_ID": vm['HOSPITAL_ID'],
            "HOSPITAL_NAME": vm['HOSPITAL_NAME']
        });
    };
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('deptListCtrl', deptListCtrl);
deptListCtrl.$inject = ['$rootScope', '$state', '$stateParams', 'hospitalDeptService', 'downloadCommon'];
function deptListCtrl($rootScope, $state, $stateParams, hospitalDeptService, downloadCommon) {
    var vm = this;
    vm['HOSPITAL_ID'] = $stateParams['HOSPITAL_ID'];
    vm['HOSPITAL_NAME'] = $stateParams['HOSPITAL_NAME'];
    vm.isDownloading = false;
    var downLoadParam = null;//信息导出是根据表格展示来的，所以要记录表格展示时的筛选条件
    vm.getDeptList = function () {
        var params = {
            "HOSPITAL_ID": vm['HOSPITAL_ID']
        };
        downLoadParam = params;
        hospitalDeptService.getDeptListHtml(vm, params, $state);
    };
    vm.getDeptList();

    vm.downLoadFile = function () {
        vm.isDownloading = true;
        hospitalDeptService.downloadDeptList(downLoadParam, function (response) {
            $rootScope.handleMessage(response, function (data) {
                downloadCommon.downloadFile(data['fileName'], "医院科室信息.xls");
                vm.isDownloading = false;
            }, function () {
                vm.isDownloading = false;
                $rootScope.alertDialog("信息导出失败");
            });
        }, function () {
            vm.isDownloading = false;
            $rootScope.alertDialog("信息导出失败");
        });
    };
    vm.addDept = function () {
        $state.go('main.baseData.deptAdd', {
            "HOSPITAL_ID": vm['HOSPITAL_ID'],
            "HOSPITAL_NAME": vm['HOSPITAL_NAME']
        });
    };
    //返回
    vm.goBack = function () {
        $state.go('main.baseData.hospitalDeptList');
    };
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('hospitalListCtrl', hospitalListCtrl);
hospitalListCtrl.$inject = ['$rootScope', '$state', 'hospitalDeptService', '$q', 'SessionStorage', 'Common', 'downloadCommon'];
function hospitalListCtrl($rootScope, $state, hospitalDeptService, $q, SessionStorage, Common, downloadCommon) {
    var vm = this;

    var lastProvince = null;
    var lastCity = null;
    var lastCounty = null;

    var downLoadParam = null;

    vm.isDownloading = false;

    Common.getDictList({
        DICT_TYPE_CODE_LIST: [{
            DICT_TYPE_CODE: '0004'
        }]
    }, function (response) {
        $rootScope.handleMessage(
            response,
            function (data) {
                vm.hospitalLevels = data[0].DICT_CODE_LIST;
            },
            function () {
                vm.hospitalLevels = [];
                $rootScope.alertDialog('获取医院等级列表失败');
            }
        );
    }, function () {
        $rootScope.alertDialog('获取医院等级列表失败');
    });


    vm.initProvinceList = function (isTouched) {
        if (isTouched) return;
        if (!SessionStorage.get('loginInfo').organizationKeyId) {
            $rootScope.commonService('getProvinceList', '', function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.hospitalAddressProvinces = data;
                    },
                    function () {
                        vm.hospitalAddressProvinces = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        } else {
            hospitalDeptService.getProvinceList('', function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.hospitalAddressProvinces = data;
                    },
                    function () {
                        vm.hospitalAddressProvinces = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        }
    };


    vm.initCityListOfCertainProvince = function () {
        if (vm.hospitalAddressProvince === '-1') {
            vm.hospitalAddressCitys = [];
            return;
        }
        if (lastProvince && lastProvince === vm.hospitalAddressProvince.PROVINCE_CODE) {
            return;
        }
        var params = {
            PROVINCE_CODE: vm.hospitalAddressProvince.PROVINCE_CODE
        };
        lastProvince = vm.hospitalAddressProvince.PROVINCE_CODE;

        if (!SessionStorage.get('loginInfo').organizationKeyId) {
            $rootScope.commonService('getCityListOfCertainProvince', params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.hospitalAddressCitys = data;
                    },
                    function () {
                        vm.hospitalAddressCitys = [];
                        $rootScope.alertDialog('获取市列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取市列表失败');
            });
        } else {
            hospitalDeptService.getCityListOfCertainProvince(params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.hospitalAddressCitys = data;
                    },
                    function () {
                        vm.hospitalAddressCitys = [];
                        $rootScope.alertDialog('获取市列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取市列表失败');
            });
        }
    };

    vm.initCountyListOfCertainCity = function () {
        if (vm.hospitalAddressCity === '-1') {
            vm.hospitalAddressCountys = [];
            return;
        }
        if (lastCity && lastCity === vm.hospitalAddressCity.CITY_CODE) {
            return;
        }
        var params = {
            CITY_CODE: vm.hospitalAddressCity.CITY_CODE
        };
        lastCity = vm.hospitalAddressCity.CITY_CODE;
        if (!SessionStorage.get('loginInfo').organizationKeyId) {
            $rootScope.commonService('getCountyListOfCertainCity', params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.hospitalAddressCountys = data;
                    },
                    function () {
                        vm.hospitalAddressCountys = [];
                        $rootScope.alertDialog('获取区/县列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取区/县列表失败');
            });
        } else {
            hospitalDeptService.getCountyListOfCertainCity(params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.hospitalAddressCountys = data;
                    },
                    function () {
                        vm.organizAddressCountys = [];
                        $rootScope.alertDialog('获取区/县失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取区/县失败');
            });
        }
    };


    vm.initSubdistrictListOfCertainCounty = function () {
        if (vm.hospitalAddressCounty === '-1') {
            vm.hospitalAddressStreets = [];
            return;
        }
        if (lastCounty && lastCounty === vm.hospitalAddressCounty.COUNTY_DISTRICT_CODE) {
            return;
        }
        var params = {
            COUNTY_DISTRICT_CODE: vm.hospitalAddressCounty.COUNTY_DISTRICT_CODE
        };
        lastCounty = vm.hospitalAddressCounty.COUNTY_DISTRICT_CODE;
        if (!SessionStorage.get('loginInfo').organizationKeyId) {
            $rootScope.commonService('getSubdistrictListOfCertainCounty', params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.hospitalAddressStreets = data;
                    },
                    function () {
                        vm.hospitalAddressStreets = [];
                        $rootScope.alertDialog('获取街道列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取街道列表失败');
            });
        } else {
            hospitalDeptService.getSubdistrictListOfCertainCounty(params, function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.hospitalAddressStreets = data;
                    },
                    function () {
                        vm.hospitalAddressStreets = [];
                        $rootScope.alertDialog('获取街道列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取街道列表失败');
            });
        }
    };

    vm.changeAddress = function (index) {
        switch (index) {
            case 1:
                vm.hospitalAddressCity = '-1';
                vm.hospitalAddressCounty = '-1';
                vm.hospitalAddressStreet = '-1';
                break;
            case 2:
                vm.hospitalAddressCounty = '-1';
                vm.hospitalAddressStreet = '-1';
                break;
            case 3:
                vm.hospitalAddressStreet = '-1';
                break;
            default:
                break;

        }
    };

    vm.searchTextChange = function (search) {
        var searchParam = {
            ORGANIZATION_NAME: search
        };
        var result = $q.defer();
        hospitalDeptService.getHospitalNameList(searchParam, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    result.resolve(data);
                },
                function () {
                    result.resolve([]);
                    $rootScope.alertDialog('根据名称搜索医院失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('根据名称搜索医院失败');
        });
        return result.promise;
    };

    vm.tabledataHtml = function () {
        var listPara = {
            "EXPORT_HOSPITAL_DEPT": true,
            "PROVINCE_CODE": !vm.hospitalAddressProvince || vm.hospitalAddressProvince === '-1' ? null : vm.hospitalAddressProvince.PROVINCE_CODE,
            "CITY_CODE": !vm.hospitalAddressCity || vm.hospitalAddressCity === '-1' ? null : vm.hospitalAddressCity.CITY_CODE,
            "COUNTY_DISTRICT_CODE": !vm.hospitalAddressCounty || vm.hospitalAddressCounty === '-1' ? null : vm.hospitalAddressCounty.COUNTY_DISTRICT_CODE,
            "STREET_TOWNSHIP_CODE": !vm.hospitalAddressStreet || vm.hospitalAddressStreet === '-1' ? null : vm.hospitalAddressStreet.STREET_TOWNSHIP_CODE,
            "ORGANIZATION_NAME": vm.searchText ? vm.searchText : null,
            "DEPT_AMOUNT": !vm.deptNumber || vm.deptNumber ? vm.deptNumber : null,
            "HOSPITAL_LEVEL_CODE": !vm.hospitalLevel || vm.hospitalLevel === '-1' ? null : vm.hospitalLevel.DICT_VALUE_CODE,
            "IS_ONLINE": !vm.isEnable || vm.isEnable === '-1' ? null : vm.isEnable
        };
        downLoadParam = listPara;
        hospitalDeptService.getHospitalListHtml(vm, listPara, $state);
    };
    vm.tabledataHtml();

    vm.downLoadFile = function () {
        vm.isDownloading = true;
        hospitalDeptService.downloadHospitalList(downLoadParam, function (response) {
            $rootScope.handleMessage(response, function (data) {
                downloadCommon.downloadFile(data['fileName'], "医院列表信息.xls");
                vm.isDownloading = false;
            }, function () {
                vm.isDownloading = false;
                $rootScope.alertDialog("信息导出失败");
            });
        }, function () {
            vm.isDownloading = false;
            $rootScope.alertDialog("信息导出失败");
        });
    };

    return vm;
}
"use strict";
SMS.SERVICES.service('hospitalDeptService', hospitalDeptService);
hospitalDeptService.$inject = ['HospitalDept', 'bootstrapTable', '$rootScope'];
function hospitalDeptService(HospitalDept, bootstrapTable, $rootScope) {
    var vm = this;

    var firstList = true;//用于第一次表格判断，因为插件原因第一次加载表格会发出两次请求

    vm.getProvinceList = function (param, successFunction, failedFunction) {
        HospitalDept.getProvinceList(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getCityListOfCertainProvince = function (param, successFunction, failedFunction) {
        HospitalDept.getCityListOfCertainProvince(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getCountyListOfCertainCity = function (param, successFunction, failedFunction) {
        HospitalDept.getCountyListOfCertainCity(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getSubdistrictListOfCertainCounty = function (param, successFunction, failedFunction) {
        HospitalDept.getSubdistrictListOfCertainCounty(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getHospitalNameList = function (param, successFunction, failedFunction) {
        HospitalDept.getHospitalNameList(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getHospitalLevelList = function (param, successFunction, failedFunction) {
        HospitalDept.getHospitalLevelList(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getDeptList = function (param, successFunction, failedFunction) {
        HospitalDept.getDeptList(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.downloadDeptList = function (param, successFunction, failedFunction) {
        HospitalDept.downloadDeptList(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.downloadHospitalList = function (param, successFunction, failedFunction) {
        HospitalDept.downloadHospitalList(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.addDept = function (param, successFunction, failedFunction) {
        HospitalDept.addDept(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.updateDept = function (param, successFunction, failedFunction) {
        HospitalDept.updateDept(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getDeptById = function (param, successFunction, failedFunction) {
        HospitalDept.getDeptById(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getHospitalListHtml = function ($vm, listPara, $state) {
        var list = {
            dataFunction: getHospitalList,
            dataParams: listPara,
            columns: [{
                field: 'ORGANIZATION_NAME',
                title: '医院名称',
                align: 'center',
                formatter: function (val) {
                    return "<div  style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click div': function (e, vlaue, row) {
                        $state.go('main.baseData.deptList', {
                            "HOSPITAL_ID": row.HOSPITAL_ID,
                            "HOSPITAL_NAME": row.ORGANIZATION_NAME
                        });
                    }
                }
            }, {
                field: 'HOSPITAL_LEVEL_NAME',
                title: '医院等级',
                align: 'center'
            }, {
                field: 'HOSPITAL_ADDRESS',
                title: '机构地址',
                align: 'center'
            }, {
                field: 'DEPT_AMOUNT',
                title: '科室数量',
                align: 'center'
            }, {
                field: 'IS_ONLINE',
                title: '是否上线',
                align: 'center'
            }]
        };

        function getHospitalList(param, successFunction, failedFunction) {
            HospitalDept.getHospitalList(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function (data) {
                        successFunction(data || {total: 0, rows: []});
                        if (firstList && data.total === 0) {
                            $rootScope.alertDialog("现在还没有建立医院，请去组织机构管理中建立");
                        }
                        firstList = false;
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.hospitalTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };

    vm.getDeptListHtml = function ($vm, listPara, $state) {
        var list = {
            dataFunction: getDeptList,
            dataParams: listPara,
            columns: [{
                field: 'DEPT_NAME',
                title: '科室名称',
                align: 'center',
                formatter: function (val) {
                    return "<div  style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click div': function (e, vlaue, row) {
                        $state.go('main.baseData.deptEdit', {
                            "HOSPITAL_ID": row.HOSPITAL_ID,
                            "HOSPITAL_NAME": row.HOSPITAL_NAME,
                            "DEPT_ID": row.DEPT_ID
                        });
                    }
                }
            }, {
                field: 'HOSPITAL_NAME',
                title: '所属医院',
                align: 'center'
            }, {
                field: 'IS_ONLINE',
                title: '是否上线',
                align: 'center',
                formatter: function (val) {
                    if (val === '1' || val === 1) {
                        return "是";
                    } else {
                        return "否";
                    }
                }
            }]
        };

        function getDeptList(param, successFunction, failedFunction) {
            HospitalDept.getDeptList(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.deptTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('roleAddCtrl', roleAddCtrl);
roleAddCtrl.$inject = ['$rootScope', '$state', 'roleService'];
function roleAddCtrl($rootScope, $state, roleService) {
    var vm = this;
    //控制显示隐藏和判断
    vm.add = true;
    vm.editable = true;
    roleService.getJurisdictionsOfRole(
        {},
        function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.items = data;
                },
                function () {
                    $rootScope.alertDialog("查询角色数据失败");
                }
            );
        },
        function () {
            $rootScope.alertDialog("查询角色数据失败");
        }
    );
    //初始化list和下标list
    roleService.initJurisdictionList();
    vm.toggle = function (item1, itme2, itme3) {
        roleService.toggle(item1, itme2, itme3);
    };
    vm.createNewRole = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }

        if (!vm.isSelectOne(vm.items)) {
            $rootScope.alertDialog("请至少选择一项功能");
            return;
        }
        var params = {
            "ROLE_NAME": vm.ROLE_NAME,
            "JURISDICTION_LIST": roleService.getJurisdictionList()
        };
        roleService.createRole(
            params,
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        $state.go('main.baseData.roleList');
                    },
                    function () {
                        $rootScope.alertDialog('创建角色失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('创建角色失败');
            });
    };

    vm.cancel = function () {
        if (vm.ROLE_NAME || roleService.getJurisdictionList().length > 0) {
            $rootScope.confirmDialog(
                '您确定要放弃保存吗?',
                function () {
                    $state.go('main.baseData.roleList');
                },
                function () {

                }
            );
        } else {
            $state.go('main.baseData.roleList');
        }
    };
    //判断至少选择一个功能
    vm.isSelectOne = function (list) {
        return roleService.isSelectOne(list);
    };
    //判断半选状态
    vm.isIndeterminate = function (item) {
        if (item['SUBLIST'] && item['SUBLIST'].length > 0) {
            var b = false;
            angular.forEach(item['SUBLIST'], function (value) {
                if (value['IS_SELECT'] === "1" || value['IS_SELECT'] === 1) {
                    b = true;
                    return false;
                }
            });
            return b;
        } else {
            return false;
        }
    };
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('roleEditCtrl', roleEditCtrl);
roleEditCtrl.$inject = ['$rootScope', '$state', 'roleService'];
function roleEditCtrl($rootScope, $state, roleService) {
    var vm = this;
    //控制显示隐藏和判断
    vm.edit = true;
    vm.editable = false;
    var OLD_ROLE_NAME;
    var old_items = [];
    //赋值
    vm.ROLE_NAME = $state.params.ROLE_NAME;
    roleService.getJurisdictionsOfRole(
        {
            "ROLE_KEY_ID": $state.params.ROLE_KEY_ID
        },
        function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.items = data;
                },
                function () {
                    $rootScope.alertDialog("查询角色数据失败");
                }
            );
        },
        function () {
            $rootScope.alertDialog("查询角色数据失败");
        }
    );
    //初始化list和下标list
    roleService.initJurisdictionList();
    vm.toggle = function (item1, itme2, itme3) {
        roleService.toggle(item1, itme2, itme3);
    };
    vm.edit = function () {
        OLD_ROLE_NAME = angular.copy(vm.ROLE_NAME);
        old_items = angular.copy(vm.items);
        vm.editable = true;
    };
    //更新角色
    vm.createNewRole = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }

        if (!vm.isSelectOne(vm.items)) {
            $rootScope.alertDialog("请至少选择一项功能");
            return;
        }
        var params = {
            "ROLE_KEY_ID": $state.params.ROLE_KEY_ID,
            "ROLE_NAME": vm.ROLE_NAME,
            "JURISDICTION_LIST": roleService.getJurisdictionList()
        };
        roleService.updateRole(
            params,
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        vm.editable = false;
                        roleService.initJurisdictionList();
                    },
                    function () {
                        $rootScope.alertDialog('更新角色失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('更新角色失败');
            }
        );
    };
    //删除角色
    vm.deleteRole = function () {
        roleService.checkUser(
            {
                "ROLE_KEY_ID": $state.params.ROLE_KEY_ID
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        $rootScope.confirmDialog(
                            '是否确定删除该角色？',
                            function () {
                                roleService.deleteRole(
                                    {
                                        "ROLE_KEY_ID": $state.params.ROLE_KEY_ID
                                    },
                                    function (response) {
                                        $rootScope.handleMessage(
                                            response,
                                            function () {
                                                $state.go('main.baseData.roleList');
                                            },
                                            function (response) {
                                                $rootScope.alertDialog(response.message);
                                            }
                                        );
                                    },
                                    function () {
                                        $rootScope.alertDialog('删除角色失败');
                                    }
                                );
                            },
                            function () {

                            }
                        );
                    },
                    function () {
                        $rootScope.alertDialog('查询用户是否关联角色失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('查询用户是否关联角色失败');
            }
        );
    };
    //取消
    vm.cancel = function () {
        if (OLD_ROLE_NAME !== vm.ROLE_NAME || roleService.getJurisdictionList().length > 0) {
            $rootScope.confirmDialog(
                '您确定要放弃保存吗?',
                function () {
                    resetData();
                    vm.editable = false;
                },
                function () {

                }
            );
        } else {
            vm.editable = false;
        }
        function resetData() {
            vm.ROLE_NAME = OLD_ROLE_NAME;
            vm.items = old_items;
            roleService.initJurisdictionList();
        }
    };
    //返回
    vm.goBack = function () {
        $state.go('main.baseData.roleList');
    };
    //判断至少选择一个功能
    vm.isSelectOne = function (list) {
        return roleService.isSelectOne(list);
    };
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('roleListCtrl', roleListCtrl);
roleListCtrl.$inject = ['$rootScope', '$state', 'roleService', 'downloadCommon'];
function roleListCtrl($rootScope, $state, roleService, downloadCommon) {
    var vm = this;
    vm.isDownloading = false;
    var downLoadParam = null;//信息导出是根据表格展示来的，所以要记录表格展示时的筛选条件
    vm.getRoleList = function () {
        var params = {};
        downLoadParam = params;
        roleService.showTable(vm, params, $state);
    };
    vm.getRoleList();

    vm.downLoadFile = function () {
        vm.isDownloading = true;
        roleService.downloadRoleList(downLoadParam, function (response) {
            $rootScope.handleMessage(response, function (data) {
                downloadCommon.downloadFile(data['fileName'], "系统角色信息.xls");
                vm.isDownloading = false;
            }, function () {
                vm.isDownloading = false;
                $rootScope.alertDialog("信息导出失败");
            });
        }, function () {
            vm.isDownloading = false;
            $rootScope.alertDialog("信息导出失败");
        });
    };
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('userAddCtrl', userAddCtrl);
userAddCtrl.$inject = ['$rootScope', '$state', 'userService'];
function userAddCtrl($rootScope, $state, userService) {
    var vm = this;

    //控制显示隐藏和判断
    vm.add = true;
    vm.editable = true;
    vm.canClearPassword = false;

    userService.getAllAccountRole(
        {
            "IS_LIMIT_AUTHORITY": 0
        },
        function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.items = data;
                },
                function () {
                    $rootScope.alertDialog('获取角色失败');
                }
            );
        },
        function () {
            $rootScope.alertDialog('获取角色失败');
        });
    vm.selected = [];
    vm.exists = function (item, list) {
        return list.indexOf(item) > -1;
    };
    vm.toggle = function (item, list) {
        var idx = list.indexOf(item.ROLE_KEY_ID);
        if (idx > -1) {
            list.splice(idx, 1);
        }
        else {
            list.push(item.ROLE_KEY_ID);
        }
    };

    //用户名查重
    vm.checkUserNameDuplicate = function () {
        userService.checkUserNameDuplicate(
            {
                "USER_KEY_ID": '',
                "USER_NAME": vm.clientName
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        if (data) {
                            $rootScope.alertDialog('用户名重复');
                            vm.clientName = '';
                        }
                    },
                    function () {
                        $rootScope.alertDialog('用户名查重失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('用户名查重失败');
            }
        );
    };

    //密码
    vm.clearPassword = function () {
        if (vm.editable) {
            vm.password = '';
        }
    };

    //邮箱
    vm.email = '';

    //组织机构
    vm.organization = [];
    vm.getOrganizationList = function () {
        userService.getOrganizationList(
            {
                "ORGANIZATION_NAME": vm.searchTerm
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organization = data;
                    },
                    function () {
                        $rootScope.alertDialog('获取机构失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取机构失败');
            }
        );
    };
    vm.searchTerm;
    vm.selectedOrganization = {};
    vm.clearSearchTerm = function () {
        vm.searchTerm = '';
        //关闭的时候判断已有的值是否在list中，在的话选中，不在的话把list赋值给list再选中
        if (vm.selectedOrganization !== undefined) {
            var temp = $rootScope.selectItem(vm.organization, "ORGANIZATION_KEY_ID", vm.selectedOrganization.ORGANIZATION_KEY_ID);
            if (temp !== undefined) {
                vm.selectedOrganization = temp;
            } else {
                vm.organization = [];
                vm.organization.push(temp);
                vm.selectedOrganization = vm.organization[0];
            }
        }
    };
    vm.getSearchTerm = function () {
        if(vm.selectedOrganization !== undefined){
            vm.searchTerm = vm.selectedOrganization.ORGANIZATION_NAME;
            vm.searchTermChange();
        }
    };
    angular.element('input[name="organization"]').on('keydown', function (ev) {
        ev.stopPropagation();
    });
    vm.searchTermChange = function () {
        if (vm.searchTerm !== '' && vm.searchTerm !== undefined) {
            vm.getOrganizationList();
        }
    };

    //是否启用
    vm.selectState = 1;

    //保存
    vm.createNewUser = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }

        var roleList = [];
        angular.forEach(vm.selected, function (item) {
            roleList.push({
                "ROLE_KEY_ID": item
            });
        });
        if (!userService.validJudge(form, roleList, vm.selectedOrganization.ORGANIZATION_KEY_ID, $rootScope.alertDialog)) {
            return;
        }
        var params = {
            "ACCOUNT": vm.clientName,
            "ORGANIZATION_KEY_ID": vm.selectedOrganization.ORGANIZATION_KEY_ID,
            "USER_NAME": vm.clientName,
            "PASSWORD": vm.password,
            "USER_MAILBOX": vm.email,
            "IS_ONLINE": vm.selectState,
            "ROLE_LIST": roleList
        };
        userService.createNewUser(
            params,
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        $state.go('main.baseData.userList');
                    },
                    function () {
                        $rootScope.alertDialog('创建用户失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('创建用户失败');
            }
        );
    };
    //取消
    vm.cancel = function () {
        $rootScope.confirmDialog(
            '确定放弃已填数据?',
            function () {
                $state.go('main.baseData.userList');
            },
            function () {

            }
        );
    };
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('userEditCtrl', userEditCtrl);
userEditCtrl.$inject = ['$rootScope', '$state', '$mdDialog', '$stateParams', 'userService'];
function userEditCtrl($rootScope, $state, $mdDialog, $stateParams, userService) {
    var vm = this;

    //控制显示隐藏和判断
    vm.edit = true;
    vm.editable = false;
    vm.canClearPassword = true;

    vm.edit = function () {
        vm.editable = true;
    };

    vm.USER_KEY_ID = $stateParams.USER_KEY_ID;
    // 获取角色
    userService.getAllAccountRole(
        {
            "IS_LIMIT_AUTHORITY": 0
        },
        function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.items = data;
                    getUserInfoByKeyId();
                },
                function () {
                    $rootScope.alertDialog('获取角色失败');
                }
            );
        },
        function () {
            $rootScope.alertDialog('获取角色失败');
        }
    );

    //获取详细信息
    function getUserInfoByKeyId() {
        userService.getUserInfoByKeyId(
            {
                "USER_KEY_ID": vm.USER_KEY_ID
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.userInfo = data;
                        vm.dealData(vm.userInfo);
                    },
                    function () {
                        $rootScope.alertDialog('获取用户信息失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取用户信息失败');
            }
        );
    }

    //处理数据
    vm.dealData = function (data) {
        //角色处理
        vm.originalUserRoleArr = data.USER_ROLE;
        vm.selected = [];
        angular.forEach(vm.originalUserRoleArr, function (item) {
            vm.selected.push(item.ROLE_KEY_ID);
        });
        //用户名
        vm.clientName = data.ACCOUNT;
        //邮箱
        vm.email = data.USER_MAILBOX;
        //所属机构
        vm.organization = [];
        vm.originalOrganization = {
            "ORGANIZATION_KEY_ID": data.ORGANIZATION_KEY_ID,
            "ORGANIZATION_NAME": data.ORGANIZATION_NAME
        };
        vm.organization = userService.merge(vm.organization, vm.originalOrganization);
        vm.searchTerm = data.ORGANIZATION_NAME;
        vm.selectedOrganization = vm.originalOrganization;
        //是否启用
        vm.selectState = data.IS_ONLINE;
    };

    vm.items = [];
    vm.selected = [];
    vm.originalUserRoleArr = [];
    vm.exists = function (item, list) {
        return list.indexOf(item) > -1;
    };
    vm.toggle = function (item, list) {
        if (!vm.editable) {
            return;
        }
        var idx = list.indexOf(item.ROLE_KEY_ID);
        if (idx > -1) {
            list.splice(idx, 1);
        }
        else {
            list.push(item.ROLE_KEY_ID);
        }
    };

    //用户名
    vm.clientName = '';
    vm.checkUserNameDuplicate = function () {
        if (vm.clientName === vm.userInfo.ACCOUNT) {
            return;
        }
        userService.checkUserNameDuplicate(
            {
                "USER_KEY_ID": vm.USER_KEY_ID,
                "USER_NAME": vm.clientName
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        if (data) {
                            $rootScope.alertDialog('用户名重复');
                            vm.clientName = '';
                        }
                    },
                    function () {
                        $rootScope.alertDialog('用户名查重失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('用户名查重失败');
            }
        );
    };

    //密码
    vm.defaultPassword = '12345678';
    vm.password = vm.defaultPassword;
    vm.clearPassword = function () {
        if (vm.editable && vm.canClearPassword) {
            vm.password = '';
        }
    };

    //邮箱
    vm.email = '';

    //组织机构
    vm.organization = [];
    vm.getOrganizationList = function () {
        userService.getOrganizationList(
            {
                "ORGANIZATION_NAME": vm.searchTerm
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organization = data;
                    },
                    function () {
                        $rootScope.alertDialog('获取机构失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取机构失败');
            }
        );
    };
    vm.selectedOrganization = {};
    vm.clearSearchTerm = function () {
        vm.searchTerm = '';
        //关闭的时候判断已有的值是否在list中，在的话选中，不在的话把list赋值给list再选中
        if (vm.selectedOrganization !== undefined) {
            var temp = $rootScope.selectItem(vm.organization, "ORGANIZATION_KEY_ID", vm.selectedOrganization.ORGANIZATION_KEY_ID);
            if (temp !== undefined) {
                vm.selectedOrganization = temp;
            } else {
                vm.organization = [];
                vm.organization.push(temp);
                vm.selectedOrganization = vm.organization[0];
            }
        }
    };
    vm.getSearchTerm = function () {
        if(vm.selectedOrganization !== undefined){
            vm.searchTerm = vm.selectedOrganization.ORGANIZATION_NAME;
            vm.searchTermChange();
        }
    };
    angular.element('input[name="organization"]').on('keydown', function (ev) {
        ev.stopPropagation();
    });
    vm.searchTermChange = function () {
        if (vm.searchTerm !== '' && vm.searchTerm !== undefined) {
            vm.getOrganizationList();
        }
    };

    //保存
    vm.createNewUser = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }

        var roleList = [];
        angular.forEach(vm.selected, function (item) {
            roleList.push({
                "ROLE_KEY_ID": item
            });
        });
        if (!userService.validJudge(form, roleList, vm.selectedOrganization.ORGANIZATION_KEY_ID, $rootScope.alertDialog)) {
            return;
        }
        var params = {
            "USER_KEY_ID": vm.USER_KEY_ID,
            "ACCOUNT": vm.clientName,
            "ORGANIZATION_KEY_ID": vm.selectedOrganization.ORGANIZATION_KEY_ID,
            "USER_NAME": vm.clientName,
            "USER_MAILBOX": vm.email,
            "IS_ONLINE": vm.selectState,
            "ROLE_LIST": roleList
        };
        if (vm.password !== vm.defaultPassword) {
            params.PASSWORD = vm.password;
        }
        userService.editUser(
            params,
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        vm.editable = false;
                        getUserInfoByKeyId();
                        vm.defaultPassword = '12345678';
                        vm.password = vm.defaultPassword;
                    },
                    function () {
                        $rootScope.alertDialog('保存失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('保存失败');
            }
        );
    };
    //取消
    vm.cancel = function () {
        var confirm = $mdDialog.confirm()
            .title('提示')
            .textContent('是否丢弃已编辑信息？')
            .ok('确定')
            .cancel('取消');
        $mdDialog.show(confirm).then(function () {
            vm.dealData(vm.userInfo);
            vm.password = vm.defaultPassword;
            vm.editable = !vm.editable;
        }, function () {
            return;
        });
    };
    //删除用户
    vm.deleteUser = function () {
        var confirm = $mdDialog.confirm()
            .title('提示')
            .textContent('是否确定删除该用户？')
            .ok('确定')
            .cancel('取消');
        $mdDialog.show(confirm).then(function () {
            userService.deleteUser(
                {
                    "USER_KEY_ID": vm.USER_KEY_ID
                },
                function (response) {
                    $rootScope.handleMessage(
                        response,
                        function () {
                            $state.go('main.baseData.userList');
                        },
                        function () {
                            $rootScope.alertDialog('删除用户失败');
                        }
                    );
                },
                function () {
                    $rootScope.alertDialog('删除用户失败');
                }
            );
        }, function () {
            return;
        });
    };
    //返回
    vm.goBack = function () {
        $state.go('main.baseData.userList');
    };
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('userListCtrl', userListCtrl);
userListCtrl.$inject = ['$rootScope', '$state', 'userService', 'downloadCommon'];
function userListCtrl($rootScope, $state, userService, downloadCommon) {
    var vm = this;
    vm.isDownloading = false;
    vm.roles = [];
    userService.getAllAccountRole(
        {
            "IS_LIMIT_AUTHORITY": 1
        },
        function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.roles = data;
                },
                function () {
                    $rootScope.alertDialog('获取角色失败');
                }
            );
        },
        function () {
            $rootScope.alertDialog('获取角色失败');
        }
    );

    vm.selectedRoles = [];

    //组织机构
    vm.getOrganizationList = function () {
        userService.getOrganizationList(
            {
                "ORGANIZATION_NAME": vm.searchTerm
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.organization = data;
                    },
                    function () {
                        $rootScope.alertDialog('获取机构失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取机构失败');
            }
        );
    };
    vm.searchTerm;
    vm.selectedOrganization = {};
    vm.clearSearchTerm = function () {
        vm.searchTerm = '';
        //关闭的时候判断已有的值是否在list中，在的话选中，不在的话把list赋值给list再选中
        if (vm.selectedOrganization !== undefined && vm.selectedOrganization.ORGANIZATION_KEY_ID !== undefined) {
            var temp = $rootScope.selectItem(vm.organization, "ORGANIZATION_KEY_ID", vm.selectedOrganization.ORGANIZATION_KEY_ID);
            if (temp !== undefined) {
                vm.selectedOrganization = temp;
            } else {
                vm.organization = [];
                vm.organization.push(temp);
                vm.selectedOrganization = vm.organization[0];
            }
        }
    };
    vm.getSearchTerm = function () {
        vm.searchTerm = vm.selectedOrganization ? vm.selectedOrganization.ORGANIZATION_NAME : undefined;
        vm.searchTermChange();
    };
    angular.element('input[name="organization"]').on('keydown', function (ev) {
        ev.stopPropagation();
    });
    vm.searchTermChange = function () {
        if (vm.searchTerm !== '' && vm.searchTerm !== undefined) {
            vm.getOrganizationList();
        }
    };

    //是否启用
    vm.selectState = 1;

    //查询
    vm.account = '';

    vm.getUserList = function () {
        var roleList = [];
        angular.forEach(vm.selectedRoles, function (item) {
            roleList.push({
                "ROLE_KEY_ID": item.ROLE_KEY_ID
            });
        });
        var params = {
            "ORGANIZATION_KEY_ID": vm.selectedOrganization ? vm.selectedOrganization.ORGANIZATION_KEY_ID : '',
            "IS_ONLINE": vm.selectState,
            "ACCOUNT": vm.account,
            "ROLE_KEY_ID_LIST": roleList
        };
        userService.showTable(vm, params, $state);
        vm.downLoadParam = params;
    };

    //创建
    vm.create = function () {
        $state.go('main.baseData.userAdd');
    };

    //导出表格
    vm.downLoadFile = function () {
        vm.isDownloading = true;
        userService.downloadUserList(vm.downLoadParam, function (response) {
            $rootScope.handleMessage(response, function (data) {
                downloadCommon.downloadFile(data['fileName'], "系统用户信息.xls");
                vm.isDownloading = false;
            }, function () {
                vm.isDownloading = false;
                $rootScope.alertDialog("信息导出失败");
            });
        }, function () {
            vm.isDownloading = false;
            $rootScope.alertDialog("信息导出失败");
        });
    };

    vm.getUserList();

    return vm;
}
"use strict";
SMS.SERVICES.service('userService', userService);
userService.$inject = ['$rootScope', '$state', 'User', 'bootstrapTable'];
function userService($rootScope, $state, User, bootstrapTable) {
    var vm = this;
    vm.getAllAccountRole = function (params, successFunction, failedFunction) {
        return User.getAllAccountRole(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.checkUserNameDuplicate = function (params, successFunction, failedFunction) {
        return User.checkUserNameDuplicate(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getOrganizationList = function (params, successFunction, failedFunction) {
        return User.getOrganizationList(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.createNewUser = function (params, successFunction, failedFunction) {
        return User.createNewUser(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getUserList = function (params, successFunction, failedFunction) {
        return User.getUserList(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getUserInfoByKeyId = function (params, successFunction, failedFunction) {
        return User.getUserInfoByKeyId(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.deleteUser = function (params, successFunction, failedFunction) {
        return User.deleteUser(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.editUser = function (params, successFunction, failedFunction) {
        return User.editUser(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.merge = function (arr1, arr2) {
        var arr3 = [], arr4 = [];
        arr3 = arr3.concat(arr1, arr2);
        angular.forEach(arr3, function (value) {
            if (isNotContains(arr4, value) || arr4.length === 0) {
                arr4.push(value);
            }
        });
        function isNotContains(arr4, value) {
            var b = true;
            angular.forEach(arr4, function (item) {
                if (item['ORGANIZATION_KEY_ID'] === value['ORGANIZATION_KEY_ID']
                    || item['ORGANIZATION_NAME'] === value['ORGANIZATION_NAME']) {
                    b = false;
                    return false;
                }
            });
            return b;
        }

        return arr4;
    };

    vm.showTable = function ($vm, params, $state) {
        var list = {
            dataFunction: ajaxRequest,
            dataParams: params,
            columns: [{
                field: 'ACCOUNT',
                title: '用户名',
                align: 'center',
                valign: 'middle',
                width: 248,
                formatter: accountFormat,
                events: {
                    'click .flag': function (e, value, row) {
                        $state.go('main.baseData.userEdit', {"USER_KEY_ID": row.USER_KEY_ID});
                    }
                }
            }, {
                field: 'ORGANIZATION_NAME',
                title: '所属机构',
                width: 298,
                align: 'center',
                valign: 'middle'
            }, {
                field: 'USER_ROLE',
                title: '用户所属角色',
                width: 288,
                align: 'center',
                valign: 'middle',
                formatter: userRoleFormatter
            }, {
                field: 'USER_MAILBOX',
                title: '用户邮箱',
                align: 'center',
                width: 198,
                valign: 'middle'
            }, {
                field: 'IS_ONLINE',
                title: '是否上线',
                width: 168,
                align: 'center',
                valign: 'middle',
                formatter: isOnlineFormatter
            }]
        };
        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };

        function accountFormat(value) {
            return '<div class="flag" style="color: #428bca;">' + value + '</div>';
        }

        function userRoleFormatter(value) {
            var htmlArr = [];
            for (var i = 0; i < value.length; i++) {
                htmlArr.push('<div>' + value[i].ROLE_NAME + '</div>');
            }
            return htmlArr.join('');
        }

        function isOnlineFormatter(value) {
            return value === 1 ? '是' : '否';
        }

        return $vm;
    };

    function ajaxRequest(params, successFunction, failedFunction) {
        User.getUserList(JSON.stringify(params)).$promise
            .then(function (response) {
                $rootScope.handleMessage(response, function () {
                    successFunction(response.value || {total: 0, rows: []});
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                });
            }, function () {
                $rootScope.alertDialog("获取列表信息失败");
                failedFunction();
            });
    }

    vm.isEmptyObject = function (obj) {
        for (var n in obj) {
            return false
        }
        return true;
    };

    vm.validJudge = function (form, roleList, organization_key_id, failedTip) {
        if (roleList.length === 0) {
            failedTip('请选择至少一个账号角色');
            return false;
        }
        if (!vm.isEmptyObject(form.clientName.$error)) {
            if (form.clientName.$error.required) {
                failedTip('用户名不能为空');
            } else {
                failedTip('用户名不符合规则');
            }
            return false;
        }
        if (!vm.isEmptyObject(form.password.$error)) {
            if (form.password.$error.required) {
                failedTip('账号密码不能为空');
            } else {
                failedTip('账号密码不符合规则');
            }
            return false;
        }
        if (!vm.isEmptyObject(form.email.$error)) {
            if (form.email.$error) {
                failedTip('账号邮箱不符合规则');
            }
            return false;
        }
        if (organization_key_id === null || organization_key_id === undefined) {
            failedTip('请选择一个所属机构');
            return false;
        }
        return true;
    };

    vm.downloadUserList = function (params, successFunction, failedFunction) {
        return User.downloadUserList(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('doctorIndividualAddCtrl', doctorIndividualAddCtrl);
doctorIndividualAddCtrl.$inject = ['$rootScope', '$state', 'doctorIndividualService', '$mdDialog'];
function doctorIndividualAddCtrl($rootScope, $state, doctorIndividualService, $mdDialog) {
    var vm = this;

    vm.editable = true;

    //获取一些基本值
    var dict_type_code_list = [
        {
            "DICT_TYPE_CODE": "0009",//性别
            "LIST_NAME": "sexCodeName"
        }, {
            "DICT_TYPE_CODE": "0013",//医生职称
            "LIST_NAME": "titleCodeName"
        }
    ];
    $rootScope.commonService(
        "getDictList",
        {"DICT_TYPE_CODE_LIST": dict_type_code_list},
        function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.dictList = data;
                    eachDictValue(data);
                },
                function () {
                    $rootScope.alertDialog('获取字典列表失败');
                }
            );
        },
        function () {
            $rootScope.alertDialog('获取字典列表失败');
        }
    );
    //单个赋值
    function eachDictValue(data) {
        angular.forEach(dict_type_code_list, function (item) {
            vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
        });
    }

    //checkPhoneNumber
    vm.checkPhoneNumber = function (form) {
        if (!doctorIndividualService.isEmptyObject(form.phone.$error)) {
            return;
        }
        doctorIndividualService.checkPhoneNumber(
            {"DOCTOR_PHONE_NUMBER": vm.phone},
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        if (data) {
                            $rootScope.alertDialog('手机号重复');
                            vm.phone = '';
                        }
                    },
                    function () {
                        $rootScope.alertDialog('手机号查重失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('手机号查重失败');
            }
        );
    };

    //所属医院
    vm.hospital = [];
    var hospitalSelectedTemp = undefined;
    vm.getHospitalList = function () {
        doctorIndividualService.getHospitalList(
            {
                "SEARCH_HOSPITAL": vm.searchHospital
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.hospital = data;
                    },
                    function () {
                        $rootScope.alertDialog('获取医院失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取医院失败');
            }
        );
    };
    vm.searchHospital;
    vm.selectedHospital = {};
    vm.clearSearchHospital = function () {
        vm.searchHospital = '';
        //关闭的时候判断已有的值是否在list中，在的话选中，不在的话把list赋值给list再选中
        if (vm.selectedHospital !== undefined && vm.selectedHospital.HOSPITAL_ID !== undefined) {
            var temp = $rootScope.selectItem(vm.hospital, "HOSPITAL_ID", vm.selectedHospital.HOSPITAL_ID);
            if (temp !== undefined) {
                vm.selectedHospital = temp;
            } else {
                vm.hospital = [];
                vm.hospital.push(temp);
                vm.selectedHospital = vm.hospital[0];
            }
            if (hospitalSelectedTemp !== vm.selectedHospital.HOSPITAL_ID) {
                vm.deptArr = [];
                vm.dept = undefined;
                //去请求科室
                vm.getDeptList();
            }
        }
    };
    vm.getSearchHospital = function () {
        if (vm.selectedHospital === undefined) {
            return;
        }
        vm.searchHospital = vm.selectedHospital.HOSPITAL_NAME;
        vm.searchHospitalChange();
    };
    angular.element('input[name="hospital"]').on('keydown', function (ev) {
        ev.stopPropagation();
    });
    vm.searchHospitalChange = function () {
        if(vm.searchHospital !== '' && vm.searchHospital !== undefined) {
            vm.getHospitalList();
        }
    };

    //所属科室
    vm.deptArr = [];
    vm.getDeptList = function () {
        doctorIndividualService.getDeptList(
            {
                "HOSPITAL_ID": vm.selectedHospital.HOSPITAL_ID
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.deptArr = data;
                    },
                    function () {
                        $rootScope.alertDialog('获取科室失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取科室失败');
            }
        );
    };
    vm.sureDept = function () {
        if (vm.dept !== undefined) {
            var temp = $rootScope.selectItem(vm.deptArr, "DEPT_ID", vm.dept.DEPT_ID);
            if (temp !== undefined) {
                vm.dept = temp;
            } else {
                vm.deptArr = [];
                vm.deptArr.push(temp);
                vm.dept = vm.deptArr[0];
            }
        }
    };

    //button function
    vm.cancel = function () {
        $state.go('main.doctor.doctorIndividualList');
    };
    vm.save = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }
        var data = doctorIndividualService.validJudge(form, vm, 0);
        if (data) {
            doctorIndividualService.createDoctorAndUser(
                data,
                function (response) {
                    $rootScope.handleMessage(
                        response,
                        function () {
                            $state.go('main.doctor.doctorIndividualList');
                        },
                        function () {
                            $rootScope.alertDialog('创建医生失败');
                        }
                    );
                },
                function () {
                    $rootScope.alertDialog('创建医生失败');
                }
            );
        }
    };

    vm.failedTip = function (text) {
        $mdDialog.show(
            $mdDialog.alert()
                .clickOutsideToClose(true)
                .title('提示')
                .textContent(text)
                .ok('确定')
        );
    };

    //密码
    vm.defaultPasswordState = true;
    vm.defaultPassword = '123456';
    vm.password = vm.defaultPassword;
    vm.canClearPassword = true;
    vm.clearPassword = function () {
        if (vm.editable && vm.canClearPassword) {
            vm.password = '';
        }
    };
    vm.showDefaultpasswordButton = true;
    vm.passwordSwitch = function () {
        //ng-click 触发时机比 checkbox 值更改早，所以反着写
        if (vm.defaultPasswordState) {
            vm.password = '';
        } else {
            vm.password = vm.defaultPassword;
        }
    };
    vm.current = 'basic';

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('doctorIndividualEditCtrl', doctorIndividualEditCtrl);
doctorIndividualEditCtrl.$inject = ['$rootScope', '$scope', '$state', '$stateParams', 'doctorIndividualService', '$mdDialog'];
function doctorIndividualEditCtrl($rootScope, $scope, $state, $stateParams, doctorIndividualService, $mdDialog) {
    var vm = this;

    vm.editable = false;
    vm.hasSideNav = true;

    vm.FAMILY_DOCTOR_KEY_ID = $stateParams.FAMILY_DOCTOR_KEY_ID;

    vm.back = function () {
        $state.go('main.doctor.doctorIndividualList');
    };

    vm.edit = function (form) {
        form.$setPristine();
        form.$setUntouched();
        vm.editable = !vm.editable;
        vm.defaultPasswordState = !vm.defaultPasswordState;
    };

    vm.cancel = function (form) {
        if (form.$dirty) {
            $rootScope.confirmDialog(
                '您确定要放弃保存吗?',
                function () {
                    vm.dealData(vm.doctorInfo);
                    vm.editable = !vm.editable;
                    vm.defaultPasswordState = !vm.defaultPasswordState;
                },
                function () {

                }
            );
        } else {
            vm.editable = !vm.editable;
            vm.defaultPasswordState = !vm.defaultPasswordState;
        }
        
    };

    vm.save = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }
        var data = doctorIndividualService.validJudge(form, vm, 1);
        if (data) {
            data.FAMILY_DOCTOR_KEY_ID = vm.FAMILY_DOCTOR_KEY_ID;
            doctorIndividualService.editDoctorInfo(
                data,
                function (response) {
                    $rootScope.handleMessage(
                        response,
                        function () {
                            vm.editable = !vm.editable;
                            vm.defaultPasswordState = !vm.defaultPasswordState;
                            getDoctorInfoById();
                        },
                        function (response) {
                            $rootScope.alertDialog(response['message']);
                        }
                    );
                },
                function () {
                    $rootScope.alertDialog('保存失败');
                }
            );
        }
    };

    vm.failedTip = function (text) {
        $mdDialog.show(
            $mdDialog.alert()
                .clickOutsideToClose(true)
                .title('提示')
                .textContent(text)
                .ok('确定')
        );
    };

    //获取一些基本值
    var dict_type_code_list = [
        {
            "DICT_TYPE_CODE": "0009",//性别
            "LIST_NAME": "sexCodeName"
        }, {
            "DICT_TYPE_CODE": "0013",//医生职称
            "LIST_NAME": "titleCodeName"
        }
    ];
    $rootScope.commonService(
        "getDictList",
        {"DICT_TYPE_CODE_LIST": dict_type_code_list},
        function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.dictList = data;
                    eachDictValue(data);
                    getDoctorInfoById();
                },
                function () {
                    $rootScope.alertDialog('获取字典列表失败');
                }
            );
        },
        function () {
            $rootScope.alertDialog('获取字典列表失败');
        }
    );
    //单个赋值
    function eachDictValue(data) {
        angular.forEach(dict_type_code_list, function (item) {
            vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
        });
    }

    function getDoctorInfoById() {
        doctorIndividualService.getDoctorInfoById(
            {"FAMILY_DOCTOR_KEY_ID": vm.FAMILY_DOCTOR_KEY_ID},
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.doctorInfo = data;
                        vm.dealData(vm.doctorInfo);
                    },
                    function () {
                        $rootScope.alertDialog('获取医生信息失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取医生信息失败');
            }
        );
    }

    vm.dealData = function (data) {
        //手机号
        vm.phone = data.DOCTOR_PHONE_NUMBER;
        //姓名
        vm.name = data.DOCTOR_NAME;
        //性别
        vm.sexIndex = doctorIndividualService.findIndex(vm.sexCodeName, "DICT_VALUE_CODE", data.DOCTOR_SEX_CODE);
        vm.sexItem = vm.sexCodeName[vm.sexIndex];
        //身份证
        vm.idNo = data.DOCTOR_ID_NO;
        //医生职称
        vm.titleIndex = doctorIndividualService.findIndex(vm.titleCodeName, "DICT_VALUE_CODE", data.DOCTOR_TITLE_CODE);
        vm.title = vm.titleCodeName[vm.titleIndex];
        //所属医院
        vm.hospital = [{
            "HOSPITAL_ID": data.HOSPITAL_ID,
            "HOSPITAL_NAME": data.HOSPITAL_NAME
        }];
        vm.selectedHospital = vm.hospital[0];
        //所属科室
        vm.deptArr = [{
            "DEPT_ID": data.DEPT_ID,
            "DEPT_NAME": data.DEPT_NAME
        }];
        vm.dept = vm.deptArr[0];
        //帐号
        vm.account = data.ACCOUNT;
        //密码
        vm.password = vm.defaultPassword;
        //邮箱
        vm.email = data.PERSONAL_MAILBOX;
        //医生擅长
        vm.skill = data.SKILLED_PROJECT;
        //医生简介
        vm.summary = data.DOCTOR_SUMMARY;
        //执业医生资格证编号
        vm.certificateNo = data.DOCTOR_CERTIFICATE_NUMBER;
        //是否上线
        vm.isOnline = data.IS_ONLINE
    };

    //checkPhoneNumber
    vm.checkPhoneNumber = function (form) {
        if (!doctorIndividualService.isEmptyObject(form.phone.$error) || vm.phone === vm.doctorInfo.DOCTOR_PHONE_NUMBER) {
            return;
        }
        doctorIndividualService.checkPhoneNumber(
            {"DOCTOR_PHONE_NUMBER": vm.phone},
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        if (data) {
                            $rootScope.alertDialog('手机号重复');
                            vm.phone = '';
                        }
                    },
                    function () {
                        $rootScope.alertDialog('手机号查重失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('手机号查重失败');
            }
        );
    };

    //所属医院
    vm.hospital = [];
    var hospitalSelectedTemp = undefined;
    vm.getHospitalList = function () {
        doctorIndividualService.getHospitalList(
            {
                "SEARCH_HOSPITAL": vm.searchHospital
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.hospital = data;
                    },
                    function () {
                        $rootScope.alertDialog('获取医院失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取医院失败');
            }
        );
    };
    vm.searchHospital;
    vm.selectedHospital = {};
    vm.clearSearchHospital = function () {
        vm.searchHospital = '';
        //关闭的时候判断已有的值是否在list中，在的话选中，不在的话把list赋值给list再选中
        if (vm.selectedHospital !== undefined && vm.selectedHospital.HOSPITAL_ID !== undefined) {
            var temp = $rootScope.selectItem(vm.hospital, "HOSPITAL_ID", vm.selectedHospital.HOSPITAL_ID);
            if (temp !== undefined) {
                vm.selectedHospital = temp;
            } else {
                vm.hospital = [];
                vm.hospital.push(temp);
                vm.selectedHospital = vm.hospital[0];
            }
            if (hospitalSelectedTemp !== vm.selectedHospital.HOSPITAL_ID) {
                vm.deptArr = [];
                vm.dept = undefined;
                //去请求科室
                vm.getDeptList();
            }
        }
    };
    vm.getSearchHospital = function () {
        if (vm.selectedHospital === undefined) {
            return;
        }
        hospitalSelectedTemp = vm.selectedHospital.HOSPITAL_ID;
        vm.searchHospital = vm.selectedHospital.HOSPITAL_NAME;
        vm.searchHospitalChange();
    };
    angular.element('input[name="hospital"]').on('keydown', function (ev) {
        ev.stopPropagation();
    });
    vm.searchHospitalChange = function () {
        if(vm.searchHospital !== '' && vm.searchHospital !== undefined) {
            vm.getHospitalList();
        }
    };

    //所属科室
    vm.deptArr = [];
    vm.getDeptList = function () {
        doctorIndividualService.getDeptList(
            {
                "HOSPITAL_ID": vm.selectedHospital.HOSPITAL_ID
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.deptArr = data;
                    },
                    function () {
                        $rootScope.alertDialog('获取科室失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取科室失败');
            }
        );
    };
    vm.sureDept = function () {
        if (vm.dept !== undefined) {
            var temp = $rootScope.selectItem(vm.deptArr, "DEPT_ID", vm.dept.DEPT_ID);
            if (temp !== undefined) {
                vm.dept = temp;
            } else {
                vm.deptArr = [];
                vm.deptArr.push(temp);
                vm.dept = vm.deptArr[0];
            }
        }
    };

    //密码
    vm.defaultPasswordState = true;
    vm.canClearPassword = true;
    vm.defaultPassword = '123456';
    vm.password = vm.defaultPassword;
    vm.clearPassword = function () {
        if (vm.editable && vm.canClearPassword) {
            vm.password = '';
        }
    };
    vm.showDefaultpasswordButton = false;

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('doctorIndividualListCtrl', doctorIndividualListCtrl);
doctorIndividualListCtrl.$inject = ['$rootScope', '$state', 'doctorIndividualService', 'downloadCommon', '$mdDialog'];
function doctorIndividualListCtrl($rootScope, $state, doctorIndividualService, downloadCommon, $mdDialog) {
    var vm = this;
    vm.isDownloading = false;
    doctorIndividualService.getDoctorTitle(
        {},
        function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.titleCodeName = data;
                },
                function () {
                    $rootScope.alertDialog('获取职称失败');
                }
            );
        },
        function () {
            $rootScope.alertDialog('获取职称失败');
        }
    );

    //所属医院
    vm.hospital = [];
    vm.getHospitalList = function () {
        doctorIndividualService.getHospitalList(
            {
                "SEARCH_HOSPITAL": vm.searchHospital
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.hospital = data;
                    },
                    function () {
                        $rootScope.alertDialog('获取医院失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取医院失败');
            }
        );
    };
    vm.searchHospital;
    vm.selectedHospital = {};
    vm.clearSearchHospital = function () {
        vm.searchHospital = '';
        //关闭的时候判断已有的值是否在list中，在的话选中，不在的话把list赋值给list再选中
        if (vm.selectedHospital !== undefined) {
            var temp = $rootScope.selectItem(vm.hospital, "HOSPITAL_ID", vm.selectedHospital.HOSPITAL_ID);
            if (temp !== undefined) {
                vm.selectedHospital = temp;
            } else {
                vm.hospital = [];
                vm.hospital.push(temp);
                vm.selectedHospital = vm.hospital[0];
            }
        }
    };
    vm.getSearchHospital = function () {
        if (vm.selectedHospital === undefined) {
            return;
        }
        vm.searchHospital = vm.selectedHospital.HOSPITAL_NAME;
        vm.searchHospitalChange();
    };
    angular.element('input[name="hospital"]').on('keydown', function (ev) {
        ev.stopPropagation();
    });
    vm.searchHospitalChange = function () {
        if(vm.searchHospital !== '' && vm.searchHospital !== undefined) {
            vm.getHospitalList();
        }
    };
    
    vm.searchDoctorList = function (form) {
        var data = doctorIndividualService.filterValidJudge(form, vm);
        if (data) {
            doctorIndividualService.showTable(vm, data, $state);
            vm.downLoadParam = data;
        }
    };

    vm.create = function () {
        $state.go('main.doctor.doctorIndividualAdd');
    };

    vm.failedTip = function (text) {
        $mdDialog.show(
            $mdDialog.alert()
                .clickOutsideToClose(true)
                .title('提示')
                .textContent(text)
                .ok('确定')
        );
    };

    //导出excel
    vm.downLoadFile = function () {
        vm.isDownloading = true;
        doctorIndividualService.downloadDoctorList(vm.downLoadParam, function (response) {
            $rootScope.handleMessage(response, function (data) {
                downloadCommon.downloadFile(data['fileName'], '家庭医生信息.xls');
                vm.isDownloading = false;
            }, function () {
                vm.isDownloading = false;
                $rootScope.alertDialog("信息导出失败");
            });
        }, function () {
            vm.isDownloading = false;
            $rootScope.alertDialog("信息导出失败");
        });
    };

    //表格
    vm.searchDoctorList();

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('doctorIndividualSidebarCtrl', doctorIndividualSidebarCtrl);
doctorIndividualSidebarCtrl.$inject = ['$rootScope', '$state'];
function doctorIndividualSidebarCtrl($rootScope, $state) {
    var vm = this;

    vm.DOCTOR_NAME = $state.params.DOCTOR_NAME;
    vm.FAMILY_DOCTOR_KEY_ID = $state.params.FAMILY_DOCTOR_KEY_ID;
    
    $rootScope.$on('url-change', function(){
        vm.judgePage();
    });
    vm.judgePage=function(){
        if($rootScope.isContains($state.current.name,'signedFamilyList')){
            vm.currentPage='sign';
        } else if($rootScope.isContains($state.current.name,'signRecord')){
            vm.currentPage='record';
        }else{
            vm.currentPage='basic';
        }
    };
    vm.judgePage();//根据当前路径判断是哪一个页面
    vm.gotoBasicInfo = function () {
        vm.currentPage='basic';
        $state.go('main.doctor.doctorIndividualSidebar.detail.doctorIndividualEdit', {"FAMILY_DOCTOR_KEY_ID": vm.FAMILY_DOCTOR_KEY_ID});
    };

    vm.signedFamilyList = function () {
        vm.currentPage='sign';
        $state.go('main.doctor.doctorIndividualSidebar.detail.signedFamilyList', {"FAMILY_DOCTOR_KEY_ID": vm.FAMILY_DOCTOR_KEY_ID});
    };
    
    vm.signRecord = function () {
        vm.currentPage='record';
        $state.go('main.doctor.doctorIndividualSidebar.detail.signRecord', {"FAMILY_DOCTOR_KEY_ID": vm.FAMILY_DOCTOR_KEY_ID});
    };
    
    return vm;
}
"use strict";
SMS.SERVICES.service('doctorIndividualService', doctorIndividualService);
doctorIndividualService.$inject = ['Doctor', 'FamilyArchives', 'bootstrapTable', '$rootScope', '$filter'];
function doctorIndividualService(Doctor, FamilyArchives, bootstrapTable, $rootScope, $filter) {
    var vm = this;

    vm.idNoValid = function (code) {
        var city = {11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "};
        var tip = "";
        var pass = true;
        if (!code || !/^[1-9]\d{5}((1[89]|20)\d{2})(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])\d{3}[\dx]$/i.test(code)) {
            tip = "身份证号格式错误";
            pass = false;
        } else if (!city[code.substr(0, 2)]) {
            tip = "身份证号格式错误:地址编码错误";
            pass = false;
        } else {
            //18位身份证需要验证最后一位校验位
            if (code.length === 18) {
                code = code.split('');
                //∑(ai×Wi)(mod 11)
                //加权因子
                var factor = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2, 1];
                //校验位
                var parity = ['1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2'];
                var sum = 0;
                var ai = 0;
                var wi = 0;
                for (var i = 0; i < 17; i++) {
                    ai = code[i];
                    wi = factor[i];
                    sum += ai * wi;
                }
                var last = parity[sum % 11];
                if (last !== code[17].toUpperCase()) {
                    tip = "身份证号格式错误:校验位错误";
                    pass = false;
                }
            }
        }
        if (!pass)
            return tip;
        return pass;
    };

    vm.checkPhoneNumber = function (params, successFunction, failedFunction) {
        return Doctor.checkPhoneNumber(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getSexType = function (params, successFunction, failedFunction) {
        return Doctor.getSexType(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getDoctorTitle = function (params, successFunction, failedFunction) {
        return Doctor.getDoctorTitle(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getOrganizationList = function (params, successFunction, failedFunction) {
        return Doctor.getOrganizationList(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getHospitalList = function (params, successFunction, failedFunction) {
        return Doctor.getHospitalList(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getDeptList = function (params, successFunction, failedFunction) {
        return Doctor.getDeptList(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.createDoctorAndUser = function (params, successFunction, failedFunction) {
        return Doctor.createDoctorAndUser(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.isEmptyObject = function (obj) {
        for (var n in obj) {
            return false
        }
        return true;
    };

    vm.validJudge = function (form, $vm, modal) {
        var data = {};
        //手机号
        if (!vm.isEmptyObject(form.phone.$error)) {
            if (form.phone.$error.required) {
                $vm.failedTip('手机号不能为空');
            } else {
                $vm.failedTip('手机号不符合规则');
            }
            return false;
        }
        data.DOCTOR_PHONE_NUMBER = $vm.phone;
        //姓名
        if (!vm.isEmptyObject(form.name.$error)) {
            if (form.name.$error.required) {
                $vm.failedTip('姓名必填');
            }
            return false;
        }
        data.DOCTOR_NAME = $vm.name;
        //性别
        if ($vm.sexItem === undefined) {
            $vm.failedTip('性别必填');
            return false;
        }
        data.DOCTOR_SEX_CODE = $vm.sexItem.DICT_VALUE_CODE;
        data.DOCTOR_SEX_NAME = $vm.sexItem.DICT_VALUE_NAME;
        //身份证
        if (!vm.isEmptyObject(form.idNo.$error)) {
            $vm.failedTip('填入的身份证号不符合规则');
            return false;
        }
        data.DOCTOR_ID_NO = $vm.idNo || '';
        //医生职称
        if ($vm.title === undefined) {
            $vm.failedTip('医生职称必选');
            return false;
        }
        data.DOCTOR_TITLE_CODE = $vm.title.DICT_VALUE_CODE;
        data.DOCTOR_TITLE_NAME = $vm.title.DICT_VALUE_NAME;
        //所属医院
        if ($vm.selectedHospital.HOSPITAL_ID === undefined) {
            $vm.failedTip('所属医院必选');
            return false;
        }
        data.HOSPITAL_ID = $vm.selectedHospital.HOSPITAL_ID;
        data.HOSPITAL_NAME = $vm.selectedHospital.HOSPITAL_NAME;
        //所属科室
        if ($vm.dept === undefined) {
            $vm.failedTip('所属科室必选');
            return false;
        }
        data.DEPT_NAME = $vm.dept.DEPT_NAME;
        data.DEPT_ID = $vm.dept.DEPT_ID;
        //密码
        if (!vm.isEmptyObject(form.password.$error)) {
            if (form.password.$error.required) {
                $vm.failedTip('密码必填');
            }
            if (form.password.$error.pattern) {
                $vm.failedTip('密码不符合规则');
            }
            return false;
        }
        if (modal === 1) {
            if ($vm.password !== '123456') {
                data.PASSWORD = $vm.password;
            }
        } else {
            data.PASSWORD = $vm.password;
        }
        //邮箱
        if (!vm.isEmptyObject(form.email.$error)) {
            $vm.failedTip('输入的邮箱不符合规则');
            return false;
        }
        data.PERSONAL_MAILBOX = $vm.email || '';
        //医生擅长
        if (!vm.isEmptyObject(form.skill.$error)) {
            $vm.failedTip('医生擅长字数超出');
            return false;
        }
        data.SKILLED_PROJECT = $vm.skill || '';
        //医生简介
        if (!vm.isEmptyObject(form.summary.$error)) {
            $vm.failedTip('医生简介字数超出');
            return false;
        }
        data.DOCTOR_SUMMARY = $vm.summary || '';
        //执业医师资格证编号
        data.DOCTOR_CERTIFICATE_NUMBER = $vm.certificateNo;
        //是否上线
        if ($vm.isOnline === undefined) {
            $vm.failedTip('是否上线必选');
            return false;
        }
        data.IS_ONLINE = $vm.isOnline;

        return data;
    };

    vm.filterValidJudge = function (form, $vm) {
        var data = {};

        //医生职称
        if ($vm.titleCode === undefined || $vm.titleCode === -1) {
            data.DOCTOR_TITLE_NAME = '';
        } else {
            data.DOCTOR_TITLE_NAME = $vm.titleCode;
        }
        //是否上线
        if ($vm.isOnline === undefined || $vm.isOnline === -1) {
            data.IS_ONLINE = '';
        } else {
            data.IS_ONLINE = $vm.isOnline;
        }
        //所属医院
        if ($vm.selectedHospital === undefined || $vm.selectedHospital.HOSPITAL_ID === undefined) {
            data.HOSPITAL_ID = '';
        } else {
            data.HOSPITAL_ID = $vm.selectedHospital.HOSPITAL_ID;
        }
        //姓名
        data.DOCTOR_NAME = $vm.name || '';
        //手机号
        if (form && !vm.isEmptyObject(form.phone.$error)) {
            if (form.phone.$error.pattern) {
                $vm.failedTip('手机号不符合规则');
            }
            return false;
        }
        data.DOCTOR_PHONE_NUMBER = $vm.phone || '';

        return data;
    };

    function ajaxRequest(params, successFunction, failedFunction) {
        Doctor.searchDoctorList(JSON.stringify(params)).$promise
            .then(function (response) {
                $rootScope.handleMessage(response, function () {
                    successFunction(response.value || {total: 0, rows: []});
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                });
            }, function () {
                $rootScope.alertDialog("获取列表信息失败");
                failedFunction();
            });
    }

    vm.showTable = function ($vm, params, $state) {
        var list = {
            dataFunction: ajaxRequest,
            dataParams: params,
            columns: [{
                field: 'DOCTOR_NAME',
                title: '医生姓名',
                align: 'center',
                valign: 'middle',
                width: 168,
                formatter: nameFormat,
                events: {
                    'click .flag': function (e, value, row) {
                        $state.go('main.doctor.doctorIndividualSidebar.detail.doctorIndividualEdit', {DOCTOR_NAME: row.DOCTOR_NAME, FAMILY_DOCTOR_KEY_ID: row.FAMILY_DOCTOR_KEY_ID});
                    }
                }
            }, {
                field: 'DOCTOR_SEX_NAME',
                title: '性别',
                width: 148,
                align: 'center',
                valign: 'middle'
            }, {
                field: 'DOCTOR_PHONE_NUMBER',
                title: '手机号',
                align: 'center',
                width: 168,
                valign: 'middle'
            }, {
                field: 'DEPT_NAME',
                title: '所属科室',
                align: 'center',
                width: 168,
                valign: 'middle'
            }, {
                field: 'DOCTOR_TITLE_NAME',
                title: '职称',
                align: 'center',
                width: 168,
                valign: 'middle'
            }, {
                field: 'HOSPITAL_NAME',
                title: '所属医院',
                align: 'center',
                width: 232,
                valign: 'middle'

            }, {
                field: 'IS_ONLINE',
                title: '是否上线',
                width: 148,
                align: 'center',
                valign: 'middle',
                formatter: isOnlineFormatter
            }]
        };
        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };

        function nameFormat(value) {
            return '<div class="flag" style="color: #428bca">' + value + '</div>';
        }

        function isOnlineFormatter(value) {
            return value === 1 ? '是' : '否';
        }

        return $vm;
    };

    vm.getDoctorInfoById = function (params, successFunction, failedFunction) {
        return Doctor.getDoctorInfoById(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.findIndex = function (list, key, value) {
        for (var i = 0; i < list.length; i++) {
            if (value == list[i][key]) {
                return i;
            }
        }
        return 0;
    };

    vm.editDoctorInfo = function (params, successFunction, failedFunction) {
        return Doctor.editDoctorInfo(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.downloadDoctorList = function (params, successFunction, failedFunction) {
        return Doctor.downloadDoctorList(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.showSingingHomeTable = function ($vm, params, $state) {
        function ajaxSigningHomeRequest(params, successFunction, failedFunction) {
            Doctor.searchSigningHomeList(JSON.stringify(params)).$promise
                .then(function (response) {
                    $rootScope.handleMessage(response, function () {
                        successFunction(response.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        var list = {
            dataFunction: ajaxSigningHomeRequest,
            dataParams: params,
            columns: [{
                field: 'checkbox',
                title: '',
                align: 'center',
                valign: 'middle',
                checkbox : true
            }, {
                field: 'HOUSEHOLDER_NAME',
                title: '户主姓名',
                align: 'center',
                valign: 'middle',
                formatter: nameFormat,
                events: {
                    'click .flag': function (e, value, row) {

                        $state.go('main.resident.familyArchivesSidebar.detail.familyArchivesEdit', {"FAMILY_KEY_ID": row.FAMILY_KEY_ID});
                    }
                }
            }, {
                field: 'HOUSEHOLDER_PHONE_NO',
                title: '户主联系电话',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'HOUSEHOLDER_ID_NO',
                title: '户主身份证号',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'HOUSE_ADDRESS',
                title: '家庭住址',
                align: 'center',
                valign: 'middle'
            }]
        };
        $vm.signingHomeTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };

        function nameFormat(value) {
            if(!$rootScope.isShow('1003002002')){
                return '<div  style="color: #428bca">' + value + '</div>';
            }
            return '<div class="flag" style="color: #428bca">' + value + '</div>';
        }

        return $vm;
    };


    vm.showUnsingingHomeTable = function ($vm, params) {
        function ajaxRequest(params, successFunction, failedFunction) {
            Doctor.searchUnsigningHomeList(JSON.stringify(params)).$promise
                .then(function (response) {
                    $rootScope.handleMessage(response, function () {
                        $vm.total = response.value ? response.value.total : 0;
                        successFunction(response.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        var list = {
            dataFunction: ajaxRequest,
            dataParams: params,
            columns: [{
                field: 'IS_SIGNED',
                title: '操作',
                align: 'center',
                valign: 'middle',
                formatter: function (value, row) {
                    return [
                        '<md-button class="md-raised md-button" style="margin: 0" ',
                        value && (row.FAMILY_DOCTOR_KEY_ID+"" === $vm.FAMILY_DOCTOR_KEY_ID+"") ? 'disabled title="该家庭的签约医生已经是该医生"' : '',
                        '>',
                        (value) ? '更换签约' : '签约',
                        '</md-button>'
                    ].join('');
                },
                events: {
                    'click .md-raised': function (e, value, row) {
                        if (value && (row.FAMILY_DOCTOR_KEY_ID+"" === $vm.FAMILY_DOCTOR_KEY_ID+"")) {
                            return;
                        } else {
                            $vm.signEnsureShow(row);
                        }
                    }
                }
            }, {
                field: 'IS_SIGNED',
                title: '签约状态',
                align: 'center',
                valign: 'middle',
                formatter: function (value) {
                    return (value) ? "已签约" : "未签约";
                }
            }, {
                field: 'DOCTOR_NAME',
                title: '签约医生',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'HOUSEHOLDER_NAME',
                title: '户主姓名',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'HOUSEHOLDER_PHONE_NO',
                title: '户主手机',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'HOUSEHOLDER_ID_NO',
                title: '户主身份证号',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'HOUSE_ADDRESS',
                title: '家庭住址',
                align: 'center',
                valign: 'middle'
            }],
            pagination: false
        };
        $vm.unsigningHomeTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
        return $vm;
    };

    vm.showHomeMemberTable = function ($vm, params) {
        function ajaxRequest(params, successFunction, failedFunction) {
            Doctor.getFamilyMemberById(JSON.stringify(params)).$promise
                .then(function (response) {
                    $rootScope.handleMessage(response, function () {
                        successFunction(response.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        var list = {
            dataFunction: ajaxRequest,
            dataParams: params,
            columns: [{
                field: 'RESIDENT_NAME',
                title: '居民姓名',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'RESIDENT_SEX_NAME',
                title: '性别',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'BIRTHDAY',
                title: '年龄',
                align: 'center',
                valign: 'middle',
                formatter: function (value) {
                    return $filter('age')(value);
                }
            }, {
                field: 'HOUSEHOLDER_RELATIONSHIP_NAME',
                title: '与户主关系',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'RESIDENT_PHONE_NO',
                title: '联系电话',
                align: 'center',
                valign: 'middle'
            }],
            pagination: false
        };
        $vm.familyMemberTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
        return $vm;
    };

    vm.ensureSign = function (params, successFunction, failedFunction) {
        return Doctor.ensureSign(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    vm.changeSign = function (params, successFunction, failedFunction) {
        return Doctor.changeSign(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getDoctorList = function ($vm, listPara, callback) {
        var list = {
            dataFunction: getDoctorList,
            dataParams: listPara,
            columns: [{
                field: 'DOCTOR_NAME',
                title: '姓名',
                align: 'center',
                formatter: function (val) {
                    return "<div id='doctorId'  style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click #doctorId': function (e, vlaue, row) {
                        callback(row);
                    }
                }
            }, {
                field: 'DOCTOR_TITLE_NAME',
                title: '职称',
                align: 'center'
            }, {
                field: 'SKILLED_PROJECT',
                title: '擅长',
                align: 'center'
            }, {
                field: 'DOCTOR_PHONE_NUMBER',
                title: '联系电话',
                align: 'center'
            }]
        };

        function getDoctorList(param, successFunction, failedFunction) {
            FamilyArchives.searchSignDoctor(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };

    vm.getselectedDoctorList = function ($vm, listPara, data) {
        var list = {
            dataFunction: getselectedDoctorList,
            dataParams: listPara,
            pagination: false,
            columns: [{
                field: 'DOCTOR_NAME',
                title: '姓名',
                align: 'center'
            }, {
                field: 'DOCTOR_TITLE_NAME',
                title: '职称',
                align: 'center'
            }, {
                field: 'SKILLED_PROJECT',
                title: '擅长',
                align: 'center'
            }, {
                field: 'DOCTOR_PHONE_NUMBER',
                title: '联系电话',
                align: 'center'
            }]
        };

        function getselectedDoctorList(param, successFunction) {
            successFunction(data);
        }

        $vm.selectedTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
        $vm.selectedTableData.bsTableControl.operat = 'refresh';
    };
    
    vm.updateFamilyDoctorBatch = function (params, successFunction, failedFunction) {
        return Doctor.updateFamilyDoctorBatch(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.terminateBatch = function (params, successFunction, failedFunction) {
        return Doctor.terminateBatch(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('doctorTeamAddCtrl', doctorTeamAddCtrl);
doctorTeamAddCtrl.$inject = ['$rootScope', '$state', 'doctorTeamService'];
function doctorTeamAddCtrl($rootScope, $state, doctorTeamService) {
    var vm = this;
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('doctorTeamEditCtrl', doctorTeamEditCtrl);
doctorTeamEditCtrl.$inject = ['$rootScope', '$state', 'doctorTeamService'];
function doctorTeamEditCtrl($rootScope, $state, doctorTeamService) {
    var vm = this;
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('doctorTeamListCtrl', doctorTeamListCtrl);
doctorTeamListCtrl.$inject = ['$rootScope', '$state', 'doctorTeamService'];
function doctorTeamListCtrl($rootScope, $state, doctorTeamService) {
    var vm = this;
    return vm;
}
"use strict";
SMS.SERVICES.service('doctorTeamService', doctorTeamService);
doctorTeamService.$inject = [];
function doctorTeamService() {
    var vm = this;
    return vm;
}
"use strict";
SMS.SERVICES.service('roleService', roleService);
roleService.$inject = ['$rootScope', 'Role', 'bootstrapTable'];
function roleService($rootScope, Role, bootstrapTable) {
    var vm = this;
    vm.downloadRoleList = function (params, successFunction, failedFunction) {
        return Role.downloadRoleList(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    vm.getJurisdictionsOfRole = function (params, successFunction, failedFunction) {
        return Role.getJurisdictionsOfRole(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    vm.createRole = function (params, successFunction, failedFunction) {
        return Role.createRole(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    vm.updateRole = function (params, successFunction, failedFunction) {
        return Role.updateRole(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    vm.deleteRole = function (params, successFunction, failedFunction) {
        return Role.deleteRole(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    vm.checkUser = function (params, successFunction, failedFunction) {
        return Role.checkUser(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    //用户缓存记录
    vm.JURISDICTION_LIST = [];
    vm.JURISDICTION_LIST_INDEX = [];
    vm.initJurisdictionList = function () {
        vm.JURISDICTION_LIST = [];
        vm.JURISDICTION_LIST_INDEX = [];
    };
    vm.getJurisdictionList = function () {
        return vm.JURISDICTION_LIST;
    };
    //绑定按钮点击
    vm.toggle = function (item, item2, item3) {
        if (item['IS_SELECT'] === "1"
            || item['IS_SELECT'] === 1) {
            item['IS_SELECT'] = '0';
            //从1到0的查询子元素
            vm.joinList(item);
            vm.cancelSubList(item);
        } else if (item['IS_SELECT'] === "0"
            || item['IS_SELECT'] === 0
            || item['IS_SELECT'] === undefined) {
            item['IS_SELECT'] = '1';
            //从0到1的查询父元素
            vm.joinList(item);
            if (item2 && (item2['IS_SELECT'] === "0"
                || item2['IS_SELECT'] === 0
                || item2['IS_SELECT'] === undefined)) {
                item2['IS_SELECT'] = '1';
                vm.joinList(item2);
                if (item3 && (item3['IS_SELECT'] === "0"
                    || item3['IS_SELECT'] === 0
                    || item3['IS_SELECT'] === undefined)) {
                    item3['IS_SELECT'] = '1';
                    vm.joinList(item3);
                }
            }
        }
    };
    //取消子元素选中状态
    vm.cancelSubList = function (item) {
        if (item['SUBLIST'] && item['SUBLIST'].length > 0) {
            angular.forEach(item['SUBLIST'], function (value) {
                if (value['IS_SELECT'] === "1"
                    || value['IS_SELECT'] === 1) {
                    value['IS_SELECT'] = '0';
                    vm.joinList(value);
                    vm.cancelSubList(value);
                }
            });
        }
    };
    //插入和更新用户点击过的数据
    vm.joinList = function (item) {
        //查询存在不存在
        var INDEX = vm.JURISDICTION_LIST_INDEX.indexOf(item["JURISDICTION_KEY_ID"]);
        //不存在就插入，存在就更新
        if (INDEX === -1) {
            vm.JURISDICTION_LIST_INDEX.push(item["JURISDICTION_KEY_ID"]);
            vm.JURISDICTION_LIST.push({
                "VALUE": item["JURISDICTION_KEY_ID"],
                "IS_SELECT": item["IS_SELECT"]
            });
        } else {
            vm.JURISDICTION_LIST[INDEX]['IS_SELECT'] = item['IS_SELECT'];
        }
    };
    //判断至少选择一个功能
    vm.isSelectOne = function (list) {
        var b = false;
        angular.forEach(list, function (item) {
            if (item['IS_SELECT'] === "1" || item['IS_SELECT'] === 1) {
                //查询是否有子节点
                if (item['SUBLIST'] && item['SUBLIST'].length > 0) {//若有检查子列表
                    //如果子列表为true
                    if (vm.isSelectOne(item['SUBLIST'])) {
                        b = true;
                        return false;
                    }
                } else {//若没有则返回 true
                    b = true;
                    return false;
                }
            }
        });
        return b;
    };
    function ajaxRequest(params, successFunction, failedFunction) {
        Role.getRoleList(JSON.stringify(params)).$promise
            .then(function (response) {
                $rootScope.handleMessage(response, function () {
                    successFunction(response.value || {total: 0, rows: []});
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                });
            }, function () {
                $rootScope.alertDialog("获取列表信息失败");
                failedFunction();
            });
    }

    vm.showTable = function ($vm, params, $state) {
        var list = {
            dataFunction: ajaxRequest,
            dataParams: params,
            columns: [{
                field: 'ROLE_NAME',
                title: '角色名称',
                align: 'center',
                width: 298,
                valign: 'middle',
                formatter: roleFormat,
                events: {
                    'click .flag': function (e, value, row) {
                        $state.go('main.baseData.roleEdit',
                            {
                                "ROLE_KEY_ID": row.ROLE_KEY_ID,
                                "ROLE_NAME": row.ROLE_NAME
                            });
                    }
                }
            }, {
                field: 'JURISDICTION_NAME',
                title: '拥有功能权限',
                align: 'center',
                width: 902,
                valign: 'middle'
            }]
        };

        function roleFormat(value) {
            return '<div class="flag" style="color: #428bca;cursor:pointer;">' + value + '</div>';
        }

        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
        return $vm;
    };
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('fieldsListCtrl', fieldsListCtrl);
fieldsListCtrl.$inject = ['$rootScope', '$state', 'fieldsService'];
function fieldsListCtrl($rootScope, $state, fieldsService) {
    var vm = this;

    function definedData() {
        vm['fieldTypeCode'] = '-1';
        vm['suitableCrowdCode'] = '-1';
    }

    var dict_type_code_list = [
        {
            "DICT_TYPE_CODE": "0022",//字段类型
            "LIST_NAME": "fieldTypeCodeList"
        },
        {
            "DICT_TYPE_CODE": "0020",//适用人群
            "LIST_NAME": "suitableCrowdCodeList"
        }
    ];
    definedData();
    getDictList();


    function getDictList() {
        $rootScope.commonService(
            'getDictList',
            {
                "DICT_TYPE_CODE_LIST": dict_type_code_list
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        eachDictValue(data);
                    },
                    function () {
                        $rootScope.alertDialog('获取字典列表失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取字典列表失败');
            }
        );
    }


    function eachDictValue(data) {
        angular.forEach(dict_type_code_list, function (item) {
            vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
        });
    }

    vm.initTableData = function () {
        var params = {
            "FIELD_TYPE_CODE": vm['fieldTypeCode'] === '-1' ? null : vm['fieldTypeCode']['DICT_VALUE_CODE'],
            "SUITABLE_CROWD_CODE": vm['suitableCrowdCode'] === '-1' ? null : vm['suitableCrowdCode']['DICT_VALUE_CODE'],
            "FIELD_NAME": vm['FIELD_NAME']
        };
        fieldsService.showTable(vm, params);
    };
    vm.initTableData();

    return vm;
}
"use strict";
SMS.SERVICES.service('fieldsService', fieldsService);
fieldsService.$inject = ['$rootScope', '$state', 'Fields', 'bootstrapTable'];
function fieldsService($rootScope, $state, Fields, bootstrapTable) {
    var vm = this;

    function ajaxRequest(params, successFunction, failedFunction) {
        Fields.getFieldList(JSON.stringify(params)).$promise
            .then(function (response) {
                $rootScope.handleMessage(response, function () {
                    successFunction(response.value || {total: 0, rows: []});
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                });
            }, function () {
                $rootScope.alertDialog("获取列表信息失败");
                failedFunction();
            });
    }

    vm.showTable = function ($vm, params) {
        var list = {
            dataFunction: ajaxRequest,
            dataParams: params,
            columns: [{
                field: 'FIELD_NAME',
                title: '字段名称',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'FIELD_TYPE_NAME',
                title: '字段类型',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'FIELD_DETAILED_CONTENT',
                title: '字段内容',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'SUITABLE_CROWD_NAME',
                title: '适用人群',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'USE_TIMES',
                title: '使用次数',
                align: 'center',
                valign: 'middle'
            }]
        };

        function roleFormat(value) {
            return '<div class="flag" style="color: #428bca;cursor:pointer;">' + value + '</div>';
        }

        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
        return $vm;
    };
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('templateListCtrl', templateListCtrl);
templateListCtrl.$inject = ['$rootScope', '$state', 'templateService'];
function templateListCtrl($rootScope, $state, templateService) {
    var vm = this;
    templateService.showTable(vm, {}, $state);
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('templatePreviewCtrl', templatePreviewCtrl);
templatePreviewCtrl.$inject = ['$rootScope', '$state', '$stateParams', 'templateService'];
function templatePreviewCtrl($rootScope, $state, $stateParams, templateService) {
    var vm = this;

    var TEMPLATE_KEY_ID = $stateParams.TEMPLATE_KEY_ID;

    vm.cancel = function () {
        $state.go('main.followupTemplate.templateList');
    };

    getFollowUpTemplateById();
    //获取模版信息
    function getFollowUpTemplateById() {
        templateService.getFollowUpTemplateById(
            {
                "TEMPLATE_KEY_ID": TEMPLATE_KEY_ID
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        var result = handleData(data);
                        vm.templateInfo = result;
                        vm.TEMPLATE_NAME = result.TEMPLATE_NAME;
                        vm.TITLE_LIST = result.TITLE_LIST;
                    },
                    function () {
                        $rootScope.alertDialog('随访模版信息获取失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('随访模版信息获取失败');
            }
        );
    }

    //对数据中的多选填空处理
    function handleData(data) {
        for (var i = 0; i < data.TITLE_LIST.length; i++) {
            for (var j = 0; j < data.TITLE_LIST[i].FIELD_LIST.length; j++) {
                if (data.TITLE_LIST[i].FIELD_LIST[j].FIELD_TYPE_CODE === '0022000070') {
                    for (var k = 0; k < data.TITLE_LIST[i].FIELD_LIST[j].FIELD_DETAILED_LIST.length; k++) {
                        var temp = data.TITLE_LIST[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT.split("");
                        var obj = [];
                        for (var m = 0; m < temp.length; m++) {
                            obj.push({
                                "TEMP_NAME": temp[m]
                            });
                        }
                        data.TITLE_LIST[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT = obj;
                    }
                }
            }
        }

        return data;
    }

    vm.toggle = function (item, obj) {
        if (obj.MODEL === undefined) {
            obj.MODEL = [];
        }
        var idx = obj.MODEL.indexOf(item);
        if (idx > -1) {
            obj.MODEL.splice(idx, 1);
        }
        else {
            obj.MODEL.push(item);
        }
    };

    return vm;
}
"use strict";
SMS.SERVICES.service('templateService', templateService);
templateService.$inject = ['$rootScope', 'Template', 'bootstrapTable'];
function templateService($rootScope, Template, bootstrapTable) {
    var vm = this;

    vm.showTable = function ($vm, params, $state) {
        var list = {
            dataFunction: ajaxRequest,
            dataParams: params,
            columns: [{
                field: 'TEMPLATE_NAME',
                title: '随访模版',
                align: 'center',
                valign: 'middle',
                width: 300,
                formatter: accountFormat,
                events: {
                    'click .flag': function (e, value, row) {
                        $state.go('main.followupTemplate.templatePreview', {"TEMPLATE_KEY_ID": row.TEMPLATE_KEY_ID});
                    }
                }
            }, {
                field: 'SUITABLE_CROWD_NAME',
                title: '适用人群',
                width: 225,
                align: 'center',
                valign: 'middle'
            }, {
                field: 'CREATE_TIME',
                title: '创建时间',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'UPDATE_TIME',
                title: '修改时间',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'OPERATE',
                title: '操作',
                align: 'center',
                valign: 'middle'
            }]
        };
        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };

        function accountFormat(value) {
            return '<div class="flag" style="color: #428bca">' + value + '</div>';
        }

        return $vm;
    };

    function ajaxRequest(params, successFunction, failedFunction) {
        Template.getTemplateList(JSON.stringify(params)).$promise
            .then(function (response) {
                $rootScope.handleMessage(response, function () {
                    successFunction(response.value || {total: 0, rows: []});
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                });
            }, function () {
                $rootScope.alertDialog("获取列表信息失败");
                failedFunction();
            });
    }

    vm.getFollowUpTemplateById = function (param, successFunction, failedFunction) {
        Template.getFollowUpTemplateById(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('contractDetailReportCtrl', contractDetailReportCtrl);
contractDetailReportCtrl.$inject = ['$rootScope', '$state', 'contractReportService'];
function contractDetailReportCtrl($rootScope, $state, contractReportService) {
    var vm = this;

    vm.returnBack=function () {
      $state.go('main.report.contractReport');
    };

    contractReportService.getMoreSignedData({
        TYPE: '1'
    }, function (response) {
        $rootScope.handleMessage(response, function (data) {
            drawAllDataChart(data);
        }, function () {
            $rootScope.alertDialog("获取图表信息失败");
        });
    }, function () {
        $rootScope.alertDialog("获取图表信息失败");
    });


    function drawAllDataChart(totalData) {
        var organizationList = [];
        var signedDataList = [];
        var unsignedDataList = [];
        var formatterLabelName = {};

        for (var i = 0; i < totalData.ALL_ORGANIZATION_LIST.length; i++) {
            organizationList.push(totalData.ALL_ORGANIZATION_LIST[i].ORGANIZATION_NAME);
            signedDataList.push((totalData.ALL_ORGANIZATION_LIST[i].SIGNED_RESIDENT_TOTAL*100/totalData.ALL_ORGANIZATION_LIST[i].RESIDENT_TOTAL).toFixed(2));
            unsignedDataList.push((totalData.ALL_ORGANIZATION_LIST[i].UNSIGNED_RESIDENT_TOTAL*100/totalData.ALL_ORGANIZATION_LIST[i].RESIDENT_TOTAL).toFixed(2));
            formatterLabelName[totalData.ALL_ORGANIZATION_LIST[i].ORGANIZATION_NAME] = [totalData.ALL_ORGANIZATION_LIST[i].SIGNED_RESIDENT_TOTAL, totalData.ALL_ORGANIZATION_LIST[i].UNSIGNED_RESIDENT_TOTAL];
        }

        vm.allOrganizationChart = {
            title: {
                text: '各机构签约人数比例',
                x: 'left'
            },
            grid: {
                bottom: totalData.ALL_ORGANIZATION_LIST.length > 15 ? '23%' : '16%',
                containLabel: true
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                    type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                },
                formatter: function (a) {
                    if (!a) {
                        return;
                    }
                    return "<div><span>" + a[0].name + "</span><br/><span>" + a[0].seriesName + ":" + formatterLabelName[a[0].name][0] + "</span><br/><span>" + a[1].seriesName + ":" + formatterLabelName[a[0].name][1] + "</span><br/><span>签约比例：" + a[0].data + "%</span><div>";
                }
            },
            legend: {
                orient: 'horizontal',
                left: 'right',
                top: 'top',
                data: ['未签约人数', '已签约人数']
            },
            xAxis: [
                {
                    type: 'category',
                    axisLabel: {
                        interval: 0,
                        rotate: 30,
                        formatter: function (value) {
                            if (value && value.length > 10) {
                                return value.substring(0, 10) + "...";
                            }
                            return value;
                        }
                    },
                    data: organizationList
                }
            ],
            dataZoom: [{
                show: totalData.ALL_ORGANIZATION_LIST.length > 15 ? true : false,
                bottom: 0,
                startValue: 0,
                endValue: 15,
                handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                handleSize: '80%',
                handleStyle: {
                    color: '#fff',
                    shadowBlur: 3,
                    shadowColor: 'rgba(0, 0, 0, 0.6)',
                    shadowOffsetX: 2,
                    shadowOffsetY: 2
                }
            }],
            yAxis: [
                {
                    type: 'value',
                    axisLabel:{
                        formatter:'{value} %'
                    }
                }
            ],
            series: [
                {
                    name: '已签约人数',
                    type: 'bar',
                    stack: '各机构签约人数比例',
                    data: signedDataList,
                    barMinHeight: 12,
                    label: {
                        normal: {
                            show: true,
                            position: 'inside',
                            formatter: function (val) {
                                return formatterLabelName[val.name][0];
                            }
                        }
                    }
                },
                {
                    name: '未签约人数',
                    type: 'bar',
                    stack: '各机构签约人数比例',
                    barMinHeight: 12,
                    data: unsignedDataList,
                    label: {
                        normal: {
                            show: true,
                            position: 'inside',
                            formatter: function (val) {
                                return formatterLabelName[val.name][1];
                            }
                        }
                    }
                }
            ]
        };
    }

    contractReportService.getPageSignedData(vm, {TYPE: "1"}, $state);

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('contractReportCtrl', contractReportCtrl);
contractReportCtrl.$inject = ['$rootScope', '$state', 'contractReportService'];
function contractReportCtrl($rootScope, $state, contractReportService) {
    var vm = this;

    var lastLevel = null;
    var lastOrganization = null;

    vm.organizationReportName = '';
    vm.doctorReportName = '';

    vm.isSearch = true;
    vm.isReset = false;
    vm.isSearching = false;
    vm.selectDoctor=false;

    vm.resetChart = function () {
        vm.isReset = true;
        vm.selectDoctor=false;
        vm.searchObject = null;
        vm.organizationLevel = null;
        vm.organizationName = null;
        vm.doctorName = null;
        vm.searchOrganizationOrDoctor = null;
        contractReportService.getAllSignedData({
            TYPE: "1"
        }, function (response) {
            $rootScope.handleMessage(response, function (data) {
                resetTotalData(data);
                vm.isReset = false;
            }, function () {
                $rootScope.alertDialog("获取所有签约信息失败");
                vm.isReset = false;
            });
        }, function () {
            $rootScope.alertDialog("获取所有签约信息失败");
            vm.isReset = false;
        });
    };

    vm.resetChart();

    function resetTotalData(totalData) {
        setAreaAndScale(totalData.AREA_AND_SCALE);
        vm.isLevel = totalData.ORGANIZATION_LEVEL;
        vm.organizationReportName = "";
        vm.doctorReportName = "";
        var organizationList = [];
        var signedDataList = [];
        var unsignedDataList = [];
        var formatterLabelName = {};

        for (var i = 0; i < totalData.ORGANIZATION_LIST.length; i++) {
            organizationList.push(totalData.ORGANIZATION_LIST[i].ORGANIZATION_NAME);
            signedDataList.push((totalData.ORGANIZATION_LIST[i].SIGNED_RESIDENT_TOTAL*100/(totalData.ORGANIZATION_LIST[i].SIGNED_RESIDENT_TOTAL+totalData.ORGANIZATION_LIST[i].UNSIGNED_RESIDENT_TOTAL)).toFixed(2));
            unsignedDataList.push((totalData.ORGANIZATION_LIST[i].UNSIGNED_RESIDENT_TOTAL*100/(totalData.ORGANIZATION_LIST[i].SIGNED_RESIDENT_TOTAL+totalData.ORGANIZATION_LIST[i].UNSIGNED_RESIDENT_TOTAL)).toFixed(2));
            formatterLabelName[totalData.ORGANIZATION_LIST[i].ORGANIZATION_NAME] = [totalData.ORGANIZATION_LIST[i].SIGNED_RESIDENT_TOTAL, totalData.ORGANIZATION_LIST[i].UNSIGNED_RESIDENT_TOTAL];
        }

        vm.isSearch = true;
        vm.category = {
            title: {
                text: '各机构签约人数比例',
                x: 'left'
            },
            grid: {
                bottom: '16%',
                containLabel: true
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                    type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                },
                formatter: function (a) {
                    if (!a || a.length===0) {
                        return;
                    }
                    return "<div><span>" + a[0].name + "</span><br/><span>" + a[0].seriesName + ":" + formatterLabelName[a[0].name][0] + "</span><br/><span>" + a[1].seriesName + ":" + formatterLabelName[a[0].name][1] + "</span><br/><span>签约比例：" + a[0].data + "%</span><div>";
                }
            },
            legend: {
                orient: 'horizontal',
                left: 'right',
                top: 'top',
                data: ['未签约人数', '已签约人数']
            },
            xAxis: [
                {
                    type: 'category',
                    axisLabel: {
                        interval: 0,
                        rotate: 30,
                        formatter: function (value) {
                            if (value && value.length > 10) {
                                return value.substring(0, 10) + "...";
                            }
                            return value;
                        }
                    },
                    data: organizationList
                }
            ],
            yAxis: [
                {
                    type: 'value',
                    axisLabel:{
                        formatter:'{value} %'
                    }
                }
            ],
            series: [
                {
                    name: '已签约人数',
                    type: 'bar',
                    stack: '各机构签约人数比例',
                    data: signedDataList,
                    barMinHeight: 12,
                    label: {
                        normal: {
                            show: true,
                            position: 'inside',
                            formatter: function (val) {
                                return formatterLabelName[val.name][0];
                            }
                        }
                    }
                },
                {
                    name: '未签约人数',
                    type: 'bar',
                    stack: '各机构签约人数比例',
                    barMinHeight: 12,
                    data: unsignedDataList,
                    label: {
                        normal: {
                            show: true,
                            position: 'inside',
                            formatter: function (val) {
                                return formatterLabelName[val.name][1];
                            }
                        }
                    }
                }
            ]
        };
    }

    function setAreaAndScale(scaleData) {
        vm.isSearch = false;
        if (!scaleData) {
            scaleData = {};
        }
        vm.familyTotal = scaleData.FAMILY_TOTAL || 0;
        vm.residentTotal = scaleData.RESIDENT_TOTAL || 0;
        vm.signedFamilyTotal = scaleData.SIGNED_FAMILY_TOTAL || 0;
        vm.signedResidentTotal = scaleData.SIGNED_RESIDENT_TOTAL || 0;
        vm.unsignedFamilyTotal = scaleData.UNSIGNED_FAMILY_TOTAL || 0;
        vm.unsignedResidentTotal = scaleData.UNSIGNED_RESIDENT_TOTAL || 0;
        vm.doctorTotal = scaleData.DOCTOR_TOTAL || 0;
        vm.familyDoctorScale = scaleData.FAMILY_DOCTOR_SCALE || 0;
        vm.organizationReportName = scaleData.ORGANIZATION_NAME;

        var optionLeft = {
            title: {
                text: '签约家庭比例',
                x: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                orient: 'horizontal',
                left: 'center',
                top: 'bottom',
                data: ['未签约家庭数', '已签约家庭数']
            },
            series: [
                {
                    name: '签约家庭比例',
                    type: 'pie',
                    radius: '55%',
                    center: ['50%', '50%'],
                    label: {
                        normal: {
                            show: true,
                            position: 'inside',
                            formatter: function (val) {
                                return val.name + ":" + val.percent + "%";
                            }
                        }
                    },
                    data: [
                        {value: scaleData.SIGNED_FAMILY_TOTAL || 0, name: '已签约家庭数'},
                        {value: scaleData.UNSIGNED_FAMILY_TOTAL || 0, name: '未签约家庭数'}
                    ],
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };

        var optionRight = {
            title: {
                text: '签约人数比例',
                x: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                orient: 'horizontal',
                left: 'center',
                top: 'bottom',
                data: ['未签约人数', '已签约人数']
            },
            series: [
                {
                    name: '签约人数比例',
                    type: 'pie',
                    radius: '55%',
                    center: ['50%', '50%'],
                    label: {
                        normal: {
                            show: true,
                            position: 'inside',
                            formatter: function (val) {
                                return val.name + ":" + val.percent + "%";
                            }
                        }
                    },
                    data: [
                        {value: scaleData.SIGNED_RESIDENT_TOTAL || 0, name: '已签约人数'},
                        {value: scaleData.UNSIGNED_RESIDENT_TOTAL || 0, name: '未签约人数'}

                    ],
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        };

        vm.leftPie = optionLeft;
        vm.rightPie = optionRight;
    }

    vm.initLevelList = function () {
        if (!vm.organizationLevels) {
            contractReportService.getOrganizationLevel('', function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.organizationLevels = data;
                }, function () {
                    $rootScope.alertDialog("获取机构级别失败");
                });
            }, function () {
                $rootScope.alertDialog("获取机构级别失败");
            });
        }
    };

    vm.initOrangizationByLevel = function () {
        if (lastLevel && lastLevel === vm.organizationLevel.LEVEL) {
            return;
        }
        lastLevel = vm.organizationLevel.LEVEL;
        contractReportService.getOrganizationByLevel({
            ORGANIZATION_LEVEL: vm.organizationLevel.LEVEL
        }, function (response) {
            $rootScope.handleMessage(response, function (data) {
                vm.organizationNames = data;
            }, function () {
                $rootScope.alertDialog("获取机构级别失败");
            });
        }, function () {
            $rootScope.alertDialog("获取机构级别失败");
        });
    };

    vm.initAllDoctorData = function () {
        if (lastOrganization && lastOrganization === vm.organizationName.ORGANIZATION_KEY_ID) {
            return;
        }
        lastOrganization = vm.organizationName.ORGANIZATION_KEY_ID;
        contractReportService.getDoctorByOrganization({
            ORGANIZATION_KEY_ID: vm.organizationName.ORGANIZATION_KEY_ID
        }, function (response) {
            $rootScope.handleMessage(response, function (data) {
                vm.doctorNames = data.DOCTOR_LIST;
            }, function () {
                $rootScope.alertDialog("获取医生列表失败");
            });
        }, function () {
            $rootScope.alertDialog("获取医生列表失败");
        });
    };

    vm.searchForTable = function () {

        var param = {};
        if ((!vm.searchOrganizationOrDoctor || !vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID) && (!vm.searchObject || (vm.searchObject === '0' && !vm.organizationName) || (vm.searchObject === '1' && !vm.doctorName))) {
            $rootScope.alertDialog("请输入正确的筛选条件！");
            return;
        }
        vm.selectDoctor=false;
        vm.isSearching = true;
        if (vm.searchOrganizationOrDoctor && vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID && !vm.searchOrganizationOrDoctor.FAMILY_DOCTOR_KEY_ID) {
            param.ORGANIZATION_KEY_ID = vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID;
            vm.doctorReportName='';
        } else if (vm.searchOrganizationOrDoctor && vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID && vm.searchOrganizationOrDoctor.FAMILY_DOCTOR_KEY_ID) {
            param.ORGANIZATION_KEY_ID = vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID;
            param.FAMILY_DOCTOR_KEY_ID = vm.searchOrganizationOrDoctor.FAMILY_DOCTOR_KEY_ID;
            vm.doctorReportName = vm.searchOrganizationOrDoctor.ORGANIZATION_OR_DOCTOR_NAME;
            vm.selectDoctor=true;
        } else if (vm.searchObject === '0') {
            param.ORGANIZATION_KEY_ID = vm.organizationName.ORGANIZATION_KEY_ID;
            vm.doctorReportName='';
        } else {
            param.ORGANIZATION_KEY_ID = vm.organizationName.ORGANIZATION_KEY_ID;
            param.FAMILY_DOCTOR_KEY_ID = vm.doctorName.FAMILY_DOCTOR_KEY_ID;
            vm.doctorReportName = vm.doctorName.DOCTOR_NAME;
            vm.selectDoctor=true;
        }

        contractReportService.getAllSignedData(param, function (response) {
            $rootScope.handleMessage(response, function (data) {
                setAreaAndScale(data.AREA_AND_SCALE);
                vm.isSearching = false;
            }, function () {
                $rootScope.alertDialog("获取统计信息失败");
                vm.isSearching = false;
            });
        }, function () {
            $rootScope.alertDialog("获取统计信息失败");
            vm.isSearching = false;
        });
    };


    vm.getOrganizationList = function () {
        contractReportService.getOrganizationORDoctor({
            SEARCH_NAME: vm.searchTerm
        }, function (response) {
            $rootScope.handleMessage(response, function (data) {
                vm.organization = data.ORGANIZATION_OR_DOCTOR_LIST;
            }, function () {
                $rootScope.alertDialog("获取统计信息失败");
            });
        }, function () {
            $rootScope.alertDialog("获取统计信息失败");
        });
    };
    vm.searchTerm;
    vm.searchOrganizationOrDoctor = {};
    vm.clearSearchTerm = function () {
        vm.searchTerm = '';
        //关闭的时候判断已有的值是否在list中，在的话选中，不在的话把list赋值给list再选中
        if (vm.searchOrganizationOrDoctor !== undefined) {
            var temp;
            if(vm.searchOrganizationOrDoctor.FAMILY_DOCTOR_KEY_ID){
                 temp = $rootScope.selectItem(vm.organization, "FAMILY_DOCTOR_KEY_ID", vm.searchOrganizationOrDoctor.FAMILY_DOCTOR_KEY_ID);
            }else{
                temp = $rootScope.selectItem(vm.organization, "ORGANIZATION_KEY_ID", vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID);
            }

            if (temp != null) {
                vm.searchOrganizationOrDoctor = temp;
            } else {
                vm.organization = [];
                vm.organization.push(temp);
                vm.searchOrganizationOrDoctor = vm.organization[0];
            }
        }
    };
    vm.getSearchTerm = function () {
        vm.searchTerm = vm.searchOrganizationOrDoctor ? vm.searchOrganizationOrDoctor.ORGANIZATION_OR_DOCTOR_NAME : undefined;
        vm.searchTermChange();
    };
    angular.element('input[name="organization"]').on('keydown', function (ev) {
        ev.stopPropagation();
    });
    vm.searchTermChange = function () {
        if (vm.searchTerm !== '' && vm.searchTerm !== undefined) {
            vm.getOrganizationList();
        } else {
            vm.organization = [];
        }
    };


    vm.changeSearchForAllSelect=function(searchData) {
        if(!searchData || !searchData.ORGANIZATION_OR_DOCTOR_NAME){
            return;
        }

        if(vm.organizationLevels){
            vm.organizationLevel=getIndexOrAdd({
                LEVEL:searchData.ORGANIZATION_LEVEL
            },vm.organizationLevels,'LEVEL');
        }else{
            contractReportService.getOrganizationLevel('', function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.organizationLevels = data;
                    vm.organizationLevel=getIndexOrAdd({
                        LEVEL:searchData.ORGANIZATION_LEVEL
                    },vm.organizationLevels,'LEVEL');
                }, function () {
                    $rootScope.alertDialog("获取机构级别失败");
                });
            }, function () {
                $rootScope.alertDialog("获取机构级别失败");
            });
        }



        if (lastLevel && lastLevel === searchData.ORGANIZATION_LEVEL) {
            vm.organizationName=getIndexOrAdd({
                ORGANIZATION_KEY_ID:searchData.ORGANIZATION_KEY_ID,
                ORGANIZATION_NAME:searchData.ORGANIZATION_NAME
            },vm.organizationNames,'ORGANIZATION_KEY_ID');
        }else{
            contractReportService.getOrganizationByLevel({
                ORGANIZATION_LEVEL: searchData.ORGANIZATION_LEVEL
            }, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.organizationNames = data;
                    vm.organizationName=getIndexOrAdd({
                        ORGANIZATION_KEY_ID:searchData.ORGANIZATION_KEY_ID,
                        ORGANIZATION_NAME:searchData.ORGANIZATION_NAME
                    },vm.organizationNames,'ORGANIZATION_KEY_ID');
                }, function () {
                    $rootScope.alertDialog("获取机构级别失败");
                });
            }, function () {
                $rootScope.alertDialog("获取机构级别失败");
            });
        }

        if(searchData.FAMILY_DOCTOR_KEY_ID){
            vm.searchObject='1';

            if (lastOrganization && lastOrganization === searchData.ORGANIZATION_KEY_ID) {
                vm.doctorName=getIndexOrAdd({
                    FAMILY_DOCTOR_KEY_ID:searchData.FAMILY_DOCTOR_KEY_ID,
                    DOCTOR_NAME:searchData.ORGANIZATION_OR_DOCTOR_NAME
                },vm.doctorNames,'FAMILY_DOCTOR_KEY_ID');
            }else{
                contractReportService.getDoctorByOrganization({
                    ORGANIZATION_KEY_ID: searchData.ORGANIZATION_KEY_ID
                }, function (response) {
                    $rootScope.handleMessage(response, function (data) {
                        vm.doctorNames = data.DOCTOR_LIST;
                        vm.doctorName=getIndexOrAdd({
                            FAMILY_DOCTOR_KEY_ID:searchData.FAMILY_DOCTOR_KEY_ID,
                            DOCTOR_NAME:searchData.ORGANIZATION_OR_DOCTOR_NAME
                        },vm.doctorNames,'FAMILY_DOCTOR_KEY_ID');
                    }, function () {
                        $rootScope.alertDialog("获取医生列表失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取医生列表失败");
                });
            }
        }else{
            vm.searchObject='0';
        }

        lastLevel= searchData.ORGANIZATION_LEVEL;
        lastOrganization = searchData.ORGANIZATION_KEY_ID;


        function getIndexOrAdd(selectValue, selectList, compareKey) {
            if (selectList) {
                for (var i = 0; i < selectList.length; i++) {
                    if ((selectList[i][compareKey]+'') === (selectValue[compareKey]+'')) {
                        return selectList[i];
                    }
                }
                selectList[selectList.length] = selectValue;
                return selectList[selectList.length-1];
            } else {
                selectList = [selectValue];
                return selectList[0];
            }
        }
    }


    vm.changeSelect = function (index) {
        switch (index) {
            case 0:
                vm.organizationLevel = null;
                vm.organizationName = null;
                vm.doctorName = null;
                vm.searchOrganizationOrDoctor=null;
                break;
            case 1:
                vm.organizationName = null;
                vm.doctorName = null;
                vm.searchOrganizationOrDoctor=null;
                break;
            case 2:
                vm.doctorName = null;
                vm.searchOrganizationOrDoctor=null;
                break;
            default:
                vm.searchOrganizationOrDoctor=null;
                break;
        }
    };

    vm.moreInfo = function () {
        $state.go('main.report.contractDetailReport');
    };

    return vm;
}
"use strict";
SMS.SERVICES.service('contractReportService', contractReportService);
contractReportService.$inject = ['Report', '$rootScope', 'bootstrapTable'];
function contractReportService(Report, $rootScope, bootstrapTable) {
    var vm = this;


    vm.getOrganizationLevel = function (params, successFunction, failedFunction) {
        Report.getOrganizationLevel(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getOrganizationByLevel = function (params, successFunction, failedFunction) {
        Report.getOrganizationByLevel(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getAllSignedData = function (params, successFunction, failedFunction) {
        Report.getAllSignedData(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getDoctorByOrganization = function (params, successFunction, failedFunction) {
        Report.getDoctorByOrganization(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getOrganizationORDoctor = function (params, successFunction, failedFunction) {
        Report.getOrganizationORDoctor(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getMoreSignedData = function (params, successFunction, failedFunction) {
        Report.getMoreSignedData(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getPageSignedData = function ($vm, listPara) {
        var list = {
            dataFunction: getSignedDataList,
            dataParams: listPara,
            columns: [{
                field: 'ORGANIZATION_NAME',
                title: '机构名称',
                align: 'center'
            }, {
                field: 'SIGNED_RESIDENT_TOTAL',
                title: '签约人数',
                align: 'center'
            }, {
                field: 'UNSIGNED_RESIDENT_TOTAL',
                title: '未签约人数',
                align: 'center'
            }, {
                field: 'RESIDENT_TOTAL',
                title: '居民总数',
                align: 'center'
            }, {
                field: 'SINGED_RESIDENT_PERSENT',
                title: '签约比例',
                align: 'center'
            }]
        };

        function getSignedDataList(param, successFunction, failedFunction) {
            Report.getPageSignedData(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.organizationTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };


    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('followupTimesReportCtrl', followupTimesReportCtrl);
followupTimesReportCtrl.$inject = ['$rootScope', '$state', 'followupTimesReportService','$filter'];
function followupTimesReportCtrl($rootScope, $state, followupTimesReportService,$filter) {
    var vm = this;
    vm.isReset = false;
    vm.isSearching = false;

    var lastLevel = null;
    var lastOrganization = null;

    vm.organizationReportName = '';
    vm.doctorReportName = '';


    vm.resetChart=function () {
        vm.searchObject = null;
        vm.organizationLevel = null;
        vm.organizationName = null;
        vm.doctorName = null;
        vm.searchOrganizationOrDoctor = null;
        vm.isReset = true;
        var now=new Date();
        vm.startDate=new Date(now.getFullYear()+'-'+(now.getMonth()+1)+'-01');
        vm.endDate=new Date();
        followupTimesReportService.getAllFollowUpData({
            START_DATE:$filter('commonDate')(vm.startDate),
            END_DATE:$filter('commonDate')(vm.endDate)
        }, function (response) {
            $rootScope.handleMessage(response, function (data) {
                drawChart(data);
                vm.isReset = false;
            }, function () {
                $rootScope.alertDialog("获取所有签约信息失败");
                vm.isReset = false;
            });
        },function () {
            $rootScope.alertDialog("获取所有签约信息失败");
            vm.isReset = false;
        });
    };

    vm.resetChart();


    function drawChart(chartData) {
        vm.isLevel = chartData.ORGANIZATION_LEVEL;
        if(chartData){
            vm.doctorFollowupTotal=chartData.DOCTOR_FOLLOW_UP_TOTAL||0;
            vm.doctorFollowupAverage=chartData.DOCTOR_FOLLOW_UP_AVERAGE||0;
            vm.diabetesAverage=chartData.DIABETES_AVERAGE||'0.0';
            vm.hypertensionAverage=chartData.HYPERTENSION_AVERAGE||'0.0';
        }else{
            vm.doctorFollowupTotal=0;
            vm.doctorFollowupAverage=0;
            vm.diabetesAverage='0.0';
            vm.hypertensionAverage='0.0';
        }



        vm.chartOption= {
            color: ['#3398DB'],
            tooltip : {
                trigger: 'axis',
                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis : [
                {
                    type : 'category',
                    data : ['高血压人群','糖尿病人群'],
                    axisTick: {
                        alignWithLabel: true
                    }
                }
            ],
            yAxis : [
                {
                    type : 'value',
                    minInterval: 1
                }
            ],
            series : [
                {
                    name:'居民受访次数',
                    type:'bar',
                    barWidth: '60%',
                    data:[chartData?chartData.HYPERTENSION_TOTAL||0:0,chartData?chartData.DIABETES_TOTAL||0:0]
                }
            ]
        };
    }

    vm.drawChartByDate=function () {

        var param = {
            START_DATE:$filter('commonDate')(vm.startDate),
            END_DATE:$filter('commonDate')(vm.endDate)
        };
        if ((!vm.startDate || !vm.endDate) && (!vm.searchObject || (vm.searchObject === '0' && !vm.organizationName) || (vm.searchObject === '1' && !vm.doctorName))) {
            $rootScope.alertDialog("请输入正确的筛选条件！");
            return;
        }
        vm.isSearching = true;
        if((!vm.searchOrganizationOrDoctor  || !vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID )&& (!vm.organizationName || !vm.organizationName.ORGANIZATION_KEY_ID)){
            param.ORGANIZATION_KEY_ID = null;
            param.FAMILY_DOCTOR_KEY_ID = null;
        }else if (vm.searchOrganizationOrDoctor && vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID && !vm.searchOrganizationOrDoctor.FAMILY_DOCTOR_KEY_ID) {
            param.ORGANIZATION_KEY_ID = vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID;
        } else if (vm.searchOrganizationOrDoctor && vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID && vm.searchOrganizationOrDoctor.FAMILY_DOCTOR_KEY_ID) {
            param.ORGANIZATION_KEY_ID = vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID;
            param.FAMILY_DOCTOR_KEY_ID = vm.searchOrganizationOrDoctor.FAMILY_DOCTOR_KEY_ID;
        } else if (vm.searchObject === '0') {
            param.ORGANIZATION_KEY_ID = vm.organizationName.ORGANIZATION_KEY_ID;
        } else {
            param.ORGANIZATION_KEY_ID = vm.organizationName.ORGANIZATION_KEY_ID;
            param.FAMILY_DOCTOR_KEY_ID = vm.doctorName.FAMILY_DOCTOR_KEY_ID;
        }

        followupTimesReportService.getAllFollowUpData(param, function (response) {
            $rootScope.handleMessage(response, function (data) {
                drawChart(data);
                vm.isSearching = false;
            }, function () {
                $rootScope.alertDialog("获取所有签约信息失败");
                vm.isSearching = false;
            });
        },function () {

        });
    };

    vm.initLevelList = function () {
        if (!vm.organizationLevels) {
            followupTimesReportService.getOrganizationLevel('', function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.organizationLevels = data;
                }, function () {
                    $rootScope.alertDialog("获取机构级别失败");
                });
            }, function () {
                $rootScope.alertDialog("获取机构级别失败");
            });
        }
    };

    vm.initOrangizationByLevel = function () {
        if (lastLevel && lastLevel === vm.organizationLevel.LEVEL) {
            return;
        }
        lastLevel = vm.organizationLevel.LEVEL;
        followupTimesReportService.getOrganizationByLevel({
            ORGANIZATION_LEVEL: vm.organizationLevel.LEVEL
        }, function (response) {
            $rootScope.handleMessage(response, function (data) {
                vm.organizationNames = data;
            }, function () {
                $rootScope.alertDialog("获取机构级别失败");
            });
        }, function () {
            $rootScope.alertDialog("获取机构级别失败");
        });
    };

    vm.initAllDoctorData = function () {
        if (lastOrganization && lastOrganization === vm.organizationName.ORGANIZATION_KEY_ID) {
            return;
        }
        lastOrganization = vm.organizationName.ORGANIZATION_KEY_ID;
        followupTimesReportService.getDoctorByOrganization({
            ORGANIZATION_KEY_ID: vm.organizationName.ORGANIZATION_KEY_ID
        }, function (response) {
            $rootScope.handleMessage(response, function (data) {
                vm.doctorNames = data.DOCTOR_LIST;
            }, function () {
                $rootScope.alertDialog("获取医生列表失败");
            });
        }, function () {
            $rootScope.alertDialog("获取医生列表失败");
        });
    };

    vm.getOrganizationList = function () {
        followupTimesReportService.getOrganizationORDoctor({
            SEARCH_NAME: vm.searchTerm
        }, function (response) {
            $rootScope.handleMessage(response, function (data) {
                vm.organization = data.ORGANIZATION_OR_DOCTOR_LIST;
            }, function () {
                $rootScope.alertDialog("获取统计信息失败");
            });
        }, function () {
            $rootScope.alertDialog("获取统计信息失败");
        });
    };
    vm.searchTerm;
    vm.searchOrganizationOrDoctor = {};
    vm.clearSearchTerm = function () {
        vm.searchTerm = '';
        //关闭的时候判断已有的值是否在list中，在的话选中，不在的话把list赋值给list再选中
        if (vm.searchOrganizationOrDoctor !== undefined) {
            var temp;
            if(vm.searchOrganizationOrDoctor.FAMILY_DOCTOR_KEY_ID){
                temp = $rootScope.selectItem(vm.organization, "FAMILY_DOCTOR_KEY_ID", vm.searchOrganizationOrDoctor.FAMILY_DOCTOR_KEY_ID);
            }else{
                temp = $rootScope.selectItem(vm.organization, "ORGANIZATION_KEY_ID", vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID);
            }
            if (temp != null) {
                vm.searchOrganizationOrDoctor = temp;
            } else {
                vm.organization = [];
                vm.organization.push(temp);
                vm.searchOrganizationOrDoctor = vm.organization[0];
            }
        }
    };
    vm.getSearchTerm = function () {
        vm.searchTerm = vm.searchOrganizationOrDoctor ? vm.searchOrganizationOrDoctor.ORGANIZATION_OR_DOCTOR_NAME : undefined;
        vm.searchTermChange();
    };
    angular.element('input[name="organization"]').on('keydown', function (ev) {
        ev.stopPropagation();
    });
    vm.searchTermChange = function () {
        if (vm.searchTerm !== '' && vm.searchTerm !== undefined) {
            vm.getOrganizationList();
        } else {
            vm.organization = [];
        }
    };


    vm.changeSearchForAllSelect=function(searchData) {
        if(!searchData || !searchData.ORGANIZATION_OR_DOCTOR_NAME){
            return;
        }

        if(vm.organizationLevels){
            vm.organizationLevel=getIndexOrAdd({
                LEVEL:searchData.ORGANIZATION_LEVEL
            },vm.organizationLevels,'LEVEL');
        }else{
            followupTimesReportService.getOrganizationLevel('', function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.organizationLevels = data;
                    vm.organizationLevel=getIndexOrAdd({
                        LEVEL:searchData.ORGANIZATION_LEVEL
                    },vm.organizationLevels,'LEVEL');
                }, function () {
                    $rootScope.alertDialog("获取机构级别失败");
                });
            }, function () {
                $rootScope.alertDialog("获取机构级别失败");
            });
        }



        if (lastLevel && lastLevel === searchData.ORGANIZATION_LEVEL) {
            vm.organizationName=getIndexOrAdd({
                ORGANIZATION_KEY_ID:searchData.ORGANIZATION_KEY_ID,
                ORGANIZATION_NAME:searchData.ORGANIZATION_NAME
            },vm.organizationNames,'ORGANIZATION_KEY_ID');
        }else{
            followupTimesReportService.getOrganizationByLevel({
                ORGANIZATION_LEVEL: searchData.ORGANIZATION_LEVEL
            }, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.organizationNames = data;
                    vm.organizationName=getIndexOrAdd({
                        ORGANIZATION_KEY_ID:searchData.ORGANIZATION_KEY_ID,
                        ORGANIZATION_NAME:searchData.ORGANIZATION_NAME
                    },vm.organizationNames,'ORGANIZATION_KEY_ID');
                }, function () {
                    $rootScope.alertDialog("获取机构级别失败");
                });
            }, function () {
                $rootScope.alertDialog("获取机构级别失败");
            });
        }

        if(searchData.FAMILY_DOCTOR_KEY_ID){
            vm.searchObject='1';

            if (lastOrganization && lastOrganization === searchData.ORGANIZATION_KEY_ID) {
                vm.doctorName=getIndexOrAdd({
                    FAMILY_DOCTOR_KEY_ID:searchData.FAMILY_DOCTOR_KEY_ID,
                    DOCTOR_NAME:searchData.ORGANIZATION_OR_DOCTOR_NAME
                },vm.doctorNames,'FAMILY_DOCTOR_KEY_ID');
            }else{
                followupTimesReportService.getDoctorByOrganization({
                    ORGANIZATION_KEY_ID: searchData.ORGANIZATION_KEY_ID
                }, function (response) {
                    $rootScope.handleMessage(response, function (data) {
                        vm.doctorNames = data.DOCTOR_LIST;
                        vm.doctorName=getIndexOrAdd({
                            FAMILY_DOCTOR_KEY_ID:searchData.FAMILY_DOCTOR_KEY_ID,
                            DOCTOR_NAME:searchData.ORGANIZATION_OR_DOCTOR_NAME
                        },vm.doctorNames,'FAMILY_DOCTOR_KEY_ID');
                    }, function () {
                        $rootScope.alertDialog("获取医生列表失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取医生列表失败");
                });
            }
        }else{
            vm.searchObject='0';
        }

        lastLevel= searchData.ORGANIZATION_LEVEL;
        lastOrganization = searchData.ORGANIZATION_KEY_ID;


        function getIndexOrAdd(selectValue, selectList, compareKey) {
            if (selectList) {
                for (var i = 0; i < selectList.length; i++) {
                    if ((selectList[i][compareKey]+'') === (selectValue[compareKey]+'')) {
                        return selectList[i];
                    }
                }
                selectList[selectList.length] = selectValue;
                return selectList[selectList.length-1];
            } else {
                selectList = [selectValue];
                return selectList[0];
            }
        }
    };


    vm.changeSelect = function (index) {
        switch (index) {
            case 0:
                vm.organizationLevel = null;
                vm.organizationName = null;
                vm.doctorName = null;
                vm.searchOrganizationOrDoctor=null;
                break;
            case 1:
                vm.organizationName = null;
                vm.doctorName = null;
                vm.searchOrganizationOrDoctor=null;
                break;
            case 2:
                vm.doctorName = null;
                vm.searchOrganizationOrDoctor=null;
                break;
            default:
                vm.searchOrganizationOrDoctor=null;
                break;
        }
    };

    return vm;
}
"use strict";
SMS.SERVICES.service('followupTimesReportService', followupTimesReportService);
followupTimesReportService.$inject = ['Report'];
function followupTimesReportService(Report) {
    var vm = this;

    vm.getAllFollowUpData = function (param, successFunction, failedFunction) {
        Report.getAllFollowUpData(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getOrganizationLevel = function (params, successFunction, failedFunction) {
        Report.getOrganizationLevel(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getOrganizationByLevel = function (params, successFunction, failedFunction) {
        Report.getOrganizationByLevel(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    

    vm.getDoctorByOrganization = function (params, successFunction, failedFunction) {
        Report.getDoctorByOrganization(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getOrganizationORDoctor = function (params, successFunction, failedFunction) {
        Report.getOrganizationORDoctor(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('keyPopulationDetailReportCtrl', keyPopulationDetailReportCtrl);
keyPopulationDetailReportCtrl.$inject = ['$rootScope', '$state', 'keyPopulationReportService','$filter'];
function keyPopulationDetailReportCtrl($rootScope, $state, keyPopulationReportService,$filter) {
    var vm = this;
    vm.isSearching=false;
    vm.years=[];
    vm.months=[1,2,3,4,5,6,7,8,9,10,11,12];
    vm.isTimeUsed = $state.params.DETAIL_CHART_VALUE === 'GlucoseAndWarning';

    if(vm.isTimeUsed){
        keyPopulationReportService.getSysDate('', function (response) {
            $rootScope.handleMessage(response, function (data) {
                vm.nowYear=new Date(data).getFullYear()+'';
                vm.nowMonth=new Date(data).getMonth()+1;
                for(var i=2015;i<=vm.nowYear;i++){
                    vm.years.push(i);
                }
                vm.Year=vm.nowYear;
                vm.Month=vm.months[vm.nowMonth-1];
                setChartsAndTable();
            }, function () {
                $rootScope.alertDialog("获取服务器时间失败");
                vm.nowYear=new Date().getFullYear()+'';
                vm.nowMonth=new Date().getMonth()+1;
                for(var i=2015;i<=vm.nowYear;i++){
                    vm.years.push(i);
                }
                vm.Year=vm.nowYear;
                vm.Month=vm.months[vm.nowMonth-1];
                setChartsAndTable();
            });
        },function () {
            $rootScope.alertDialog("获取服务器时间失败");
            vm.nowYear=new Date().getFullYear()+'';
            vm.nowMonth=new Date().getMonth()+1;
            for(var i=2015;i<=vm.nowYear;i++){
                vm.years.push(i);
            }
            vm.Year=vm.nowYear;
            vm.Month=vm.months[vm.nowMonth-1];
            setChartsAndTable();
        });
    }else{
        setChartsAndTable();
    }

    vm.changeYear=function () {
        vm.Month=1;
    };

    vm.refreshChart=function () {
        vm.isSearching=true;
        setChartsAndTable();
    };

    vm.returnBack=function () {
      $state.go('main.report.keyPopulationReportReturnBack',{
          TYPE:$state.params.DETAIL_CHART_TYPE
      });  
    };

    function setChartsAndTable() {
        if ($state.params.DETAIL_CHART_TYPE === 'diabetes' && $state.params.DETAIL_CHART_VALUE === 'GlucoseAndWarning') {
            vm.firstTitle="辖区内各机构本月血糖稳定与预警人数";
            vm.secondTitle="各机构本月血糖稳定与预警人数";
            keyPopulationReportService.getMoreGlucoseAndWarningData({
                SEARCH_YEAR_MONTH: $filter('commonDate')(new Date(vm.Year + '-' + vm.Month))
            }, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    drawGlucoseAndWarningCharts(data.HDP_DISTRIBUTION_DATA);
                    vm.isSearching=false;
                }, function () {
                    $rootScope.alertDialog("获取辖区内各机构本月血糖稳定及预警人数数据失败");
                    vm.isSearching=false;
                });
            }, function () {
                $rootScope.alertDialog("获取辖区内各机构本月血糖稳定及预警人数数据失败");
                vm.isSearching=false;
            });
            keyPopulationReportService.getPageGlucoseAndWarningData(vm,{
                SEARCH_YEAR_MONTH: $filter('commonDate')(new Date(vm.Year + '-' + vm.Month))
            });
        } else if ($state.params.DETAIL_CHART_TYPE === 'hypertension' && $state.params.DETAIL_CHART_VALUE === 'GlucoseAndWarning') {
            vm.firstTitle="辖区内各机构本月血压稳定与预警人数";
            vm.secondTitle="各机构本月血糖压稳定与预警人数";
            keyPopulationReportService.getMoreHBPGlucoseAndWarningData({
                SEARCH_YEAR_MONTH: $filter('commonDate')(new Date(vm.Year + '-' + vm.Month))
            }, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    drawGlucoseAndWarningCharts(data.HDP_DISTRIBUTION_DATA);
                    vm.isSearching=false;
                }, function () {
                    $rootScope.alertDialog("获取辖区内各机构本月血糖稳定及预警人数数据失败");
                    vm.isSearching=false;
                });
            }, function () {
                $rootScope.alertDialog("获取辖区内各机构本月血糖稳定及预警人数数据失败");
                vm.isSearching=false;
            });
            keyPopulationReportService.getPageHBPGlucoseAndWarningData(vm,{
                SEARCH_YEAR_MONTH: $filter('commonDate')(new Date(vm.Year + '-' + vm.Month))
            });
        }else if($state.params.DETAIL_CHART_TYPE === 'diabetes' && $state.params.DETAIL_CHART_VALUE === 'Distribution'){
            vm.firstTitle="辖区内各机构糖尿病人群分布";
            vm.secondTitle="各机构糖尿病人群人数比例表格";
            keyPopulationReportService.getMoreODPDistributionData({}, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    drawDistributionCharts(data.ODP_DISTRIBUTION_DATA);
                    vm.isSearching=false;
                }, function () {
                    $rootScope.alertDialog("获取辖区内各机构糖尿病人群分布(更多)数据失败");
                    vm.isSearching=false;
                });
            }, function () {
                $rootScope.alertDialog("获取辖区内各机构糖尿病人群分布(更多)数据失败");
                vm.isSearching=false;
            });
            keyPopulationReportService.getPageODPDistributionData(vm,{});
        }else if($state.params.DETAIL_CHART_TYPE === 'hypertension' && $state.params.DETAIL_CHART_VALUE === 'Distribution'){
            vm.firstTitle="辖区内各机构高血压人群分布";
            vm.secondTitle="各机构高血压人群人数比例表格";
            keyPopulationReportService.getMoreOHPDistributionData({}, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    drawDistributionCharts(data.HDP_DISTRIBUTION_DATA);
                    vm.isSearching=false;
                }, function () {
                    $rootScope.alertDialog("获取辖区内各机构高血压人群分布(更多)数据失败");
                    vm.isSearching=false;
                });
            }, function () {
                $rootScope.alertDialog("获取辖区内各机构高血压人群分布(更多)数据失败");
                vm.isSearching=false;
            });
            keyPopulationReportService.getPageOHPDistributionData(vm,{});
        }
    }
    
    function drawGlucoseAndWarningCharts(chartsData) {
        if(!chartsData){
            chartsData=[];
        }
        var nameList=[];
        var valueList_1=[];
        var valueList_2=[];

        for(var i=chartsData.length-1;i>=0;i--){
            nameList.push(chartsData[i].ORGANIZATION_NAME);
            valueList_1.push(chartsData[i].STABLE_COUNT);
            valueList_2.push(chartsData[i].UNSTABLE_COUNT);
        }

        vm.chartData={
            color:['#1d4fdc','#ff6b6b'],
            title:{
                text:$state.params.DETAIL_CHART_TYPE==='diabetes'?'辖区各机构本月血糖稳定与预警人数':'辖区各机构本月血压稳定与预警人数',
                left:'left'
            },
            tooltip : {
                trigger: 'axis',
                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                },
                formatter:function (a) {
                    if (!a) {
                        return;
                    }
                    
                    if((a[0].value+a[1].value)===0){
                        return "<div><span>" + a[0].name + "</span><br/><span>预警比例：-%</span><div>";
                    }
                    return "<div><span>" + a[0].name + "</span><br/><span>预警比例：" +(a[1].value*100/(a[0].value+a[1].value)).toFixed(2) + "%</span><div>";
                }
            },
            legend: {
                data: ['稳定人数', '预警人数'],
                left:'right'
            },
            grid: {
                left: '2%',
                right: '5%',
                bottom: '3%',
                containLabel: true
            },
            dataZoom: [
                {
                    type:'slider',
                    show: chartsData.length>15?true:false,
                    yAxisIndex: 0,
                    startValue:chartsData.length-15,
                    endValue:chartsData.length-1,
                    handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                    showDataShadow: false,
                    left: '96%'
                }
            ],
            xAxis:  {
                type: 'value',
                minInterval: 1
            },
            yAxis: {
                type: 'category',
                data: nameList,
                axisLabel: {
                    interval: 0,
                    formatter: function (value) {
                        if (value && value.length > 10) {
                            return value.substring(0, 10) + "...";
                        }
                        return value;
                    }
                }
            },
            series: [
                {
                    name: '稳定人数',
                    type: 'bar',
                    stack: $state.params.DETAIL_CHART_TYPE==='diabetes'?'糖尿病患者':'高血压患者',
                    label: {
                        normal: {
                            show: true,
                            position: 'inside'
                        }
                    },
                    data:valueList_1
                },
                {
                    name: '预警人数',
                    type: 'bar',
                    stack: $state.params.DETAIL_CHART_TYPE==='diabetes'?'糖尿病患者':'高血压患者',
                    label: {
                        normal: {
                            show: true,
                            position: 'inside'
                        }
                    },
                    data: valueList_2
                }
            ]
        };
    }
    
    function drawDistributionCharts(chartsData) {
        if(!chartsData){
            chartsData=[];
        }
        var nameList=[];
        var valueList=[];



        for(var i=chartsData.length-1;i>=0;i--){
                nameList.push(chartsData[i].ORGANIZATION_NAME);
            if($state.params.DETAIL_CHART_TYPE!=='diabetes'){
                valueList.push(chartsData[i].SUB_HYPERTENSION_TOTAL);
            }else{
                valueList.push(chartsData[i].SUB_DIABETES_TOTAL);
            }

        }

        vm.chartData={
            title:{
                text:$state.params.DETAIL_CHART_TYPE==='diabetes'?'辖区各机构糖尿病人群分布':'辖区各机构高血压人群分布',
                left:'left'
            },
            tooltip : {
                trigger: 'axis',
                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                },
                formatter:function (a) {
                    if (!a) {
                        return;
                    }
                    return "<div><span>" + a[0].name + 
                        "</span><br/><span>患病人群数："+ a[0].value +
                        "</span><br/><span>所占比例：" +
                        ($state.params.DETAIL_CHART_TYPE==='diabetes'?(chartsData[(chartsData.length-a[0].dataIndex-1)].DIABETES_TOTAL!==0?chartsData[(chartsData.length-a[0].dataIndex-1)].DIABETES_PERSENT:'-'):(chartsData[(chartsData.length-a[0].dataIndex-1)].HYPERTENSION_TOTAL!==0?chartsData[(chartsData.length-a[0].dataIndex-1)].HYPERTENSION_PERSENT:'-')) +
                        "%</span><div>";
                }
            },
            legend: {
                data: ['患病人群数'],
                left:'right'
            },
            grid: {
                left: '2%',
                right: '5%',
                bottom: '3%',
                containLabel: true
            },
            dataZoom: [
                {
                    type:'slider',
                    show: chartsData.length>15?true:false,
                    yAxisIndex: 0,
                    startValue:chartsData.length-15,
                    endValue:chartsData.length-1,
                    handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                    showDataShadow: false,
                    left: '96%'
                }
            ],
            xAxis:  {
                type: 'value',
                minInterval: 1
            },
            yAxis: {
                type: 'category',
                data: nameList,
                axisLabel: {
                    interval: 0,
                    formatter: function (value) {
                        if (value && value.length > 10) {
                            return value.substring(0, 10) + "...";
                        }
                        return value;
                    }
                }
            },
            series: [
                {
                    name: '患病人群数',
                    type: 'bar',
                    label: {
                        normal: {
                            show: true,
                            position: 'inside'
                        }
                    },
                    data:valueList
                }
            ]
        };
    }


    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('keyPopulationReportCtrl', keyPopulationReportCtrl);
keyPopulationReportCtrl.$inject = ['$rootScope', '$state', 'keyPopulationReportService','contractReportService','$filter'];
function keyPopulationReportCtrl($rootScope, $state, keyPopulationReportService,contractReportService,$filter) {
    var vm = this;

    var lastLevel = null;
    var lastOrganization = null;
    vm.lastSearchParam=null;


    vm.isReset=false;
    vm.isSearching=false;
    vm.organizationReportName = '';
    vm.isLevel=null;//是否是分支机构，即是否有下属机构，'1'表示有下属机构，'0'表示没有


    vm.currentNavItem=$state.params.TYPE?$state.params.TYPE:'diabetes';
    vm.years=[];
    vm.months=['01','02','03','04','05','06','07','08','09','10','11','12'];



    vm.initLevelList = function () {
        if (!vm.organizationLevels) {
            contractReportService.getOrganizationLevel('', function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.organizationLevels = data;
                }, function () {
                    $rootScope.alertDialog("获取机构级别失败");
                });
            }, function () {
                $rootScope.alertDialog("获取机构级别失败");
            });
        }
    };

    vm.initOrangizationByLevel = function () {
        if (lastLevel && lastLevel === vm.organizationLevel.LEVEL) {
            return;
        }
        lastLevel = vm.organizationLevel.LEVEL;
        contractReportService.getOrganizationByLevel({
            ORGANIZATION_LEVEL: vm.organizationLevel.LEVEL
        }, function (response) {
            $rootScope.handleMessage(response, function (data) {
                vm.organizationNames = data;
            }, function () {
                $rootScope.alertDialog("获取机构级别失败");
            });
        }, function () {
            $rootScope.alertDialog("获取机构级别失败");
        });
    };

    vm.initAllDoctorData = function () {
        if (lastOrganization && lastOrganization === vm.organizationName.ORGANIZATION_KEY_ID) {
            return;
        }
        lastOrganization = vm.organizationName.ORGANIZATION_KEY_ID;
        contractReportService.getDoctorByOrganization({
            ORGANIZATION_KEY_ID: vm.organizationName.ORGANIZATION_KEY_ID
        }, function (response) {
            $rootScope.handleMessage(response, function (data) {
                vm.doctorNames = data.DOCTOR_LIST;
            }, function () {
                $rootScope.alertDialog("获取医生列表失败");
            });
        }, function () {
            $rootScope.alertDialog("获取医生列表失败");
        });
    };

    vm.getOrganizationList = function () {
        contractReportService.getOrganizationORDoctor({
            SEARCH_NAME: vm.searchTerm
        }, function (response) {
            $rootScope.handleMessage(response, function (data) {
                vm.organization = data.ORGANIZATION_OR_DOCTOR_LIST;
            }, function () {
                $rootScope.alertDialog("获取统计信息失败");
            });
        }, function () {
            $rootScope.alertDialog("获取统计信息失败");
        });
    };
    vm.searchTerm;
    vm.searchOrganizationOrDoctor = {};
    vm.clearSearchTerm = function () {
        vm.searchTerm = '';
        //关闭的时候判断已有的值是否在list中，在的话选中，不在的话把list赋值给list再选中
        if (vm.searchOrganizationOrDoctor !== undefined) {
            var temp;
            if(vm.searchOrganizationOrDoctor.FAMILY_DOCTOR_KEY_ID){
                temp = $rootScope.selectItem(vm.organization, "FAMILY_DOCTOR_KEY_ID", vm.searchOrganizationOrDoctor.FAMILY_DOCTOR_KEY_ID);
            }else{
                temp = $rootScope.selectItem(vm.organization, "ORGANIZATION_KEY_ID", vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID);
            }
            if (temp != null) {
                vm.searchOrganizationOrDoctor = temp;
            } else {
                vm.organization = [];
                vm.organization.push(temp);
                vm.searchOrganizationOrDoctor = vm.organization[0];
            }
        }
    };
    vm.getSearchTerm = function () {
        vm.searchTerm = vm.searchOrganizationOrDoctor ? vm.searchOrganizationOrDoctor.ORGANIZATION_OR_DOCTOR_NAME : undefined;
        vm.searchTermChange();
    };
    angular.element('input[name="organization"]').on('keydown', function (ev) {
        ev.stopPropagation();
    });
    vm.searchTermChange = function () {
        if (vm.searchTerm !== '' && vm.searchTerm !== undefined) {
            vm.getOrganizationList();
        } else {
            vm.organization = [];
        }
    };
    vm.changeSearchForAllSelect=function(searchData) {
        if(!searchData || !searchData.ORGANIZATION_OR_DOCTOR_NAME){
            return;
        }

        if(vm.organizationLevels){
            vm.organizationLevel=getIndexOrAdd({
                LEVEL:searchData.ORGANIZATION_LEVEL
            },vm.organizationLevels,'LEVEL');
        }else{
            contractReportService.getOrganizationLevel('', function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.organizationLevels = data;
                    vm.organizationLevel=getIndexOrAdd({
                        LEVEL:searchData.ORGANIZATION_LEVEL
                    },vm.organizationLevels,'LEVEL');
                }, function () {
                    $rootScope.alertDialog("获取机构级别失败");
                });
            }, function () {
                $rootScope.alertDialog("获取机构级别失败");
            });
        }



        if (lastLevel && lastLevel === searchData.ORGANIZATION_LEVEL) {
            vm.organizationName=getIndexOrAdd({
                ORGANIZATION_KEY_ID:searchData.ORGANIZATION_KEY_ID,
                ORGANIZATION_NAME:searchData.ORGANIZATION_NAME
            },vm.organizationNames,'ORGANIZATION_KEY_ID');
        }else{
            contractReportService.getOrganizationByLevel({
                ORGANIZATION_LEVEL: searchData.ORGANIZATION_LEVEL
            }, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.organizationNames = data;
                    vm.organizationName=getIndexOrAdd({
                        ORGANIZATION_KEY_ID:searchData.ORGANIZATION_KEY_ID,
                        ORGANIZATION_NAME:searchData.ORGANIZATION_NAME
                    },vm.organizationNames,'ORGANIZATION_KEY_ID');
                }, function () {
                    $rootScope.alertDialog("获取机构级别失败");
                });
            }, function () {
                $rootScope.alertDialog("获取机构级别失败");
            });
        }

        if(searchData.FAMILY_DOCTOR_KEY_ID){
            vm.searchObject='1';

            if (lastOrganization && lastOrganization === searchData.ORGANIZATION_KEY_ID) {
                vm.doctorName=getIndexOrAdd({
                    FAMILY_DOCTOR_KEY_ID:searchData.FAMILY_DOCTOR_KEY_ID,
                    DOCTOR_NAME:searchData.ORGANIZATION_OR_DOCTOR_NAME
                },vm.doctorNames,'FAMILY_DOCTOR_KEY_ID');
            }else{
                contractReportService.getDoctorByOrganization({
                    ORGANIZATION_KEY_ID: searchData.ORGANIZATION_KEY_ID
                }, function (response) {
                    $rootScope.handleMessage(response, function (data) {
                        vm.doctorNames = data.DOCTOR_LIST;
                        vm.doctorName=getIndexOrAdd({
                            FAMILY_DOCTOR_KEY_ID:searchData.FAMILY_DOCTOR_KEY_ID,
                            DOCTOR_NAME:searchData.ORGANIZATION_OR_DOCTOR_NAME
                        },vm.doctorNames,'FAMILY_DOCTOR_KEY_ID');
                    }, function () {
                        $rootScope.alertDialog("获取医生列表失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取医生列表失败");
                });
            }
        }else{
            vm.searchObject='0';
        }

        lastLevel= searchData.ORGANIZATION_LEVEL;
        lastOrganization = searchData.ORGANIZATION_KEY_ID;


        function getIndexOrAdd(selectValue, selectList, compareKey) {
            if (selectList) {
                for (var i = 0; i < selectList.length; i++) {
                    if ((selectList[i][compareKey]+'') === (selectValue[compareKey]+'')) {
                        return selectList[i];
                    }
                }
                selectList[selectList.length] = selectValue;
                return selectList[selectList.length-1];
            } else {
                selectList = [selectValue];
                return selectList[0];
            }
        }
    };
    vm.changeSelect = function (index) {
        switch (index) {
            case 0:
                vm.organizationLevel = null;
                vm.organizationName = null;
                vm.doctorName = null;
                vm.searchOrganizationOrDoctor=null;
                break;
            case 1:
                vm.organizationName = null;
                vm.doctorName = null;
                vm.searchOrganizationOrDoctor=null;
                break;
            case 2:
                vm.doctorName = null;
                vm.searchOrganizationOrDoctor=null;
                break;
            default:
                vm.searchOrganizationOrDoctor=null;
                break;
        }
    };


    vm.resetChart=function () {
        vm.lastSearchParam=null;
        vm.isReset = true;
        vm.searchObject = null;
        vm.organizationLevel = null;
        vm.organizationName = null;
        vm.doctorName = null;
        vm.searchOrganizationOrDoctor = null;
        vm.organizationReportName = '';
        resetTime();
        if(vm.currentNavItem==='diabetes'){
            vm.showLeftMiddle={
                chart:true,
                date:true,
                more:true
            };
            vm.showLeftBottom={
                chart:true,
                date:true,
                more:false
            };
            vm.showRightTop={
                chart:true,
                date:false,
                more:true
            };
            vm.showRightMiddle={
                chart:false,
                date:false,
                more:false
            };
            vm.showRightBottom={
                chart:true,
                date:false,
                more:false
            };
        }else if(vm.currentNavItem==='hypertension'){
            vm.showLeftMiddle={
                chart:true,
                date:true,
                more:true
            };
            vm.showLeftBottom={
                chart:true,
                date:true,
                more:false
            };
            vm.showRightTop={
                chart:true,
                date:false,
                more:true
            };
            vm.showRightMiddle={
                chart:true,
                date:false,
                more:false
            };
            vm.showRightBottom={
                chart:true,
                date:false,
                more:false
            };
        }
        getResetAllData(vm.currentNavItem);

    };

    vm.searchChart=function () {
        vm.isSearching=true;
        if ((!vm.searchOrganizationOrDoctor || !vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID) && (!vm.searchObject || (vm.searchObject === '0' && !vm.organizationName) || (vm.searchObject === '1' && !vm.doctorName))) {
            $rootScope.alertDialog("请输入正确的筛选条件！");
            vm.isSearching = false;
            return;
        }
        if(vm.currentNavItem==='diabetes'){

            vm.showLeftMiddle={
                chart:false,
                date:true,
                more:true
            };
            vm.showLeftBottom={
                chart:true,
                date:true,
                more:false
            };
            vm.showRightTop={
                chart:false,
                date:false,
                more:true
            };
            vm.showRightMiddle={
                chart:true,
                date:true,
                more:false
            };
            vm.showRightBottom={
                chart:true,
                date:false,
                more:false
            };
        }else if(vm.currentNavItem==='hypertension'){
            vm.showLeftMiddle={
                chart:true,
                date:true,
                more:false
            };
            vm.showLeftBottom={
                chart:true,
                date:true,
                more:false
            };
            vm.showRightTop={
                chart:false,
                date:false,
                more:false
            };
            vm.showRightMiddle={
                chart:true,
                date:false,
                more:false
            };
            vm.showRightBottom={
                chart:true,
                date:false,
                more:false
            };
        }
        getSearchData(vm.currentNavItem);

    };

    vm.changeNavItem=function (type) {
        if(type===vm.currentNavItem){
            return;
        }
        resetTime();
        if(!vm.lastSearchParam && type==='diabetes'){
            vm.isReset=true;
            vm.showLeftMiddle={
                chart:true,
                date:true,
                more:true
            };
            vm.showLeftBottom={
                chart:true,
                date:true,
                more:false
            };
            vm.showRightTop={
                chart:true,
                date:false,
                more:true
            };
            vm.showRightMiddle={
                chart:false,
                date:false,
                more:false
            };
            vm.showRightBottom={
                chart:true,
                date:false,
                more:false
            };
            getResetAllData(type);
        }else if(!vm.lastSearchParam && type!=='diabetes'){
            vm.isReset=true;
            vm.showLeftMiddle={
                chart:true,
                date:true,
                more:true
            };
            vm.showLeftBottom={
                chart:true,
                date:true,
                more:false
            };
            vm.showRightTop={
                chart:true,
                date:false,
                more:true
            };
            vm.showRightMiddle={
                chart:true,
                date:false,
                more:false
            };
            vm.showRightBottom={
                chart:true,
                date:false,
                more:false
            };
            getResetAllData(type);
        }else if(vm.lastSearchParam && type==='diabetes'){
            vm.isSearching=true;
            vm.showLeftMiddle={
                chart:false,
                date:true,
                more:true
            };
            vm.showLeftBottom={
                chart:true,
                date:true,
                more:false
            };
            vm.showRightTop={
                chart:false,
                date:false,
                more:true
            };
            vm.showRightMiddle={
                chart:true,
                date:true,
                more:false
            };
            vm.showRightBottom={
                chart:true,
                date:false,
                more:false
            };
            getSearchData(type);
        }else if(vm.lastSearchParam && type!=='diabetes'){
            vm.isSearching=true;
            vm.showLeftMiddle={
                chart:true,
                date:true,
                more:false
            };
            vm.showLeftBottom={
                chart:true,
                date:true,
                more:false
            };
            vm.showRightTop={
                chart:false,
                date:false,
                more:false
            };
            vm.showRightMiddle={
                chart:true,
                date:false,
                more:false
            };
            vm.showRightBottom={
                chart:true,
                date:false,
                more:false
            };
            getSearchData(type);
        }
    };

    vm.moreInfo=function (value) {
        $state.go('main.report.keyPopulationDetailReport',{
            DETAIL_CHART_TYPE:vm.currentNavItem,
            DETAIL_CHART_VALUE:value
        });
    };
    
    function getResetAllData(type) {
        if(type==='diabetes'){
            keyPopulationReportService.getAllDiabetesData({
                SEARCH_TIME:vm.nowYear,
                SEARCH_YEAR_MONTH:$filter('commonDate')(new Date(vm.nowYear+'-'+vm.nowMonth))
            }, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.isLevel=data.ORGANIZATION_LEVEL;
                    vm.diabetesTotal=data.DIABETES_DATA.DIABETES_TOTAL||0;
                    vm.followupTotal=data.DIABETES_DATA.FOLLOW_UP_TOTAL||0;
                    vm.followupAverage=data.DIABETES_DATA.RESIDENT_FOLLOW_UP_ED_AVERAGE||0;
                    vm.averageTime=data.DIABETES_DATA.DIABETES_AVERAGE||0;
                    vm.doctorManageAverage=data.DIABETES_DATA.DOCTOR_PER_RESIDENT_MANAGEMENT||0;
                    drawLeftMiddle(data,'diabetes');
                    drawLeftBottom(data,'diabetes');
                    drawRightTop(data,'diabetes');
                    drawRightBottom(data,'diabetes');
                    vm.isReset = false;
                }, function () {
                    $rootScope.alertDialog("获取报表初始化数据失败");
                    vm.isReset = false;
                });
            },function () {
                $rootScope.alertDialog("获取报表初始化数据失败");
                vm.isReset = false;
            });
        }else{
            keyPopulationReportService.getAllHypertensionData({
                SEARCH_TIME:vm.nowYear,
                SEARCH_YEAR_MONTH:$filter('commonDate')(new Date(vm.nowYear+'-'+vm.nowMonth))
            }, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.isLevel=data.ORGANIZATION_LEVEL;
                    vm.hypertensionTotal=data.HYPERTENSION_DATA.HYPERTENSION_TOTAL||0;
                    vm.followupHypertensionTotal=data.HYPERTENSION_DATA.FOLLOW_UP_TOTAL||0;
                    vm.hypertensionDoctorAverage=data.HYPERTENSION_DATA.DOCTOR_PER_RESIDENT_MANAGEMENT||0;
                    vm.hypertensionFollowupAverage=data.HYPERTENSION_DATA.RESIDENT_FOLLOW_UP_ED_AVERAGE||0;
                    vm.hypertensionAverageTime=data.HYPERTENSION_DATA.DIABETES_AVERAGE||0;
                    vm.manageNumber_1=data.HYPERTENSION_DATA.GRADING_MANAGEMENT_1||0;
                    vm.manageNumber_2=data.HYPERTENSION_DATA.GRADING_MANAGEMENT_2||0;
                    vm.manageNumber_3=data.HYPERTENSION_DATA.GRADING_MANAGEMENT_3||0;
                    vm.bloodPressure_1=data.HYPERTENSION_DATA.BLOOD_PRESSURE_GRADING_1||0;
                    vm.bloodPressure_2=data.HYPERTENSION_DATA.BLOOD_PRESSURE_GRADING_2||0;
                    vm.bloodPressure_3=data.HYPERTENSION_DATA.BLOOD_PRESSURE_GRADING_3||0;
                    drawLeftMiddle(data,'hypertension');
                    drawLeftBottom(data,'hypertension');
                    drawRightTop(data,'hypertension');
                    drawRightMiddle(data,'hypertension');
                    drawRightBottom(data,'hypertension');
                    vm.isReset = false;
                }, function () {
                    $rootScope.alertDialog("获取报表初始化数据失败");
                    vm.isReset = false;
                });
            },function () {
                $rootScope.alertDialog("获取报表初始化数据失败");
                vm.isReset = false;
            });
        }
    }

    function getSearchData(type) {
        var param={
            SEARCH_TIME:vm.nowYear,
            SEARCH_YEAR_MONTH:$filter('commonDate')(new Date(vm.nowYear+'-'+vm.nowMonth))
        };
        if (vm.searchOrganizationOrDoctor && vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID && !vm.searchOrganizationOrDoctor.FAMILY_DOCTOR_KEY_ID) {
            param.ORGANIZATION_KEY_ID = vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID;
        } else if (vm.searchOrganizationOrDoctor && vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID && vm.searchOrganizationOrDoctor.FAMILY_DOCTOR_KEY_ID) {
            param.ORGANIZATION_KEY_ID = vm.searchOrganizationOrDoctor.ORGANIZATION_KEY_ID;
            param.FAMILY_DOCTOR_KEY_ID = vm.searchOrganizationOrDoctor.FAMILY_DOCTOR_KEY_ID;
        } else if (vm.searchObject === '0') {
            param.ORGANIZATION_KEY_ID = vm.organizationName.ORGANIZATION_KEY_ID;
        } else {
            param.ORGANIZATION_KEY_ID = vm.organizationName.ORGANIZATION_KEY_ID;
            param.FAMILY_DOCTOR_KEY_ID = vm.doctorName.FAMILY_DOCTOR_KEY_ID;
        }
        vm.organizationReportName=vm.organizationName.ORGANIZATION_NAME;
        vm.lastSearchParam=param;

        if(type==='diabetes'){
            vm.refreshRightMiddle();
            keyPopulationReportService.getAllDiabetesData(param, function (response) {
                $rootScope.handleMessage(response, function (data) {

                    vm.diabetesTotal=data.DIABETES_DATA.DIABETES_TOTAL||0;
                    vm.followupTotal=data.DIABETES_DATA.FOLLOW_UP_TOTAL||0;
                    vm.followupAverage=data.DIABETES_DATA.RESIDENT_FOLLOW_UP_ED_AVERAGE||0;
                    vm.averageTime=data.DIABETES_DATA.DIABETES_AVERAGE||0;
                    vm.doctorManageAverage=data.DIABETES_DATA.DOCTOR_PER_RESIDENT_MANAGEMENT||0;
                    drawLeftMiddle(data,'diabetes');
                    drawLeftBottom(data,'diabetes');
                    drawRightTop(data,'diabetes');
                    drawRightBottom(data,'diabetes');
                    vm.isSearching=false;
                }, function () {
                    $rootScope.alertDialog("查询报表数据失败");
                    vm.isSearching=false;
                });
            },function () {
                $rootScope.alertDialog("查询报表数据失败");
                vm.isSearching=false;
            });
        }else{
            vm.refreshLeftMiddle('hypertension');
            keyPopulationReportService.getAllHypertensionData(param, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    vm.isLevel=data.ORGANIZATION_LEVEL;
                    vm.hypertensionTotal=data.HYPERTENSION_DATA.HYPERTENSION_TOTAL||0;
                    vm.followupHypertensionTotal=data.HYPERTENSION_DATA.FOLLOW_UP_TOTAL||0;
                    vm.hypertensionDoctorAverage=data.HYPERTENSION_DATA.DOCTOR_PER_RESIDENT_MANAGEMENT||0;
                    vm.hypertensionFollowupAverage=data.HYPERTENSION_DATA.RESIDENT_FOLLOW_UP_ED_AVERAGE||0;
                    vm.hypertensionAverageTime=data.HYPERTENSION_DATA.DIABETES_AVERAGE||0;
                    vm.manageNumber_1=data.HYPERTENSION_DATA.GRADING_MANAGEMENT_1||0;
                    vm.manageNumber_2=data.HYPERTENSION_DATA.GRADING_MANAGEMENT_2||0;
                    vm.manageNumber_3=data.HYPERTENSION_DATA.GRADING_MANAGEMENT_3||0;
                    vm.bloodPressure_1=data.HYPERTENSION_DATA.BLOOD_PRESSURE_GRADING_1||0;
                    vm.bloodPressure_2=data.HYPERTENSION_DATA.BLOOD_PRESSURE_GRADING_2||0;
                    vm.bloodPressure_3=data.HYPERTENSION_DATA.BLOOD_PRESSURE_GRADING_3||0;
                    drawLeftBottom(data,'hypertension');
                    drawRightTop(data,'hypertension');
                    drawRightMiddle(data,'hypertension');
                    drawRightBottom(data,'hypertension');
                    vm.isSearching = false;
                }, function () {
                    $rootScope.alertDialog("获取报表数据失败");
                    vm.isSearching = false;
                });
            },function () {
                $rootScope.alertDialog("获取报表数据失败");
                vm.isSearching = false;
            });
        }
    }
    
    function resetTime() {
        vm.leftMiddleYear=vm.nowYear+'';
        vm.leftMiddleMonth=vm.nowMonth+'';
        vm.leftBottomYear=vm.nowYear+'';
        vm.rightTopYear=vm.nowYear+'';
        vm.rightTopMonth=vm.nowMonth+'';
        vm.rightMiddleYear=vm.nowYear+'';
        vm.rightMiddleMonth=vm.nowMonth+'';
        vm.rightBottomYear=vm.nowYear+'';
        vm.rightBottomMonth=vm.nowMonth+'';
    }


    vm.changeRightMiddleYear=function() {
        vm.rightMiddleMonth='01';
        vm.refreshRightMiddle();
    };

    vm.changeLeftMiddleYear=function() {
        vm.leftMiddleMonth='01';
        vm.refreshLeftMiddle();
    };

    vm.refreshRightMiddle=function() {
        var param=vm.lastSearchParam||{};
        param.SEARCH_YEAR_MONTH=vm.rightMiddleYear+'-'+vm.rightMiddleMonth+'-01';
        keyPopulationReportService.getGlucoseAndWarningData(param, function (response) {
            $rootScope.handleMessage(response, function (data) {
                drawRightMiddle(data,vm.currentNavItem);
            }, function () {
                $rootScope.alertDialog("获取月度稳定人数与预警人数失败");
            });
        },function () {
            $rootScope.alertDialog("获取月度稳定人数与预警人数失败");
        });

    };

    vm.refreshLeftMiddle=function(type) {
        var param=vm.lastSearchParam||{};
        param.SEARCH_YEAR_MONTH=vm.leftMiddleYear+'-'+vm.leftMiddleMonth+'-01'
        if((type && type==='hypertension') || vm.currentNavItem==='hypertension'){
            keyPopulationReportService.getHBPGlucoseAndWarningData(param, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    drawLeftMiddle(data,vm.currentNavItem);
                }, function () {
                    $rootScope.alertDialog("获取月度稳定人数与预警人数失败");
                });
            },function () {
                $rootScope.alertDialog("获取月度稳定人数与预警人数失败");
            });
        }else{
            keyPopulationReportService.getGlucoseAndWarningData(param, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    drawLeftMiddle(data,vm.currentNavItem);
                }, function () {
                    $rootScope.alertDialog("获取月度稳定人数与预警人数失败");
                });
            },function () {
                $rootScope.alertDialog("获取月度稳定人数与预警人数失败");
            });
        }
    };

    vm.refreshLeftBottom=function () {
        var param=vm.lastSearchParam||{};
        param.SEARCH_TIME=vm.leftBottomYear;
        if(vm.currentNavItem==='hypertension') {
            keyPopulationReportService.getPerMonthHypertensionData(param, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    drawLeftBottom(data,vm.currentNavItem);
                }, function () {
                    $rootScope.alertDialog("获取每月新增糖尿病患者数据失败");
                });
            },function () {
                $rootScope.alertDialog("获取每月新增糖尿病患者数据失败");
            });
        }else{
            keyPopulationReportService.getPerMonthDiabetesData(param, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    drawLeftBottom(data,vm.currentNavItem);
                }, function () {
                    $rootScope.alertDialog("获取每月新增高血压患者数据失败");
                });
            },function () {
                $rootScope.alertDialog("获取每月新增高血压患者数据失败");
            });
        }
    };


    function drawLeftMiddle(chartData,type) {
        if (!vm.showLeftMiddle.chart) {
            return;
        }

        var axisList = [];
        var axisValueList_1 = [];
        var axisValueList_2 = [];

        if (type='hypertension' && vm.lastSearchParam) {
            if (!chartData.GLUCOSE_AND_WARNING) {
                chartData.GLUCOSE_AND_WARNING = [{}];
            }

            vm.leftMiddle={
                color:['#1d4fdc','#ff6b6b'],
                title : {
                    text: '月度血压稳定与预警人数数据',
                    x:'left'
                },
                tooltip : {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                series : [
                    {
                        name: '高血压患者',
                        type: 'pie',
                        radius : '55%',
                        center: ['50%', '60%'],
                        data:[
                            {value:chartData.GLUCOSE_AND_WARNING[0].STABLE_COUNT||0, name:'稳定人数'},
                            {value:chartData.GLUCOSE_AND_WARNING[0].UNSTABLE_COUNT||0, name:'预警人数'}
                        ],
                        label: {
                            normal: {
                                formatter:function(val){
                                    return val.name+'-'+val.percent+'%';
                                }
                            }
                        },
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };
        } else {
            if (!chartData.GLUCOSE_AND_WARNING) {
                chartData.GLUCOSE_AND_WARNING = [];
            }

            for (var i = 0; i < chartData.GLUCOSE_AND_WARNING.length; i++) {
                axisList.push(chartData.GLUCOSE_AND_WARNING[i].ORGANIZATION_NAME);
                axisValueList_1.push(chartData.GLUCOSE_AND_WARNING[i].UNSTABLE_COUNT || 0);
                axisValueList_2.push(chartData.GLUCOSE_AND_WARNING[i].STABLE_COUNT || 0);
            }

            vm.leftMiddle = {
                color:['#1d4fdc','#ff6b6b'],
                title: {
                    text: type === 'diabetes' ? '辖区内各机构本月血糖稳定及预警人数' : '辖区内各机构本月血压稳定及预警人数',
                    x: 'left'

                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                        type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                    }
                },
                legend: {
                    orient: 'vertical',
                    data: ['预警人数', '稳定人数'],
                    x: 'right'
                },
                grid: {
                    left: '8%',
                    right: '4%',
                    bottom: '16%',
                    containLabel: true
                },
                xAxis: [
                    {
                        type: 'category',
                        data: axisList,
                        axisLabel: {
                            interval: 0,
                            rotate: 30,
                            formatter: function (value) {
                                if (value && value.length > 10) {
                                    return value.substring(0, 10) + "...";
                                }
                                return value;
                            }
                        }
                    }
                ],
                yAxis: [
                    {
                        type: 'value',
                        minInterval: 1
                    }
                ],
                series: [
                    {
                        name: '稳定人数',
                        type: 'bar',
                        stack: type === 'diabetes' ? '糖尿病人数' : '高血压人数',
                        data: axisValueList_2
                    },
                    {
                        name: '预警人数',
                        type: 'bar',
                        stack: type === 'diabetes' ? '糖尿病人数' : '高血压人数',
                        data: axisValueList_1
                    }
                ]
            };
        }
    }

    function drawLeftBottom(chartData,type) {
        if(!vm.showLeftBottom.chart){
            return;
        }

        var axisList=[];
        var axisValueList=[];

        if(type==='diabetes') {
            for (var i = 0,j=0; i < chartData.TIME_LIST.length; i++) {
                axisList.push( chartData.TIME_LIST[i].TIME+'月');
                if(j<chartData.PER_MONTH_DIABETES_DATA.length && chartData.PER_MONTH_DIABETES_DATA[j].ADD_TIME===chartData.TIME_LIST[i].TIME){
                    axisValueList.push(chartData.PER_MONTH_DIABETES_DATA[j].DIABETES_TOTAL);
                    j++;
                }else{
                    axisValueList.push(0);
                }
            }

            vm.leftBottom={
                title: {
                    text: '每月新增糖尿病人数'
                },
                tooltip : {
                    trigger: 'axis'
                },
                legend: {
                    data:['新增糖尿病人数'],
                    orient: 'vertical',
                    x:'right'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis : [
                    {
                        type : 'category',
                        boundaryGap : false,
                        data : axisList,
                        axisLabel: {
                            interval: 0
                        }
                    }
                ],
                yAxis : [
                    {
                        type : 'value',
                        minInterval: 1
                    }
                ],
                series : [
                    {
                        name:'新增糖尿病人数',
                        type:'line',
                        label: {
                            normal: {
                                show: true,
                                textStyle:{
                                    color:'#000'
                                }
                            }
                        },
                        data:axisValueList
                    }
                ]
            };
        }else {
            for (var i = 0,j=0; i < chartData.TIME_LIST.length; i++) {
                axisList.push( chartData.TIME_LIST[i].TIME+'月');
                if(j<chartData.PER_MONTH_HYPERTENSION_DATA.length && chartData.PER_MONTH_HYPERTENSION_DATA[j].ADD_TIME===chartData.TIME_LIST[i].TIME){
                    axisValueList.push(chartData.PER_MONTH_HYPERTENSION_DATA[j].HYPERTENSION_TOTAL);
                    j++;
                }else{
                    axisValueList.push(0);
                }
            }

            vm.leftBottom={
                title: {
                    text: '每月新增高血压人数'
                },
                tooltip : {
                    trigger: 'axis'
                },
                legend: {
                    data:['新增高血压人数'],
                    orient: 'vertical',
                    x:'right'
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis : [
                    {
                        type : 'category',
                        boundaryGap : false,
                        data : axisList,
                        axisLabel: {
                            interval: 0
                        }
                    }
                ],
                yAxis : [
                    {
                        type : 'value',
                        minInterval: 1
                    }
                ],
                series : [
                    {
                        name:'新增高血压人数',
                        type:'line',
                        label: {
                            normal: {
                                show: true,
                                textStyle:{
                                    color:'#000'
                                }
                            }
                        },
                        data:axisValueList
                    }
                ]
            };
        }
    }

    function drawRightTop(chartData,type) {
        if(!vm.showRightTop.chart || vm.isLevel==='0'){
            return;
        }
        var total=0;
        var axisList=[];
        var axisValueList=[];

        if(type==='diabetes') {
            for (var i = 0; i < chartData.ODP_DISTRIBUTION_DATA.length; i++) {
                axisList.push(chartData.ODP_DISTRIBUTION_DATA[i].ORGANIZATION_NAME);
                axisValueList.push({
                    value:chartData.ODP_DISTRIBUTION_DATA[i].SUB_DIABETES_TOTAL||0,
                    name:chartData.ODP_DISTRIBUTION_DATA[i].ORGANIZATION_NAME
                });
                total=total+chartData.ODP_DISTRIBUTION_DATA[i].SUB_DIABETES_TOTAL||0;
            }
            if(total!==vm.diabetesTotal){
                axisList.push('其他');
                axisValueList.push({
                    value:(vm.diabetesTotal-total),
                    name:'其他'
                });
            }
            vm.rightTop={
                title : {
                    text: '辖区内各机构糖尿病人群分布',
                    x:'center'
                },
                tooltip : {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                series : [
                    {
                        name: '糖尿病人群分布',
                        type: 'pie',
                        radius : '55%',
                        center: ['50%', '60%'],
                        label: {
                            normal: {
                                formatter:function(val){
                                    return val.name+'-'+val.percent+'%';
                                }
                            }
                        },
                        data:axisValueList,
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };
        }else {
            for (var i = 0; i < chartData.OHP_DISTRIBUTION_DATA.length; i++) {
                axisList.push(chartData.OHP_DISTRIBUTION_DATA[i].ORGANIZATION_NAME);
                axisValueList.push({
                    value:chartData.OHP_DISTRIBUTION_DATA[i].SUB_HYPERTENSION_TOTAL||0,
                    name:chartData.OHP_DISTRIBUTION_DATA[i].ORGANIZATION_NAME
                });
                total=total+chartData.OHP_DISTRIBUTION_DATA[i].SUB_HYPERTENSION_TOTAL||0;
            }
            if(total!==vm.hypertensionTotal){
                axisList.push('其他');
                axisValueList.push({
                    value:(vm.hypertensionTotal-total),
                    name:'其他'
                });
            }
            vm.rightTop={
                title : {
                    text: '辖区内各机构高血压人群分布',
                    x:'center'
                },
                tooltip : {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                series : [
                    {
                        name: '高血压人群分布',
                        type: 'pie',
                        radius : '55%',
                        center: ['50%', '60%'],
                        label: {
                            normal: {
                                formatter:function(val){
                                    return val.name+'-'+val.percent+'%';
                                }
                            }
                        },
                        data:axisValueList,
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };
        }
    }

    function drawRightMiddle(chartData,type) {
        if(!vm.showRightMiddle.chart){
            return;
        }

        if(type==='diabetes') {
            if(!chartData.GLUCOSE_AND_WARNING){
                chartData.GLUCOSE_AND_WARNING=[{}];
            }
            vm.rightMiddle={
                title : {
                    text: '月度血糖稳定与预警人数数据',
                    x:'left'
                },
                tooltip : {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                series : [
                    {
                        name: '糖尿病患者',
                        type: 'pie',
                        radius : '55%',
                        center: ['50%', '60%'],
                        data:[
                            {value:chartData.GLUCOSE_AND_WARNING[0].STABLE_COUNT||0, name:'稳定人数'},
                            {value:chartData.GLUCOSE_AND_WARNING[0].UNSTABLE_COUNT||0, name:'预警人数'}
                        ],
                        label: {
                            normal: {
                                formatter:function(val){
                                    return val.name+'-'+val.percent+'%';
                                }
                            }
                        },
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };
        }else{
            if(!chartData.HBP_DISTRIBUTION){
                chartData.HBP_DISTRIBUTION={};
            }
            var dataList=[{
                value:chartData.HBP_DISTRIBUTION.BLOOD_PRESSURE_GRADING_1||0,
                name:'一级高血压人数'
            },{
                value:chartData.HBP_DISTRIBUTION.BLOOD_PRESSURE_GRADING_2||0,
                name:'二级高血压人数'
            },{
                value:chartData.HBP_DISTRIBUTION.BLOOD_PRESSURE_GRADING_3||0,
                name:'三级高血压人数'
            }];

            vm.rightMiddle={
                title : {
                    text: '高血压人群血压级别分布',
                    x:'left'
                },
                tooltip : {
                    trigger: 'item',
                    formatter: "{a} <br/>{b} : {c} ({d}%)"
                },
                series : [
                    {
                        name: '高血压人群',
                        type: 'pie',
                        radius : '55%',
                        center: ['50%', '60%'],
                        data:dataList,
                        label: {
                            normal: {
                                formatter:function(val){
                                    return val.name+'-'+val.percent+'%';
                                }
                            }
                        },
                        itemStyle: {
                            emphasis: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };
        }
    }

    function drawRightBottom(chartData,type) {
        if(!vm.showRightBottom.chart){
            return;
        }

        if(type==='diabetes') {
            if(!chartData.DIABETES_FACTORS){
                chartData.DIABETES_FACTORS={};
            }
            vm.rightBottom={
                color: ['#3398DB'],
                title : {
                    text: '相关人群生活状态统计'
                },
                tooltip : {
                    trigger: 'axis',
                    axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                        type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis : [
                    {
                        type : 'category',
                        data : ['吸烟', '饮酒', '超重', '肥胖', '规律运动'],
                        axisTick: {
                            alignWithLabel: true
                        },
                        axisLabel: {
                            interval: 0
                        }
                    }
                ],
                yAxis : [
                    {
                        type : 'value',
                        minInterval: 1
                    }
                ],
                series : [
                    {
                        name:'人数',
                        type:'bar',
                        barWidth: '60%',
                        data:[chartData.DIABETES_FACTORS.SMOKING||0,
                            chartData.DIABETES_FACTORS.DRINK||0,
                            chartData.DIABETES_FACTORS.OVERWEIGHT||0,
                            chartData.DIABETES_FACTORS.OBESITY||0,
                            chartData.DIABETES_FACTORS.REGULAR_MOVEMENT||0]
                    }
                ]
            };
        }else{
            if(!chartData.HYPERTENSION_FACTORS){
                chartData.HYPERTENSION_FACTORS={};
            }
            vm.rightBottom={
                color: ['#3398DB'],
                title : {
                    text: '高血压因素统计情况'
                },
                tooltip : {
                    trigger: 'axis',
                    axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                        type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis : [
                    {
                        type : 'category',
                        data : ['吸烟', '饮酒', '超重', '肥胖', '低盐饮食'],
                        axisTick: {
                            alignWithLabel: true
                        },
                        axisLabel: {
                            interval: 0
                        }
                    }
                ],
                yAxis : [
                    {
                        type : 'value',
                        minInterval: 1
                    }
                ],
                series : [
                    {
                        name:'人数',
                        type:'bar',
                        barWidth: '60%',
                        data:[chartData.HYPERTENSION_FACTORS.SMOKING||0,
                            chartData.HYPERTENSION_FACTORS.DRINK||0,
                            chartData.HYPERTENSION_FACTORS.OVERWEIGHT||0,
                            chartData.HYPERTENSION_FACTORS.OBESITY||0,
                            chartData.HYPERTENSION_FACTORS.LOW_SALT_DIET||0]
                    }
                ]
            };
        }
    }
    keyPopulationReportService.getSysDate('', function (response) {
        $rootScope.handleMessage(response, function (data) {
            vm.nowYear=new Date(data).getFullYear()+'';
            vm.nowMonth=new Date(data).getMonth()+1;
            for(var i=2015;i<=vm.nowYear;i++){
                vm.years.push(i);
            }
            vm.resetChart();
            vm.resetChart();
        }, function () {
            $rootScope.alertDialog("获取服务器时间失败");
            vm.nowYear=new Date().getFullYear()+'';
            vm.nowMonth=new Date().getMonth()+1;
            for(var i=2015;i<=vm.nowYear;i++){
                vm.years.push(i);
            }
        });
    },function () {
        $rootScope.alertDialog("获取服务器时间失败");
        vm.nowYear=new Date().getFullYear()+'';
        vm.nowMonth=new Date().getMonth()+1;
        for(var i=2015;i<=vm.nowYear;i++){
            vm.years.push(i);
        }
    });
    return vm;
}
"use strict";
SMS.SERVICES.service('keyPopulationReportService', keyPopulationReportService);
keyPopulationReportService.$inject = ['Report','bootstrapTable','$rootScope'];
function keyPopulationReportService(Report,bootstrapTable,$rootScope) {
    var vm = this;

    vm.getAllDiabetesData = function (param, successFunction, failedFunction) {
        Report.getAllDiabetesData(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getGlucoseAndWarningData = function (param, successFunction, failedFunction) {
        Report.getGlucoseAndWarningData(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getHBPGlucoseAndWarningData = function (param, successFunction, failedFunction) {
        Report.getHBPGlucoseAndWarningData(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getPerMonthDiabetesData = function (param, successFunction, failedFunction) {
        Report.getPerMonthDiabetesData(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getAllHypertensionData = function (param, successFunction, failedFunction) {
        Report.getAllHypertensionData(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getSysDate = function (param, successFunction, failedFunction) {
        Report.getSysDate(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getPerMonthHypertensionData = function (param, successFunction, failedFunction) {
        Report.getPerMonthHypertensionData(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getMoreGlucoseAndWarningData = function (param, successFunction, failedFunction) {
        Report.getMoreGlucoseAndWarningData(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getMoreHBPGlucoseAndWarningData = function (param, successFunction, failedFunction) {
        Report.getMoreHBPGlucoseAndWarningData(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getMoreODPDistributionData = function (param, successFunction, failedFunction) {
        Report.getMoreODPDistributionData(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getMoreOHPDistributionData = function (param, successFunction, failedFunction) {
        Report.getMoreOHPDistributionData(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };
    
    vm.getPageGlucoseAndWarningData = function ($vm, listPara) {
        var list = {
            dataFunction: getDataList,
            dataParams: listPara,
            columns: [{
                field: 'ORGANIZATION_NAME',
                title: '机构名称',
                align: 'center'
            }, {
                field: 'STABLE_COUNT',
                title: '血糖稳定人数',
                align: 'center'
            }, {
                field: 'UNSTABLE_COUNT',
                title: '血糖预警人数',
                align: 'center'
            }, {
                field: 'DIABETES_PERSENT',
                title: '预警比例',
                align: 'center',
                sortable:true,
                formatter:function (value,row) {
                    if(row.STABLE_COUNT===0 && row.UNSTABLE_COUNT===0){
                        return '-';
                    }
                    return (row.UNSTABLE_COUNT*100/(row.STABLE_COUNT+row.UNSTABLE_COUNT)).toFixed(2)+'%';
                }
            }]
        };

        function getDataList(param, successFunction, failedFunction) {
            Report.getPageGlucoseAndWarningData(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };

    vm.getPageHBPGlucoseAndWarningData = function ($vm, listPara) {
        var list = {
            dataFunction: getDataList,
            dataParams: listPara,
            columns: [{
                field: 'ORGANIZATION_NAME',
                title: '机构名称',
                align: 'center'
            }, {
                field: 'STABLE_COUNT',
                title: '血压稳定人数',
                align: 'center'
            }, {
                field: 'UNSTABLE_COUNT',
                title: '血压预警人数',
                align: 'center'
            }, {
                field: 'HYPERTENSION_PERSENT',
                title: '预警比例',
                align: 'center',
                sortable:true,
                formatter:function (value,row) {
                    if(row.STABLE_COUNT===0 && row.UNSTABLE_COUNT===0){
                        return '-';
                    }
                    return (row.UNSTABLE_COUNT*100/(row.STABLE_COUNT+row.UNSTABLE_COUNT)).toFixed(2)+'%';
                }
            }]
        };

        function getDataList(param, successFunction, failedFunction) {
            Report.getPageHBPGlucoseAndWarningData(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };

    vm.getPageODPDistributionData=function ($vm, listPara) {
        var list = {
            dataFunction: getDataList,
            dataParams: listPara,
            columns: [{
                field: 'ORGANIZATION_NAME',
                title: '机构名称',
                align: 'center'
            }, {
                field: 'SUB_DIABETES_TOTAL',
                title: '糖尿病人群数',
                align: 'center'
            }, {
                field: 'DIABETES_PERSENT',
                title: '所占比例',
                align: 'center',
                sortable:true,
                formatter:function (value) {
                    if(value){
                        return value+'%';
                    }
                    return "-";
                }
            }]
        };

        function getDataList(param, successFunction, failedFunction) {
            Report.getPageODPDistributionData(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };

    vm.getPageOHPDistributionData=function ($vm, listPara) {
        var list = {
            dataFunction: getDataList,
            dataParams: listPara,
            columns: [{
                field: 'ORGANIZATION_NAME',
                title: '机构名称',
                align: 'center'
            }, {
                field: 'SUB_HYPERTENSION_TOTAL',
                title: '高血压人群数',
                align: 'center'
            }, {
                field: 'HYPERTENSION_PERSENT',
                title: '所占比例',
                align: 'center',
                sortable:true,
                formatter:function (value) {
                    if(value){
                        return value+'%';
                    }
                    return "-";
                }
            }]
        };

        function getDataList(param, successFunction, failedFunction) {
            Report.getPageOHPDistributionData(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('familyArchivesAddCtrl', familyArchivesAddCtrl);
familyArchivesAddCtrl.$inject = ['$rootScope', '$state', '$mdPanel', '$filter', '$q', 'familyArchivesService'];
function familyArchivesAddCtrl($rootScope, $state, $mdPanel, $filter, $q, familyArchivesService) {
    var vm = this;
    vm.add = true;
    vm.editable = true;

    var lastprovince = null;
    var lastcity = null;
    var lastcounty = null;

    function definedData() {
        //初始化多选数组
        vm['familyAttributeSelected'] = [];
        vm['domesticApplianceTypeSelected'] = [];
        vm['vehicleTypeSelected'] = [];
        vm['refuseDisposalWaySelected'] = [];
        vm['sewageDisposalWaySelected'] = [];
        vm['recreationalSportsEquipmentTypeSelected'] = [];
        vm['memberList'] = [];
        //初始化单选
        //vm['livingType'] = {};
        //vm['residentType'] = {};
        vm['addressProvince'] = {};
        vm['addressCity'] = {};
        vm['addressCounty'] = {};
        vm['addressStreet'] = {};
        vm['familyAttribute'] = {};
        vm['houseType'] = {};
        vm['cookroomType'] = {};
        vm['kitchenVentilationSystem'] = {};
        vm['fuelType'] = {};
        vm['waterSource'] = {};
        vm['toiletType'] = {};
        vm['pinfoldPosition'] = {};
        vm['domesticApplianceType'] = {};
        vm['vehicleType'] = {};
        vm['economicConditionsType'] = {};
        vm['perCapitaAnnualIncome'] = {};
        vm['refuseDisposalWay'] = {};
        vm['sewageDisposalWay'] = {};
        vm['recreationalSportsEquipmentType'] = {};
    }

    var dict_type_code_list = [
        {
            "DICT_TYPE_CODE": "0007001",//居住类型
            "LIST_NAME": "livingTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007002",//常住类型
            "LIST_NAME": "residentTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007003",//户属性
            "LIST_NAME": "familyAttributeList"
        },
        {
            "DICT_TYPE_CODE": "0007004",//房屋分类
            "LIST_NAME": "houseTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007005",//厨房
            "LIST_NAME": "cookroomTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007006",//厨房排风措施
            "LIST_NAME": "kitchenVentilationSystemList"
        },
        {
            "DICT_TYPE_CODE": "0007007",//燃料类别
            "LIST_NAME": "fuelTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007008",//饮水
            "LIST_NAME": "waterSourceList"
        },
        {
            "DICT_TYPE_CODE": "0007009",//厕所
            "LIST_NAME": "toiletTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007010",//禽畜栏
            "LIST_NAME": "pinfoldPositionList"
        },
        {
            "DICT_TYPE_CODE": "0007011",//家用电器
            "LIST_NAME": "domesticApplianceTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007012",//交通工具
            "LIST_NAME": "vehicleTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007013",//经济状况
            "LIST_NAME": "economicConditionsTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007014",//家庭年人均收入
            "LIST_NAME": "perCapitaAnnualIncomeList"
        },
        {
            "DICT_TYPE_CODE": "0007015",//垃圾处理
            "LIST_NAME": "refuseDisposalWayList"
        },
        {
            "DICT_TYPE_CODE": "0007016",//污水处理
            "LIST_NAME": "sewageDisposalWayList"
        },
        {
            "DICT_TYPE_CODE": "0007017",//文体设备
            "LIST_NAME": "recreationalSportsEquipmentTypeList"
        },
        {
            "DICT_TYPE_CODE": "0014",//与户主关系类型
            "LIST_NAME": "householderRelationshipList"
        }
    ];

    definedData();
    getDictList();
    updateFamilyNumber();

    //获取字典表
    function getDictList() {
        $rootScope.commonService(
            'getDictList',
            {
                "DICT_TYPE_CODE_LIST": dict_type_code_list
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        eachDictValue(data);
                    },
                    function () {
                        $rootScope.alertDialog('获取字典列表失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取字典列表失败');
            }
        );
    }

    function transList2Key(list) {
        var templistA = [];
        var templistB = [];
        angular.forEach(list, function (item) {
            if (item['DICT_VALUE_CODE']) {
                templistA.push(item['DICT_VALUE_CODE']);
            }
            if (item['DICT_VALUE_NAME']) {
                templistB.push(item['DICT_VALUE_NAME']);
            }
        });
        return {
            "DICT_VALUE_CODE": templistA.join(','),
            "DICT_VALUE_NAME": templistB.join(',')
        };
    }

    //添加签约医生
    vm.addDoctor = function () {
        SMS.CONTROLLERS.controller('selectDoctorController', selectDoctorController);
        selectDoctorController.$inject = ['$rootScope', '$scope', 'mdPanelRef', '$filter', 'familyArchivesService'];
        function selectDoctorController($rootScope, $scope, mdPanelRef, $filter, familyArchivesService) {
            $scope.searched = false;
            function callback(row) {
                $scope.searched = true;
                familyArchivesService.getselectedDoctorList(
                    $scope,
                    {},
                    {
                        "total": 1,
                        "rows": [row]
                    }
                );
                $scope['row'] = row;
                $rootScope.getCurrentDateTime(
                    function (data) {
                        if (vm['beginTimeFormat'] === undefined) {
                            vm['beginTimeFormat'] = data;
                            vm['beginTime'] = $filter('commonDate')(vm['beginTimeFormat']);
                            var tempEndTime = new Date(new Date(vm['beginTimeFormat']).getTime());
                            tempEndTime.setFullYear(tempEndTime.getFullYear() + 1);
                            tempEndTime.setDate(tempEndTime.getDate() - 1);
                            vm['endTimeFormat'] = tempEndTime;
                            vm['endTime'] = $filter('commonDate')(vm['endTimeFormat']);
                        }
                        if ($scope['beginTime'] === undefined) {
                            $scope['beginTime'] = $filter('commonDate')(vm['beginTimeFormat'], 'yyyy年MM月dd日');
                            $scope['endTime'] = $filter('commonDate')(vm['endTimeFormat'], 'yyyy年MM月dd日');
                            $scope.$apply();
                        }
                    }
                );
                $scope.$apply();
            }

            $scope.hide = function () {
                mdPanelRef.close();
            };
            $scope.cancel = function () {
                mdPanelRef.close();
            };
            $scope.back = function () {
                $scope.searched = false;
            };
            $scope.addDoctor = function () {
                vm['responsibleDoctorId'] = $scope['row']['FAMILY_DOCTOR_KEY_ID'];//责任医生ID
                vm['responsibleDoctorName'] = $scope['row']['DOCTOR_NAME'];//责任医生姓名
                vm['hospitalName'] = $scope['row']['HOSPITAL_NAME'];//所属医院
                vm['doctorTitleName'] = $scope['row']['DOCTOR_TITLE_NAME'];//职称
                mdPanelRef.close();
            };
            $scope.search = function () {
                $scope.getDoctorList();
            };
            $scope.getDoctorList = function () {
                var params = {
                    "SEARCH_DOCTOR": $scope.searchValue
                };
                familyArchivesService.getDoctorList($scope, params, callback);
            };
            $scope.$on('panelClose',
                function () {
                    mdPanelRef.close();
                }
            );
        }

        var position = $mdPanel.newPanelPosition().absolute().center();
        var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
        var config = {
            animation: animation,
            attachTo: angular.element(document.body),
            controller: selectDoctorController,
            templateUrl: 'template/resident/familyArchives/selectDoctor.html',
            position: position,
            trapFocus: true,
            disableParentScroll: true,
            clickOutsideToClose: false,
            clickEscapeToClose: true,
            hasBackdrop: true,
            fullscreen: false
        };
        $mdPanel.open(config);
    };
    //添加家庭成员
    vm.addFamilyMember = function () {
        if (!vm['residentKeyId']) {
            $rootScope.alertDialog("请先添加户主信息,如:身份证");
            return;
        }
        if (vm['familyNumber'] === 99) {
            $rootScope.alertDialog("家庭人数超过限制，无法添加家庭成员");
            return;
        }
        SMS.CONTROLLERS.controller('selectFamilyMemberController', selectFamilyMemberController);
        selectFamilyMemberController.$inject = ['$rootScope', '$scope', 'mdPanelRef', 'familyArchivesService'];
        function selectFamilyMemberController($rootScope, $scope, mdPanelRef, familyArchivesService) {
            $scope.searched = false;
            $scope.add = true;
            $scope['householderRelationshipList'] = vm['householderRelationshipList'];
            function callback(row) {
                if (row.FAMILY_KEY_ID !== undefined
                    && row.FAMILY_KEY_ID !== null
                    && row.FAMILY_KEY_ID !== "") {
                    $rootScope.alertDialog("不能添加该居民，因为该居民已组建过家庭");
                    return;
                }
                if (row['RESIDENT_KEY_ID'] === vm['residentKeyId']) {
                    $rootScope.alertDialog("不能选择户主作为家庭成员");
                    return;
                }
                $scope.searched = true;
                familyArchivesService.getselectedFamilyMemberList(
                    $scope,
                    {},
                    {
                        "total": 1,
                        "rows": [row]
                    }
                );
                $scope['row'] = row;
                $scope['relationship'] = undefined;
                $scope.$apply();
            }

            $scope.hide = function () {
                mdPanelRef.close();
            };
            $scope.cancel = function () {
                mdPanelRef.close();
            };
            $scope.back = function (form) {
                form.$setPristine();
                form.$setUntouched();
                $scope.searched = false;
            };
            $scope.addFamilyMember = function () {
                if ($rootScope.selectIndex(vm['memberList'], "RESIDENT_KEY_ID", $scope['row']['RESIDENT_KEY_ID']) !== -1) {
                    $rootScope.alertDialog("已经添加过该成员，不能重复添加");
                    return;
                }
                var HOUSEHOLDER_RELATIONSHIP_CODE = $scope['relationship'] === null? '':$scope['relationship']['DICT_VALUE_CODE'];
                var HOUSEHOLDER_RELATIONSHIP_NAME = $scope['relationship'] === null? $scope['relationshipSearchText']:$scope['relationship']['DICT_VALUE_NAME'];
                $scope['row']['HOUSEHOLDER_RELATIONSHIP_CODE'] = HOUSEHOLDER_RELATIONSHIP_CODE;
                $scope['row']['HOUSEHOLDER_RELATIONSHIP_NAME'] = HOUSEHOLDER_RELATIONSHIP_NAME;
                $scope['row']['HOUSEHOLDER_SYMBOL'] = "0";
                vm['memberList'].push($scope['row']);
                updateFamilyNumber();
                mdPanelRef.close();
            };
            $scope.searchTextChange = function () {
                var result = $q.defer();
                //var searchList = $filter('filter')($scope['householderRelationshipList'], {'DICT_VALUE_NAME': search});//模糊搜索
                var searchList = $scope['householderRelationshipList'];
                result.resolve(searchList);
                return result.promise;
            };
            $scope.search = function () {
                $scope.getFamilyMemberList();
            };
            $scope.getFamilyMemberList = function () {
                var params = {
                    "SEARCH_RESIDENT": $scope.searchValue,
                    "RESIDENT_KEY_ID": vm['residentKeyId']
                };
                familyArchivesService.getFamilyMemberList($scope, params, callback);
            };
            $scope.$on('panelClose',
                function () {
                    mdPanelRef.close();
                }
            );
        }

        var position = $mdPanel.newPanelPosition().absolute().center();
        var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
        var config = {
            animation: animation,
            attachTo: angular.element(document.body),
            controller: selectFamilyMemberController,
            templateUrl: 'template/resident/familyArchives/selectFamilyMember.html',
            position: position,
            trapFocus: true,
            disableParentScroll: true,
            clickOutsideToClose: false,
            clickEscapeToClose: true,
            hasBackdrop: true,
            fullscreen: false
        };
        $mdPanel.open(config);
    };
    //查看家庭成员
    vm.viewFamilyMember = function (item) {
        if(!$rootScope.isShow('1003001002')){
            return;
        }
        $state.go('main.resident.residentArchivesSidebar.detail.residentArchivesEdit', {"RESIDENT_KEY_ID": item.RESIDENT_KEY_ID});
    };
    //添加编辑成员
    vm.editFamilyMember = function (item) {
        SMS.CONTROLLERS.controller('editFamilyMemberController', editFamilyMemberController);
        editFamilyMemberController.$inject = ['$rootScope', '$scope', 'mdPanelRef', 'familyArchivesService'];
        function editFamilyMemberController($rootScope, $scope, mdPanelRef, familyArchivesService) {
            $scope.searched = true;
            $scope.edit = true;
            $scope['householderRelationshipList'] = vm['householderRelationshipList'];
            item['FAMILY_KEY_ID'] = "-1";//改为已经组成家庭
            $scope['row'] = item;
            $scope['relationship'] = $rootScope.selectItem($scope['householderRelationshipList'], "DICT_VALUE_CODE", $scope['row']['HOUSEHOLDER_RELATIONSHIP_CODE']);
            if ($scope['relationship'] === undefined) {
                $scope['relationship'] = {
                    'DICT_VALUE_CODE': '',
                    'DICT_VALUE_NAME': $scope['row']['HOUSEHOLDER_RELATIONSHIP_NAME']
                };
            }
            familyArchivesService.getselectedFamilyMemberList(
                $scope,
                {},
                {
                    "total": 1,
                    "rows": [$scope['row']]
                }
            );
            $scope.hide = function () {
                mdPanelRef.close();
            };
            $scope.cancel = function () {
                mdPanelRef.close();
            };
            $scope.back = function (form) {
                form.$setPristine();
                form.$setUntouched();
                $scope.searched = false;
            };
            $scope.addFamilyMember = function () {
                var HOUSEHOLDER_RELATIONSHIP_CODE = $scope['relationship'] === null? '':$scope['relationship']['DICT_VALUE_CODE'];
                var HOUSEHOLDER_RELATIONSHIP_NAME = $scope['relationship'] === null? $scope['relationshipSearchText']:$scope['relationship']['DICT_VALUE_NAME'];
                $scope['row']['HOUSEHOLDER_RELATIONSHIP_CODE'] = HOUSEHOLDER_RELATIONSHIP_CODE;
                $scope['row']['HOUSEHOLDER_RELATIONSHIP_NAME'] = HOUSEHOLDER_RELATIONSHIP_NAME;
                $scope['row']['HOUSEHOLDER_SYMBOL'] = "0";
                vm['memberList'].push($scope['row']);
                mdPanelRef.close();
            };
            $scope.searchTextChange = function () {
                var result = $q.defer();
                //var searchList = $filter('filter')($scope['householderRelationshipList'], {'DICT_VALUE_NAME': search});//模糊搜索
                var searchList = $scope['householderRelationshipList'];
                result.resolve(searchList);
                return result.promise;
            };
            $scope.search = function () {
                $scope.getFamilyMemberList();
            };
            $scope.getFamilyMemberList = function () {
                var params = {
                    "SEARCH_RESIDENT": $scope.searchValue
                };
                familyArchivesService.getFamilyMemberList($scope, params, callback);
            };
            $scope.$on('panelClose',
                function () {
                    mdPanelRef.close();
                }
            );
        }

        var position = $mdPanel.newPanelPosition().absolute().center();
        var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
        var config = {
            animation: animation,
            attachTo: angular.element(document.body),
            controller: editFamilyMemberController,
            templateUrl: 'template/resident/familyArchives/selectFamilyMember.html',
            position: position,
            trapFocus: true,
            disableParentScroll: true,
            clickOutsideToClose: false,
            clickEscapeToClose: true,
            hasBackdrop: true,
            fullscreen: false
        };
        $mdPanel.open(config);
    };
    //删除家庭成员
    vm.deleteFamilyMember = function (index) {
        vm['memberList'].splice(index, 1);
        updateFamilyNumber();
    };
    //保存家庭档案
    vm.saveFamily = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }
        if (vm['addressStreet'] === '-1'
            || vm['houseAddress'] === undefined
            || vm['houseAddress'] === null
            || vm['houseAddress'] === '') {
            $rootScope.scrollTo('addressArea');
            $rootScope.alertDialog("请填写住宅详细地址");
            return;
        }
        //多选的内容组装
        var familyAttribute = transList2Key(vm['familyAttributeSelected']);
        var domesticApplianceType = transList2Key(vm['domesticApplianceTypeSelected']);
        var vehicleType = transList2Key(vm['vehicleTypeSelected']);
        var refuseDisposalWay = transList2Key(vm['refuseDisposalWaySelected']);
        var sewageDisposalWay = transList2Key(vm['sewageDisposalWaySelected']);
        var recreationalSportsEquipmentType = transList2Key(vm['recreationalSportsEquipmentTypeSelected']);
        //参数组装
        var params = {
            "FAMILY_CODE": "",//家庭编号
            "LIVING_TYPE_CODE": vm['livingType']['DICT_VALUE_CODE'],//居住类型编码
            "LIVING_TYPE_NAME": vm['livingType']['DICT_VALUE_NAME'],//居住类型名称
            "RESIDENT_TYPE_CODE": vm['residentType']['DICT_VALUE_CODE'],//常住类型编码
            "RESIDENT_TYPE_NAME": vm['residentType']['DICT_VALUE_NAME'],//常住类型名称
            "FAMILY_NUMBER": vm['familyNumber'],//家庭人数
            "RESIDENT_KEY_ID": vm['residentKeyId'],//户主ID
            "HOUSEHOLDER_NAME": vm['householderName'],//户主姓名
            "HOUSEHOLDER_ID_NO": vm['householderIdNo'],//37132119871101100
            "HOUSEHOLDER_PHONE_NO": vm['householderPhoneNo'],//15601707710
            "FIXED_PHONE_NO": vm['fixedPhoneNo'],//021
            "POSTCODE": vm['postcode'],//10000
            "PROVINCE_CODE": vm['addressProvince']['PROVINCE_CODE'],//省编码
            "PROVINCE_NAME": vm['addressProvince']['PROVINCE_NAME'],//省名称
            "CITY_CODE": vm['addressCity']['CITY_CODE'],//市编码
            "CITY_NAME": vm['addressCity']['CITY_NAME'],//市名称
            "COUNTY_DISTRICT_CODE": vm['addressCounty']['COUNTY_DISTRICT_CODE'],//县/区编码
            "COUNTY_DISTRICT_NAME": vm['addressCounty']['COUNTY_DISTRICT_NAME'],//县/区名称
            "STREET_TOWNSHIP_CODE": vm['addressStreet']['STREET_TOWNSHIP_CODE'],//街道/乡/镇编码
            "STREET_TOWNSHIP_NAME": vm['addressStreet']['STREET_TOWNSHIP_NAME'],//街道/乡/镇名称
            "HOUSE_ADDRESS": vm['houseAddress'],//住宅详细地址
            "FAMILY_ATTRIBUTE_CODE": familyAttribute['DICT_VALUE_CODE'],//户属性编码
            "FAMILY_ATTRIBUTE_NAME": familyAttribute['DICT_VALUE_NAME'],//户属性名称
            "HOUSING_AREA": vm['housingArea'],//1
            "PER_CAPITA_LIVING_AREA": vm['perCapitaLivingArea'],//1
            "HOUSE_TYPE_CODE": vm['houseType']['DICT_VALUE_CODE'],//房屋分类编码
            "HOUSE_TYPE_NAME": vm['houseType']['DICT_VALUE_NAME'],//房屋分类名称
            "NUMBER_OF_ROOMS": vm['numberOfRooms'],//20
            "COOKROOM_TYPE_CODE": vm['cookroomType']['DICT_VALUE_CODE'],//厨房类型编码
            "COOKROOM_TYPE_NAME": vm['cookroomType']['DICT_VALUE_NAME'],//厨房类型名称
            "KITCHEN_VENTILATION_SYSTEM_CODE": vm['kitchenVentilationSystem']['DICT_VALUE_CODE'],//厨房排风设施编码
            "KITCHEN_VENTILATION_SYSTEM_NAME": vm['kitchenVentilationSystem']['DICT_VALUE_NAME'],//厨房排风设施名称
            "FUEL_TYPE_CODE": vm['fuelType']['DICT_VALUE_CODE'],//燃料类别编码
            "FUEL_TYPE_NAME": vm['fuelType']['DICT_VALUE_NAME'],//燃料类别名称
            "WATER_SOURCE_CODE": vm['waterSource']['DICT_VALUE_CODE'],//饮水来源编码
            "WATER_SOURCE_NAME": vm['waterSource']['DICT_VALUE_NAME'],//饮水来源名称
            "TOILET_TYPE_CODE": vm['toiletType']['DICT_VALUE_CODE'],//厕所类型编码
            "TOILET_TYPE_NAME": vm['toiletType']['DICT_VALUE_NAME'],//厕所类型名称
            "PINFOLD_POSITION_CODE": vm['pinfoldPosition']['DICT_VALUE_CODE'],//禽畜栏位置编码
            "PINFOLD_POSITION_NAME": vm['pinfoldPosition']['DICT_VALUE_NAME'],//禽畜栏位置名称
            "DOMESTIC_APPLIANCE_TYPE_CODE": domesticApplianceType['DICT_VALUE_CODE'],//家用电器类型编码
            "DOMESTIC_APPLIANCE_TYPE_NAME": domesticApplianceType['DICT_VALUE_NAME'],//家用电器类型名称
            "VEHICLE_TYPE_CODE": vehicleType['DICT_VALUE_CODE'],//交通工具类型编码
            "VEHICLE_TYPE_NAME": vehicleType['DICT_VALUE_NAME'],//交通工具类型名称
            "ECONOMIC_CONDITIONS_TYPE_CODE": vm['economicConditionsType']['DICT_VALUE_CODE'],//经济状况类型编码
            "ECONOMIC_CONDITIONS_TYPE_NAME": vm['economicConditionsType']['DICT_VALUE_NAME'],//经济状况类型名称
            "PER_CAPITA_ANNUAL_INCOME_CODE": vm['perCapitaAnnualIncome']['DICT_VALUE_CODE'],//家庭年人均收入范围编码
            "PER_CAPITA_ANNUAL_INCOME_NAME": vm['perCapitaAnnualIncome']['DICT_VALUE_NAME'],//家庭年人均收入范围名称
            "TOTAL_FAMILY_INCOME": vm['totalFamilyIncome'],//家庭总收入(元/年)
            "TOTAL_FAMILY_EXPENDITURE": vm['totalFamilyExpenditure'],//家庭总支出(元/年)
            "REFUSE_DISPOSAL_WAY_CODE": refuseDisposalWay['DICT_VALUE_CODE'],//垃圾处理方式编码
            "REFUSE_DISPOSAL_WAY_NAME": refuseDisposalWay['DICT_VALUE_NAME'],//垃圾处理方式名称
            "SEWAGE_DISPOSAL_WAY_CODE": sewageDisposalWay['DICT_VALUE_CODE'],//污水处理方式编码
            "SEWAGE_DISPOSAL_WAY_NAME": sewageDisposalWay['DICT_VALUE_NAME'],//污水处理方式名称
            "RECREATIONAL_SPORTS_EQUIPMENT_TYPE_CODE": recreationalSportsEquipmentType['DICT_VALUE_CODE'],//文体设备类型编码
            "RECREATIONAL_SPORTS_EQUIPMENT_TYPE_NAME": recreationalSportsEquipmentType['DICT_VALUE_NAME'],//文体设备类型名称
            "RESPONSIBLE_DOCTOR_ID": vm['responsibleDoctorId'],//责任医生ID
            "RESPONSIBLE_DOCTOR_NAME": vm['responsibleDoctorName'],//责任医生姓名
            "DEGREE_OF_ARCHIVES_INTEGRALITY": vm['degreeOfArchivesIntegrality'],//档案完整度
            "MEMBER_LIST": vm['memberList'],
            "REMARK": vm['remark'],
            "BEGIN_TIME": vm['beginTime'],
            "END_TIME": vm['endTime']
        };
        //计算档案完整度
        params['degreeOfArchivesIntegrality'] = countIntegrality(params);
        function countIntegrality(params) {
            var all = 0;
            var count = 0;
            angular.forEach(params, function (item) {
                if (item !== undefined && item !== null) {
                    if (item instanceof Array) {
                        if (item.length > 0) {
                            count++;
                        }
                    } else {
                        count++;
                    }
                }
                all++;
            });
            return all === 0 ? 1 : (count / all);
        }

        familyArchivesService.addFamily(
            params,
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        if(vm['responsibleDoctorId']){
                            $state.go('main.resident.familyArchivesListReturn',{
                                TYPE:0
                            });
                        }else{
                            $state.go('main.resident.familyArchivesListReturn',{
                                TYPE:1
                            });
                        }

                    },
                    function () {
                        $rootScope.alertDialog('创建家庭档案失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('创建家庭档案失败');
            }
        );
    };
    //根据身份证号查询名字
    vm.serachHouseholderName = function (form) {
        if (!$rootScope.isEmptyObject(form.householderIdNo.$error)) {
            return;
        }
        var householderIdNo = vm['householderIdNo'];
        //参数组装
        var params = {
            "RESIDENT_ID_NO": vm['householderIdNo']
        };
        familyArchivesService.searchResident(
            params,
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        if ($rootScope.selectItem(vm['memberList'], 'RESIDENT_KEY_ID', data['RESIDENT_KEY_ID'])) {
                            $rootScope.alertDialog("更改的户主已在家庭成员中，更改无效");
                            vm['householderIdNo'] = householderIdNo;
                        } else {
                            vm['householderName'] = data['RESIDENT_NAME'];
                            vm['householderPhoneNo'] = data['RESIDENT_PHONE_NO'];
                            vm['residentKeyId'] = data['RESIDENT_KEY_ID'];
                        }
                    },
                    function () {
                        $rootScope.alertDialog("户主不存在或已属于其他家庭");
                    }
                );
            },
            function () {
                $rootScope.alertDialog("根据身份证号查询户主失败");
            }
        );
    };

    //返回
    vm.cancel = function (familyInfo) {
        if (familyInfo.$dirty) {
            $rootScope.confirmDialog(
                '您确定要放弃保存吗?',
                function () {
                    $state.go('main.resident.familyArchivesList');
                },
                function () {

                }
            );
        } else {
            $state.go('main.resident.familyArchivesList');
        }
    };

    vm.exists = function (item, list) {
        return list.indexOf(item) > -1;
    };

    vm.toggle = function (item, list) {
        var idx = list.indexOf(item);
        if (idx > -1) {
            list.splice(idx, 1);
        }
        else {
            list.push(item);
        }
    };
    //更新家庭人数
    function updateFamilyNumber() {
        vm['familyNumber'] = vm['memberList'].length + 1;
    }

    function eachDictValue(data) {
        angular.forEach(dict_type_code_list, function (item) {
            vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
        });
    }

    vm.addressProvince = '-1';
    vm.addressCity = '-1';
    vm.addressCounty = '-1';
    vm.addressStreet = '-1';

    vm.changeAddress = function (index) {
        switch (index) {
            case 1:
                vm.addressCity = '-1';
                vm.addressCounty = '-1';
                vm.addressStreet = '-1';
                break;
            case 2:
                vm.addressCounty = '-1';
                vm.addressStreet = '-1';
                break;
            case 3:
                vm.addressStreet = '-1';
                break;
            default:
                break;
        }
    };

    vm.initProvinceList = function (isTouched) {
        if (!isTouched) {
            $rootScope.commonService('getProvinceList', '', function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.addressProvinceArr = data;
                    },
                    function () {
                        vm.addressProvinceArr = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        }
    };

    vm.initCityListOfCertainProvince = function () {
        if (vm.addressProvince === '-1') {
            vm.addressCityArr = [];
            return;
        }
        if (lastprovince && lastprovince === vm.addressProvince.PROVINCE_CODE) {
            return;
        }
        var params = {
            PROVINCE_CODE: vm.addressProvince.PROVINCE_CODE
        };
        lastprovince = vm.addressProvince.PROVINCE_CODE;
        $rootScope.commonService('getCityListOfCertainProvince', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.addressCityArr = data;
                },
                function () {
                    vm.addressCityArr = [];
                    $rootScope.alertDialog('获取市列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取市列表失败');
        });
    };

    vm.initCountyListOfCertainCity = function () {
        if (vm.addressCity === '-1') {
            vm.addressCountyArr = [];
            return;
        }
        if (lastcity && lastcity === vm.addressCity.CITY_CODE) {
            return;
        }
        var params = {
            CITY_CODE: vm.addressCity.CITY_CODE
        };
        lastcity = vm.addressCity.CITY_CODE;
        $rootScope.commonService('getCountyListOfCertainCity', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.addressCountyArr = data;
                },
                function () {
                    vm.addressCountyArr = [];
                    $rootScope.alertDialog('获取区/县失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取区/县失败');
        });
    };

    vm.initSubdistrictListOfCertainCounty = function () {
        if (vm.addressCounty === '-1') {
            vm.addressStreetArr = [];
            return;
        }
        if (lastcounty && lastcounty === vm.addressCounty.COUNTY_DISTRICT_CODE) {
            return;
        }
        var params = {
            COUNTY_DISTRICT_CODE: vm.addressCounty.COUNTY_DISTRICT_CODE
        };
        lastcounty = vm.addressCounty.COUNTY_DISTRICT_CODE;
        $rootScope.commonService('getSubdistrictListOfCertainCounty', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.addressStreetArr = data;
                },
                function () {
                    vm.addressStreetArr = [];
                    $rootScope.alertDialog('获取街道列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取街道列表失败');
        });
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('familyArchivesEditCtrl', familyArchivesEditCtrl);
familyArchivesEditCtrl.$inject = ['$rootScope', '$state', '$mdPanel', '$filter', '$q', 'familyArchivesService'];
function familyArchivesEditCtrl($rootScope, $state, $mdPanel, $filter, $q, familyArchivesService) {
    var vm = this;
    var isSigned=0;
    vm.edit = true;
    vm.editable = false;
    vm.isResident= $rootScope.isContains($state.current.name,'residentArchivesSidebar');//是否居民个人档案中的家庭档案

    function definedData() {
        //初始化多选数组
        vm['familyAttributeSelected'] = [];
        vm['domesticApplianceTypeSelected'] = [];
        vm['vehicleTypeSelected'] = [];
        vm['refuseDisposalWaySelected'] = [];
        vm['sewageDisposalWaySelected'] = [];
        vm['recreationalSportsEquipmentTypeSelected'] = [];
        vm['memberList'] = [];
        //初始化单选
        //vm['livingType'] = {};
        //vm['residentType'] = {};
        vm['addressProvince'] = {};
        vm['addressCity'] = {};
        vm['addressCounty'] = {};
        vm['addressStreet'] = {};
        vm['familyAttribute'] = {};
        vm['houseType'] = {};
        vm['cookroomType'] = {};
        vm['kitchenVentilationSystem'] = {};
        vm['fuelType'] = {};
        vm['waterSource'] = {};
        vm['toiletType'] = {};
        vm['pinfoldPosition'] = {};
        vm['domesticApplianceType'] = {};
        vm['vehicleType'] = {};
        vm['economicConditionsType'] = {};
        vm['perCapitaAnnualIncome'] = {};
        vm['refuseDisposalWay'] = {};
        vm['sewageDisposalWay'] = {};
        vm['recreationalSportsEquipmentType'] = {};
    }

    var dict_type_code_list = [
        {
            "DICT_TYPE_CODE": "0007001",//居住类型
            "LIST_NAME": "livingTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007002",//常住类型
            "LIST_NAME": "residentTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007003",//户属性
            "LIST_NAME": "familyAttributeList"
        },
        {
            "DICT_TYPE_CODE": "0007004",//房屋分类
            "LIST_NAME": "houseTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007005",//厨房
            "LIST_NAME": "cookroomTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007006",//厨房排风措施
            "LIST_NAME": "kitchenVentilationSystemList"
        },
        {
            "DICT_TYPE_CODE": "0007007",//燃料类别
            "LIST_NAME": "fuelTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007008",//饮水
            "LIST_NAME": "waterSourceList"
        },
        {
            "DICT_TYPE_CODE": "0007009",//厕所
            "LIST_NAME": "toiletTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007010",//禽畜栏
            "LIST_NAME": "pinfoldPositionList"
        },
        {
            "DICT_TYPE_CODE": "0007011",//家用电器
            "LIST_NAME": "domesticApplianceTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007012",//交通工具
            "LIST_NAME": "vehicleTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007013",//经济状况
            "LIST_NAME": "economicConditionsTypeList"
        },
        {
            "DICT_TYPE_CODE": "0007014",//家庭年人均收入
            "LIST_NAME": "perCapitaAnnualIncomeList"
        },
        {
            "DICT_TYPE_CODE": "0007015",//垃圾处理
            "LIST_NAME": "refuseDisposalWayList"
        },
        {
            "DICT_TYPE_CODE": "0007016",//污水处理
            "LIST_NAME": "sewageDisposalWayList"
        },
        {
            "DICT_TYPE_CODE": "0007017",//文体设备
            "LIST_NAME": "recreationalSportsEquipmentTypeList"
        },
        {
            "DICT_TYPE_CODE": "0014",//与户主关系类型
            "LIST_NAME": "householderRelationshipList"
        }
    ];
    var dataBak = {};

    definedData();
    getDictList();

    //获取字典表
    function getDictList() {
        $rootScope.commonService(
            'getDictList',
            {
                "DICT_TYPE_CODE_LIST": dict_type_code_list
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        eachDictValue(data);
                        searchFamilyDetail();
                    },
                    function () {
                        $rootScope.alertDialog('获取字典列表失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取字典列表失败');
            }
        );
    }

    //获取家庭信息
    function searchFamilyDetail() {
        familyArchivesService.searchFamilyDetail(
            {
                "FAMILY_KEY_ID": $state.params.FAMILY_KEY_ID
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        isSigned=data.IS_SIGNED===0?1:0;
                        transformData(data);
                        dataBak = angular.copy(data);
                    },
                    function () {
                        $rootScope.alertDialog("查询家庭信息失败");
                    }
                );
            },
            function () {
                $rootScope.alertDialog("查询家庭信息失败");
            }
        );

    }

    function ifNullItem(item) {
        if (item === undefined || item === null || item === '') {
            return {
                "DICT_VALUE_CODE": "",
                "DICT_VALUE_NAME": ""
            };
        } else {
            return item;
        }
    }

    //转换数据
    function transformData(data) {
        vm['livingType'] = ifNullItem($rootScope.selectItem(vm['livingTypeList'], 'DICT_VALUE_CODE', data['LIVING_TYPE_CODE']));//居住类型编码
        vm['residentType'] = ifNullItem($rootScope.selectItem(vm['residentTypeList'], 'DICT_VALUE_CODE', data['RESIDENT_TYPE_CODE']));//常住类型编码
        vm['familyNumber'] = data['FAMILY_NUMBER'];//家庭人数
        vm['residentKeyId'] = data['RESIDENT_KEY_ID'];//户主ID
        vm['householderName'] = data['HOUSEHOLDER_NAME'];//户主姓名
        vm['householderIdNo'] = data['HOUSEHOLDER_ID_NO'];//37132119871101100
        vm['householderPhoneNo'] = data['HOUSEHOLDER_PHONE_NO'];//15601707710
        vm['fixedPhoneNo'] = data['FIXED_PHONE_NO'];//021
        vm['postcode'] = data['POSTCODE'];//10000
        vm.initProvinceValue('addressProvinceArr', 'addressProvince', data['PROVINCE_CODE']);//省编码
        vm.initCityValue(data['PROVINCE_CODE'], 'addressCityArr', 'addressCity', data['CITY_CODE']);//市编码
        vm.initCountyValue(data['CITY_CODE'], 'addressCountyArr', 'addressCounty', data['COUNTY_DISTRICT_CODE']);//县/区编码
        vm.initStreetValue(data['COUNTY_DISTRICT_CODE'], 'addressStreetArr', 'addressStreet', data['STREET_TOWNSHIP_CODE']);//街道/乡/镇编码
        vm['houseAddress'] = data['HOUSE_ADDRESS'];//住宅详细地址
        mutiplySelectItem(vm['familyAttributeSelected'], vm['familyAttributeList'], data['FAMILY_ATTRIBUTE_CODE']);//户属性编码
        vm['housingArea'] = data['HOUSING_AREA'];//1
        vm['perCapitaLivingArea'] = data['PER_CAPITA_LIVING_AREA'];//1
        vm['houseType'] = ifNullItem($rootScope.selectItem(vm['houseTypeList'], 'DICT_VALUE_CODE', data['HOUSE_TYPE_CODE']));//房屋分类编码
        vm['numberOfRooms'] = data['NUMBER_OF_ROOMS'];//20
        vm['cookroomType'] = ifNullItem($rootScope.selectItem(vm['cookroomTypeList'], 'DICT_VALUE_CODE', data['COOKROOM_TYPE_CODE']));//厨房类型编码
        vm['kitchenVentilationSystem'] = ifNullItem($rootScope.selectItem(vm['kitchenVentilationSystemList'], 'DICT_VALUE_CODE', data['KITCHEN_VENTILATION_SYSTEM_CODE']));//厨房排风设施编码
        vm['fuelType'] = ifNullItem($rootScope.selectItem(vm['fuelTypeList'], 'DICT_VALUE_CODE', data['FUEL_TYPE_CODE']));//燃料类别编码
        vm['waterSource'] = ifNullItem($rootScope.selectItem(vm['waterSourceList'], 'DICT_VALUE_CODE', data['WATER_SOURCE_CODE']));//饮水来源编码
        vm['toiletType'] = ifNullItem($rootScope.selectItem(vm['toiletTypeList'], 'DICT_VALUE_CODE', data['TOILET_TYPE_CODE']));//厕所类型编码
        vm['pinfoldPosition'] = ifNullItem($rootScope.selectItem(vm['pinfoldPositionList'], 'DICT_VALUE_CODE', data['PINFOLD_POSITION_CODE']));//禽畜栏位置编码
        mutiplySelectItem(vm['domesticApplianceTypeSelected'], vm['domesticApplianceTypeList'], data['DOMESTIC_APPLIANCE_TYPE_CODE']);//家用电器类型编码
        mutiplySelectItem(vm['vehicleTypeSelected'], vm['vehicleTypeList'], data['VEHICLE_TYPE_CODE']);//交通工具类型编码
        vm['economicConditionsType'] = ifNullItem($rootScope.selectItem(vm['economicConditionsTypeList'], 'DICT_VALUE_CODE', data['ECONOMIC_CONDITIONS_TYPE_CODE']));//经济状况类型编码
        vm['perCapitaAnnualIncome'] = ifNullItem($rootScope.selectItem(vm['perCapitaAnnualIncomeList'], 'DICT_VALUE_CODE', data['PER_CAPITA_ANNUAL_INCOME_CODE']));//家庭年人均收入范围编码
        vm['totalFamilyIncome'] = data['TOTAL_FAMILY_INCOME'];//家庭总收入(元/年)
        vm['totalFamilyExpenditure'] = data['TOTAL_FAMILY_EXPENDITURE'];//家庭总支出(元/年)
        mutiplySelectItem(vm['refuseDisposalWaySelected'], vm['refuseDisposalWayList'], data['REFUSE_DISPOSAL_WAY_CODE']);//垃圾处理方式编码
        mutiplySelectItem(vm['sewageDisposalWaySelected'], vm['sewageDisposalWayList'], data['SEWAGE_DISPOSAL_WAY_CODE']);//污水处理方式编码
        mutiplySelectItem(vm['recreationalSportsEquipmentTypeSelected'], vm['recreationalSportsEquipmentTypeList'], data['RECREATIONAL_SPORTS_EQUIPMENT_TYPE_CODE']);//文体设备类型编码
        vm['responsibleDoctorId'] = data['RESPONSIBLE_DOCTOR_ID'];//责任医生ID
        vm['responsibleDoctorName'] = data['RESPONSIBLE_DOCTOR_NAME'];//责任医生姓名
        vm['degreeOfArchivesIntegrality'] = data['DEGREE_OF_ARCHIVES_INTEGRALITY'];//档案完整度
        vm['memberList'] = data['MEMBER_LIST'];
        vm['remark'] = data['REMARK'];
        vm['createTime'] = data['CREATE_TIME'];
        vm['beginTime'] = data['BEGIN_TIME'];
        vm['endTime'] = data['END_TIME'];
        if (vm['createTime'] !== undefined
            && vm['createTime'] !== ''
            && vm['createTime'] !== null) {
            vm['createTimeFormat'] = new Date(vm['createTime']);
        }
        if (vm['beginTime'] !== undefined
            && vm['beginTime'] !== ''
            && vm['beginTime'] !== null) {
            vm['beginTimeFormat'] = new Date(vm['beginTime']);
        }
        if (vm['endTime'] !== undefined
            && vm['endTime'] !== ''
            && vm['endTime'] !== null) {
            vm['endTimeFormat'] = new Date(vm['endTime']);
        }
    }

    function mutiplySelectItem(list, dict, code) {
        if (code === undefined || code === null || code === '') {
            return;
        }
        var codeList = code.split(',');
        angular.forEach(codeList, function (item) {
            list.push($rootScope.selectItem(dict, 'DICT_VALUE_CODE', item));
        });
    }

    function transList2Key(list) {
        var templistA = [];
        var templistB = [];
        angular.forEach(list, function (item) {
            if (item['DICT_VALUE_CODE']) {
                templistA.push(item['DICT_VALUE_CODE']);
            }
            if (item['DICT_VALUE_NAME']) {
                templistB.push(item['DICT_VALUE_NAME']);
            }
        });
        return {
            "DICT_VALUE_CODE": templistA.join(','),
            "DICT_VALUE_NAME": templistB.join(',')
        };
    }

    //添加签约医生
    vm.addDoctor = function () {
        SMS.CONTROLLERS.controller('selectDoctorController', selectDoctorController);
        selectDoctorController.$inject = ['$rootScope', '$scope', 'mdPanelRef', '$filter', 'familyArchivesService'];
        function selectDoctorController($rootScope, $scope, mdPanelRef, $filter, familyArchivesService) {
            $scope.searched = false;
            function callback(row) {
                $scope.searched = true;
                familyArchivesService.getselectedDoctorList(
                    $scope,
                    {},
                    {
                        "total": 1,
                        "rows": [row]
                    }
                );
                $scope['row'] = row;
                $rootScope.getCurrentDateTime(
                    function (data) {
                        if (vm['beginTimeFormat'] === undefined) {
                            vm['beginTimeFormat'] = data;
                            vm['beginTime'] = $filter('commonDate')(vm['beginTimeFormat']);
                            var tempEndTime = new Date(new Date(vm['beginTimeFormat']).getTime());
                            tempEndTime.setFullYear(tempEndTime.getFullYear() + 1);
                            tempEndTime.setDate(tempEndTime.getDate() - 1);
                            vm['endTimeFormat'] = tempEndTime;
                            vm['endTime'] = $filter('commonDate')(vm['endTimeFormat']);
                        }
                        if ($scope['beginTime'] === undefined) {
                            $scope['beginTime'] = $filter('commonDate')(vm['beginTimeFormat'], 'yyyy年MM月dd日');
                            $scope['endTime'] = $filter('commonDate')(vm['endTimeFormat'], 'yyyy年MM月dd日');
                            $scope.$apply();
                        }
                    }
                );
                $scope.$apply();
            }

            $scope.hide = function () {
                mdPanelRef.close();
            };
            $scope.cancel = function () {
                mdPanelRef.close();
            };
            $scope.back = function () {
                $scope.searched = false;
            };
            $scope.addDoctor = function () {
                vm['responsibleDoctorId'] = $scope['row']['FAMILY_DOCTOR_KEY_ID'];//责任医生ID
                vm['responsibleDoctorName'] = $scope['row']['DOCTOR_NAME'];//责任医生姓名
                vm['hospitalName'] = $scope['row']['HOSPITAL_NAME'];//所属医院
                vm['doctorTitleName'] = $scope['row']['DOCTOR_TITLE_NAME'];//职称
                vm['DOCTOR_CHANGED'] = true;
                mdPanelRef.close();
            };
            $scope.search = function () {
                $scope.getDoctorList();
            };
            $scope.getDoctorList = function () {
                var params = {
                    "SEARCH_DOCTOR": $scope.searchValue
                };
                familyArchivesService.getDoctorList($scope, params, callback);
            };
            $scope.$on('panelClose',
                function () {
                    mdPanelRef.close();
                }
            );
        }

        var position = $mdPanel.newPanelPosition().absolute().center();
        var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
        var config = {
            animation: animation,
            attachTo: angular.element(document.body),
            controller: selectDoctorController,
            templateUrl: 'template/resident/familyArchives/selectDoctor.html',
            position: position,
            trapFocus: true,
            disableParentScroll: true,
            clickOutsideToClose: false,
            clickEscapeToClose: true,
            hasBackdrop: true,
            fullscreen: false
        };
        $mdPanel.open(config);
    };
    //添加家庭成员
    vm.addFamilyMember = function () {
        if (!vm['residentKeyId']) {
            $rootScope.alertDialog("请先添加户主信息,如:身份证");
            return;
        }
        if (vm['familyNumber'] === 99) {
            $rootScope.alertDialog("家庭人数超过限制，无法添加家庭成员");
            return;
        }
        SMS.CONTROLLERS.controller('selectFamilyMemberController', selectFamilyMemberController);
        selectFamilyMemberController.$inject = ['$rootScope', '$scope', 'mdPanelRef', 'familyArchivesService'];
        function selectFamilyMemberController($rootScope, $scope, mdPanelRef, familyArchivesService) {
            $scope.searched = false;
            $scope.add = true;
            $scope['householderRelationshipList'] = vm['householderRelationshipList'];
            function callback(row) {
                if (row.FAMILY_KEY_ID !== undefined
                    && row.FAMILY_KEY_ID !== null
                    && row.FAMILY_KEY_ID !== "") {
                    $rootScope.alertDialog("不能添加该居民，因为该居民已组建过家庭");
                    return;
                }
                if (row['RESIDENT_KEY_ID'] === vm['residentKeyId']) {
                    $rootScope.alertDialog("不能选择户主作为家庭成员");
                    return;
                }
                $scope.searched = true;
                familyArchivesService.getselectedFamilyMemberList(
                    $scope,
                    {},
                    {
                        "total": 1,
                        "rows": [row]
                    }
                );
                $scope['row'] = row;
                $scope['relationship'] = undefined;
                $scope.$apply();
            }

            $scope.hide = function () {
                mdPanelRef.close();
            };
            $scope.cancel = function () {
                mdPanelRef.close();
            };
            $scope.back = function (form) {
                form.$setPristine();
                form.$setUntouched();
                $scope.searched = false;
            };
            $scope.addFamilyMember = function () {
                if ($rootScope.selectIndex(vm['memberList'], "RESIDENT_KEY_ID", $scope['row']['RESIDENT_KEY_ID']) !== -1) {
                    $rootScope.alertDialog("已经添加过该成员，不能重复添加");
                    return;
                }
                var HOUSEHOLDER_RELATIONSHIP_CODE = $scope['relationship'] === null? '':$scope['relationship']['DICT_VALUE_CODE'];
                var HOUSEHOLDER_RELATIONSHIP_NAME = $scope['relationship'] === null? $scope['relationshipSearchText']:$scope['relationship']['DICT_VALUE_NAME'];
                $scope['row']['HOUSEHOLDER_RELATIONSHIP_CODE'] = HOUSEHOLDER_RELATIONSHIP_CODE;
                $scope['row']['HOUSEHOLDER_RELATIONSHIP_NAME'] = HOUSEHOLDER_RELATIONSHIP_NAME;
                $scope['row']['HOUSEHOLDER_SYMBOL'] = "0";
                vm['memberList'].push($scope['row']);
                vm['MEMBER_CHANGED'] = true;//标识成员更新
                updateFamilyNumber();
                mdPanelRef.close();
            };
            $scope.searchTextChange = function () {
                var result = $q.defer();
                //var searchList = $filter('filter')($scope['householderRelationshipList'], {'DICT_VALUE_NAME': search});//模糊搜索
                var searchList = $scope['householderRelationshipList'];
                result.resolve(searchList);
                return result.promise;
            };
            $scope.search = function () {
                $scope.getFamilyMemberList();
            };
            $scope.getFamilyMemberList = function () {
                var params = {
                    "SEARCH_RESIDENT": $scope.searchValue,
                    "RESIDENT_KEY_ID": vm['residentKeyId']
                };
                familyArchivesService.getFamilyMemberList($scope, params, callback);
            };
            $scope.$on('panelClose',
                function () {
                    mdPanelRef.close();
                }
            );
        }

        var position = $mdPanel.newPanelPosition().absolute().center();
        var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
        var config = {
            animation: animation,
            attachTo: angular.element(document.body),
            controller: selectFamilyMemberController,
            templateUrl: 'template/resident/familyArchives/selectFamilyMember.html',
            position: position,
            trapFocus: true,
            disableParentScroll: true,
            clickOutsideToClose: false,
            clickEscapeToClose: true,
            hasBackdrop: true,
            fullscreen: false
        };
        $mdPanel.open(config);
    };
    //查看家庭成员
    vm.viewFamilyMember = function (item) {
        if(!$rootScope.isShow('1003001002')){
            return;
        }
        $state.go('main.resident.residentArchivesSidebar.detail.residentArchivesEdit', {"RESIDENT_KEY_ID": item.RESIDENT_KEY_ID});
    };
    //编辑家庭成员
    vm.editFamilyMember = function (item) {
        SMS.CONTROLLERS.controller('editFamilyMemberController', editFamilyMemberController);
        editFamilyMemberController.$inject = ['$rootScope', '$scope', 'mdPanelRef', 'familyArchivesService'];
        function editFamilyMemberController($rootScope, $scope, mdPanelRef, familyArchivesService) {
            $scope.searched = true;
            $scope.edit = true;
            $scope['householderRelationshipList'] = vm['householderRelationshipList'];
            item['FAMILY_KEY_ID'] = "-1";//改为已经组成家庭
            $scope['row'] = item;
            $scope['relationship'] = $rootScope.selectItem($scope['householderRelationshipList'], "DICT_VALUE_CODE", $scope['row']['HOUSEHOLDER_RELATIONSHIP_CODE']);
            if ($scope['relationship'] === undefined) {
                $scope['relationship'] = {
                    'DICT_VALUE_CODE': '',
                    'DICT_VALUE_NAME': $scope['row']['HOUSEHOLDER_RELATIONSHIP_NAME']
                };
            }
            familyArchivesService.getselectedFamilyMemberList(
                $scope,
                {},
                {
                    "total": 1,
                    "rows": [$scope['row']]
                }
            );
            $scope.hide = function () {
                mdPanelRef.close();
            };
            $scope.cancel = function () {
                mdPanelRef.close();
            };
            $scope.back = function (form) {
                form.$setPristine();
                form.$setUntouched();
                $scope.searched = false;
            };
            $scope.addFamilyMember = function () {
                var HOUSEHOLDER_RELATIONSHIP_CODE = $scope['relationship'] === null? '':$scope['relationship']['DICT_VALUE_CODE'];
                var HOUSEHOLDER_RELATIONSHIP_NAME = $scope['relationship'] === null? $scope['relationshipSearchText']:$scope['relationship']['DICT_VALUE_NAME'];
                $scope['row']['HOUSEHOLDER_RELATIONSHIP_CODE'] = HOUSEHOLDER_RELATIONSHIP_CODE;
                $scope['row']['HOUSEHOLDER_RELATIONSHIP_NAME'] = HOUSEHOLDER_RELATIONSHIP_NAME;
                $scope['row']['HOUSEHOLDER_SYMBOL'] = "0";
                //vm['memberList'].push($scope['row']);//编辑不加这个人
                vm['MEMBER_CHANGED'] = true;//标识成员更新
                mdPanelRef.close();
            };
            $scope.searchTextChange = function () {
                var result = $q.defer();
                //var searchList = $filter('filter')($scope['householderRelationshipList'], {'DICT_VALUE_NAME': search});//模糊搜索
                var searchList = $scope['householderRelationshipList'];
                result.resolve(searchList);
                return result.promise;
            };
            $scope.search = function () {
                $scope.getFamilyMemberList();
            };
            $scope.getFamilyMemberList = function () {
                var params = {
                    "SEARCH_RESIDENT": $scope.searchValue
                };
                familyArchivesService.getFamilyMemberList($scope, params, callback);
            };
            $scope.$on('panelClose',
                function () {
                    mdPanelRef.close();
                }
            );
        }

        var position = $mdPanel.newPanelPosition().absolute().center();
        var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
        var config = {
            animation: animation,
            attachTo: angular.element(document.body),
            controller: editFamilyMemberController,
            templateUrl: 'template/resident/familyArchives/selectFamilyMember.html',
            position: position,
            trapFocus: true,
            disableParentScroll: true,
            clickOutsideToClose: false,
            clickEscapeToClose: true,
            hasBackdrop: true,
            fullscreen: false
        };
        $mdPanel.open(config);
    };
    //删除家庭成员
    vm.deleteFamilyMember = function (index) {
        vm['memberList'].splice(index, 1);
        vm['MEMBER_CHANGED'] = true;//标识成员更新
        updateFamilyNumber();
    };
    //保存家庭档案
    vm.saveFamily = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }
        if (vm['addressStreet'] === '-1'
            || vm['houseAddress'] === undefined
            || vm['houseAddress'] === null
            || vm['houseAddress'] === '') {
            $rootScope.scrollTo('addressArea');
            $rootScope.alertDialog("请填写住宅详细地址");
            return;
        }
        //多选的内容组装
        var familyAttribute = transList2Key(vm['familyAttributeSelected']);
        var domesticApplianceType = transList2Key(vm['domesticApplianceTypeSelected']);
        var vehicleType = transList2Key(vm['vehicleTypeSelected']);
        var refuseDisposalWay = transList2Key(vm['refuseDisposalWaySelected']);
        var sewageDisposalWay = transList2Key(vm['sewageDisposalWaySelected']);
        var recreationalSportsEquipmentType = transList2Key(vm['recreationalSportsEquipmentTypeSelected']);
        //参数组装
        var params = {
            "FAMILY_KEY_ID": $state.params.FAMILY_KEY_ID,
            "FAMILY_CODE": "",//家庭编号
            "LIVING_TYPE_CODE": vm['livingType']['DICT_VALUE_CODE'],//居住类型编码
            "LIVING_TYPE_NAME": vm['livingType']['DICT_VALUE_NAME'],//居住类型名称
            "RESIDENT_TYPE_CODE": vm['residentType']['DICT_VALUE_CODE'],//常住类型编码
            "RESIDENT_TYPE_NAME": vm['residentType']['DICT_VALUE_NAME'],//常住类型名称
            "FAMILY_NUMBER": vm['familyNumber'],//家庭人数
            "RESIDENT_KEY_ID": vm['residentKeyId'],//户主ID
            "HOUSEHOLDER_NAME": vm['householderName'],//户主姓名
            "HOUSEHOLDER_ID_NO": vm['householderIdNo'],//37132119871101100
            "HOUSEHOLDER_PHONE_NO": vm['householderPhoneNo'],//15601707710
            "FIXED_PHONE_NO": vm['fixedPhoneNo'],//021
            "POSTCODE": vm['postcode'],//10000
            "PROVINCE_CODE": vm['addressProvince']['PROVINCE_CODE'],//省编码
            "PROVINCE_NAME": vm['addressProvince']['PROVINCE_NAME'],//省名称
            "CITY_CODE": vm['addressCity']['CITY_CODE'],//市编码
            "CITY_NAME": vm['addressCity']['CITY_NAME'],//市名称
            "COUNTY_DISTRICT_CODE": vm['addressCounty']['COUNTY_DISTRICT_CODE'],//县/区编码
            "COUNTY_DISTRICT_NAME": vm['addressCounty']['COUNTY_DISTRICT_NAME'],//县/区名称
            "STREET_TOWNSHIP_CODE": vm['addressStreet']['STREET_TOWNSHIP_CODE'],//街道/乡/镇编码
            "STREET_TOWNSHIP_NAME": vm['addressStreet']['STREET_TOWNSHIP_NAME'],//街道/乡/镇名称
            "HOUSE_ADDRESS": vm['houseAddress'],//住宅详细地址
            "FAMILY_ATTRIBUTE_CODE": familyAttribute['DICT_VALUE_CODE'],//户属性编码
            "FAMILY_ATTRIBUTE_NAME": familyAttribute['DICT_VALUE_NAME'],//户属性名称
            "HOUSING_AREA": vm['housingArea'],//1
            "PER_CAPITA_LIVING_AREA": vm['perCapitaLivingArea'],//1
            "HOUSE_TYPE_CODE": vm['houseType']['DICT_VALUE_CODE'],//房屋分类编码
            "HOUSE_TYPE_NAME": vm['houseType']['DICT_VALUE_NAME'],//房屋分类名称
            "NUMBER_OF_ROOMS": vm['numberOfRooms'],//20
            "COOKROOM_TYPE_CODE": vm['cookroomType']['DICT_VALUE_CODE'],//厨房类型编码
            "COOKROOM_TYPE_NAME": vm['cookroomType']['DICT_VALUE_NAME'],//厨房类型名称
            "KITCHEN_VENTILATION_SYSTEM_CODE": vm['kitchenVentilationSystem']['DICT_VALUE_CODE'],//厨房排风设施编码
            "KITCHEN_VENTILATION_SYSTEM_NAME": vm['kitchenVentilationSystem']['DICT_VALUE_NAME'],//厨房排风设施名称
            "FUEL_TYPE_CODE": vm['fuelType']['DICT_VALUE_CODE'],//燃料类别编码
            "FUEL_TYPE_NAME": vm['fuelType']['DICT_VALUE_NAME'],//燃料类别名称
            "WATER_SOURCE_CODE": vm['waterSource']['DICT_VALUE_CODE'],//饮水来源编码
            "WATER_SOURCE_NAME": vm['waterSource']['DICT_VALUE_NAME'],//饮水来源名称
            "TOILET_TYPE_CODE": vm['toiletType']['DICT_VALUE_CODE'],//厕所类型编码
            "TOILET_TYPE_NAME": vm['toiletType']['DICT_VALUE_NAME'],//厕所类型名称
            "PINFOLD_POSITION_CODE": vm['pinfoldPosition']['DICT_VALUE_CODE'],//禽畜栏位置编码
            "PINFOLD_POSITION_NAME": vm['pinfoldPosition']['DICT_VALUE_NAME'],//禽畜栏位置名称
            "DOMESTIC_APPLIANCE_TYPE_CODE": domesticApplianceType['DICT_VALUE_CODE'],//家用电器类型编码
            "DOMESTIC_APPLIANCE_TYPE_NAME": domesticApplianceType['DICT_VALUE_NAME'],//家用电器类型名称
            "VEHICLE_TYPE_CODE": vehicleType['DICT_VALUE_CODE'],//交通工具类型编码
            "VEHICLE_TYPE_NAME": vehicleType['DICT_VALUE_NAME'],//交通工具类型名称
            "ECONOMIC_CONDITIONS_TYPE_CODE": vm['economicConditionsType']['DICT_VALUE_CODE'],//经济状况类型编码
            "ECONOMIC_CONDITIONS_TYPE_NAME": vm['economicConditionsType']['DICT_VALUE_NAME'],//经济状况类型名称
            "PER_CAPITA_ANNUAL_INCOME_CODE": vm['perCapitaAnnualIncome']['DICT_VALUE_CODE'],//家庭年人均收入范围编码
            "PER_CAPITA_ANNUAL_INCOME_NAME": vm['perCapitaAnnualIncome']['DICT_VALUE_NAME'],//家庭年人均收入范围名称
            "TOTAL_FAMILY_INCOME": vm['totalFamilyIncome'],//家庭总收入(元/年)
            "TOTAL_FAMILY_EXPENDITURE": vm['totalFamilyExpenditure'],//家庭总支出(元/年)
            "REFUSE_DISPOSAL_WAY_CODE": refuseDisposalWay['DICT_VALUE_CODE'],//垃圾处理方式编码
            "REFUSE_DISPOSAL_WAY_NAME": refuseDisposalWay['DICT_VALUE_NAME'],//垃圾处理方式名称
            "SEWAGE_DISPOSAL_WAY_CODE": sewageDisposalWay['DICT_VALUE_CODE'],//污水处理方式编码
            "SEWAGE_DISPOSAL_WAY_NAME": sewageDisposalWay['DICT_VALUE_NAME'],//污水处理方式名称
            "RECREATIONAL_SPORTS_EQUIPMENT_TYPE_CODE": recreationalSportsEquipmentType['DICT_VALUE_CODE'],//文体设备类型编码
            "RECREATIONAL_SPORTS_EQUIPMENT_TYPE_NAME": recreationalSportsEquipmentType['DICT_VALUE_NAME'],//文体设备类型名称
            "RESPONSIBLE_DOCTOR_ID": vm['responsibleDoctorId'],//责任医生ID
            "RESPONSIBLE_DOCTOR_NAME": vm['responsibleDoctorName'],//责任医生姓名
            "DEGREE_OF_ARCHIVES_INTEGRALITY": vm['degreeOfArchivesIntegrality'],//档案完整度
            "MEMBER_LIST": vm['memberList'],
            "REMARK": vm['remark'],
            "BEGIN_TIME": vm['beginTime'],
            "END_TIME": vm['endTime']
        };
        //计算档案完整度
        params['degreeOfArchivesIntegrality'] = countIntegrality(params);
        //家庭和签约医生是否变化
        if (vm['DOCTOR_CHANGED']) {
            params['DOCTOR_CHANGED'] = vm['DOCTOR_CHANGED'];
        }
        if (vm['MEMBER_CHANGED']) {
            params['MEMBER_CHANGED'] = vm['MEMBER_CHANGED'];
        }
        function countIntegrality(params) {
            var all = 0;
            var count = 0;
            angular.forEach(params, function (item) {
                if (item !== undefined && item !== null) {
                    if (item instanceof Array) {
                        if (item.length > 0) {
                            count++;
                        }
                    } else {
                        count++;
                    }
                }
                all++;
            });
            return all === 0 ? 1 : (count / all);
        }

        familyArchivesService.editFamily(
            params,
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        vm.editable = false;
                        dataBak = params;
                    },
                    function () {
                        $rootScope.alertDialog('更新家庭档案失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('更新家庭档案失败');
            }
        );
    };
    //根据身份证号查询名字
    vm.serachHouseholderName = function (form) {
        if (!$rootScope.isEmptyObject(form.householderIdNo.$error)) {
            return;
        }
        if (vm['householderIdNo'] === dataBak['HOUSEHOLDER_ID_NO']) {
            return;
        }
        //参数组装
        var params = {
            "RESIDENT_ID_NO": vm['householderIdNo']
        };
        familyArchivesService.searchResident(
            params,
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        if ($rootScope.selectItem(vm['memberList'], 'RESIDENT_KEY_ID', data['RESIDENT_KEY_ID'])) {
                            $rootScope.alertDialog("更改的户主已在家庭成员中，更改无效");
                            vm['householderIdNo'] = dataBak['HOUSEHOLDER_ID_NO'];
                        } else {
                            vm['householderName'] = data['RESIDENT_NAME'];
                            vm['householderPhoneNo'] = data['RESIDENT_PHONE_NO'];
                            vm['residentKeyId'] = data['RESIDENT_KEY_ID'];
                        }
                    },
                    function () {
                        $rootScope.alertDialog("户主不存在或已属于其他家庭");
                    }
                );
            },
            function () {
                $rootScope.alertDialog("根据身份证号查询户主失败");
            }
        );
    };
    //编辑
    vm.edit = function (form) {
        form.$setPristine();
        form.$setUntouched();
        vm.editable = true;
    };
    //取消
    vm.cancel = function (familyInfo) {
        if (familyInfo.$dirty) {
            $rootScope.confirmDialog(
                '您确定要放弃保存吗?',
                function () {
                    resetData();
                    vm.editable = false;
                },
                function () {

                }
            );
        } else {
            vm.editable = false;
        }
        function resetData() {
            var data = angular.copy(dataBak);
            definedData();
            transformData(data);
        }
    };
    //返回
    vm.goBack = function () {
        if(vm.isResident){
            $rootScope.back();
        }else {
            $state.go('main.resident.familyArchivesListReturn',{
                TYPE:isSigned
            });
        }
    };

    vm.exists = function (item, list) {
        return list.indexOf(item) > -1;
    };

    vm.toggle = function (item, list) {
        var idx = list.indexOf(item);
        if (idx > -1) {
            list.splice(idx, 1);
        }
        else {
            list.push(item);
        }
    };
    //更新家庭人数
    function updateFamilyNumber() {
        vm['familyNumber'] = vm['memberList'].length + 1;
    }

    function eachDictValue(data) {
        angular.forEach(dict_type_code_list, function (item) {
            vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
        });
    }

    vm.addressProvince = '-1';
    vm.addressCity = '-1';
    vm.addressCounty = '-1';
    vm.addressStreet = '-1';

    vm.changeAddress = function (index) {
        switch (index) {
            case 1:
                vm.addressCity = '-1';
                vm.addressCounty = '-1';
                vm.addressStreet = '-1';
                break;
            case 2:
                vm.addressCounty = '-1';
                vm.addressStreet = '-1';
                break;
            case 3:
                vm.addressStreet = '-1';
                break;
            default:
                break;
        }
    };

    vm.initProvinceList = function (isTouched, listName, modelName) {
        var originalCode = vm[modelName]['PROVINCE_CODE'];
        if (!isTouched) {
            $rootScope.commonService('getProvinceList', '', function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm[listName] = data;
                        vm[modelName] = $rootScope.selectItem(vm[listName], 'PROVINCE_CODE', originalCode);
                    },
                    function () {
                        vm[listName] = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        }
    };

    vm.initProvinceValue = function (listName, modelName, code) {
        $rootScope.commonService('getProvinceList', '', function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    vm[modelName] = $rootScope.selectItem(vm[listName], 'PROVINCE_CODE', code);
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取省列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取省列表失败');
        });
    };

    vm.initCityListOfCertainProvince = function (topName, listName, modelName) {
        if (vm[topName] === '-1') {
            vm[listName] = [];
            return;
        }
        var params = {
            "PROVINCE_CODE": vm[topName].PROVINCE_CODE
        };
        var originalCode = vm[modelName]['CITY_CODE'];
        $rootScope.commonService('getCityListOfCertainProvince', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    vm[modelName] = $rootScope.selectItem(vm[listName], 'CITY_CODE', originalCode);
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取市列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取市列表失败');
        });
    };

    vm.initCityValue = function (topCode, listName, modelName, code) {
        var params = {
            "PROVINCE_CODE": topCode
        };
        $rootScope.commonService('getCityListOfCertainProvince', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    vm[modelName] = $rootScope.selectItem(vm[listName], 'CITY_CODE', code);
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取市列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取市列表失败');
        });
    };

    vm.initCountyListOfCertainCity = function (topName, listName, modelName) {
        if (vm[topName] === '-1') {
            vm[listName] = [];
            return;
        }
        var params = {
            "CITY_CODE": vm[topName].CITY_CODE
        };
        var originalCode = vm[modelName]['COUNTY_DISTRICT_CODE'];
        $rootScope.commonService('getCountyListOfCertainCity', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    vm[modelName] = $rootScope.selectItem(vm[listName], 'COUNTY_DISTRICT_CODE', originalCode);
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取区/县失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取区/县失败');
        });
    };

    vm.initCountyValue = function (topCode, listName, modelName, code) {
        var params = {
            "CITY_CODE": topCode
        };
        $rootScope.commonService('getCountyListOfCertainCity', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    vm[modelName] = $rootScope.selectItem(vm[listName], 'COUNTY_DISTRICT_CODE', code);
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取区/县失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取区/县失败');
        });
    };

    vm.initSubdistrictListOfCertainCounty = function (topName, listName, modelName) {
        if (vm[topName] === '-1') {
            vm[listName] = [];
            return;
        }
        var params = {
            "COUNTY_DISTRICT_CODE": vm[topName].COUNTY_DISTRICT_CODE
        };
        var originalCode = vm[modelName]['STREET_TOWNSHIP_NAME'];
        $rootScope.commonService('getSubdistrictListOfCertainCounty', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    vm[modelName] = $rootScope.selectItem(vm[listName], 'STREET_TOWNSHIP_NAME', originalCode);
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取街道列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取街道列表失败');
        });
    };

    vm.initStreetValue = function (topCode, listName, modelName, code) {
        var params = {
            "COUNTY_DISTRICT_CODE": topCode
        };
        $rootScope.commonService('getSubdistrictListOfCertainCounty', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    vm[modelName] = $rootScope.selectItem(vm[listName], 'STREET_TOWNSHIP_CODE', code);
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取街道列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取街道列表失败');
        });
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('familyArchivesListCtrl', familyArchivesListCtrl);
familyArchivesListCtrl.$inject = ['$rootScope', '$state', 'familyArchivesService', 'downloadCommon'];
function familyArchivesListCtrl($rootScope, $state, familyArchivesService, downloadCommon) {
    var vm = this;

    vm.isDownloading = false;
    var downLoadParam = {};
    var downSignedPatam = {};
    vm.selectedIndex = $state.params.TYPE?$state.params.TYPE:0;

    var lastProvince = null;
    var lastCity = null;
    var lastCounty = null;

    vm.searchTerm;
    vm.selectedDoctor = {};
    //签约医生
    vm.doctor = [];
    vm.getDoctorList = function () {
        familyArchivesService.getSignedDoctorList(
            {"DOCTOR_NAME": vm.searchTerm},
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.doctor = data;
                    },
                    function () {
                        $rootScope.alertDialog('获取医生列表失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取医生列表失败');
            }
        );
    };
    vm.clearSearchTerm = function () {
        vm.searchTerm = '';
        //关闭的时候判断已有的值是否在list中，在的话选中，不在的话把list赋值给list再选中
        if (vm.selectedDoctor !== undefined) {
            var temp = $rootScope.selectItem(vm.doctor, "FAMILY_DOCTOR_KEY_ID", vm.selectedDoctor.FAMILY_DOCTOR_KEY_ID);
            if (temp !== undefined) {
                vm.selectedDoctor = temp;
            } else {
                vm.doctor = [];
                vm.doctor.push(temp);
                vm.selectedDoctor = vm.doctor[0];
            }
        }
    };
    vm.getSearchTerm = function () {
        vm.searchTerm = vm.selectedDoctor ? vm.selectedDoctor.DOCTOR_NAME : undefined;
        vm.searchTermChange();
    };
    angular.element('input[name="doctor"]').on('keydown', function (ev) {
        ev.stopPropagation();
    });
    vm.searchTermChange = function () {
        if (vm.searchTerm !== '' && vm.searchTerm !== undefined) {
            vm.getDoctorList();
        }
    };

    vm.tabledataHtml = function (index) {
        if (index === 1) {
            downLoadParam = {
                "HOUSEHOLDER_NAME": vm.householderName ? vm.householderName : null,
                "HOUSEHOLDER_PHONE_NO": vm.householderPhoneNo ? vm.householderPhoneNo :null,
                "PROVINCE_CODE": !vm.familyAddressProvince || vm.familyAddressProvince === '-1' ? null : vm.familyAddressProvince.PROVINCE_CODE,
                "CITY_CODE": !vm.familyAddressCity || vm.familyAddressCity === '-1' ? null : vm.familyAddressCity.CITY_CODE,
                "COUNTY_DISTRICT_CODE": !vm.familyAddressCounty || vm.familyAddressCounty === '-1' ? null : vm.familyAddressCounty.COUNTY_DISTRICT_CODE,
                "STREET_TOWNSHIP_CODE": !vm.familyAddressStreet || vm.familyAddressStreet === '-1' ? null : vm.familyAddressStreet.STREET_TOWNSHIP_CODE
            };
            familyArchivesService.getFamilyArchiveList(vm, downLoadParam);
        } else {
            downSignedPatam = {
                "FAMILY_DOCTOR_KEY_ID": vm.selectedDoctor ? vm.selectedDoctor.FAMILY_DOCTOR_KEY_ID : null,
                "HOUSEHOLDER_NAME": vm.householderName ? vm.householderName : null,
                "HOUSEHOLDER_PHONE_NO": vm.householderPhoneNo ? vm.householderPhoneNo :null,
                "PROVINCE_CODE": !vm.familyAddressProvince || vm.familyAddressProvince === '-1' ? null : vm.familyAddressProvince.PROVINCE_CODE,
                "CITY_CODE": !vm.familyAddressCity || vm.familyAddressCity === '-1' ? null : vm.familyAddressCity.CITY_CODE,
                "COUNTY_DISTRICT_CODE": !vm.familyAddressCounty || vm.familyAddressCounty === '-1' ? null : vm.familyAddressCounty.COUNTY_DISTRICT_CODE,
                "STREET_TOWNSHIP_CODE": !vm.familyAddressStreet || vm.familyAddressStreet === '-1' ? null : vm.familyAddressStreet.STREET_TOWNSHIP_CODE
            };
            familyArchivesService.getSignedFamilyArchiveList(vm, downSignedPatam);
        }

    };

    vm.tabledataHtml(0);
    vm.tabledataHtml(1);

    vm.initProvinceList = function (isTouched) {
        if (!isTouched) {
            $rootScope.commonService('getProvinceList', '', function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.familyAddressProvinces = data;
                    },
                    function () {
                        vm.familyAddressProvinces = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        }
    };

    vm.initCityListOfCertainProvince = function () {
        if (vm.familyAddressProvince === '-1') {
            vm.familyAddressCitys = [];
            return;
        }
        if (lastProvince && lastProvince === vm.familyAddressProvince.PROVINCE_CODE) {
            return;
        }
        var params = {
            PROVINCE_CODE: vm.familyAddressProvince.PROVINCE_CODE
        };
        lastProvince = vm.familyAddressProvince.PROVINCE_CODE;
        $rootScope.commonService('getCityListOfCertainProvince', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.familyAddressCitys = data;
                },
                function () {
                    vm.familyAddressCitys = [];
                    $rootScope.alertDialog('获取市列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取市列表失败');
        });
    };

    vm.initCountyListOfCertainCity = function () {
        if (vm.familyAddressCity === '-1') {
            vm.familyAddressCountys = [];
            return;
        }
        if (lastCity && lastCity === vm.familyAddressCity.CITY_CODE) {
            return;
        }
        var params = {
            CITY_CODE: vm.familyAddressCity.CITY_CODE
        };
        lastCity = vm.familyAddressCity.CITY_CODE;
        $rootScope.commonService('getCountyListOfCertainCity', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.familyAddressCountys = data;
                },
                function () {
                    vm.familyAddressCountys = [];
                    $rootScope.alertDialog('获取区/县失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取区/县失败');
        });
    };

    vm.initSubdistrictListOfCertainCounty = function () {
        if (vm.familyAddressCounty === '-1') {
            vm.familyAddressStreets = [];
            return;
        }
        if (lastCounty && lastCounty === vm.familyAddressCounty.COUNTY_DISTRICT_CODE) {
            return;
        }
        var params = {
            COUNTY_DISTRICT_CODE: vm.familyAddressCounty.COUNTY_DISTRICT_CODE
        };
        lastCounty = vm.familyAddressCounty.COUNTY_DISTRICT_CODE;
        $rootScope.commonService('getSubdistrictListOfCertainCounty', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.familyAddressStreets = data;
                },
                function () {
                    vm.familyAddressStreets = [];
                    $rootScope.alertDialog('获取街道列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取街道列表失败');
        });
    };

    vm.changeAddress = function (index) {
        switch (index) {
            case 1:
                vm.familyAddressCity = '-1';
                vm.familyAddressCounty = '-1';
                vm.familyAddressStreet = '-1';
                break;
            case 2:
                vm.familyAddressCounty = '-1';
                vm.familyAddressStreet = '-1';
                break;
            case 3:
                vm.familyAddressStreet = '-1';
                break;
            default:
                break;

        }
    };

    vm.downLoadFile = function (index) {
        vm.isDownloading = true;
        if (index === 0) {
            familyArchivesService.exportSignedFamily(downSignedPatam, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    downloadCommon.downloadFile(data['fileName'], "家庭档案信息.xls");
                    vm.isDownloading = false;
                }, function () {
                    vm.isDownloading = false;
                    $rootScope.alertDialog("信息导出失败");
                });
            }, function () {
                vm.isDownloading = false;
                $rootScope.alertDialog("信息导出失败");
            });
        } else {
            familyArchivesService.exportUnsignedFamily(downLoadParam, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    downloadCommon.downloadFile(data['fileName'], "家庭档案信息.xls");
                    vm.isDownloading = false;
                }, function () {
                    vm.isDownloading = false;
                    $rootScope.alertDialog("信息导出失败");
                });
            }, function () {
                vm.isDownloading = false;
                $rootScope.alertDialog("信息导出失败");
            });
        }

    };

    vm.create = function () {
        $state.go('main.resident.familyArchivesAdd');
    };
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('familyArchivesSidebarCtrl', familyArchivesSidebarCtrl);
familyArchivesSidebarCtrl.$inject = ['$rootScope', '$state', '$scope', '$stateParams', 'familyArchivesService'];
function familyArchivesSidebarCtrl($rootScope, $state, $scope, $stateParams, familyArchivesService) {
    var vm = this;

    vm.FAMILY_KEY_ID = $stateParams.FAMILY_KEY_ID;

    vm.currentTab = 'basicArchive';

    //获取家庭信息
    function searchFamilyDetail() {
        familyArchivesService.searchFamilyDetail(
            {
                "FAMILY_KEY_ID": $state.params.FAMILY_KEY_ID
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm['HOUSEHOLDER_NAME'] = data['HOUSEHOLDER_NAME'];
                    },
                    function () {
                        $rootScope.alertDialog("查询家庭信息失败");
                    }
                );
            },
            function () {
                $rootScope.alertDialog("查询家庭信息失败");
            }
        );

    }
    searchFamilyDetail();

    $scope.$on("updateFamilyDetail",
        function () { //监听来自父controller的信息
            searchFamilyDetail();
        }
    );

    vm.tabShow = true;
    vm.tabClick = function (tabName) {
        if (vm.currentTab === tabName) {
            vm.tabShow = !vm.tabShow;
        } else {
            vm.tabShow = true;
            vm.currentTab = tabName;
        }
    };
    $rootScope.$on('url-change', function () {
        vm.judgePage();
    });
    vm.judgePage = function () {
        if ($rootScope.isContains($state.current.name, 'signDoctor')) {
            vm.currentPage = 'signDoctor';
        } else if ($rootScope.isContains($state.current.name, 'familyMember')) {
            vm.currentPage = 'familyMember';
        } else {
            vm.currentPage = 'basic';
        }
    };
    vm.judgePage();//根据当前路径判断是哪一个页面
    vm.gotoFamilyArchive = function () {
        vm.currentPage = 'basic';
        $state.go('main.resident.familyArchivesSidebar.detail.familyArchivesEdit', {"FAMILY_KEY_ID": vm.FAMILY_KEY_ID});
    };

    vm.gotoFamilyMember = function () {
        vm.currentPage = 'familyMember';
        $state.go('main.resident.familyArchivesSidebar.detail.familyMember', {"FAMILY_KEY_ID": vm.FAMILY_KEY_ID});
    };

    vm.gotoSignDoctor = function () {
        vm.currentPage = 'signDoctor';
        $state.go('main.resident.familyArchivesSidebar.detail.signDoctor', {"FAMILY_KEY_ID": vm.FAMILY_KEY_ID});
    };
    return vm;
}

"use strict";
SMS.CONTROLLERS.controller('familyFamilyMemberCtrl', familyFamilyMemberCtrl);
familyFamilyMemberCtrl.$inject = ['$rootScope', '$state', '$scope', '$mdPanel', '$q', 'familyArchivesService'];
function familyFamilyMemberCtrl($rootScope, $state, $$scope, $mdPanel, $q, familyArchivesService) {
    var vm = this;
    vm.editable = true;
    var dict_type_code_list = [
        {
            "DICT_TYPE_CODE": "0014",//与户主关系类型
            "LIST_NAME": "householderRelationshipList"
        }
    ];
    var family_key_id = $state.params.FAMILY_KEY_ID;
    //转换数据
    function transformData(data) {
        vm['residentKeyId'] = data['RESIDENT_KEY_ID'];//户主ID
        vm['memberList'] = data['MEMBER_LIST'];//家庭成员
    }

    function eachDictValue(data) {
        angular.forEach(dict_type_code_list, function (item) {
            vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
        });
    }

    //获取家庭成员信息
    function searchFamilyMemberDetail() {
        familyArchivesService.searchFamilyMemberDetail(
            {
                "FAMILY_KEY_ID": family_key_id
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        transformData(data);
                    },
                    function () {
                        $rootScope.alertDialog("查询家庭信息失败");
                    }
                );
            },
            function () {
                $rootScope.alertDialog("查询家庭信息失败");
            }
        );
    }

    //获取字典表
    function getDictList() {
        $rootScope.commonService(
            'getDictList',
            {
                "DICT_TYPE_CODE_LIST": dict_type_code_list
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        eachDictValue(data);
                        searchFamilyMemberDetail();
                    },
                    function () {
                        $rootScope.alertDialog('获取字典列表失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取字典列表失败');
            }
        );
    }

    getDictList();

    //添加家庭成员
    vm.addFamilyMember = function () {
        if (vm['memberList'].length === 99) {
            $rootScope.alertDialog("家庭人数超过限制，无法添加家庭成员");
            return;
        }
        SMS.CONTROLLERS.controller('selectFamilyMemberController', selectFamilyMemberController);
        selectFamilyMemberController.$inject = ['$rootScope', '$scope', 'mdPanelRef', 'familyArchivesService'];
        function selectFamilyMemberController($rootScope, $scope, mdPanelRef, familyArchivesService) {
            $scope.searched = false;
            $scope.add = true;
            $scope['householderRelationshipList'] = vm['householderRelationshipList'];
            function callback(row) {
                if (row.FAMILY_KEY_ID !== undefined
                    && row.FAMILY_KEY_ID !== null
                    && row.FAMILY_KEY_ID !== "") {
                    $rootScope.alertDialog("不能添加该居民，因为该居民已组建过家庭");
                    return;
                }
                if (row['RESIDENT_KEY_ID'] === vm['residentKeyId']) {
                    $rootScope.alertDialog("不能选择户主作为家庭成员");
                    return;
                }
                familyArchivesService.getselectedFamilyMemberList(
                    $scope,
                    {},
                    {
                        "total": 1,
                        "rows": [row]
                    }
                );
                $scope['row'] = row;
                $scope['relationship'] = undefined;
                $scope.searched = true;
                $scope.$apply();
            }

            $scope.hide = function () {
                mdPanelRef.close();
            };
            $scope.cancel = function () {
                mdPanelRef.close();
            };
            $scope.back = function (form) {
                form.$setPristine();
                form.$setUntouched();
                $scope.searched = false;
            };
            $scope.addFamilyMember = function () {
                if ($rootScope.selectIndex(vm['memberList'], "RESIDENT_KEY_ID", $scope['row']['RESIDENT_KEY_ID']) !== -1) {
                    $rootScope.alertDialog("已经添加过该成员，不能重复添加");
                    return;
                }
                var HOUSEHOLDER_RELATIONSHIP_CODE = $scope['relationship'] === null? '':$scope['relationship']['DICT_VALUE_CODE'];
                var HOUSEHOLDER_RELATIONSHIP_NAME = $scope['relationship'] === null? $scope['relationshipSearchText']:$scope['relationship']['DICT_VALUE_NAME'];
                $scope['row']['HOUSEHOLDER_RELATIONSHIP_CODE'] = HOUSEHOLDER_RELATIONSHIP_CODE;
                $scope['row']['HOUSEHOLDER_RELATIONSHIP_NAME'] = HOUSEHOLDER_RELATIONSHIP_NAME;
                $scope['row']['HOUSEHOLDER_SYMBOL'] = "0";
                $scope['row']['FAMILY_KEY_ID'] = family_key_id;
                //vm['memberList'].push($scope['row']);
                //vm['MEMBER_CHANGED'] = true;//标识成员更新
                var params = $scope['row'];
                familyArchivesService.addFamilyMember(
                    params,
                    function (response) {
                        $rootScope.handleMessage(
                            response,
                            function () {
                                searchFamilyMemberDetail();
                                mdPanelRef.close();
                            },
                            function () {
                                $rootScope.alertDialog('添加家庭成员失败');
                            }
                        );
                    },
                    function () {
                        $rootScope.alertDialog('添加家庭成员失败');
                    }
                );
            };
            $scope.searchTextChange = function () {
                var result = $q.defer();
                //var searchList = $filter('filter')($scope['householderRelationshipList'], {'DICT_VALUE_NAME': search});//模糊搜索
                var searchList = $scope['householderRelationshipList'];
                result.resolve(searchList);
                return result.promise;
            };
            $scope.search = function () {
                $scope.getFamilyMemberList();
            };
            $scope.getFamilyMemberList = function () {
                var params = {
                    "SEARCH_RESIDENT": $scope.searchValue,
                    "RESIDENT_KEY_ID": vm['residentKeyId']
                };
                familyArchivesService.getFamilyMemberList($scope, params, callback);
            };
            $scope.$on('panelClose',
                function () {
                    mdPanelRef.close();
                }
            );
        }

        var position = $mdPanel.newPanelPosition().absolute().center();
        var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
        var config = {
            animation: animation,
            attachTo: angular.element(document.body),
            controller: selectFamilyMemberController,
            templateUrl: 'template/resident/familyArchives/selectFamilyMember.html',
            position: position,
            trapFocus: true,
            disableParentScroll: true,
            clickOutsideToClose: false,
            clickEscapeToClose: true,
            hasBackdrop: true,
            fullscreen: false
        };
        $mdPanel.open(config);
    };
    //查看家庭成员
    vm.viewFamilyMember = function (item) {
        if (!$rootScope.isShow('1003001002')) {
            return;
        }
        $state.go('main.resident.residentArchivesSidebar.detail.residentArchivesEdit', {"RESIDENT_KEY_ID": item.RESIDENT_KEY_ID});
    };
    //编辑家庭成员
    vm.editFamilyMember = function (item) {
        SMS.CONTROLLERS.controller('editFamilyMemberController', editFamilyMemberController);
        editFamilyMemberController.$inject = ['$rootScope', '$scope', 'mdPanelRef', 'familyArchivesService'];
        function editFamilyMemberController($rootScope, $scope, mdPanelRef, familyArchivesService) {
            $scope.searched = true;
            $scope.edit = true;
            $scope.setHolder = false;
            $scope['householderRelationshipList'] = vm['householderRelationshipList'];
            $scope['otherFamilyMember'] = angular.copy(vm['memberList']);
            //$scope['householder'] = $rootScope.selectItem(vm['memberList'], 'RESIDENT_KEY_ID', vm['residentKeyId']);//原来的户主
            $scope['otherFamilyMember'].splice($rootScope.selectIndex(vm['memberList'], 'RESIDENT_KEY_ID', item['RESIDENT_KEY_ID']), 1);
            //item['FAMILY_KEY_ID'] = "-1";//改为已经组成家庭
            item['FAMILY_KEY_ID'] = family_key_id;
            $scope['row'] = item;
            $scope['relationship'] = $rootScope.selectItem($scope['householderRelationshipList'], "DICT_VALUE_CODE", $scope['row']['HOUSEHOLDER_RELATIONSHIP_CODE']);
            if ($scope['relationship'] === undefined) {
                $scope['relationship'] = {
                    'DICT_VALUE_CODE': '',
                    'DICT_VALUE_NAME': $scope['row']['HOUSEHOLDER_RELATIONSHIP_NAME']
                };
            }
            familyArchivesService.getselectedFamilyMemberList(
                $scope,
                {},
                {
                    "total": 1,
                    "rows": [$scope['row']]
                }
            );
            $scope.hide = function () {
                mdPanelRef.close();
            };
            $scope.cancel = function () {
                mdPanelRef.close();
            };
            $scope.back = function (form) {
                form.$setPristine();
                form.$setUntouched();
                $scope.searched = false;
            };
            $scope.addFamilyMember = function () {
                var HOUSEHOLDER_RELATIONSHIP_CODE = $scope['relationship'] === null? '':$scope['relationship']['DICT_VALUE_CODE'];
                var HOUSEHOLDER_RELATIONSHIP_NAME = $scope['relationship'] === null? $scope['relationshipSearchText']:$scope['relationship']['DICT_VALUE_NAME'];
                $scope['row']['HOUSEHOLDER_RELATIONSHIP_CODE'] = HOUSEHOLDER_RELATIONSHIP_CODE;
                $scope['row']['HOUSEHOLDER_RELATIONSHIP_NAME'] = HOUSEHOLDER_RELATIONSHIP_NAME;
                $scope['row']['HOUSEHOLDER_SYMBOL'] = "0";
                //vm['MEMBER_CHANGED'] = true;//标识成员更新
                var params = $scope['row'];
                familyArchivesService.editFamilyMember(
                    params,
                    function (response) {
                        $rootScope.handleMessage(
                            response,
                            function () {
                                searchFamilyMemberDetail();
                                mdPanelRef.close();
                            },
                            function () {
                                $rootScope.alertDialog('保存家庭成员失败');
                            }
                        );
                    },
                    function () {
                        $rootScope.alertDialog('保存家庭成员失败');
                    }
                );
            };
            $scope.searchTextChange = function () {
                var result = $q.defer();
                //var searchList = $filter('filter')($scope['householderRelationshipList'], {'DICT_VALUE_NAME': search});//模糊搜索
                var searchList = $scope['householderRelationshipList'];
                result.resolve(searchList);
                return result.promise;
            };
            //更换户主
            $scope.setFamilyHolder = function () {
                var FAMILY_MEMBER_LIST = [
                    {
                        "RESIDENT_KEY_ID": $scope['row']['RESIDENT_KEY_ID'],//新户主ID
                        "HOUSEHOLDER_SYMBOL": 1,
                        "HOUSEHOLDER_RELATIONSHIP_CODE": null,//把与户主关系传成null
                        "HOUSEHOLDER_RELATIONSHIP_NAME": null//把与户主关系传成null
                    }
                ];
                angular.forEach($scope['otherFamilyMember'], function (item) {
                    FAMILY_MEMBER_LIST.push({
                        "RESIDENT_KEY_ID": item['RESIDENT_KEY_ID'],
                        "HOUSEHOLDER_SYMBOL": 0,
                        "HOUSEHOLDER_RELATIONSHIP_CODE": item['resetRelationship'] === null? '':item['resetRelationship']['DICT_VALUE_CODE'],
                        "HOUSEHOLDER_RELATIONSHIP_NAME": item['resetRelationship'] === null? item['searchText']:item['resetRelationship']['DICT_VALUE_NAME']
                    });
                });
                var params = {
                    "FAMILY_KEY_ID": family_key_id,
                    "RESIDENT_KEY_ID": $scope['row']['RESIDENT_KEY_ID'],//新户主ID
                    "FAMILY_MEMBER_LIST": FAMILY_MEMBER_LIST//List里面放的是所有家庭成员的信息,包括户主，第一条就是户主的信息
                };
                familyArchivesService.setFamilyHolder(
                    params,
                    function (response) {
                        $rootScope.handleMessage(
                            response,
                            function () {
                                $rootScope.alertDialog('更换户主成功');
                                searchFamilyMemberDetail();
                                $$scope.$emit("updateFamilyDetail");//将信息传递给父controller
                                mdPanelRef.close();
                            },
                            function () {
                                $rootScope.alertDialog('更换户主失败');
                            }
                        );
                    },
                    function () {
                        $rootScope.alertDialog('更换户主失败');
                    }
                );
            };
            $scope.gotoFamilyHolder = function (form) {
                form.$setPristine();
                form.$setUntouched();
                $scope.setHolder = true;
            };
            $scope.backEdit = function () {
                $scope.setHolder = false;
            };
            $scope.search = function () {
                $scope.getFamilyMemberList();
            };
            $scope.getFamilyMemberList = function () {
                var params = {
                    "SEARCH_RESIDENT": $scope.searchValue
                };
                familyArchivesService.getFamilyMemberList($scope, params, callback);
            };
            $scope.$on('panelClose',
                function () {
                    mdPanelRef.close();
                }
            );
        }

        var position = $mdPanel.newPanelPosition().absolute().center();
        var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
        var config = {
            animation: animation,
            attachTo: angular.element(document.body),
            controller: editFamilyMemberController,
            templateUrl: 'template/resident/familyArchives/selectFamilyMember.html',
            position: position,
            trapFocus: true,
            disableParentScroll: true,
            clickOutsideToClose: false,
            clickEscapeToClose: true,
            hasBackdrop: true,
            fullscreen: false
        };
        $mdPanel.open(config);
    };
    //删除家庭成员
    vm.deleteFamilyMember = function (index) {
        $rootScope.confirmDialog(
            '是否要将该成员从家庭中去除？',
            function () {
                var params = {
                    "FAMILY_KEY_ID": family_key_id,
                    "RESIDENT_KEY_ID": vm['memberList'][index]['RESIDENT_KEY_ID']
                };
                familyArchivesService.deleteFamilyMember(
                    params,
                    function (response) {
                        $rootScope.handleMessage(
                            response,
                            function () {
                                searchFamilyMemberDetail();
                            },
                            function () {
                                $rootScope.alertDialog('删除家庭成员失败');
                            }
                        );
                    },
                    function () {
                        $rootScope.alertDialog('删除家庭成员失败');
                    }
                );
            },
            function () {

            }
        );
        //vm['memberList'].splice(index, 1);
        //vm['MEMBER_CHANGED'] = true;//标识成员更新
    };

    return vm;
}
"use strict";
SMS.SERVICES.service('familyArchivesService', familyArchivesService);
familyArchivesService.$inject = ['$rootScope', '$state', 'FamilyArchives', 'bootstrapTable'];
function familyArchivesService($rootScope, $state, FamilyArchives, bootstrapTable) {
    var vm = this;

    vm.searchFamilyDetail = function (params, successFunction, failedFunction) {
        FamilyArchives.searchFamilyDetail(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.searchSignFamilyMember = function (params, successFunction, failedFunction) {
        FamilyArchives.searchSignFamilyMember(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.searchResident = function (params, successFunction, failedFunction) {
        FamilyArchives.searchResident(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.searchSignDoctor = function (params, successFunction, failedFunction) {
        FamilyArchives.searchSignDoctor(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.addFamily = function (params, successFunction, failedFunction) {
        FamilyArchives.addFamily(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.editFamily = function (params, successFunction, failedFunction) {
        FamilyArchives.editFamily(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.searchFamilyMemberDetail = function (params, successFunction, failedFunction) {
        FamilyArchives.searchFamilyMemberDetail(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.addFamilyMember = function (params, successFunction, failedFunction) {
        FamilyArchives.addFamilyMember(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.editFamilyMember = function (params, successFunction, failedFunction) {
        FamilyArchives.editFamilyMember(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.deleteFamilyMember = function (params, successFunction, failedFunction) {
        FamilyArchives.deleteFamilyMember(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.setFamilyHolder = function (params, successFunction, failedFunction) {
        FamilyArchives.setFamilyHolder(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.searchSignDoctorDetail = function (params, successFunction, failedFunction) {
        FamilyArchives.searchSignDoctorDetail(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.addSignDoctor = function (params, successFunction, failedFunction) {
        FamilyArchives.addSignDoctor(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.editSignDoctor = function (params, successFunction, failedFunction) {
        FamilyArchives.editSignDoctor(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.exportSignedFamily = function (param, successFunction, failedFunction) {
        FamilyArchives.exportSignedFamily(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.exportUnsignedFamily = function (param, successFunction, failedFunction) {
        FamilyArchives.exportUnsignedFamily(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getSignedDoctorList = function (param, successFunction, failedFunction) {
        FamilyArchives.getSignedDoctorList(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getDoctorList = function ($vm, listPara, callback) {
        var list = {
            dataFunction: getDoctorList,
            dataParams: listPara,
            pageSize: 5, // 设置默认分页为 5
            pageList: [5],
            columns: [{
                field: 'DOCTOR_NAME',
                title: '姓名',
                align: 'center',
                formatter: function (val) {
                    return "<div id='doctorId'  style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click #doctorId': function (e, vlaue, row) {
                        callback(row);
                    }
                }
            }, {
                field: 'DOCTOR_TITLE_NAME',
                title: '职称',
                align: 'center'
            }, {
                field: 'SKILLED_PROJECT',
                title: '擅长',
                align: 'center'
            }, {
                field: 'DOCTOR_PHONE_NUMBER',
                title: '联系电话',
                align: 'center'
            }]
        };

        function getDoctorList(param, successFunction, failedFunction) {
            FamilyArchives.searchSignDoctor(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };

    vm.getselectedDoctorList = function ($vm, listPara, data) {
        var list = {
            dataFunction: getselectedDoctorList,
            dataParams: listPara,
            pagination: false,
            pageSize: 5, // 设置默认分页为 5
            pageList: [5],
            columns: [{
                field: 'DOCTOR_NAME',
                title: '姓名',
                align: 'center'
            }, {
                field: 'DOCTOR_TITLE_NAME',
                title: '职称',
                align: 'center'
            }, {
                field: 'SKILLED_PROJECT',
                title: '擅长',
                align: 'center'
            }, {
                field: 'DOCTOR_PHONE_NUMBER',
                title: '联系电话',
                align: 'center'
            }]
        };

        function getselectedDoctorList(param, successFunction) {
            successFunction(data);
        }

        $vm.selectedTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
        $vm.selectedTableData.bsTableControl.operat = 'refresh';
    };

    vm.getFamilyMemberList = function ($vm, listPara, callback) {
        var list = {
            dataFunction: getFamilyMemberList,
            dataParams: listPara,
            pageSize: 5, // 设置默认分页为 5
            pageList: [5],
            columns: [{
                field: 'RESIDENT_NAME',
                title: '居民姓名',
                align: 'center',
                formatter: function (val) {
                    return "<div id='doctorId'  style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click #doctorId': function (e, vlaue, row) {
                        callback(row);
                    }
                }
            }, {
                field: 'RESIDENT_SEX_NAME',
                title: '性别',
                align: 'center'
            }, {
                field: 'RESIDENT_PHONE_NO',
                title: '手机号',
                align: 'center'
            }, {
                field: 'RESIDENT_ID_NO',
                title: '身份证号',
                align: 'center'
            }, {
                field: 'FAMILY_KEY_ID',
                title: '是否已组建家庭',
                align: 'center',
                formatter: function (val) {
                    if (val !== undefined && val !== null && val !== "") {
                        return "是";
                    }
                    return "否";
                }
            }]
        };

        function getFamilyMemberList(param, successFunction, failedFunction) {
            FamilyArchives.searchSignFamilyMember(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };

    vm.getselectedFamilyMemberList = function ($vm, listPara, data) {
        var list = {
            dataFunction: getselectedFamilyMemberList,
            dataParams: listPara,
            pagination: false,
            pageSize: 5, // 设置默认分页为 5
            pageList: [5],
            columns: [{
                field: 'RESIDENT_NAME',
                title: '居民姓名',
                align: 'center'
            }, {
                field: 'RESIDENT_SEX_NAME',
                title: '性别',
                align: 'center'
            }, {
                field: 'RESIDENT_PHONE_NO',
                title: '手机号',
                align: 'center'
            }, {
                field: 'RESIDENT_ID_NO',
                title: '身份证号',
                align: 'center'
            }, {
                field: 'FAMILY_KEY_ID',
                title: '是否已组建家庭',
                align: 'center',
                formatter: function (val) {
                    if (val !== undefined && val !== null && val !== "") {
                        return "是";
                    }
                    return "否";
                }
            }]
        };

        function getselectedFamilyMemberList(param, successFunction) {
            successFunction(data);
        }

        $vm.selectedTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
        $vm.selectedTableData.bsTableControl.operat = 'refresh';
    };

    vm.getFamilyArchiveList = function ($vm, listPara) {
        var list = {
            dataFunction: getFamilyList,
            dataParams: listPara,
            columns: [{
                field: 'HOUSEHOLDER_NAME',
                title: '户主名称',
                align: 'center',
                formatter: function (val) {
                    return "<div  style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click div': function (e, vlaue, row) {
                        $state.go('main.resident.familyArchivesSidebar.detail.familyArchivesEdit', {"FAMILY_KEY_ID": row.FAMILY_KEY_ID});
                    }
                }
            }, {
                field: 'FIXED_PHONE_NO',
                title: '联系电话',
                align: 'center'
            }, {
                field: 'FAMILY_NUMBER',
                title: '家庭人数',
                align: 'center'
            }, {
                field: 'HOUSE_ADDRESS',
                title: '家庭住址',
                align: 'center'
            }, {
                field: 'CREATE_TIME',
                title: '建档时间',
                align: 'center'
            }]
        };

        function getFamilyList(param, successFunction, failedFunction) {
            FamilyArchives.showUnsignedFamily(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };

    vm.getSignedFamilyArchiveList = function ($vm, listPara) {
        var list = {
            dataFunction: getSignedFamilyList,
            dataParams: listPara,
            columns: [{
                field: 'HOUSEHOLDER_NAME',
                title: '户主名称',
                align: 'center',
                formatter: function (val) {
                    return "<div  style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click div': function (e, vlaue, row) {
                        $state.go('main.resident.familyArchivesSidebar.detail.familyArchivesEdit', {"FAMILY_KEY_ID": row.FAMILY_KEY_ID});
                    }
                }
            }, {
                field: 'FIXED_PHONE_NO',
                title: '联系电话',
                align: 'center'
            }, {
                field: 'FAMILY_NUMBER',
                title: '家庭人数',
                align: 'center'
            }, {
                field: 'HOUSE_ADDRESS',
                title: '家庭住址',
                align: 'center'
            }, {
                field: 'CREATE_TIME',
                title: '建档时间',
                align: 'center'
            }, {
                field: 'DOCTOR_NAME',
                title: '签约医生',
                align: 'center'
            }, {
                field: 'ORGANIZATION_NAME',
                title: '医生所属机构',
                align: 'center'
            }]
        };

        function getSignedFamilyList(param, successFunction, failedFunction) {
            FamilyArchives.showSignedFamily(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.signedTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };
    
    vm.getSignedRecordList = function ($vm, params) {
        function ajaxSignedRecordRequest(params, successFunction, failedFunction) {
            FamilyArchives.getSignedRecordList(JSON.stringify(params)).$promise
                .then(function (response) {
                    $rootScope.handleMessage(response, function () {
                        successFunction(response.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        var list = {
            dataFunction: ajaxSignedRecordRequest,
            dataParams: params,
            columns: [{
                field: 'CREATE_TIME',
                title: '时间',
                align: 'center'
            }, {
                field: 'RECORD_INFO',
                title: '操作记录',
                align: 'left',
                formatter: recordFormat
            }],
            showHeader: false,
            classes: 'table table-no-bordered'
        };
        $vm.signedRecordTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };

        function recordFormat(value, row) {
            var result = '<div><span style="color: #428bca">' + row.CREATOR_NAME + '</span>' + row.RECORD_INFO + '</div>';
            if(row.REMARK !== null && row.REMARK !== undefined && row.REMARK !== ""){
                result += ('<div>备注：' + row.REMARK + '</div>');
            }
            return result;
        }

        return $vm;
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('familySignDoctorCtrl', familySignDoctorCtrl);
familySignDoctorCtrl.$inject = ['$rootScope', '$state', '$mdDialog', '$mdPanel', 'familyArchivesService'];
function familySignDoctorCtrl($rootScope, $state, $mdDialog, $mdPanel, familyArchivesService) {
    var vm = this;
    vm.editable = true;
    var family_key_id = $state.params.FAMILY_KEY_ID;
    vm.dataBak;
    init(0);
    function init(model) {
        //model
        //0-----初始化
        //1-----刷新
        searchSignDoctorDetail();
        if(model === 1){
            vm.signedRecordTableData.bsTableControl.operat = 'refresh';
        }else{
            getSignedRecordList();
        }
    }

    //是否有签约医生
    function isSignDoctor() {
        return !$rootScope.isEmptyObject(vm.dataBak);
    }

    //转换数据
    function transformData(data) {
        vm.dataBak = angular.copy(data);
        if (isSignDoctor()) {
            vm['responsibleDoctorId'] = data['RESPONSIBLE_DOCTOR_ID'];//责任医生ID
            vm['responsibleDoctorName'] = data['RESPONSIBLE_DOCTOR_NAME'];//责任医生姓名
            vm['belongHospitalId'] = data['BELONG_HOSPITAL_ID'];
            vm['hospitalName'] = data['HOSPITAL_NAME'];//所属医院
            vm['doctorTitleDode'] = data['DOCTOR_TITLE_CODE'];
            vm['doctorTitleName'] = data['DOCTOR_TITLE_NAME'];//职称
            vm['beginTime'] = data['BEGIN_TIME'];
            vm['endTime'] = data['END_TIME'];
            if (vm['beginTime'] !== undefined
                && vm['beginTime'] !== ''
                && vm['beginTime'] !== null) {
                vm['beginTimeFormat'] = new Date(vm['beginTime']);
            }
            if (vm['endTime'] !== undefined
                && vm['endTime'] !== ''
                && vm['endTime'] !== null) {
                vm['endTimeFormat'] = new Date(vm['endTime']);
            }
        } else {
            vm['responsibleDoctorId'] = null;
            vm['responsibleDoctorName'] = null;
            vm['belongHospitalId'] = null;
            vm['hospitalName'] = null;
            vm['doctorTitleDode'] = null;
            vm['doctorTitleName'] = null;
        }
    }

    //获取签约医生信息
    function searchSignDoctorDetail() {
        familyArchivesService.searchSignDoctorDetail(
            {
                "FAMILY_KEY_ID": family_key_id
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        transformData(data);
                    },
                    function () {
                        $rootScope.alertDialog("查询签约医生信息失败");
                    }
                );
            },
            function () {
                $rootScope.alertDialog("查询签约医生信息失败");
            }
        );
    }

    //添加签约医生
    vm.addDoctor = function () {
        SMS.CONTROLLERS.controller('selectDoctorController', selectDoctorController);
        selectDoctorController.$inject = ['$rootScope', '$scope', 'mdPanelRef', '$filter', 'familyArchivesService'];
        function selectDoctorController($rootScope, $scope, mdPanelRef, $filter, familyArchivesService) {
            $scope.searched = false;
            function callback(row) {
                $scope.searched = true;
                familyArchivesService.getselectedDoctorList(
                    $scope,
                    {},
                    {
                        "total": 1,
                        "rows": [row]
                    }
                );
                $scope['row'] = row;
                $rootScope.getCurrentDateTime(
                    function (data) {
                        if (vm['beginTimeFormat'] === undefined) {
                            vm['beginTimeFormat'] = data;
                            vm['beginTime'] = $filter('commonDate')(vm['beginTimeFormat']);
                            var tempEndTime = new Date(new Date(vm['beginTimeFormat']).getTime());
                            tempEndTime.setFullYear(tempEndTime.getFullYear() + 1);
                            tempEndTime.setDate(tempEndTime.getDate() - 1);
                            vm['endTimeFormat'] = tempEndTime;
                            vm['endTime'] = $filter('commonDate')(vm['endTimeFormat']);
                        }
                        if ($scope['beginTime'] === undefined) {
                            $scope['beginTime'] = $filter('commonDate')(vm['beginTimeFormat'], 'yyyy年MM月dd日');
                            $scope['endTime'] = $filter('commonDate')(vm['endTimeFormat'], 'yyyy年MM月dd日');
                            $scope.$apply();
                        }
                    }
                );
                $scope.$apply();
            }

            function addSignDoctor(params) {
                familyArchivesService.addSignDoctor(
                    params,
                    function (response) {
                        $rootScope.handleMessage(
                            response,
                            function () {
                                init(1);
                                mdPanelRef.close();
                            },
                            function () {
                                $rootScope.alertDialog('添加签约医生失败');
                            }
                        );
                    },
                    function () {
                        $rootScope.alertDialog('添加签约医生失败');
                    }
                );
            }

            function editSignDoctor(params) {
                familyArchivesService.editSignDoctor(
                    params,
                    function (response) {
                        $rootScope.handleMessage(
                            response,
                            function () {
                                init(1);
                                mdPanelRef.close();
                            },
                            function () {
                                $rootScope.alertDialog('更换签约医生失败');
                            }
                        );
                    },
                    function () {
                        $rootScope.alertDialog('更换签约医生失败');
                    }
                );
            }

            $scope.hide = function () {
                mdPanelRef.close();
            };
            $scope.cancel = function () {
                mdPanelRef.close();
            };
            $scope.back = function () {
                $scope.searched = false;
            };
            $scope.addDoctor = function () {
                var row = $scope['row'];
                var NEW_VALUE = {
                    "FAMILY_KEY_ID": family_key_id,
                    "RESPONSIBLE_DOCTOR_ID": row['DOCTOR_ID'],
                    "RESPONSIBLE_DOCTOR_NAME": row['DOCTOR_NAME'],
                    "BELONG_HOSPITAL_ID": row['BELONG_HOSPITAL_ID'],
                    "HOSPITAL_NAME": row['HOSPITAL_NAME'],
                    "DOCTOR_TITLE_CODE": row['DOCTOR_TITLE_CODE'],
                    "DOCTOR_TITLE_NAME": row['DOCTOR_TITLE_NAME'],
                    "BEGIN_TIME": vm['beginTime'],
                    "END_TIME": vm['endTime']
                };
                if (isSignDoctor()) {
                    var params = {
                        "FAMILY_KEY_ID": family_key_id,
                        "OLD_RESPONSIBLE_DOCTOR_ID": vm['dataBak']['RESPONSIBLE_DOCTOR_ID'],
                        "NEW_RESPONSIBLE_DOCTOR_ID": NEW_VALUE['RESPONSIBLE_DOCTOR_ID'],
                        "NEW_RESPONSIBLE_DOCTOR_NAME": NEW_VALUE['RESPONSIBLE_DOCTOR_NAME']
                    };
                    editSignDoctor(params);
                } else {
                    var params = NEW_VALUE;
                    addSignDoctor(params);
                }
                //vm['responsibleDoctorId'] = $scope['row']['FAMILY_DOCTOR_KEY_ID'];//责任医生ID
                //vm['responsibleDoctorName'] = $scope['row']['DOCTOR_NAME'];//责任医生姓名
                //vm['hospitalName'] = $scope['row']['HOSPITAL_NAME'];//所属医院
                //vm['doctorTitleName'] = $scope['row']['DOCTOR_TITLE_NAME'];//职称
                //vm['DOCTOR_CHANGED'] = true;
                //mdPanelRef.close();
            };
            $scope.search = function () {
                $scope.getDoctorList();
            };
            $scope.getDoctorList = function () {
                var params = {
                    "SEARCH_DOCTOR": $scope.searchValue
                };
                familyArchivesService.getDoctorList($scope, params, callback);
            };
            $scope.$on('panelClose',
                function () {
                    mdPanelRef.close();
                }
            );
        }

        var position = $mdPanel.newPanelPosition().absolute().center();
        var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
        var config = {
            animation: animation,
            attachTo: angular.element(document.body),
            controller: selectDoctorController,
            templateUrl: 'template/resident/familyArchives/selectDoctor.html',
            position: position,
            trapFocus: true,
            disableParentScroll: true,
            clickOutsideToClose: false,
            clickEscapeToClose: true,
            hasBackdrop: true,
            fullscreen: false
        };
        $mdPanel.open(config);
    };

    //签约记录
    function getSignedRecordList() {
        var data = {
            "FAMILY_KEY_ID": family_key_id
        };

        familyArchivesService.getSignedRecordList(vm, data);
    }

    //解除签约
    vm.removeSign = function () {
        SMS.CONTROLLERS.controller('DialogRemoveSignEnsureController', DialogRemoveSignEnsureController);
        DialogRemoveSignEnsureController.$inject = ['$scope', '$mdDialog', 'mdPanelRef', 'doctorIndividualService'];
        function DialogRemoveSignEnsureController($scope, $mdDialog, mdPanelRef, doctorIndividualService) {
            $scope.hide = function () {
                mdPanelRef.close();
            };
            $scope.cancel = function () {
                mdPanelRef.close();
            };

            $scope.ensure = function (form) {
                if (!$rootScope.check(form)) {
                    return;
                }
                var params = {
                    "BEFORE_DOCTOR_ID": vm.responsibleDoctorId,
                    "REMARK": $scope.remark,
                    "FAMILY_LIST": [{
                        "FAMILY_KEY_ID": family_key_id
                    }]
                };

                doctorIndividualService.terminateBatch(
                    params,
                    function (response) {
                        $rootScope.handleMessage(
                            response,
                            function () {
                                init(1);
                                $rootScope.alertDialog('解约成功！').then(mdPanelRef.close());
                            },
                            function () {
                                $rootScope.alertDialog('解约失败');
                            }
                        );
                    },
                    function () {
                        $rootScope.alertDialog('解约失败');
                    });
            };

            function initremoveSign() {
                $scope.householder_name = vm.householder_name;
                $scope.signedDoctor = vm.responsibleDoctorName;
                $scope.remark = "";
                $scope.familyModel = true;
            };
            initremoveSign();

            $scope.$on('panelClose',
                function(){
                    mdPanelRef.close();
                }
            );
        }

        var position = $mdPanel.newPanelPosition().absolute().center();
        var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
        var config = {
            animation: animation,
            attachTo: angular.element(document.body),
            controller: DialogRemoveSignEnsureController,
            templateUrl: 'template/doctor/doctorIndividual/signManage/_removeSignEnsure.html',
            position: position,
            trapFocus: true,
            disableParentScroll: true,
            clickOutsideToClose: false,
            clickEscapeToClose: true,
            hasBackdrop: true,
            fullscreen: false
        };
        $mdPanel.open(config);
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('residentArchivesAddCtrl', residentArchivesAddCtrl);
residentArchivesAddCtrl.$inject = ['$rootScope', '$state', 'residentArchivesService', '$filter'];
function residentArchivesAddCtrl($rootScope, $state, residentArchivesService, $filter) {
    var vm = this;

    //控制是否可编辑的字段
    vm.editable = true;

    //先赋初值，避免报错
    vm.medicalExpensesPaymentWaySelected = [];
    vm.drugAllergyHistorySelected = [];
    vm.exposureHistorySelected = [];
    vm.deformityConditionSelected = [];

    var dict_type_code_list = [
        {
            "DICT_TYPE_CODE": "0009",//性别
            "LIST_NAME": "sexCodeName"
        }, {
            "DICT_TYPE_CODE": "0010",//民族
            "LIST_NAME": "nationArr"
        }, {
            "DICT_TYPE_CODE": "0007001",//居住类型
            "LIST_NAME": "resideTypeArr"
        }, {
            "DICT_TYPE_CODE": "0011",//婚姻状况
            "LIST_NAME": "maritalStateArr"
        }, {
            "DICT_TYPE_CODE": "0008001",//户口属性
            "LIST_NAME": "householdRegisterArr"
        }, {
            "DICT_TYPE_CODE": "0007002",//常住类型
            "LIST_NAME": "registerSignArr"
        }, {
            "DICT_TYPE_CODE": "0008002",//血型
            "LIST_NAME": "bloodTypeArr"
        }, {
            "DICT_TYPE_CODE": "0008003",//文化程度
            "LIST_NAME": "degreeOfEducationArr"
        }, {
            "DICT_TYPE_CODE": "0008004",//职业
            "LIST_NAME": "careerTypeArr"
        }, {
            "DICT_TYPE_CODE": "0012",//医疗费用支付方式
            "LIST_NAME": "medicalExpensesPaymentWayArr"
        }, {
            "DICT_TYPE_CODE": "0008005",//药物过敏史
            "LIST_NAME": "drugAllergyHistoryArr"
        }, {
            "DICT_TYPE_CODE": "0008006",//暴露史
            "LIST_NAME": "exposureHistoryArr"
        }, {
            "DICT_TYPE_CODE": "0008007",//残疾情况
            "LIST_NAME": "deformityConditionArr"
        }, {
            "DICT_TYPE_CODE": "0007006",//厨房排风措施
            "LIST_NAME": "kitchen_ventilation_system_arr"
        }, {
            "DICT_TYPE_CODE": "0007007",//燃料类型
            "LIST_NAME": "fuel_type_arr"
        }, {
            "DICT_TYPE_CODE": "0007008",//饮水
            "LIST_NAME": "water_source_arr"
        }, {
            "DICT_TYPE_CODE": "0007009",//厕所
            "LIST_NAME": "toilet_type_arr"
        }, {
            "DICT_TYPE_CODE": "0007010",//禽畜栏
            "LIST_NAME": "pinfold_position_arr"
        }
    ];

    vm.exists = function (item, list) {
        return list.indexOf(item) > -1;
    };

    vm.toggle = function (item, list) {
        var idx = list.indexOf(item);
        if (idx > -1) {
            list.splice(idx, 1);
        }
        else {
            list.push(item);
        }
    };

    //获取字典列表
    $rootScope.commonService(
        "getDictList",
        {"DICT_TYPE_CODE_LIST": dict_type_code_list},
        function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.dictList = data;
                    eachDictValue(data);
                },
                function () {
                    $rootScope.alertDialog('获取字典列表失败');
                }
            );
        },
        function () {
            $rootScope.alertDialog('获取字典列表失败');
        }
    );

    //单个赋值
    function eachDictValue(data) {
        angular.forEach(dict_type_code_list, function (item) {
            vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
        });
    }

    vm.remove = function (index, list) {
        list.splice(index, 1);
    };

    vm.checkIdNo = function (form) {
        if (!residentArchivesService.isEmptyObject(form.idNo.$error)) {
            return;
        }
        residentArchivesService.checkIdNo(
            {
                "RESIDENT_KEY_ID": "",
                "RESIDENT_ID_NO": vm.idNo
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        if (data) {
                            $rootScope.alertDialog('根据身份证号验证，该居民已创建过档案，不能重复创建');
                        }
                    },
                    function () {
                        $rootScope.alertDialog('身份证查重失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('身份证查重失败');
            }
        );
    };

    vm.disease_history_list = [];
    vm.operation_history_list = [];
    vm.injury_history_list = [];
    vm.transfusion_history_list = [];
    vm.hospitalization_history_list = [];
    vm.family_medical_history_list = [];
    vm.genetic_history_list = [];

    //添加疾病史
    vm.addDiseaseHistory = function () {
        vm.disease_history_list.push({
            "DISEASE_NAME": "",
            "TIME_OF_DIAGNOSIS": null,
            "REMARK": ""
        });
    };
    vm.disease_history_tate_change = function () {
        if (vm.disease_history_tate === 0) {
            vm.disease_history_list = [];
        } else if (vm.disease_history_tate === 1) {
            vm.addDiseaseHistory();
        }
    };

    //添加手术史
    vm.addOperationHistory = function () {
        vm.operation_history_list.push({
            "OPERATION_NAME": "",
            "OPERATION_TIME": null,
            "OPERATION_DIAGNOSIS": "",
            "REMARK": ""
        });
    };
    vm.operation_history_state_change = function () {
        if (vm.operation_history_state === 0) {
            vm.operation_history_list = [];
        } else if (vm.operation_history_state === 1) {
            vm.addOperationHistory();
        }
    };

    //添加外伤史
    vm.addInjuryHistory = function () {
        vm.injury_history_list.push({
            "INJURY_NAME": "",
            "INJURY_TIME": null,
            "REMARK": ""
        });
    };
    vm.injury_history_state_change = function () {
        if (vm.injury_history_state === 0) {
            vm.injury_history_list = [];
        } else if (vm.injury_history_state === 1) {
            vm.addInjuryHistory();
        }
    };

    //添加输血史
    vm.addTransfusionHistory = function () {
        vm.transfusion_history_list.push({
            "TRANSFUSION_REASON": "",
            "TRANSFUSION_TIME": null,
            "TRANSFUSION_VOLUME": "",
            "REMARK": ""
        });
    };
    vm.transfusion_history_state_change = function () {
        if (vm.transfusion_history_state === 0) {
            vm.transfusion_history_list = [];
        } else if (vm.transfusion_history_state === 1) {
            vm.addTransfusionHistory();
        }
    };

    //添加住院史
    vm.addHospitalizationHistory = function () {
        vm.hospitalization_history_list.push({
            "HOSPITALIZATION_REASON": "",
            "HOSPITALIZATION_TIME": null,
            "DIAGNOSIS": "",
            "MEDICAL_INSTITUTION_NAME": "",
            "REMARK": ""
        });
    };
    vm.hospitalization_history_state_change = function () {
        if (vm.hospitalization_history_state === 0) {
            vm.hospitalization_history_list = [];
        } else if (vm.hospitalization_history_state === 1) {
            vm.addHospitalizationHistory();
        }
    };

    //添加家族史
    vm.addFamilyMedicalHistory = function () {
        vm.family_medical_history_list.push({
            "DISEASE_NAME": "",
            "RELATIONSHIP": "",
            "REMARK": ""
        });
    };
    vm.family_medical_history_state_change = function () {
        if (vm.family_medical_history_state === 0) {
            vm.family_medical_history_list = [];
        } else if (vm.family_medical_history_state === 1) {
            vm.addFamilyMedicalHistory();
        }
    };

    //添加遗传史
    vm.addGeneticHistory = function () {
        vm.genetic_history_list.push({
            "DISEASE_NAME": "",
            "REMARK": ""
        });
    };
    vm.genetic_history_state_change = function () {
        if (vm.genetic_history_state === 0) {
            vm.genetic_history_list = [];
        } else if (vm.genetic_history_state === 1) {
            vm.addGeneticHistory();
        }
    };

    vm.nativePlaceProvince = '-1';
    vm.nativePlaceCity = '-1';
    vm.registerProvince = '-1';
    vm.registerCity = '-1';
    vm.registerCounty = '-1';
    vm.registerStreet = '-1';
    vm.addressProvince = '-1';
    vm.addressCity = '-1';
    vm.addressCounty = '-1';
    vm.addressStreet = '-1';
    vm.changeAddress = function (index) {
        switch (index) {
            case 11:
                vm.nativePlaceCity = '-1';
                break;
            case 21:
                vm.registerCity = '-1';
                vm.registerCounty = '-1';
                vm.registerStreet = '-1';
                break;
            case 22:
                vm.registerCounty = '-1';
                vm.registerStreet = '-1';
                break;
            case 23:
                vm.registerStreet = '-1';
                break;
            case 31:
                vm.addressCity = '-1';
                vm.addressCounty = '-1';
                vm.addressStreet = '-1';
                break;
            case 32:
                vm.addressCounty = '-1';
                vm.addressStreet = '-1';
                break;
            case 33:
                vm.addressStreet = '-1';
                break;
            default:
                break;
        }
    };

    vm.initProvinceList = function (isTouched, listName, modelName) {
        var originalCode = undefined;
        if ((vm[modelName]+'') === '-1') {
            originalCode = '-1';
        } else {
            originalCode = vm[modelName]['PROVINCE_CODE'];
        }
        if (!isTouched) {
            $rootScope.commonService('getProvinceList', '', function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm[listName] = data;
                        if ((originalCode+'') === '-1') {
                            vm[modelName] = '-1';
                        } else {
                            vm[modelName] = $rootScope.selectItem(vm[listName], 'PROVINCE_CODE', originalCode);
                        }
                    },
                    function () {
                        vm[listName] = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        }
    };

    vm.initCityListOfCertainProvince = function (topName, listName, modelName) {
        if ((vm[topName]+'') === '-1') {
            vm[listName] = [];
            return;
        }
        var params = {
            "PROVINCE_CODE": vm[topName].PROVINCE_CODE
        };
        var originalCode = undefined;
        if ((vm[modelName]+'') === '-1') {
            originalCode = '-1';
        } else {
            originalCode = vm[modelName]['CITY_CODE'];
        }
        $rootScope.commonService('getCityListOfCertainProvince', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    if ((originalCode+'') === '-1') {
                        vm[modelName] = '-1';
                    } else {
                        vm[modelName] = $rootScope.selectItem(vm[listName], 'CITY_CODE', originalCode);
                    }
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取市列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取市列表失败');
        });
    };

    vm.initCountyListOfCertainCity = function (topName, listName, modelName) {
        if (vm[topName] === '-1') {
            vm[listName] = [];
            return;
        }
        var params = {
            "CITY_CODE": vm[topName].CITY_CODE
        };
        var originalCode = undefined;
        if ((vm[modelName]+'') === '-1') {
            originalCode = '-1';
        } else {
            originalCode = vm[modelName]['COUNTY_DISTRICT_CODE'];
        }
        $rootScope.commonService('getCountyListOfCertainCity', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    if ((originalCode+'') === '-1') {
                        vm[modelName] = '-1';
                    } else {
                        vm[modelName] = $rootScope.selectItem(vm[listName], 'COUNTY_DISTRICT_CODE', originalCode);
                    }
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取区/县失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取区/县失败');
        });
    };

    vm.initSubdistrictListOfCertainCounty = function (topName, listName, modelName) {
        if (vm[topName] === '-1') {
            vm[listName] = [];
            return;
        }
        var params = {
            "COUNTY_DISTRICT_CODE": vm[topName].COUNTY_DISTRICT_CODE
        };
        var originalCode = undefined;
        if ((vm[modelName]+'') === '-1') {
            originalCode = '-1';
        } else {
            originalCode = vm[modelName]['STREET_TOWNSHIP_NAME'];
        }
        $rootScope.commonService('getSubdistrictListOfCertainCounty', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    if ((originalCode+'') === '-1') {
                        vm[modelName] = '-1';
                    } else {
                        vm[modelName] = $rootScope.selectItem(vm[listName], 'STREET_TOWNSHIP_NAME', originalCode);
                    }
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取街道列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取街道列表失败');
        });
    };

    vm.save = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }

        var data = {
            "RESIDENT_NAME": vm.personName,
            "RESIDENT_ID_NO": vm.idNo,
            "RESIDENT_SEX_CODE": vm.sexItem.DICT_VALUE_CODE,
            "RESIDENT_SEX_NAME": vm.sexItem.DICT_VALUE_NAME,
            "BIRTHDAY": $filter('commonDate')(vm.dateOfBirth),
            "NATION_CODE": vm['nation']['DICT_VALUE_CODE'],
            "NATION_NAME": vm['nation']['DICT_VALUE_NAME'],
            "WORK_UNIT": vm['workingAgency'],
            "RESIDENT_PHONE_NO": vm['phone'],
            "LIVING_TYPE_CODE": vm['resideType'] ? vm['resideType']['DICT_VALUE_CODE'] : "",
            "LIVING_TYPE_NAME": vm['resideType'] ? vm['resideType']['DICT_VALUE_NAME'] : "",
            "MARITAL_STATUS_CODE": vm['maritalState'] ? vm['maritalState']['DICT_VALUE_CODE'] : "",
            "MARITAL_STATUS_NAME": vm['maritalState'] ? vm['maritalState']['DICT_VALUE_NAME'] : "",
            "HOUSEHOLD_REGISTER_CODE": vm['householdRegister'] ? vm['householdRegister']['DICT_VALUE_CODE'] : "",
            "HOUSEHOLD_REGISTER_NAME": vm['householdRegister'] ? vm['householdRegister']['DICT_VALUE_NAME'] : "",
            "RESIDENT_TYPE_CODE": vm['registerSign']['DICT_VALUE_CODE'],
            "RESIDENT_TYPE_NAME": vm['registerSign']['DICT_VALUE_NAME'],
            "NATIVE_PLACE_PROVINCE_CODE": vm['nativePlaceProvince'] ? vm['nativePlaceProvince']['PROVINCE_CODE'] : "",
            "NATIVE_PLACE_PROVINCE_NAME": vm['nativePlaceProvince'] ? vm['nativePlaceProvince']['PROVINCE_NAME'] : "",
            "NATIVE_PLACE_CITY_CODE": vm['nativePlaceCity'] ? vm['nativePlaceCity']['CITY_CODE'] : "",
            "NATIVE_PLACE_CITY_NAME": vm['nativePlaceCity'] ? vm['nativePlaceCity']['CITY_NAME'] : "",

            "REGISTER_PROVINCE_CODE": vm['registerProvince'] ? vm['registerProvince']['PROVINCE_CODE'] : "",
            "REGISTER_PROVINCE_NAME": vm['registerProvince'] ? vm['registerProvince']['PROVINCE_NAME'] : "",
            "REGISTER_CITY_CODE": vm['registerCity'] ? vm['registerCity']['CITY_CODE'] : "",
            "REGISTER_CITY_NAME": vm['registerCity'] ? vm['registerCity']['CITY_NAME'] : "",
            "REGISTER_COUNTY_DISTRICT_CODE": vm['registerCounty'] ? vm['registerCounty']['COUNTY_DISTRICT_CODE'] : "",
            "REGISTER_COUNTY_DISTRICT_NAME": vm['registerCounty'] ? vm['registerCounty']['COUNTY_DISTRICT_NAME'] : "",
            "REGISTER_STREET_TOWNSHIP_CODE": vm['registerStreet'] ? vm['registerStreet']['STREET_TOWNSHIP_CODE'] : "",
            "REGISTER_STREET_TOWNSHIP_NAME": vm['registerStreet'] ? vm['registerStreet']['STREET_TOWNSHIP_NAME'] : "",
            "HOUSEHOLD_REGISTER_ADDRESS": vm['householdRegisterAddress'] ? vm['householdRegisterAddress'] : "",
            "ADDRESS_PROVINCE_CODE": vm['addressProvince'] ? vm['addressProvince']['PROVINCE_CODE'] : "",
            "ADDRESS_PROVINCE_NAME": vm['addressProvince'] ? vm['addressProvince']['PROVINCE_NAME'] : "",
            "ADDRESS_CITY_CODE": vm['addressCity'] ? vm['addressCity']['CITY_CODE'] : "",
            "ADDRESS_CITY_NAME": vm['addressCity'] ? vm['addressCity']['CITY_NAME'] : "",
            "ADDRESS_COUNTY_DISTRICT_CODE": vm['addressCounty'] ? vm['addressCounty']['COUNTY_DISTRICT_CODE'] : "",
            "ADDRESS_COUNTY_DISTRICT_NAME": vm['addressCounty'] ? vm['addressCounty']['COUNTY_DISTRICT_NAME'] : "",
            "ADDRESS_STREET_TOWNSHIP_CODE": vm['addressStreet'] ? vm['addressStreet']['STREET_TOWNSHIP_CODE'] : "",
            "ADDRESS_STREET_TOWNSHIP_NAME": vm['addressStreet'] ? vm['addressStreet']['STREET_TOWNSHIP_NAME'] : "",
            "HOUSE_ADDRESS": vm['houseAddress'] ? vm['houseAddress'] : "",

            "BLOOD_TYPE_CODE": vm['bloodType']['DICT_VALUE_CODE'],
            "BLOOD_TYPE_NAME": vm['bloodType']['DICT_VALUE_NAME'],
            "RH_NEGATIVE": vm['rhNegative'],
            "DEGREE_OF_EDUCATION_CODE": vm['degreeOfEducation'] ? vm['degreeOfEducation']['DICT_VALUE_CODE'] : "",
            "DEGREE_OF_EDUCATION_NAME": vm['degreeOfEducation'] ? vm['degreeOfEducation']['DICT_VALUE_NAME'] : "",
            "CAREER_TYPE_CODE": vm['careerType'] ? vm['careerType']['DICT_VALUE_CODE'] : "",
            "CAREER_TYPE_NAME": vm['careerType'] ? vm['careerType']['DICT_VALUE_NAME'] : "",
            "CONTACT_NAME": vm['contactName'],
            "CONTACT_PHONE_NO": vm['contactPhoneNo'],
            "KITCHEN_VENTILATION_SYSTEM_CODE": vm['kitchen_ventilation_system'] ? vm['kitchen_ventilation_system']['DICT_VALUE_CODE'] : "",
            "KITCHEN_VENTILATION_SYSTEM_NAME": vm['kitchen_ventilation_system'] ? vm['kitchen_ventilation_system']['DICT_VALUE_NAME'] : "",
            "FUEL_TYPE_CODE": vm['fuel_type'] ? vm['fuel_type']['DICT_VALUE_CODE'] : "",
            "FUEL_TYPE_NAME": vm['fuel_type'] ? vm['fuel_type']['DICT_VALUE_NAME'] : "",
            "WATER_SOURCE_CODE": vm['water_source'] ? vm['water_source']['DICT_VALUE_CODE'] : "",
            "WATER_SOURCE_NAME": vm['water_source'] ? vm['water_source']['DICT_VALUE_NAME'] : "",
            "TOILET_TYPE_CODE": vm['toilet_type'] ? vm['toilet_type']['DICT_VALUE_CODE'] : "",
            "TOILET_TYPE_NAME": vm['toilet_type'] ? vm['toilet_type']['DICT_VALUE_NAME'] : "",
            "PINFOLD_POSITION_CODE": vm['pinfold_position'] ? vm['pinfold_position']['DICT_VALUE_CODE'] : "",
            "PINFOLD_POSITION_NAME": vm['pinfold_position'] ? vm['pinfold_position']['DICT_VALUE_NAME'] : "",
            "REMARK": vm['remark'] || ""
        };
        if(data.REGISTER_PROVINCE_CODE !== undefined && data.HOUSEHOLD_REGISTER_ADDRESS === ''){
            $rootScope.alertDialog("请填写完整的户籍地址");
            return;
        }
        if(data.ADDRESS_PROVINCE_CODE !== undefined && data.HOUSE_ADDRESS === ''){
            $rootScope.alertDialog("请填写完整的居住地址");
            return;
        }
        //医药费支付方式
        if(vm.medicalExpensesPaymentWaySelected === undefined || vm.medicalExpensesPaymentWaySelected.length === 0){
            $rootScope.alertDialog('医疗费用支付方式为必选');
            return;
        }
        var medical_expenses_payment_way = residentArchivesService.objectToString(vm.medicalExpensesPaymentWaySelected);
        data.MEDICAL_EXPENSES_PAYMENT_WAY_CODE = medical_expenses_payment_way.CODE;
        data.MEDICAL_EXPENSES_PAYMENT_WAY_NAME = medical_expenses_payment_way.NAME;

        //药物过敏史
        if (vm.drugAllergyHistoryState === undefined) {
            $rootScope.alertDialog('药物过敏史为必选');
            return;
        } else if (vm.drugAllergyHistoryState === 0) {
            data.DRUG_ALLERGY_HISTORY_CODE = "";
            data.DRUG_ALLERGY_HISTORY_NAME = "";
            data.OTHER_DRUG_ALLERGY_HISTORY_NAME = "";
        } else {
            if( ((vm.drugAllergyHistorySelected === undefined || vm.drugAllergyHistorySelected.length === 0) && vm.other_drug_allergy_history_state !== true)
                || (vm.other_drug_allergy_history_state === true && (vm.other_drug_allergy_history_name === undefined || vm.other_drug_allergy_history_name.replace(/(^\s*)|(\s*$)/g,"") === '')) ){
                $rootScope.alertDialog('请填写完整的药物过敏史');
                return;
            }
            var drug_allergy_history = residentArchivesService.objectToString(vm.drugAllergyHistorySelected);
            data.DRUG_ALLERGY_HISTORY_CODE = drug_allergy_history.CODE;
            data.DRUG_ALLERGY_HISTORY_NAME = drug_allergy_history.NAME;
            data.OTHER_DRUG_ALLERGY_HISTORY_NAME = vm.other_drug_allergy_history_name;
        }
        //暴露史
        if (vm.exposureHistoryState === undefined) {
            $rootScope.alertDialog('暴露史为必选');
            return;
        } else if (vm.exposureHistoryState === 0) {
            data.EXPOSURE_HISTORY_CODE = "";
            data.EXPOSURE_HISTORY_NAME = "";
        } else {
            if(vm.exposureHistorySelected === undefined || vm.exposureHistorySelected.length === 0){
                $rootScope.alertDialog('请填写完整的暴露史');
                return;
            }
            var exposure_history = residentArchivesService.objectToString(vm.exposureHistorySelected);
            data.EXPOSURE_HISTORY_CODE = exposure_history.CODE;
            data.EXPOSURE_HISTORY_NAME = exposure_history.NAME;
        }

        //残疾情况
        if (vm.deformityConditionState !== 1) {
            data.DEFORMITY_CONDITION_CODE = "";
            data.DEFORMITY_CONDITION_NAME = "";
            data.OTHER_DEFORMITY_CONDITION_NAME = "";
        } else {
            if( ((vm.deformityConditionSelected === undefined || vm.deformityConditionSelected.length === 0) && vm.other_deformity_condition_state !== true)
                || (vm.other_deformity_condition_state === true && (vm.other_deformity_condition_name === undefined || vm.other_deformity_condition_name.replace(/(^\s*)|(\s*$)/g,"") === '')) ) {
                $rootScope.alertDialog('请填写完整的残疾情况');
                return;
            }
            var deformity_condition = residentArchivesService.objectToString(vm.deformityConditionSelected);
            data.DEFORMITY_CONDITION_CODE = deformity_condition.CODE;
            data.DEFORMITY_CONDITION_NAME = deformity_condition.NAME;
            data.OTHER_DEFORMITY_CONDITION_NAME = vm.other_deformity_condition_name;
        }

        //疾病史
        if (vm.disease_history_tate === undefined
            || vm.disease_history_tate === 0
            || (vm.disease_history_tate === 1 && vm.disease_history_list.length === 0)) {
            data.DISEASE_HISTORY_LIST = [];
        } else {
            data.DISEASE_HISTORY_LIST = [];
            angular.forEach(vm.disease_history_list, function (item) {
                if (item.DISEASE_NAME !== '' && item.TIME_OF_DIAGNOSIS !== '' && item.TIME_OF_DIAGNOSIS !== null) {
                    data.DISEASE_HISTORY_LIST.push(angular.copy(item));
                }
            });
            residentArchivesService.dateObjToString(data.DISEASE_HISTORY_LIST, 'TIME_OF_DIAGNOSIS');
        }

        //手术史
        if (vm.operation_history_state === undefined
            || vm.operation_history_state === 0
            || vm.operation_history_state === 1 && vm.operation_history_list.length === 0) {
            data.OPERATION_HISTORY_LIST = [];
        } else {
            data.OPERATION_HISTORY_LIST = [];
            angular.forEach(vm.operation_history_list, function (item) {
                if (item.OPERATION_NAME !== '' && item.OPERATION_TIME !== '' && item.OPERATION_TIME !== null && item.OPERATION_DIAGNOSIS !== '') {
                    data.OPERATION_HISTORY_LIST.push(angular.copy(item));
                }
            });
            residentArchivesService.dateObjToString(data.OPERATION_HISTORY_LIST, 'OPERATION_TIME');
        }

        //外伤史
        if (vm.injury_history_state === undefined
            || vm.injury_history_state === 0
            || vm.injury_history_state === 1 && vm.injury_history_list.length === 0) {
            data.INJURY_HISTORY_LIST = [];
        } else {
            data.INJURY_HISTORY_LIST = [];
            angular.forEach(vm.injury_history_list, function (item) {
                if (item.INJURY_NAME !== '' && item.INJURY_TIME !== '' && item.INJURY_TIME !== null) {
                    data.INJURY_HISTORY_LIST.push(angular.copy(item));
                }
            });
            residentArchivesService.dateObjToString(data.INJURY_HISTORY_LIST, 'INJURY_TIME');
        }

        //输血史
        if (vm.transfusion_history_state === undefined
            || vm.transfusion_history_state === 0
            || vm.transfusion_history_state === 1 && vm.transfusion_history_list.length === 0) {
            data.TRANSFUSION_HISTORY_LIST = [];
        } else {
            data.TRANSFUSION_HISTORY_LIST = [];
            angular.forEach(vm.transfusion_history_list, function (item) {
                if (item.TRANSFUSION_REASON !== '' && item.TRANSFUSION_TIME !== '' && item.TRANSFUSION_TIME !== null && item.TRANSFUSION_VOLUME !== '') {
                    data.TRANSFUSION_HISTORY_LIST.push(angular.copy(item));
                }
            });
            residentArchivesService.dateObjToString(data.TRANSFUSION_HISTORY_LIST, 'TRANSFUSION_TIME');
        }

        //住院史
        if (vm.hospitalization_history_state === undefined
            || vm.hospitalization_history_state === 0
            || vm.hospitalization_history_state === 1 && vm.hospitalization_history_list.length === 0) {
            data.HOSPITALIZATION_HISTORY_LIST = [];
        } else {
            data.HOSPITALIZATION_HISTORY_LIST = [];
            angular.forEach(vm.hospitalization_history_list, function (item) {
                if (item.HOSPITALIZATION_REASON !== '' && item.HOSPITALIZATION_TIME !== '' && item.HOSPITALIZATION_TIME !== null && item.DIAGNOSIS !== '' && item.MEDICAL_INSTITUTION_NAME !== '') {
                    data.HOSPITALIZATION_HISTORY_LIST.push(angular.copy(item));
                }
            });
            residentArchivesService.dateObjToString(data.HOSPITALIZATION_HISTORY_LIST, 'HOSPITALIZATION_TIME');
        }

        //家族史
        if (vm.family_medical_history_state === undefined
            || vm.family_medical_history_state === 0
            || vm.family_medical_history_state === 1 && vm.family_medical_history_list.length === 0) {
            data.FAMILY_MEDICAL_HISTORY_LIST = [];
        } else {
            data.FAMILY_MEDICAL_HISTORY_LIST = [];
            angular.forEach(vm.family_medical_history_list, function (item) {
                if (item.DISEASE_NAME !== '' && item.RELATIONSHIP !== '') {
                    data.FAMILY_MEDICAL_HISTORY_LIST.push(angular.copy(item));
                }
            });
        }

        //遗传史
        if (vm.genetic_history_state === undefined
            || vm.genetic_history_state === 0
            || vm.genetic_history_state === 1 && vm.genetic_history_list.length === 0) {
            data.GENETIC_HISTORY_LIST = [];
        } else {
            data.GENETIC_HISTORY_LIST = [];
            angular.forEach(vm.genetic_history_list, function (item) {
                if (item.DISEASE_NAME !== '') {
                    data.GENETIC_HISTORY_LIST.push(angular.copy(item));
                }
            });
        }
        
        residentArchivesService.createResident(
            data,
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        $rootScope.alertDialog('创建成功');
                        $state.go('main.resident.residentArchivesListReturn',{
                            TYPE:1
                        });
                    },
                    function () {
                        $rootScope.alertDialog('创建失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('创建失败');
            }
        );

    };

    vm.cancel = function () {
        $state.go('main.resident.residentArchivesList');
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('residentArchivesEditCtrl', residentArchivesEditCtrl);
residentArchivesEditCtrl.$inject = ['$rootScope', '$state', '$stateParams', 'residentArchivesService', '$filter'];
function residentArchivesEditCtrl($rootScope, $state, $stateParams, residentArchivesService, $filter) {
    var vm = this;
    var isSinged=0;
    //控制是否可编辑的字段
    vm.editable = false;
    vm.hasSideNav = true;
    vm.show_householder_symbol = true;

    vm.RESIDENT_KEY_ID = $stateParams.RESIDENT_KEY_ID;

    //先赋初值，避免报错
    vm.medicalExpensesPaymentWaySelected = [];
    vm.drugAllergyHistorySelected = [];
    vm.exposureHistorySelected = [];
    vm.deformityConditionSelected = [];

    var dict_type_code_list = [
        {
            "DICT_TYPE_CODE": "0009",//性别
            "LIST_NAME": "sexCodeName"
        }, {
            "DICT_TYPE_CODE": "0010",//民族
            "LIST_NAME": "nationArr"
        }, {
            "DICT_TYPE_CODE": "0007001",//居住类型
            "LIST_NAME": "resideTypeArr"
        }, {
            "DICT_TYPE_CODE": "0011",//婚姻状况
            "LIST_NAME": "maritalStateArr"
        }, {
            "DICT_TYPE_CODE": "0008001",//户口属性
            "LIST_NAME": "householdRegisterArr"
        }, {
            "DICT_TYPE_CODE": "0007002",//常住类型
            "LIST_NAME": "registerSignArr"
        }, {
            "DICT_TYPE_CODE": "0008002",//血型
            "LIST_NAME": "bloodTypeArr"
        }, {
            "DICT_TYPE_CODE": "0008003",//文化程度
            "LIST_NAME": "degreeOfEducationArr"
        }, {
            "DICT_TYPE_CODE": "0008004",//职业
            "LIST_NAME": "careerTypeArr"
        }, {
            "DICT_TYPE_CODE": "0012",//医疗费用支付方式
            "LIST_NAME": "medicalExpensesPaymentWayArr"
        }, {
            "DICT_TYPE_CODE": "0008005",//药物过敏史
            "LIST_NAME": "drugAllergyHistoryArr"
        }, {
            "DICT_TYPE_CODE": "0008006",//暴露史
            "LIST_NAME": "exposureHistoryArr"
        }, {
            "DICT_TYPE_CODE": "0008007",//残疾情况
            "LIST_NAME": "deformityConditionArr"
        }, {
            "DICT_TYPE_CODE": "0007006",//厨房排风措施
            "LIST_NAME": "kitchen_ventilation_system_arr"
        }, {
            "DICT_TYPE_CODE": "0007007",//燃料类型
            "LIST_NAME": "fuel_type_arr"
        }, {
            "DICT_TYPE_CODE": "0007008",//饮水
            "LIST_NAME": "water_source_arr"
        }, {
            "DICT_TYPE_CODE": "0007009",//厕所
            "LIST_NAME": "toilet_type_arr"
        }, {
            "DICT_TYPE_CODE": "0007010",//禽畜栏
            "LIST_NAME": "pinfold_position_arr"
        }
    ];

    vm.exists = function (item, list) {
        return list.indexOf(item) > -1;
    };

    vm.toggle = function (item, list) {
        var idx = list.indexOf(item);
        if (idx > -1) {
            list.splice(idx, 1);
        }
        else {
            list.push(item);
        }
    };

    //获取字典列表
    $rootScope.commonService(
        "getDictList",
        {"DICT_TYPE_CODE_LIST": dict_type_code_list},
        function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.dictList = data;
                    eachDictValue(data);
                    getResidentDetailInfo();
                },
                function () {
                    $rootScope.alertDialog('获取字典列表失败');
                }
            );
        },
        function () {
            $rootScope.alertDialog('获取字典列表失败');
        }
    );

    //单个赋值
    function eachDictValue(data) {
        angular.forEach(dict_type_code_list, function (item) {
            vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
        });
    }

    vm.remove = function (index, list) {
        list.splice(index, 1);
    };

    vm.checkIdNo = function (form) {
        if (!residentArchivesService.isEmptyObject(form.idNo.$error)) {
            return;
        }
        residentArchivesService.checkIdNo(
            {
                "RESIDENT_KEY_ID": vm.RESIDENT_KEY_ID,
                "RESIDENT_ID_NO": vm.idNo
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        if (data) {
                            $rootScope.alertDialog('根据身份证号验证，该居民已创建过档案，不能重复创建');
                        }
                    },
                    function () {
                        $rootScope.alertDialog('身份证查重失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('身份证查重失败');
            }
        );
    };

    vm.drugAllergyHistoryArr = [];
    vm.exposureHistoryArr = [];
    vm.deformityConditionArr = [];

    vm.disease_history_list = [];
    vm.operation_history_list = [];
    vm.injury_history_list = [];
    vm.transfusion_history_list = [];
    vm.hospitalization_history_list = [];
    vm.family_medical_history_list = [];
    vm.genetic_history_list = [];

    //添加疾病史
    vm.addDiseaseHistory = function () {
        vm.disease_history_list.push({
            "DISEASE_NAME": "",
            "TIME_OF_DIAGNOSIS": null,
            "REMARK": ""
        });
    };
    vm.disease_history_tate_change = function () {
        if (vm.disease_history_tate === 0) {
            vm.disease_history_list = [];
        } else if (vm.disease_history_tate === 1) {
            vm.addDiseaseHistory();
        }
    };

    //添加手术史
    vm.addOperationHistory = function () {
        vm.operation_history_list.push({
            "OPERATION_NAME": "",
            "OPERATION_TIME": null,
            "OPERATION_DIAGNOSIS": "",
            "REMARK": ""
        });
    };
    vm.operation_history_state_change = function () {
        if (vm.operation_history_state === 0) {
            vm.operation_history_list = [];
        } else if (vm.operation_history_state === 1) {
            vm.addOperationHistory();
        }
    };

    //添加外伤史
    vm.addInjuryHistory = function () {
        vm.injury_history_list.push({
            "INJURY_NAME": "",
            "INJURY_TIME": null,
            "REMARK": ""
        });
    };
    vm.injury_history_state_change = function () {
        if (vm.injury_history_state === 0) {
            vm.injury_history_list = [];
        } else if (vm.injury_history_state === 1) {
            vm.addInjuryHistory();
        }
    };

    //添加输血史
    vm.addTransfusionHistory = function () {
        vm.transfusion_history_list.push({
            "TRANSFUSION_REASON": "",
            "TRANSFUSION_TIME": null,
            "TRANSFUSION_VOLUME": "",
            "REMARK": ""
        });
    };
    vm.transfusion_history_state_change = function () {
        if (vm.transfusion_history_state === 0) {
            vm.transfusion_history_list = [];
        } else if (vm.transfusion_history_state === 1) {
            vm.addTransfusionHistory();
        }
    };

    //添加住院史
    vm.addHospitalizationHistory = function () {
        vm.hospitalization_history_list.push({
            "HOSPITALIZATION_REASON": "",
            "HOSPITALIZATION_TIME": null,
            "DIAGNOSIS": "",
            "MEDICAL_INSTITUTION_NAME": "",
            "REMARK": ""
        });
    };
    vm.hospitalization_history_state_change = function () {
        if (vm.hospitalization_history_state === 0) {
            vm.hospitalization_history_list = [];
        } else if (vm.hospitalization_history_state === 1) {
            vm.addHospitalizationHistory();
        }
    };

    //添加家族史
    vm.addFamilyMedicalHistory = function () {
        vm.family_medical_history_list.push({
            "DISEASE_NAME": "",
            "RELATIONSHIP": "",
            "REMARK": ""
        });
    };
    vm.family_medical_history_state_change = function () {
        if (vm.family_medical_history_state === 0) {
            vm.family_medical_history_list = [];
        } else if (vm.family_medical_history_state === 1) {
            vm.addFamilyMedicalHistory();
        }
    };

    //添加遗传史
    vm.addGeneticHistory = function () {
        vm.genetic_history_list.push({
            "DISEASE_NAME": "",
            "REMARK": ""
        });
    };
    vm.genetic_history_state_change = function () {
        if (vm.genetic_history_state === 0) {
            vm.genetic_history_list = [];
        } else if (vm.genetic_history_state === 1) {
            vm.addGeneticHistory();
        }
    };

    vm.changeAddress = function (index) {
        switch (index) {
            case 11:
                vm.nativePlaceCity = '-1';
                break;
            case 21:
                vm.registerCity = '-1';
                vm.registerCounty = '-1';
                vm.registerStreet = '-1';
                break;
            case 22:
                vm.registerCounty = '-1';
                vm.registerStreet = '-1';
                break;
            case 23:
                vm.registerStreet = '-1';
                break;
            case 31:
                vm.addressCity = '-1';
                vm.addressCounty = '-1';
                vm.addressStreet = '-1';
                break;
            case 32:
                vm.addressCounty = '-1';
                vm.addressStreet = '-1';
                break;
            case 33:
                vm.addressStreet = '-1';
                break;
            default:
                break;
        }
    };

    vm.initProvinceList = function (isTouched, listName, modelName) {
        var originalCode = undefined;
        if ((vm[modelName]+'') === '-1') {
            originalCode = '-1';
        } else {
            originalCode = vm[modelName]['PROVINCE_CODE'];
        }
        if (!isTouched) {
            $rootScope.commonService('getProvinceList', '', function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm[listName] = data;
                        if ((originalCode+'') === '-1') {
                            vm[modelName] = '-1';
                        } else {
                            vm[modelName] = $rootScope.selectItem(vm[listName], 'PROVINCE_CODE', originalCode);
                        }
                    },
                    function () {
                        vm[listName] = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        }
    };

    vm.initProvinceValue = function (listName, modelName, code) {
        $rootScope.commonService('getProvinceList', '', function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    vm[modelName] = $rootScope.selectItem(vm[listName], 'PROVINCE_CODE', code);
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取省列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取省列表失败');
        });
    };

    vm.initCityListOfCertainProvince = function (topName, listName, modelName) {
        if ((vm[topName]+'') === '-1') {
            vm[listName] = [];
            return;
        }
        var params = {
            "PROVINCE_CODE": vm[topName].PROVINCE_CODE
        };
        var originalCode = undefined;
        if ((vm[modelName]+'') === '-1') {
            originalCode = '-1';
        } else {
            originalCode = vm[modelName]['CITY_CODE'];
        }
        $rootScope.commonService('getCityListOfCertainProvince', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    if ((originalCode+'') === '-1') {
                        vm[modelName] = '-1';
                    } else {
                        vm[modelName] = $rootScope.selectItem(vm[listName], 'CITY_CODE', originalCode);
                    }
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取市列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取市列表失败');
        });
    };

    vm.initCityValue = function (topCode, listName, modelName, code) {
        var params = {
            "PROVINCE_CODE": topCode
        };
        $rootScope.commonService('getCityListOfCertainProvince', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    vm[modelName] = $rootScope.selectItem(vm[listName], 'CITY_CODE', code);
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取市列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取市列表失败');
        });
    };

    vm.initCountyListOfCertainCity = function (topName, listName, modelName) {
        if (vm[topName] === '-1') {
            vm[listName] = [];
            return;
        }
        var params = {
            "CITY_CODE": vm[topName].CITY_CODE
        };
        var originalCode = undefined;
        if ((vm[modelName]+'') === '-1') {
            originalCode = '-1';
        } else {
            originalCode = vm[modelName]['COUNTY_DISTRICT_CODE'];
        }
        $rootScope.commonService('getCountyListOfCertainCity', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    if ((originalCode+'') === '-1') {
                        vm[modelName] = '-1';
                    } else {
                        vm[modelName] = $rootScope.selectItem(vm[listName], 'COUNTY_DISTRICT_CODE', originalCode);
                    }
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取区/县失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取区/县失败');
        });
    };

    vm.initCountyValue = function (topCode, listName, modelName, code) {
        var params = {
            "CITY_CODE": topCode
        };
        $rootScope.commonService('getCountyListOfCertainCity', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    vm[modelName] = $rootScope.selectItem(vm[listName], 'COUNTY_DISTRICT_CODE', code);
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取区/县失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取区/县失败');
        });
    };

    vm.initSubdistrictListOfCertainCounty = function (topName, listName, modelName) {
        if (vm[topName] === '-1') {
            vm[listName] = [];
            return;
        }
        var params = {
            "COUNTY_DISTRICT_CODE": vm[topName].COUNTY_DISTRICT_CODE
        };
        var originalCode = undefined;
        if ((vm[modelName]+'') === '-1') {
            originalCode = '-1';
        } else {
            originalCode = vm[modelName]['STREET_TOWNSHIP_NAME'];
        }
        $rootScope.commonService('getSubdistrictListOfCertainCounty', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    if ((originalCode+'') === '-1') {
                        vm[modelName] = '-1';
                    } else {
                        vm[modelName] = $rootScope.selectItem(vm[listName], 'STREET_TOWNSHIP_NAME', originalCode);
                    }
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取街道列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取街道列表失败');
        });
    };

    vm.initStreetValue = function (topCode, listName, modelName, code) {
        var params = {
            "COUNTY_DISTRICT_CODE": topCode
        };
        $rootScope.commonService('getSubdistrictListOfCertainCounty', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm[listName] = data;
                    vm[modelName] = $rootScope.selectItem(vm[listName], 'STREET_TOWNSHIP_CODE', code);
                },
                function () {
                    vm[listName] = [];
                    $rootScope.alertDialog('获取街道列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取街道列表失败');
        });
    };

    vm.save = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }

        var data = {
            "RESIDENT_NAME": vm.personName,
            "RESIDENT_ID_NO": vm.idNo,
            "RESIDENT_SEX_CODE": vm.sexItem.DICT_VALUE_CODE,
            "RESIDENT_SEX_NAME": vm.sexItem.DICT_VALUE_NAME,
            "BIRTHDAY": $filter('commonDate')(vm.dateOfBirth),
            "NATION_CODE": vm['nation']['DICT_VALUE_CODE'],
            "NATION_NAME": vm['nation']['DICT_VALUE_NAME'],
            "WORK_UNIT": vm['workingAgency'],
            "RESIDENT_PHONE_NO": vm['phone'],
            "LIVING_TYPE_CODE": vm['resideType'] ? vm['resideType']['DICT_VALUE_CODE'] : "",
            "LIVING_TYPE_NAME": vm['resideType'] ? vm['resideType']['DICT_VALUE_NAME'] : "",
            "MARITAL_STATUS_CODE": vm['maritalState'] ? vm['maritalState']['DICT_VALUE_CODE'] : "",
            "MARITAL_STATUS_NAME": vm['maritalState'] ? vm['maritalState']['DICT_VALUE_NAME'] : "",
            "HOUSEHOLD_REGISTER_CODE": vm['householdRegister'] ? vm['householdRegister']['DICT_VALUE_CODE'] : "",
            "HOUSEHOLD_REGISTER_NAME": vm['householdRegister'] ? vm['householdRegister']['DICT_VALUE_NAME'] : "",
            "RESIDENT_TYPE_CODE": vm['registerSign']['DICT_VALUE_CODE'],
            "RESIDENT_TYPE_NAME": vm['registerSign']['DICT_VALUE_NAME'],
            "NATIVE_PLACE_PROVINCE_CODE": vm['nativePlaceProvince'] ? vm['nativePlaceProvince']['PROVINCE_CODE'] : "",
            "NATIVE_PLACE_PROVINCE_NAME": vm['nativePlaceProvince'] ? vm['nativePlaceProvince']['PROVINCE_NAME'] : "",
            "NATIVE_PLACE_CITY_CODE": vm['nativePlaceCity'] ? vm['nativePlaceCity']['CITY_CODE'] : "",
            "NATIVE_PLACE_CITY_NAME": vm['nativePlaceCity'] ? vm['nativePlaceCity']['CITY_NAME'] : "",

            "REGISTER_PROVINCE_CODE": vm['registerProvince'] ? vm['registerProvince']['PROVINCE_CODE'] : "",
            "REGISTER_PROVINCE_NAME": vm['registerProvince'] ? vm['registerProvince']['PROVINCE_NAME'] : "",
            "REGISTER_CITY_CODE": vm['registerCity'] ? vm['registerCity']['CITY_CODE'] : "",
            "REGISTER_CITY_NAME": vm['registerCity'] ? vm['registerCity']['CITY_NAME'] : "",
            "REGISTER_COUNTY_DISTRICT_CODE": vm['registerCounty'] ? vm['registerCounty']['COUNTY_DISTRICT_CODE'] : "",
            "REGISTER_COUNTY_DISTRICT_NAME": vm['registerCounty'] ? vm['registerCounty']['COUNTY_DISTRICT_NAME'] : "",
            "REGISTER_STREET_TOWNSHIP_CODE": vm['registerStreet'] ? vm['registerStreet']['STREET_TOWNSHIP_CODE'] : "",
            "REGISTER_STREET_TOWNSHIP_NAME": vm['registerStreet'] ? vm['registerStreet']['STREET_TOWNSHIP_NAME'] : "",
            "HOUSEHOLD_REGISTER_ADDRESS": vm['householdRegisterAddress'] ? vm['householdRegisterAddress'] : "",
            "ADDRESS_PROVINCE_CODE": vm['addressProvince'] ? vm['addressProvince']['PROVINCE_CODE'] : "",
            "ADDRESS_PROVINCE_NAME": vm['addressProvince'] ? vm['addressProvince']['PROVINCE_NAME'] : "",
            "ADDRESS_CITY_CODE": vm['addressCity'] ? vm['addressCity']['CITY_CODE'] : "",
            "ADDRESS_CITY_NAME": vm['addressCity'] ? vm['addressCity']['CITY_NAME'] : "",
            "ADDRESS_COUNTY_DISTRICT_CODE": vm['addressCounty'] ? vm['addressCounty']['COUNTY_DISTRICT_CODE'] : "",
            "ADDRESS_COUNTY_DISTRICT_NAME": vm['addressCounty'] ? vm['addressCounty']['COUNTY_DISTRICT_NAME'] : "",
            "ADDRESS_STREET_TOWNSHIP_CODE": vm['addressStreet'] ? vm['addressStreet']['STREET_TOWNSHIP_CODE'] : "",
            "ADDRESS_STREET_TOWNSHIP_NAME": vm['addressStreet'] ? vm['addressStreet']['STREET_TOWNSHIP_NAME'] : "",
            "HOUSE_ADDRESS": vm['houseAddress'] ? vm['houseAddress'] : "",

            "BLOOD_TYPE_CODE": vm['bloodType']['DICT_VALUE_CODE'],
            "BLOOD_TYPE_NAME": vm['bloodType']['DICT_VALUE_NAME'],
            "RH_NEGATIVE": vm['rhNegative'],
            "DEGREE_OF_EDUCATION_CODE": vm['degreeOfEducation'] ? vm['degreeOfEducation']['DICT_VALUE_CODE'] : "",
            "DEGREE_OF_EDUCATION_NAME": vm['degreeOfEducation'] ? vm['degreeOfEducation']['DICT_VALUE_NAME'] : "",
            "CAREER_TYPE_CODE": vm['careerType'] ? vm['careerType']['DICT_VALUE_CODE'] : "",
            "CAREER_TYPE_NAME": vm['careerType'] ? vm['careerType']['DICT_VALUE_NAME'] : "",
            "CONTACT_NAME": vm['contactName'],
            "CONTACT_PHONE_NO": vm['contactPhoneNo'],
            "KITCHEN_VENTILATION_SYSTEM_CODE": vm['kitchen_ventilation_system'] ? vm['kitchen_ventilation_system']['DICT_VALUE_CODE'] : "",
            "KITCHEN_VENTILATION_SYSTEM_NAME": vm['kitchen_ventilation_system'] ? vm['kitchen_ventilation_system']['DICT_VALUE_NAME'] : "",
            "FUEL_TYPE_CODE": vm['fuel_type'] ? vm['fuel_type']['DICT_VALUE_CODE'] : "",
            "FUEL_TYPE_NAME": vm['fuel_type'] ? vm['fuel_type']['DICT_VALUE_NAME'] : "",
            "WATER_SOURCE_CODE": vm['water_source'] ? vm['water_source']['DICT_VALUE_CODE'] : "",
            "WATER_SOURCE_NAME": vm['water_source'] ? vm['water_source']['DICT_VALUE_NAME'] : "",
            "TOILET_TYPE_CODE": vm['toilet_type'] ? vm['toilet_type']['DICT_VALUE_CODE'] : "",
            "TOILET_TYPE_NAME": vm['toilet_type'] ? vm['toilet_type']['DICT_VALUE_NAME'] : "",
            "PINFOLD_POSITION_CODE": vm['pinfold_position'] ? vm['pinfold_position']['DICT_VALUE_CODE'] : "",
            "PINFOLD_POSITION_NAME": vm['pinfold_position'] ? vm['pinfold_position']['DICT_VALUE_NAME'] : "",
            "REMARK": vm['remark'] || ""
        };
        if(data.REGISTER_PROVINCE_CODE !== undefined && data.HOUSEHOLD_REGISTER_ADDRESS === ''){
            $rootScope.alertDialog("请填写完整的户籍地址");
            return;
        }
        if(data.ADDRESS_PROVINCE_CODE !== undefined && data.HOUSE_ADDRESS === ''){
            $rootScope.alertDialog("请填写完整的居住地址");
            return;
        }
        //医药费支付方式
        if(vm.medicalExpensesPaymentWaySelected === undefined || vm.medicalExpensesPaymentWaySelected.length === 0){
            $rootScope.alertDialog('医疗费用支付方式为必选');
            return;
        }
        var medical_expenses_payment_way = residentArchivesService.objectToString(vm.medicalExpensesPaymentWaySelected);
        data.MEDICAL_EXPENSES_PAYMENT_WAY_CODE = medical_expenses_payment_way.CODE;
        data.MEDICAL_EXPENSES_PAYMENT_WAY_NAME = medical_expenses_payment_way.NAME;

        //药物过敏史
        if (vm.drugAllergyHistoryState === undefined) {
            $rootScope.alertDialog('药物过敏史为必选');
            return;
        } else if (vm.drugAllergyHistoryState === 0) {
            data.DRUG_ALLERGY_HISTORY_CODE = "";
            data.DRUG_ALLERGY_HISTORY_NAME = "";
            data.OTHER_DRUG_ALLERGY_HISTORY_NAME = "";
        } else {
            if( ((vm.drugAllergyHistorySelected === undefined || vm.drugAllergyHistorySelected.length === 0) && vm.other_drug_allergy_history_state !== true)
                || (vm.other_drug_allergy_history_state === true && (vm.other_drug_allergy_history_name === undefined || vm.other_drug_allergy_history_name.replace(/(^\s*)|(\s*$)/g,"") === '')) ){
                $rootScope.alertDialog('请填写完整的药物过敏史');
                return;
            }
            var drug_allergy_history = residentArchivesService.objectToString(vm.drugAllergyHistorySelected);
            data.DRUG_ALLERGY_HISTORY_CODE = drug_allergy_history.CODE;
            data.DRUG_ALLERGY_HISTORY_NAME = drug_allergy_history.NAME;
            data.OTHER_DRUG_ALLERGY_HISTORY_NAME = vm.other_drug_allergy_history_name;
        }
        //暴露史
        if (vm.exposureHistoryState === undefined) {
            $rootScope.alertDialog('暴露史为必选');
            return;
        } else if (vm.exposureHistoryState === 0) {
            data.EXPOSURE_HISTORY_CODE = "";
            data.EXPOSURE_HISTORY_NAME = "";
        } else {
            if(vm.exposureHistorySelected === undefined || vm.exposureHistorySelected.length === 0){
                $rootScope.alertDialog('请填写完整的暴露史');
                return;
            }
            var exposure_history = residentArchivesService.objectToString(vm.exposureHistorySelected);
            data.EXPOSURE_HISTORY_CODE = exposure_history.CODE;
            data.EXPOSURE_HISTORY_NAME = exposure_history.NAME;
        }

        //残疾情况
        if (vm.deformityConditionState !== 1) {
            data.DEFORMITY_CONDITION_CODE = "";
            data.DEFORMITY_CONDITION_NAME = "";
            data.OTHER_DEFORMITY_CONDITION_NAME = "";
        } else {
            if( ((vm.deformityConditionSelected === undefined || vm.deformityConditionSelected.length === 0) && vm.other_deformity_condition_state !== true)
                || (vm.other_deformity_condition_state === true && (vm.other_deformity_condition_name === undefined || vm.other_deformity_condition_name.replace(/(^\s*)|(\s*$)/g,"") === '')) ) {
                $rootScope.alertDialog('请填写完整的残疾情况');
                return;
            }
            var deformity_condition = residentArchivesService.objectToString(vm.deformityConditionSelected);
            data.DEFORMITY_CONDITION_CODE = deformity_condition.CODE;
            data.DEFORMITY_CONDITION_NAME = deformity_condition.NAME;
            data.OTHER_DEFORMITY_CONDITION_NAME = vm.other_deformity_condition_name;
        }

        //疾病史
        if (vm.disease_history_tate === undefined
            || vm.disease_history_tate === 0
            || (vm.disease_history_tate === 1 && vm.disease_history_list.length === 0)) {
            data.DISEASE_HISTORY_LIST = [];
        } else {
            data.DISEASE_HISTORY_LIST = [];
            angular.forEach(vm.disease_history_list, function (item) {
                if (item.DISEASE_NAME !== '' && item.TIME_OF_DIAGNOSIS !== '' && item.TIME_OF_DIAGNOSIS !== null) {
                    data.DISEASE_HISTORY_LIST.push(angular.copy(item));
                }
            });
            residentArchivesService.dateObjToString(data.DISEASE_HISTORY_LIST, 'TIME_OF_DIAGNOSIS');
        }

        //手术史
        if (vm.operation_history_state === undefined
            || vm.operation_history_state === 0
            || vm.operation_history_state === 1 && vm.operation_history_list.length === 0) {
            data.OPERATION_HISTORY_LIST = [];
        } else {
            data.OPERATION_HISTORY_LIST = [];
            angular.forEach(vm.operation_history_list, function (item) {
                if (item.OPERATION_NAME !== '' && item.OPERATION_TIME !== '' && item.OPERATION_TIME !== null && item.OPERATION_DIAGNOSIS !== '') {
                    data.OPERATION_HISTORY_LIST.push(angular.copy(item));
                }
            });
            residentArchivesService.dateObjToString(data.OPERATION_HISTORY_LIST, 'OPERATION_TIME');
        }

        //外伤史
        if (vm.injury_history_state === undefined
            || vm.injury_history_state === 0
            || vm.injury_history_state === 1 && vm.injury_history_list.length === 0) {
            data.INJURY_HISTORY_LIST = [];
        } else {
            data.INJURY_HISTORY_LIST = [];
            angular.forEach(vm.injury_history_list, function (item) {
                if (item.INJURY_NAME !== '' && item.INJURY_TIME !== '' && item.INJURY_TIME !== null) {
                    data.INJURY_HISTORY_LIST.push(angular.copy(item));
                }
            });
            residentArchivesService.dateObjToString(data.INJURY_HISTORY_LIST, 'INJURY_TIME');
        }

        //输血史
        if (vm.transfusion_history_state === undefined
            || vm.transfusion_history_state === 0
            || vm.transfusion_history_state === 1 && vm.transfusion_history_list.length === 0) {
            data.TRANSFUSION_HISTORY_LIST = [];
        } else {
            data.TRANSFUSION_HISTORY_LIST = [];
            angular.forEach(vm.transfusion_history_list, function (item) {
                if (item.TRANSFUSION_REASON !== '' && item.TRANSFUSION_TIME !== '' && item.TRANSFUSION_TIME !== null && item.TRANSFUSION_VOLUME !== '') {
                    data.TRANSFUSION_HISTORY_LIST.push(angular.copy(item));
                }
            });
            residentArchivesService.dateObjToString(data.TRANSFUSION_HISTORY_LIST, 'TRANSFUSION_TIME');
        }

        //住院史
        if (vm.hospitalization_history_state === undefined
            || vm.hospitalization_history_state === 0
            || vm.hospitalization_history_state === 1 && vm.hospitalization_history_list.length === 0) {
            data.HOSPITALIZATION_HISTORY_LIST = [];
        } else {
            data.HOSPITALIZATION_HISTORY_LIST = [];
            angular.forEach(vm.hospitalization_history_list, function (item) {
                if (item.HOSPITALIZATION_REASON !== '' && item.HOSPITALIZATION_TIME !== '' && item.HOSPITALIZATION_TIME !== null && item.DIAGNOSIS !== '' && item.MEDICAL_INSTITUTION_NAME !== '') {
                    data.HOSPITALIZATION_HISTORY_LIST.push(angular.copy(item));
                }
            });
            residentArchivesService.dateObjToString(data.HOSPITALIZATION_HISTORY_LIST, 'HOSPITALIZATION_TIME');
        }

        //家族史
        if (vm.family_medical_history_state === undefined
            || vm.family_medical_history_state === 0
            || vm.family_medical_history_state === 1 && vm.family_medical_history_list.length === 0) {
            data.FAMILY_MEDICAL_HISTORY_LIST = [];
        } else {
            data.FAMILY_MEDICAL_HISTORY_LIST = [];
            angular.forEach(vm.family_medical_history_list, function (item) {
                if (item.DISEASE_NAME !== '' && item.RELATIONSHIP !== '') {
                    data.FAMILY_MEDICAL_HISTORY_LIST.push(angular.copy(item));
                }
            });
        }

        //遗传史
        if (vm.genetic_history_state === undefined
            || vm.genetic_history_state === 0
            || vm.genetic_history_state === 1 && vm.genetic_history_list.length === 0) {
            data.GENETIC_HISTORY_LIST = [];
        } else {
            data.GENETIC_HISTORY_LIST = [];
            angular.forEach(vm.genetic_history_list, function (item) {
                if (item.DISEASE_NAME !== '') {
                    data.GENETIC_HISTORY_LIST.push(angular.copy(item));
                }
            });
        }

        data.RESIDENT_KEY_ID = vm.RESIDENT_KEY_ID;
        residentArchivesService.editResidentInfo(
            data,
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        vm.editable = !vm.editable;
                        getResidentDetailInfo();
                    },
                    function () {
                        $rootScope.alertDialog('编辑失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('编辑失败');
            }
        );

    };

    vm.cancel = function (form) {
        if (form.$dirty) {
            $rootScope.confirmDialog(
                '您确定要放弃保存吗?',
                function () {
                    eachModelValue(vm.originalInfo);
                    vm.editable = !vm.editable;
                },
                function () {

                }
            );
        } else {
            vm.editable = !vm.editable;
        }
    };

    vm.back = function () {
        $state.go('main.resident.residentArchivesListReturn',{
            TYPE:isSinged
        });
    };

    vm.edit = function (form) {
        form.$setPristine();
        form.$setUntouched();
        vm.editable = !vm.editable;
    };

    //根据居民ID查询居民基本信息
    function getResidentDetailInfo() {
        residentArchivesService.getResidentDetailInfo(
            {
                "RESIDENT_KEY_ID": vm.RESIDENT_KEY_ID
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.originalInfo = data;
                        isSinged=data.IS_SIGNED===0?1:0;
                        eachModelValue(data);
                    },
                    function () {
                        $rootScope.alertDialog('查询居民基本信息');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('查询居民基本信息');
            }
        );
    }

    //每个model赋值
    function eachModelValue(data) {
        vm.fileNum = data.RESIDENT_CODE;
        vm.familyId = data.FAMILY_CODE;
        vm.personName = data.RESIDENT_NAME;
        vm.idNo = data.RESIDENT_ID_NO;
        vm.sexItem = $rootScope.selectItem(vm.sexCodeName, 'DICT_VALUE_CODE', data.RESIDENT_SEX_CODE);
        vm.dateOfBirth = new Date(data.BIRTHDAY);
        vm.nation = $rootScope.selectItem(vm.nationArr, 'DICT_VALUE_CODE', data.NATION_CODE);
        vm.workingAgency = data.WORK_UNIT;
        vm.phone = data.RESIDENT_PHONE_NO;
        vm.resideType = $rootScope.selectItem(vm.resideTypeArr, 'DICT_VALUE_CODE', data.LIVING_TYPE_CODE);
        vm.maritalState = $rootScope.selectItem(vm.maritalStateArr, 'DICT_VALUE_CODE', data.MARITAL_STATUS_CODE);
        vm.householdRegister = $rootScope.selectItem(vm.householdRegisterArr, 'DICT_VALUE_CODE', data.HOUSEHOLD_REGISTER_CODE);
        vm.registerSign = $rootScope.selectItem(vm.registerSignArr, 'DICT_VALUE_CODE', data.RESIDENT_TYPE_CODE);
        vm.householder_symbol = data.HOUSEHOLDER_SYMBOL;

        if (data.NATIVE_PLACE_PROVINCE_CODE !== undefined) {
            vm.initProvinceValue('nativePlaceProvinceArr', 'nativePlaceProvince', data.NATIVE_PLACE_PROVINCE_CODE);
        } else {
            vm.nativePlaceProvince = '-1';
        }
        if (data.NATIVE_PLACE_CITY_CODE !== undefined) {
            vm.initCityValue(data.NATIVE_PLACE_PROVINCE_CODE, 'nativePlaceCityArr', 'nativePlaceCity', data.NATIVE_PLACE_CITY_CODE);
        } else {
            vm.nativePlaceCity = '-1';
        }
        if (data.REGISTER_PROVINCE_CODE !== undefined) {
            vm.initProvinceValue('registerProvinceArr', 'registerProvince', data.REGISTER_PROVINCE_CODE);
        } else {
            vm.registerProvince = '-1';
        }
        if (data.REGISTER_CITY_CODE !== undefined) {
            vm.initCityValue(data.REGISTER_PROVINCE_CODE, 'registerCityArr', 'registerCity', data.REGISTER_CITY_CODE);
        } else {
            vm.registerCity = '-1';
        }
        if (data.REGISTER_COUNTY_DISTRICT_CODE !== undefined) {
            vm.initCountyValue(data.REGISTER_CITY_CODE, 'registerCountyArr', 'registerCounty', data.REGISTER_COUNTY_DISTRICT_CODE);
        } else {
            vm.registerCounty = '-1';
        }
        if (data.REGISTER_STREET_TOWNSHIP_CODE !== undefined) {
            vm.initStreetValue(data.REGISTER_COUNTY_DISTRICT_CODE, 'registerStreetArr', 'registerStreet', data.REGISTER_STREET_TOWNSHIP_CODE);
        } else {
            vm.registerStreet = '-1';
        }
        vm.householdRegisterAddress = data.HOUSEHOLD_REGISTER_ADDRESS;
        if (data.ADDRESS_PROVINCE_CODE !== undefined) {
            vm.initProvinceValue('addressProvinceArr', 'addressProvince', data.ADDRESS_PROVINCE_CODE);
        } else {
            vm.addressProvince = '-1';
        }
        if (data.ADDRESS_CITY_CODE !== undefined) {
            vm.initCityValue(data.ADDRESS_PROVINCE_CODE, 'addressCityArr', 'addressCity', data.ADDRESS_CITY_CODE);
        } else {
            vm.addressCity = '-1';
        }
        if (data.ADDRESS_COUNTY_DISTRICT_CODE !== undefined) {
            vm.initCountyValue(data.ADDRESS_CITY_CODE, 'addressCountyArr', 'addressCounty', data.ADDRESS_COUNTY_DISTRICT_CODE);
        } else {
            vm.addressCounty = '-1';
        }
        if (data.ADDRESS_STREET_TOWNSHIP_CODE !== undefined) {
            vm.initStreetValue(data.ADDRESS_COUNTY_DISTRICT_CODE, 'addressStreetArr', 'addressStreet', data.ADDRESS_STREET_TOWNSHIP_CODE);
        } else {
            vm.addressStreet = '-1';
        }
        vm.houseAddress = data.HOUSE_ADDRESS;

        vm.bloodType = $rootScope.selectItem(vm.bloodTypeArr, 'DICT_VALUE_CODE', data.BLOOD_TYPE_CODE);
        vm.rhNegative = data.RH_NEGATIVE;
        vm.degreeOfEducation = $rootScope.selectItem(vm.degreeOfEducationArr, 'DICT_VALUE_CODE', data.DEGREE_OF_EDUCATION_CODE);
        vm.careerType = $rootScope.selectItem(vm.careerTypeArr, 'DICT_VALUE_CODE', data.CAREER_TYPE_CODE);
        vm.contactName = data.CONTACT_NAME;
        vm.contactPhoneNo = data.CONTACT_PHONE_NO;
        vm.kitchen_ventilation_system = $rootScope.selectItem(vm.kitchen_ventilation_system_arr, 'DICT_VALUE_CODE', data.KITCHEN_VENTILATION_SYSTEM_CODE);
        vm.fuel_type = $rootScope.selectItem(vm.fuel_type_arr, 'DICT_VALUE_CODE', data.FUEL_TYPE_CODE);
        vm.water_source = $rootScope.selectItem(vm.water_source_arr, 'DICT_VALUE_CODE', data.WATER_SOURCE_CODE);
        vm.toilet_type = $rootScope.selectItem(vm.toilet_type_arr, 'DICT_VALUE_CODE', data.TOILET_TYPE_CODE);
        vm.pinfold_position = $rootScope.selectItem(vm.pinfold_position_arr, 'DICT_VALUE_CODE', data.PINFOLD_POSITION_CODE);
        vm.create_time = new Date(data.CREATE_TIME);
        vm.remark = data.REMARK;

        vm.FAMILY_KEY_ID = data.FAMILY_KEY_ID;

        //医药费支付方式
        var medical_expenses_payment_way_code_arr = data.MEDICAL_EXPENSES_PAYMENT_WAY_CODE ? data.MEDICAL_EXPENSES_PAYMENT_WAY_CODE.split(',') : [""];
        if (medical_expenses_payment_way_code_arr[0] === "") {
            vm.medicalExpensesPaymentWaySelected = [];
        } else {
            vm.medicalExpensesPaymentWaySelected = residentArchivesService.getItemArrByCodeArr(vm.medicalExpensesPaymentWayArr, medical_expenses_payment_way_code_arr, 'DICT_VALUE_CODE');
        }

        //药物过敏史
        var drug_allergy_history_code_arr = data.DRUG_ALLERGY_HISTORY_CODE ? data.DRUG_ALLERGY_HISTORY_CODE.split(',') : [""];
        if (drug_allergy_history_code_arr[0] === "" && (data.OTHER_DRUG_ALLERGY_HISTORY_NAME === undefined || data.OTHER_DRUG_ALLERGY_HISTORY_NAME === '')) {
            vm.drugAllergyHistorySelected = [];
            vm.drugAllergyHistoryState = 0;
            vm.other_drug_allergy_history_name = '';
        } else {
            vm.drugAllergyHistoryState = 1;
            vm.drugAllergyHistorySelected = residentArchivesService.getItemArrByCodeArr(vm.drugAllergyHistoryArr, drug_allergy_history_code_arr, 'DICT_VALUE_CODE');
            vm.other_drug_allergy_history_state = true;
            vm.other_drug_allergy_history_name = data.OTHER_DRUG_ALLERGY_HISTORY_NAME;
        }

        //暴露史
        var exposure_history_code_arr = data.EXPOSURE_HISTORY_CODE ? data.EXPOSURE_HISTORY_CODE.split(',') : [""];
        if (exposure_history_code_arr[0] === "") {
            vm.exposureHistorySelected = [];
            vm.exposureHistoryState = 0;
        } else {
            vm.exposureHistoryState = 1;
            vm.exposureHistorySelected = residentArchivesService.getItemArrByCodeArr(vm.exposureHistoryArr, exposure_history_code_arr, 'DICT_VALUE_CODE');
        }

        //残疾情况
        var deformity_condition_code_arr = data.DEFORMITY_CONDITION_CODE ? data.DEFORMITY_CONDITION_CODE.split(',') : [""];
        if (deformity_condition_code_arr[0] === "" && (data.OTHER_DEFORMITY_CONDITION_NAME === undefined || data.OTHER_DEFORMITY_CONDITION_NAME === '')) {
            vm.deformityConditionSelected = [];
            vm.deformityConditionState = 0;
            vm.other_deformity_condition_name = '';
        } else {
            vm.deformityConditionState = 1;
            vm.deformityConditionSelected = residentArchivesService.getItemArrByCodeArr(vm.deformityConditionArr, deformity_condition_code_arr, 'DICT_VALUE_CODE');
            vm.other_deformity_condition_state = true;
            vm.other_deformity_condition_name = data.OTHER_DEFORMITY_CONDITION_NAME;
        }

        //疾病史
        vm.disease_history_list = [];
        if (data.DISEASE_HISTORY_LIST === undefined || data.DISEASE_HISTORY_LIST.length === 0) {
            vm.disease_history_tate = 0;
        } else {
            vm.disease_history_tate = 1;
            vm.disease_history_list = residentArchivesService.stringToDateObj(data.DISEASE_HISTORY_LIST, 'TIME_OF_DIAGNOSIS');
        }

        //手术史
        vm.operation_history_list = [];
        if (data.OPERATION_HISTORY_LIST === undefined || data.OPERATION_HISTORY_LIST.length === 0) {
            vm.operation_history_state = 0;
        } else {
            vm.operation_history_state = 1;
            vm.operation_history_list = residentArchivesService.stringToDateObj(data.OPERATION_HISTORY_LIST, 'OPERATION_TIME');
        }

        //外伤史
        vm.injury_history_list = [];
        if (data.INJURY_HISTORY_LIST === undefined || data.INJURY_HISTORY_LIST.length === 0) {
            vm.injury_history_state = 0;
        } else {
            vm.injury_history_state = 1;
            vm.injury_history_list = residentArchivesService.stringToDateObj(data.INJURY_HISTORY_LIST, 'INJURY_TIME');
        }

        //输血史
        vm.transfusion_history_list = [];
        if (data.TRANSFUSION_HISTORY_LIST === undefined || data.TRANSFUSION_HISTORY_LIST.length === 0) {
            vm.transfusion_history_state = 0;
        } else {
            vm.transfusion_history_state = 1;
            vm.transfusion_history_list = residentArchivesService.stringToDateObj(data.TRANSFUSION_HISTORY_LIST, 'TRANSFUSION_TIME');
        }

        //住院史
        vm.hospitalization_history_list = [];
        if (data.HOSPITALIZATION_HISTORY === undefined || data.HOSPITALIZATION_HISTORY.length === 0) {
            vm.hospitalization_history_state = 0;
        } else {
            vm.hospitalization_history_state = 1;
            vm.hospitalization_history_list = residentArchivesService.stringToDateObj(data.HOSPITALIZATION_HISTORY, 'HOSPITALIZATION_TIME');
        }

        //家族史
        vm.family_medical_history_list = [];
        if (data.FAMILY_MEDICAL_HISTORY_LIST === undefined || data.FAMILY_MEDICAL_HISTORY_LIST.length === 0) {
            vm.family_medical_history_state = 0;
        } else {
            vm.family_medical_history_state = 1;
            vm.family_medical_history_list = data.FAMILY_MEDICAL_HISTORY_LIST;
        }

        //遗传史
        vm.genetic_history_list = [];
        if (data.GENETIC_HISTORY_LIST === undefined || data.GENETIC_HISTORY_LIST.length === 0) {
            vm.genetic_history_state = 0;
        } else {
            vm.genetic_history_state = 1;
            vm.genetic_history_list = data.GENETIC_HISTORY_LIST;
        }
    }

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('residentArchivesListCtrl', residentArchivesListCtrl);
residentArchivesListCtrl.$inject = ['$rootScope', '$state', 'residentArchivesService', '$q', 'downloadCommon'];
function residentArchivesListCtrl($rootScope, $state, residentArchivesService, $q, downloadCommon) {
    var vm = this;

    vm.isDownloading = false;
    vm.selectedIndex = $state.params.TYPE?$state.params.TYPE:0;
    vm.residentAddressProvince = '-1';
    vm.residentAddressCity = '-1';
    vm.residentAddressCounty = '-1';
    vm.residentAddressStreet = '-1';
    vm.residentSex = '-1';

    var listParam = {};
    var listParamSigned = {};
    var lastProvince = null;
    var lastCity = null;
    var lastCounty = null;

    vm.searchTerm;
    vm.selectedDoctoer = {};
    //签约医生
    vm.doctor = [];
    vm.getDoctorList = function () {
        residentArchivesService.getDoctorListOrganizationConstraint(
            {"DOCTOR_NAME": vm.searchTerm},
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.doctor = data;
                    },
                    function () {
                        $rootScope.alertDialog('获取医生列表失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取医生列表失败');
            }
        );
    };
    vm.clearSearchTerm = function () {
        vm.searchTerm = '';
        //关闭的时候判断已有的值是否在list中，在的话选中，不在的话把list赋值给list再选中
        if (vm.selectedDoctor !== undefined) {
            var temp = $rootScope.selectItem(vm.doctor, "FAMILY_DOCTOR_KEY_ID", vm.selectedDoctor.FAMILY_DOCTOR_KEY_ID);
            if (temp !== undefined) {
                vm.selectedDoctor = temp;
            } else {
                vm.doctor = [];
                vm.doctor.push(temp);
                vm.selectedDoctor = vm.doctor[0];
            }
        }
    };
    vm.getSearchTerm = function () {
        vm.searchTerm = vm.selectedDoctor ? vm.selectedDoctor.DOCTOR_NAME : undefined;
        vm.searchTermChange();
    };
    angular.element('input[name="doctor"]').on('keydown', function (ev) {
        ev.stopPropagation();
    });
    vm.searchTermChange = function () {
        if (vm.searchTerm !== '' && vm.searchTerm !== undefined) {
            vm.getDoctorList();
        }
    };


    vm.initSexList = function (isTouched) {
        if (!isTouched) {
            residentArchivesService.getResidentSexList('', function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.residentSexs = data;
                    },
                    function () {
                        vm.residentSexs = [];
                        $rootScope.alertDialog('获取性别列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取性别列表失败');
            });
        }
    };

    vm.initProvinceList = function (isTouched) {
        if (!isTouched) {
            $rootScope.commonService('getProvinceList', '', function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.residentAddressProvinces = data;
                    },
                    function () {
                        vm.residentAddressProvinces = [];
                        $rootScope.alertDialog('获取省列表失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取省列表失败');
            });
        }
    };


    vm.initCityListOfCertainProvince = function () {
        if (vm.residentAddressProvince === '-1') {
            vm.residentAddressCitys = [];
            return;
        }
        if (lastProvince && lastProvince === vm.residentAddressProvince.PROVINCE_CODE) {
            return;
        }
        var params = {
            PROVINCE_CODE: vm.residentAddressProvince.PROVINCE_CODE
        };
        lastProvince = vm.residentAddressProvince.PROVINCE_CODE;
        $rootScope.commonService('getCityListOfCertainProvince', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.residentAddressCitys = data;
                },
                function () {
                    vm.residentAddressCitys = [];
                    $rootScope.alertDialog('获取市列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取市列表失败');
        });
    };

    vm.initCountyListOfCertainCity = function () {
        if (vm.residentAddressCity === '-1') {
            vm.residentAddressCountys = [];
            return;
        }
        if (lastCity && lastCity === vm.residentAddressCity.CITY_CODE) {
            return;
        }
        var params = {
            CITY_CODE: vm.residentAddressCity.CITY_CODE
        };
        lastCity = vm.residentAddressCity.CITY_CODE;
        $rootScope.commonService('getCountyListOfCertainCity', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.residentAddressCountys = data;
                },
                function () {
                    vm.residentAddressCountys = [];
                    $rootScope.alertDialog('获取区/县失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取区/县失败');
        });
    };

    vm.initSubdistrictListOfCertainCounty = function () {
        if (vm.residentAddressCounty === '-1') {
            vm.residentAddressStreets = [];
            return;
        }
        if (lastCounty && lastCounty === vm.residentAddressCounty.COUNTY_DISTRICT_CODE) {
            return;
        }
        var params = {
            COUNTY_DISTRICT_CODE: vm.residentAddressCounty.COUNTY_DISTRICT_CODE
        };
        lastCounty = vm.residentAddressCounty.COUNTY_DISTRICT_CODE;
        $rootScope.commonService('getSubdistrictListOfCertainCounty', params, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.residentAddressStreets = data;
                },
                function () {
                    vm.residentAddressStreets = [];
                    $rootScope.alertDialog('获取街道列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取街道列表失败');
        });
    };


    vm.changeAddress = function (index) {
        switch (index) {
            case 1:
                vm.residentAddressCity = '-1';
                vm.residentAddressCounty = '-1';
                vm.residentAddressStreet = '-1';
                break;
            case 2:
                vm.residentAddressCounty = '-1';
                vm.residentAddressStreet = '-1';
                break;
            case 3:
                vm.residentAddressStreet = '-1';
                break;
            default:
                break;

        }
    };

    vm.searchTextChange = function (search) {
        var searchParam = {
            DOCTOR_NAME: search
        };
        var result = $q.defer();
        residentArchivesService.getDoctorListOrganizationConstraint(searchParam, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    result.resolve(data);
                },
                function () {
                    result.resolve([]);
                }
            );
        }, function () {

        });
        return result.promise;

    };

    vm.create = function () {
        $state.go('main.resident.residentArchivesAdd');
    };

    vm.initTableData = function (index) {
        if (vm.startAge && vm.endAge && vm.endAge < vm.startAge) {
            $rootScope.alertDialog("开始年龄不能大于结束年龄");
            return;
        }
        if (index === 0) {
            listParamSigned = {
                "IS_SIGNED": true,
                "FAMILY_DOCTOR_KEY_ID": vm.selectedDoctor ? vm.selectedDoctor.FAMILY_DOCTOR_KEY_ID : null,
                "START_AGE": vm.startAge ? vm.startAge : null,
                "END_AGE": vm.endAge ? vm.endAge : null,
                "RESIDENT_SEX_CODE": vm.residentSex === '-1' ? null : vm.residentSex.DICT_VALUE_CODE,
                "ADDRESS_PROVINCE_CODE": vm.residentAddressProvince === '-1' ? null : vm.residentAddressProvince.PROVINCE_CODE,
                "ADDRESS_CITY_CODE": vm.residentAddressCity === '-1' ? null : vm.residentAddressCity.CITY_CODE,
                "ADDRESS_COUNTY_DISTRICT_CODE": vm.residentAddressCounty === '-1' ? null : vm.residentAddressCounty.COUNTY_DISTRICT_CODE,
                "ADDRESS_STREET_TOWNSHIP_CODE": vm.residentAddressStreet === '-1' ? null : vm.residentAddressStreet.STREET_TOWNSHIP_CODE,
                "RESIDENT_ID_NO": vm.residentIdNo ? vm.residentIdNo : null,
                "RESIDENT_PHONE_NO": vm.residentPhone ? vm.residentPhone : null,
                "RESIDENT_NAME": vm.residentName ? vm.residentName : null
            };
            residentArchivesService.getResidentSignedListHtml(vm, listParamSigned);
        } else {
            listParam = {
                "IS_SIGNED": null,
                "FAMILY_DOCTOR_KEY_ID": vm.selectedDoctor ? vm.selectedDoctor.FAMILY_DOCTOR_KEY_ID : null,
                "START_AGE": vm.startAge ? vm.startAge : null,
                "END_AGE": vm.endAge ? vm.endAge : null,
                "RESIDENT_SEX_CODE": vm.residentSex === '-1' ? null : vm.residentSex.DICT_VALUE_CODE,
                "ADDRESS_PROVINCE_CODE": vm.residentAddressProvince === '-1' ? null : vm.residentAddressProvince.PROVINCE_CODE,
                "ADDRESS_CITY_CODE": vm.residentAddressCity === '-1' ? null : vm.residentAddressCity.CITY_CODE,
                "ADDRESS_COUNTY_DISTRICT_CODE": vm.residentAddressCounty === '-1' ? null : vm.residentAddressCounty.COUNTY_DISTRICT_CODE,
                "ADDRESS_STREET_TOWNSHIP_CODE": vm.residentAddressStreet === '-1' ? null : vm.residentAddressStreet.STREET_TOWNSHIP_CODE,
                "RESIDENT_ID_NO": vm.residentIdNo ? vm.residentIdNo : null,
                "RESIDENT_PHONE_NO": vm.residentPhone ? vm.residentPhone : null,
                "RESIDENT_NAME": vm.residentName ? vm.residentName : null
            };
            residentArchivesService.getResidentListHtml(vm, listParam);
        }
    };
    vm.initTableData(0);
    vm.initTableData(1);

    vm.downLoadFile = function (index) {
        vm.isDownloading = true;
        if (index === 0) {
            residentArchivesService.downloadOrganizationList(listParamSigned, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    downloadCommon.downloadFile(data['fileName'], "居民档案信息.xls");
                    vm.isDownloading = false;
                }, function () {
                    vm.isDownloading = false;
                    $rootScope.alertDialog("信息导出失败");
                });
            }, function () {
                vm.isDownloading = false;
                $rootScope.alertDialog("信息导出失败");
            });
        } else {
            residentArchivesService.downloadOrganizationList(listParam, function (response) {
                $rootScope.handleMessage(response, function (data) {
                    downloadCommon.downloadFile(data['fileName'], "居民档案信息.xls");
                    vm.isDownloading = false;
                }, function () {
                    vm.isDownloading = false;
                    $rootScope.alertDialog("信息导出失败");
                });
            }, function () {
                vm.isDownloading = false;
                $rootScope.alertDialog("信息导出失败");
            });
        }

    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('residentArchivesSidebarCtrl', residentArchivesSidebarCtrl);
residentArchivesSidebarCtrl.$inject = ['$rootScope', '$state', '$stateParams', 'residentArchivesService'];
function residentArchivesSidebarCtrl($rootScope, $state, $stateParams, residentArchivesService) {
    var vm = this;

    vm.FAMILY_KEY_ID = 0;
    vm.RESIDENT_KEY_ID = $stateParams.RESIDENT_KEY_ID;

    //获取各种标志
    residentArchivesService.getResidentDiseaseFlag(
        {
            "RESIDENT_KEY_ID": vm.RESIDENT_KEY_ID
        },
        function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.FAMILY_KEY_ID = (data.FAMILY_KEY_ID+'')==='0'?null:data.FAMILY_KEY_ID;
                    vm.PHYSICAL_RECORD_KEY_ID = (data.PHYSICAL_RECORD_KEY_ID+'')==='0'?null:data.PHYSICAL_RECORD_KEY_ID;//体检信息标志
                    vm.HYPERTENSION_RECORD_KEY_ID = (data.HYPERTENSION_RECORD_KEY_ID+'')==='0'?null:data.HYPERTENSION_RECORD_KEY_ID;//高血压标志
                    vm.DIABETES_RECORD_KEY_ID = (data.DIABETES_RECORD_KEY_ID+'')==='0'?null:data.DIABETES_RECORD_KEY_ID;//糖尿病标志
                    vm.RESIDENT_NAME = data.RESIDENT_NAME;//居民姓名
                },
                function () {
                    $rootScope.alertDialog('查询标志信息失败');
                }
            );
        },
        function () {
            $rootScope.alertDialog('查询标志信息失败');
        }
    );
    residentArchivesService.getSignedDoctor(
        {
            "RESIDENT_KEY_ID": vm.RESIDENT_KEY_ID
        },
        function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    if (data === null) {
                        vm.signedDoctorName = undefined;
                    } else {
                        vm.signedDoctorName = data.DOCTOR_NAME;
                    }
                },
                function () {
                    $rootScope.alertDialog('查询签约医生姓名失败');
                }
            );
        },
        function () {
            $rootScope.alertDialog('查询签约医生姓名失败');
        }
    );

    vm.currentTab='basicArchive';

    vm.tabShow=true;
    vm.tabClick=function(tabName){
        if(vm.currentTab===tabName)
        {
            vm.tabShow=!vm.tabShow;
        }else{
            vm.tabShow=true;
            vm.currentTab=tabName;
        }
    };
    $rootScope.$on('url-change', function(){
        vm.judgePage();
    });
    vm.judgePage=function(){
        if($rootScope.isContains($state.current.name,'Examination')){
            vm.currentPage='examination';
        }else if($rootScope.isContains($state.current.name,'Identification')){
            vm.currentPage='identification';
        }else if($rootScope.isContains($state.current.name,'family')){
            vm.currentPage='family';
        }else if($rootScope.isContains($state.current.name,'hypertension')){
            vm.currentPage='hypertension';
        }else if($rootScope.isContains($state.current.name,'diabetes')){
            vm.currentPage='diabetes';
        }else{
            vm.currentPage='basic';
        }
    };
    vm.judgePage();//根据当前路径判断是哪一个页面
    vm.gotoResidentArchive = function () {
        vm.currentPage='basic';
      $state.go('main.resident.residentArchivesSidebar.detail.residentArchivesEdit', {"RESIDENT_KEY_ID": vm.RESIDENT_KEY_ID});  
    };

    vm.gotoFamilyArchive = function () {
        vm.currentPage='family';
        $state.go('main.resident.residentArchivesSidebar.detail.familyArchivesEdit', {"FAMILY_KEY_ID": vm.FAMILY_KEY_ID});
    };

    vm.gotoFamilyMember = function () {
        vm.currentPage='family';
        $state.go('main.resident.residentArchivesSidebar.detail.familyMember', {"FAMILY_KEY_ID": vm.FAMILY_KEY_ID});
    };

    vm.gotoPhysicalExaminationRecords= function () {
        vm.currentPage='examination';
        $state.go('main.resident.residentArchivesSidebar.detail.physicalExamination', {"RESIDENT_KEY_ID": vm.RESIDENT_KEY_ID});
    };

    vm.gotoPhysicalIdentification = function () {
        vm.currentPage='identification';
        $state.go('main.resident.residentArchivesSidebar.detail.physicalIdentification', {"RESIDENT_KEY_ID": vm.RESIDENT_KEY_ID});
    };

    vm.gotoHypertensionArchive = function () {
        vm.currentPage='hypertension';
        $state.go('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.hypertensionEdit', {
            "RESIDENT_KEY_ID": vm.RESIDENT_KEY_ID,
            "HYPERTENSION_RECORD_KEY_ID": vm.HYPERTENSION_RECORD_KEY_ID
        });
    };

    vm.gotoDiabetesArchive = function () {
        vm.currentPage='diabetes';
        $state.go('main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.diabetesEdit', {
            "DIABETES_RECORD_KEY_ID": vm.DIABETES_RECORD_KEY_ID
        });
    };
    
    return vm;
}

"use strict";
SMS.CONTROLLERS.controller('residentBehaviorListCtrl', residentBehaviorListCtrl);
residentBehaviorListCtrl.$inject = ['$rootScope', '$state', 'residentArchivesService'];
function residentBehaviorListCtrl($rootScope, $state, residentArchivesService) {
    var vm = this;
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('residentMedicalListCtrl', residentMedicalListCtrl);
residentMedicalListCtrl.$inject = ['$rootScope', '$state', 'residentArchivesService'];
function residentMedicalListCtrl($rootScope, $state, residentArchivesService) {
    var vm = this;
    return vm;
}
"use strict";
SMS.SERVICES.service('residentArchivesService', residentArchivesService);
residentArchivesService.$inject = ['$rootScope', '$state', 'ResidentArchives', 'bootstrapTable'];
function residentArchivesService($rootScope, $state, ResidentArchives, bootstrapTable) {
    var vm = this;


    vm.getResidentSexList = function (param, successFunction, failedFunction) {
        ResidentArchives.getResidentSexList(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getDoctorListOrganizationConstraint = function (param, successFunction, failedFunction) {
        ResidentArchives.getDoctorListOrganizationConstraint(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.downloadOrganizationList = function (param, successFunction, failedFunction) {
        ResidentArchives.exportResidentListExcel(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getResidentListHtml = function ($vm, listPara) {
        var list = {
            dataFunction: getResidentList,
            dataParams: listPara,
            columns: [{
                field: 'RESIDENT_NAME',
                title: '姓名',
                align: 'center',
                formatter: function (val) {
                    return "<div  style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click div': function (e, vlaue, row) {
                        $state.go('main.resident.residentArchivesSidebar.detail.residentArchivesEdit', {"RESIDENT_KEY_ID": row.RESIDENT_KEY_ID});
                    }
                }
            }, {
                field: 'RESIDENT_SEX_NAME',
                title: '性别',
                align: 'center'
            }, {
                field: 'BIRTHDAY',
                title: '出生日期',
                align: 'center'
            }, {
                field: 'RESIDENT_PHONE_NO',
                title: '联系方式',
                align: 'center'
            }, {
                field: 'REGISTER_ADDRESS',
                title: '居住地址',
                align: 'center'
            }, {
                field: 'CREATE_TIME',
                title: '建档时间',
                align: 'center'
            }]
        };

        function getResidentList(param, successFunction, failedFunction) {
            ResidentArchives.getResidentList(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        };
        $vm.residentTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };

    vm.getResidentSignedListHtml = function ($vm, listPara) {
        var list = {
            dataFunction: getResidentList,
            dataParams: listPara,
            columns: [{
                field: 'RESIDENT_NAME',
                title: '姓名',
                align: 'center',
                formatter: function (val) {
                    return "<div  style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click div': function (e, vlaue, row) {
                        $state.go('main.resident.residentArchivesSidebar.detail.residentArchivesEdit', {"RESIDENT_KEY_ID": row.RESIDENT_KEY_ID});
                    }
                }
            }, {
                field: 'RESIDENT_SEX_NAME',
                title: '性别',
                align: 'center'
            }, {
                field: 'BIRTHDAY',
                title: '出生日期',
                align: 'center'
            }, {
                field: 'RESIDENT_PHONE_NO',
                title: '联系方式',
                align: 'center'
            }, {
                field: 'REGISTER_ADDRESS',
                title: '居住地址',
                align: 'center'
            }, {
                field: 'CREATE_TIME',
                title: '建档时间',
                align: 'center'
            }, {
                field: 'DOCTOR_NAME',
                title: '签约医生',
                align: 'center'
            }, {
                field: 'ORGANIZATION_NAME',
                title: '医生所属机构',
                align: 'center'
            }]
        };

        function getResidentList(param, successFunction, failedFunction) {
            ResidentArchives.getResidentList(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        };
        $vm.residentSignedTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };

    vm.isEmptyObject = function (obj) {
        for (var n in obj) {
            return false
        }
        return true;
    };

    vm.checkIdNo = function (param, successFunction, failedFunction) {
        ResidentArchives.checkIdNo(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.createResident = function (param, successFunction, failedFunction) {
        ResidentArchives.createResident(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.objectToString = function (obj) {
        var nameArr = [];
        var codeArr = [];
        angular.forEach(obj, function (item) {
            nameArr.push(item.DICT_VALUE_NAME);
            codeArr.push(item.DICT_VALUE_CODE);
        });
        return {
            "NAME": nameArr.toString(),
            "CODE": codeArr.toString()
        };
    };

    //list is a Array, key is a string
    vm.dateObjToString = function (list, key) {
        if (list.length === 0) {
            return [];
        }
        for (var i = 0; i < list.length; i++) {
            list[i][key] = getDate(list[i][key]);
        }
    };

    vm.stringToDateObj = function (list, key) {
        if (list.length === 0) {
            return [];
        }
        for (var i = 0; i < list.length; i++) {
            list[i][key] = new Date(list[i][key]);
        }
        return list;
    };

    //yyyy-MM-dd
    function getDate(date) {
        var year = date.getFullYear();
        var month = date.getMonth() + 1;
        var day = date.getDate();
        return year + "-" + month + "-" + day;
    }

    vm.getResidentDetailInfo = function (param, successFunction, failedFunction) {
        ResidentArchives.getResidentDetailInfo(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getItemArrByCodeArr = function (items, codes, key) {
        var result = [];
        if (codes[0] === "") {
            return [];
        }
        for (var i = 0; i < codes.length; i++) {
            result.push($rootScope.selectItem(items, key, codes[i]));
        }
        return result;
    };

    vm.editResidentInfo = function (param, successFunction, failedFunction) {
        ResidentArchives.editResidentInfo(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getSignedDoctor = function (param, successFunction, failedFunction) {
        ResidentArchives.getSignedDoctor(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getResidentDiseaseFlag = function (param, successFunction, failedFunction) {
        ResidentArchives.getResidentDiseaseFlag(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('diabetesHeadBarCtrl', diabetesHeadBarCtrl);
diabetesHeadBarCtrl.$inject = ['$rootScope', '$state'];
function diabetesHeadBarCtrl($rootScope, $state) {
    var vm = this;
    vm.residentKeyId = $state.params.RESIDENT_KEY_ID;
    vm.diabetesRecordKeyId = $state.params.DIABETES_RECORD_KEY_ID;
    vm.goBasic = function() {
        vm.currentPage ='diabetesEdit';
        $state.go('main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.diabetesEdit', {
            "DIABETES_RECORD_KEY_ID": vm.diabetesRecordKeyId
        });
    };
    vm.goGlucose = function() {
        vm.currentPage ='bloodGlucose';
        $state.go('main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.bloodGlucoseList', {
            "RESIDENT_KEY_ID": vm.residentKeyId,
            "DIABETES_RECORD_KEY_ID": vm.diabetesRecordKeyId
        });
    };
    vm.goFollow = function() {
        vm.currentPage ='followup';
        $state.go('main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.followupList', {
            "RESIDENT_KEY_ID": vm.residentKeyId,
            "DIABETES_RECORD_KEY_ID": vm.diabetesRecordKeyId
        });
    };
    $rootScope.$on('url-change', function(e, data){
        vm.judgePage(data);
    });
    vm.judgePage=function(data){
        if($rootScope.isContains(data,'diabetesEdit')){
            vm.currentPage ='diabetesEdit';
        }else if($rootScope.isContains(data,'bloodGlucose')){
            vm.currentPage ='bloodGlucose';
        }else if($rootScope.isContains(data,'followup')){
            vm.currentPage ='followup';
        }
    };
    vm.judgePage($state.current.name);//根据当前路径判断是哪一个页面
    return vm;
}

"use strict";
SMS.CONTROLLERS.controller('hypertensionHeadBarCtrl', hypertensionHeadBarCtrl);
hypertensionHeadBarCtrl.$inject = ['$rootScope', '$state'];
function hypertensionHeadBarCtrl($rootScope, $state) {
    var vm = this;
    vm.residentKeyId = $state.params.RESIDENT_KEY_ID;
    vm.hypertensionRecordKeyId = $state.params.HYPERTENSION_RECORD_KEY_ID;
    vm.goBasic = function() {
        vm.currentPage ='hypertension';
        $state.go('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.hypertensionEdit', {
            "RESIDENT_KEY_ID": vm.residentKeyId,
            "HYPERTENSION_RECORD_KEY_ID": vm.hypertensionRecordKeyId
        });
    };
    vm.goPressure = function() {
        vm.currentPage ='bloodPressure';
        $state.go('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.bloodPressureList', {
            "HYPERTENSION_RECORD_KEY_ID": vm.hypertensionRecordKeyId
        });
    };
    vm.goFollow = function() {
        vm.currentPage ='followup';
        $state.go('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.followupList', {
            "RESIDENT_KEY_ID": vm.residentKeyId,
            "HYPERTENSION_RECORD_KEY_ID": vm.hypertensionRecordKeyId
        });
    };

    vm.goEval = function() {
        vm.currentPage ='evaluation';
        $state.go('main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.evaluationList', {
            "HYPERTENSION_RECORD_KEY_ID": vm.hypertensionRecordKeyId
        });
    };

    $rootScope.$on('url-change', function(e, data){
        vm.judgePage(data);
    });
    vm.judgePage=function(data){
        if($rootScope.isContains(data,'hypertensionEdit')){
            vm.currentPage ='hypertension';
        }else if($rootScope.isContains(data,'bloodPressure')){
            vm.currentPage ='bloodPressure';
        }else if($rootScope.isContains(data,'followup')){
            vm.currentPage ='followup';
        }else if($rootScope.isContains(data,'evaluation')){
            vm.currentPage ='evaluation';
        }
    };

    vm.judgePage($state.current.name);//根据当前路径判断是哪一个页面
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('diabetesEditCtrl', diabetesEditCtrl);
diabetesEditCtrl.$inject = ['$rootScope', '$state', '$stateParams', 'diabetesService', '$filter'];
function diabetesEditCtrl($rootScope, $state, $stateParams, diabetesService, $filter) {
    var vm = this;

    vm.data = {};

    //控制显示隐藏和判断
    vm.edit = true;
    vm.editable = false;
    vm.residentKeyId = $stateParams.RESIDENT_KEY_ID;

    function definedData() {
        //初始化单选
        vm['managementLevel'] = {};
        vm['drugCompliance'] = {};
    }

    var dict_type_code_list = [
        {
            "DICT_TYPE_CODE": "0025",//管理级别
            "LIST_NAME": "managementLevelList"
        },
        {
            "DICT_TYPE_CODE": "0026",//服药依从性
            "LIST_NAME": "drugComplianceList"
        }
    ];
    var dataBak = {};

    definedData();
    getDictList();

    function getDetailedArchives() {
        diabetesService.getDetailedArchives(
            {RESIDENT_KEY_ID: vm.residentKeyId},
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        transformData(data);
                        dataBak = angular.copy(data);
                    },
                    function () {
                        $rootScope.alertDialog("查询糖尿病数据失败");
                    }
                );
            },
            function () {
                $rootScope.alertDialog("查询糖尿病数据失败");
            }
        );
    }

    //获取字典表
    function getDictList() {
        $rootScope.commonService(
            'getDictList',
            {
                "DICT_TYPE_CODE_LIST": dict_type_code_list
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        eachDictValue(data);
                        getDetailedArchives();
                    },
                    function () {
                        $rootScope.alertDialog('获取字典列表失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取字典列表失败');
            }
        );
    }

    function eachDictValue(data) {
        angular.forEach(dict_type_code_list, function (item) {
            vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
        });
    }

    //转换数据
    function transformData(data) {
        vm['diabetesRecordKeyId'] = data['DIABETES_RECORD_KEY_ID'];//姓名
        vm['residentName'] = data['RESIDENT_NAME'];//姓名
        vm['residentSexName'] = data['RESIDENT_SEX_NAME'];//性别
        vm['birthday'] = data['BIRTHDAY'];//出生日期
        vm['residentIdNo'] = data['RESIDENT_ID_NO'];//身份证号
        vm['residentPhoneNo'] = data['RESIDENT_PHONE_NO'];//联系电话
        vm['houseAddress'] = data['HOUSE_ADDRESS'];//家庭地址
        vm['livingTypeName'] = data['LIVING_TYPE_NAME'];//居住类型
        vm['firstDateOfOnset'] = formatDateString(data['FIRST_DATE_OF_ONSET']);//首次发病日期
        vm['diagnosisTime'] = formatDateString(data['DIAGNOSIS_TIME']);// 确诊日期
        vm['diagnosisDoctorName'] = data['DIAGNOSIS_DOCTOR_NAME'];//诊断医生
        vm['diagnosisOrganization'] = data['DIAGNOSIS_ORGANIZATION'];//确诊机构
        vm['treatmentSituation'] = data['TREATMENT_SITUATION'];//治疗情况
        vm['fastingBloodGlucose'] = data['FASTING_BLOOD_GLUCOSE'];//空腹血糖
        vm['postPrandialBloodGlucose'] = data['POSTPRANDIAL_BLOOD_GLUCOSE'];//餐后血糖
        vm['totalCholesterol'] = data['TOTAL_CHOLESTEROL'];//总胆固醇
        vm['serumCreatinine'] = data['SERUM_CREATININE'];//血清肌酐
        vm['urineProtein'] = data['URINE_PROTEIN'];//尿蛋白
        vm['isTakingInsulin'] = data['IS_TAKING_INSULIN'];//是否服用胰岛素
        vm['otherAssayIndex'] = data['OTHER_ASSAY_INDEX'];//其他化验指标
        vm['managementLevelName'] = data['MANAGEMENT_LEVEL_NAME'];//管理级别
        vm['drugComplianceName'] = data['DRUG_COMPLIANCE_NAME'];//药物依从性
        vm['managementLevel'] = ifNullItem($rootScope.selectItem(vm['managementLevelList'], 'DICT_VALUE_CODE', data['MANAGEMENT_LEVEL_CODE']));//管理级别编码
        vm['drugCompliance'] = ifNullItem($rootScope.selectItem(vm['drugComplianceList'], 'DICT_VALUE_CODE', data['DRUG_COMPLIANCE_CODE']));//药物依从性
        vm['createTime'] = formatDate(data['CREATE_TIME']);//建档日期
        vm['creatorName'] = data['CREATOR_NAME'];//建档医生
        vm['creatorOrganizationName'] = data['CREATED_ORGANIZATION_NAME'];//建档医生
    }

    function formatDate(long) {
        var d=	new Date();
        d.setTime(long);
        var s=d.format('yyyy-MM-dd');
        return s;
    }

    Date.prototype.format = function(f){
        var o ={
            "M+" : this.getMonth()+1, //month
            "d+" : this.getDate(),    //day
            "h+" : this.getHours(),   //hour
            "m+" : this.getMinutes(), //minute
            "s+" : this.getSeconds(), //second
            "q+" : Math.floor((this.getMonth()+3)/3),  //quarter
            "S" : this.getMilliseconds() //millisecond
        }
        if(/(y+)/.test(f))f=f.replace(RegExp.$1,(this.getFullYear()+"").substr(4 - RegExp.$1.length));
        for(var k in o)
            if(new RegExp("("+ k +")").test(f))f = f.replace(RegExp.$1,RegExp.$1.length==1 ? o[k] : ("00"+ o[k]).substr((""+ o[k]).length));return f
    }

    function formatDateString(dateString) {
        var val = Date.parse(dateString);
        var newDate = new Date(val);
        return newDate;
    }

    vm.edit = function () {
        vm.editable = !vm.editable;
    };

    //保存
    vm.save = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }

        //参数组装
        var params = {
            "DIABETES_RECORD_KEY_ID": vm['diabetesRecordKeyId'],
            "FIRST_DATE_OF_ONSET": vm['firstDateOfOnset']? $filter('date')(vm['firstDateOfOnset'], 'yyyy-MM-dd') + ' 00:00:00': null,
            "DIAGNOSIS_TIME": vm['diagnosisTime']? $filter('date')(vm['diagnosisTime'], 'yyyy-MM-dd') + ' 00:00:00': null,
            "DIAGNOSIS_DOCTOR_NAME": vm['diagnosisDoctorName'],
            "DIAGNOSIS_ORGANIZATION": vm['diagnosisOrganization'],
            "TREATMENT_SITUATION": vm['treatmentSituation'],
            "FASTING_BLOOD_GLUCOSE": vm['fastingBloodGlucose'],
            "POSTPRANDIAL_BLOOD_GLUCOSE": vm['postPrandialBloodGlucose'],
            "TOTAL_CHOLESTEROL": vm['totalCholesterol'],
            "SERUM_CREATININE": vm['serumCreatinine'],
            "URINE_PROTEIN": vm['urineProtein'],
            "IS_TAKING_INSULIN": vm['isTakingInsulin'],
            "OTHER_ASSAY_INDEX": vm['otherAssayIndex'],
            "MANAGEMENT_LEVEL_CODE": vm['managementLevel']['DICT_VALUE_CODE'],
            "MANAGEMENT_LEVEL_NAME": vm['managementLevel']['DICT_VALUE_NAME'],
            "DRUG_COMPLIANCE_CODE": vm['drugCompliance']['DICT_VALUE_CODE'],
            "DRUG_COMPLIANCE_NAME": vm['drugCompliance']['DICT_VALUE_NAME']
        };

        diabetesService.edit(
            params,
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        $rootScope.alertDialog('编辑糖尿病档案成功');
                        vm.editable = false;
                        definedData();
                        getDictList();
                    },
                    function () {
                        $rootScope.alertDialog('编辑糖尿病档案失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('编辑糖尿病档案失败');
            }
        );
    };

    function ifNullItem(item) {
        if (item === undefined || item === null || item === '') {
            return {
                "DICT_VALUE_CODE": "",
                "DICT_VALUE_NAME": ""
            };
        } else {
            return item;
        }
    }

    //返回
    vm.cancel = function (form) {
        if (form.$dirty) {
            $rootScope.confirmDialog(
                '您确定要放弃保存吗?',
                function () {
                    resetData();
                    vm.editable = false;
                },
                function () {

                }
            );
        } else {
            vm.editable = false;
        }
        function resetData() {
            var data = angular.copy(dataBak);
            definedData();
            transformData(data);
        }
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('diabetesListCtrl', diabetesListCtrl);
diabetesListCtrl.$inject = ['$rootScope', '$state', '$mdPanel', 'diabetesService', '$filter'];
function diabetesListCtrl($rootScope, $state, $mdPanel, diabetesService, $filter) {
    var vm = this;

    vm.search = {};
    vm.search.options = null;

    vm.initScope = initScope;
    vm.getDiabetesList = getDiabetesList;

    vm.initScope();

    function initScope() {
        vm.search.followUpTypes = [
            {
                value: '',
                name: '全部'
            },
            {
                value: 'NEAR',
                name: '近期随访'
            },
            {
                value: 'OVERDUE',
                name: '过期随访'
            },
            {
                value: 'NO_PLAN',
                name: '无随访计划'
            }
        ];
        vm.search.nextFollowUpType = '';
        getDiabetesList();
    }

    function getDiabetesList() {
        var params = {
            "SEARCH_CONDITION": vm.search.searchCondition, //居民姓名或身份证号
            "LAST_FOLLOW_UP_BEGIN_TIME": vm.search.lastFollowUpBeginTime? $filter('date')(vm.search.lastFollowUpBeginTime, 'yyyy-MM-dd') + ' 00:00:00': null, //上次随访日期开始时间
            "LAST_FOLLOW_UP_END_TIME": vm.search.lastFollowUpEndTime ? $filter('date')(vm.search.lastFollowUpEndTime, 'yyyy-MM-dd') + ' 23:59:59': null, //上次随访日期截止时间
            "NEXT_FOLLOW_UP_BEGIN_TIME": vm.search.nextFollowUpBeginTime ? $filter('date')(vm.search.nextFollowUpBeginTime, 'yyyy-MM-dd') + ' 00:00:00': null, //下次随访日期开始时间
            "NEXT_FOLLOW_UP_END_TIME": vm.search.nextFollowUpEndTime ? $filter('date')(vm.search.nextFollowUpEndTime, 'yyyy-MM-dd') + ' 23:59:59': null, //下次随访日期截止时间
            "NEXT_FOLLOW_UP_TYPE": vm.search.nextFollowUpType   //下次随访
        };
        diabetesService.getDiabetesList(vm, params, $state);
    };

    vm.create = function () {
        SMS.CONTROLLERS.controller('DialogAddDiabetesController', DialogAddDiabetesController);
        DialogAddDiabetesController.$inject = ['$rootScope', '$scope', 'mdPanelRef', 'hypertensionService', 'diabetesService'];

        function DialogAddDiabetesController($rootScope, $scope, mdPanelRef, hypertensionService, diabetesService) {
            $scope.$on('panelClose',
                function(){
                    mdPanelRef.close();
                }
            );
            $scope.cancel = function () {
                mdPanelRef.close();
            };
            $scope.findResident = function() {
                hypertensionService.findResident({
                    RESIDENT_ID_NO: $scope.idNo
                }, function(res) {
                    if (res === null) {
                        $rootScope.alertDialog('没有查询到数据');
                    } else {
                        $scope.residentInfo = res;
                    }
                });
            };
            $scope.ensureResident = function() {
                diabetesService.getDetailedArchives({
                        RESIDENT_KEY_ID: $scope.residentInfo.RESIDENT_KEY_ID
                    },
                    function (response) {
                        $rootScope.handleMessage(
                            response,
                            function (data) {
                                mdPanelRef.close().then(function(){
                                    if (data.HAS_DIABETES_ARCHIVES === 0) {
                                        $state.go('main.special.diabetesAdd', {RESIDENT_KEY_ID: $scope.residentInfo.RESIDENT_KEY_ID});
                                    } else {
                                        $state.go('main.special.diabetesSidebar.detail.diabetesEdit', {RESIDENT_KEY_ID: $scope.residentInfo.RESIDENT_KEY_ID});
                                    }
                                });
                            },
                            function () {
                                $rootScope.alertDialog("查询糖尿病数据失败");
                            }
                        );
                    },
                    function () {
                        $rootScope.alertDialog("查询糖尿病数据失败");
                    })
            };
        }

        var position = $mdPanel.newPanelPosition().absolute().center();
        var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
        var config = {
            animation: animation,
            attachTo: angular.element(document.body),
            controller: DialogAddDiabetesController,
            templateUrl: 'template/special/hypertension/_add.html',
            position: position,
            trapFocus: true,
            disableParentScroll: true,
            clickOutsideToClose: false,
            clickEscapeToClose: true,
            hasBackdrop: true,
            fullscreen: vm['customFullscreen']
        };
        $mdPanel.open(config);
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('diabetesSidebarCtrl', diabetesSidebarCtrl);
diabetesSidebarCtrl.$inject = ['$rootScope', '$state', 'diabetesService'];
function diabetesSidebarCtrl($rootScope, $state, diabetesService) {
    var vm = this;

    vm.residentKeyId = $state.params.RESIDENT_KEY_ID;

    getSidebarBasicMsg();

    function getSidebarBasicMsg() {
        diabetesService.getSidebarBasicMsg(
            {RESIDENT_KEY_ID: vm.residentKeyId},
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        transformData(data);
                    },
                    function () {
                        $rootScope.alertDialog("查询基础信息失败");
                    }
                );
            },
            function () {
                $rootScope.alertDialog("查询基础信息失败");
            }
        );
    }

    function transformData(data) {
        vm.name = data.RESIDENT_NAME;
        vm.gender = data.RESIDENT_SEX_NAME;
        vm.age = data.AGE;
        vm.nextFollowUpDate = data.NEXT_FOLLOW_UP_DATE;
        vm.diabetesRecordKeyId  = data.DIABETES_RECORD_KEY_ID
    }

    $rootScope.$on('url-change', function(){
        vm.judgePage();
    });
    
    vm.judgePage=function(){
        if($rootScope.isContains($state.current.name,'diabetesEdit')){
            return 'basic';
        }else if($rootScope.isContains($state.current.name,'bloodGlucose')){
            return 'blood';
        }else if($rootScope.isContains($state.current.name,'followup')){
            return 'follow';
        }else{
            return 'basic';
        }
    };
   

    return vm;
}
"use strict";
SMS.SERVICES.service('diabetesService', diabetesService);
diabetesService.$inject = ['$rootScope', 'Diabetes', 'bootstrapTable'];
function diabetesService($rootScope, Diabetes, bootstrapTable) {
    var vm = this;

    vm.getDiabetesList = function($vm, params, $state) {
        var list = {
            dataFunction: getList,
            dataParams: params,
            columns: [{
                field: 'RESIDENT_NAME',
                title: '居民姓名',
                align: 'center',
                formatter: function (val) {
                    return "<div class='edit' style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click .edit': function (e, val, row) {
                        $state.go('main.special.diabetesSidebar.detail.diabetesEdit', {RESIDENT_KEY_ID: row.RESIDENT_KEY_ID});
                    }
                }
            }, {
                field: 'FASTING_BLOOD_GLUCOSE',
                title: '最近一次空腹血糖(mmol/L)',
                align: 'center'
            }, {
                field: 'POSTPRANDIAL_BLOOD_GLUCOSE',
                title: '最近一次餐后血糖(mmol/L)',
                align: 'center'
            }, {
                field: 'LAST_FOLLOW_UP_DATE',
                title: '上一次随访时间',
                align: 'center'
            }, {
                field: 'NEXT_FOLLOW_UP_DATE',
                title: '下一次随访时间',
                align: 'center'
            }, {
                title: '操作',
                align: 'center',
                formatter: function () {
                    return "<span class='interview' style='color: #428bca;cursor: pointer;'>随访</span>";
                },
                events: {
                    'click .interview': function (e, val, row) {
                        $state.go('main.special.diabetesSidebar.detail.followupAdd', {RESIDENT_KEY_ID: row.RESIDENT_KEY_ID, DIABETES_RECORD_KEY_ID: row.DIABETES_RECORD_KEY_ID});
                    }
                }
            }]
        };

        function getList(param, successFunction, failedFunction) {
            Diabetes.getDiabetesList(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.diabetesData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };

    vm.getDetailedArchives = function (params, successFunction, failedFunction) {
        return Diabetes.getDetailedArchives(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.add = function (params, successFunction, failedFunction) {
        return Diabetes.saveArchives(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.edit = function (params, successFunction, failedFunction) {
        return Diabetes.editArchives(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getSidebarBasicMsg = function (params, successFunction, failedFunction) {
        return Diabetes.getSidebarBasicMsg(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('hypertensionEditCtrl', hypertensionEditCtrl);
hypertensionEditCtrl.$inject = ['$rootScope', '$state', '$filter', 'hypertensionService'];
function hypertensionEditCtrl($rootScope, $state, $filter, hypertensionService) {
    var vm = this;
    var lastData = {};
    vm.CARDIOVASCULAR_RISK = [];
    vm.TARGET_ORGAN_DAMAGES = [];
    vm.COEXISTING_ASSOCIATED_DISEASES = [];
    vm.residentSexList =[];
    vm.livingTypeList =[];
    vm.drugComplianceList =[];
    vm.cardiovascularRiskFactorsList =[];
    vm.targetOrganDamagesList =[];
    vm.coexistingAssociatedDiseasesList =[];
    vm.bloodPressureGradingList =[];
    vm.gradingManagementList =[];
    vm.criticalityGradingList =[];
    vm.edit = false;

    function setSelectVal(list, key, val) {
        angular.forEach(list, function(item) {
            if (item.DICT_VALUE_CODE === val) {
                vm[key] = item;
            }
        });
    }

    function setCheckBoxVal(list, key, str) {
        if (typeof str !== 'string') {
            return;
        }
        var array = str.split(',');
        angular.forEach(list, function(item) {
            angular.forEach(array, function(code) {
                if (item.DICT_VALUE_CODE === code) {
                    vm[key].push(item);
                }
            });
        });
    }

    function getArchive(){
        hypertensionService.getDetailedArchives({
            "RESIDENT_KEY_ID": $state.params.RESIDENT_KEY_ID
        }, function(res) {
            if (res.BIRTHDAY) {
                res.BIRTHDAY = new Date(res.BIRTHDAY);
            }
            if (res.FILE_CREATE_TIME) {
                res.FILE_CREATE_TIME = new Date(res.FILE_CREATE_TIME);
            }
            if (res.EVALUATION_TIME) {
                res.EVALUATION_TIME = new Date(res.EVALUATION_TIME);
            }
            if (res.FIRST_DATE_OF_ONSET) {
                res.FIRST_DATE_OF_ONSET = new Date(res.FIRST_DATE_OF_ONSET);
            }
            if (res.DIAGNOSIS_TIME) {
                res.DIAGNOSIS_TIME = new Date(res.DIAGNOSIS_TIME);
            }
            res.IS_HAS_DIABETES += '';
            vm.CARDIOVASCULAR_RISK = [];
            vm.TARGET_ORGAN_DAMAGES = [];
            vm.COEXISTING_ASSOCIATED_DISEASES = [];
            setSelectVal(vm.drugComplianceList, 'DRUG_COMPLIANCE', res.DRUG_COMPLIANCE_CODE);
            setSelectVal(vm.bloodPressureGradingList, 'BLOOD_PRESSURE_GRADING', res.FIRST_BLOOD_PRESSURE_GRADING_CODE);
            setSelectVal(vm.criticalityGradingList, 'CRITICALITY_GRADING', res.FIRST_CRITICALITY_GRADING_CODE);
            setSelectVal(vm.gradingManagementList, 'GRADING_MANAGEMENT', res.FIRST_GRADING_MANAGEMENT_CODE);
            setCheckBoxVal(vm.cardiovascularRiskFactorsList, 'CARDIOVASCULAR_RISK', res.CARDIOVASCULAR_RISK_FACTORS_CODE);
            setCheckBoxVal(vm.targetOrganDamagesList, 'TARGET_ORGAN_DAMAGES', res.TARGET_ORGAN_DAMAGES_CODE);
            setCheckBoxVal(vm.coexistingAssociatedDiseasesList, 'COEXISTING_ASSOCIATED_DISEASES', res.COEXISTING_ASSOCIATED_DISEASES_CODE);
            vm.archiveInfo = res;
            vm.archiveInfo.BIRTHDAY=$filter('date')(res.BIRTHDAY, 'yyyy-MM-dd');
            lastData.CARDIOVASCULAR_RISK = res.CARDIOVASCULAR_RISK_FACTORS_CODE;
            lastData.TARGET_ORGAN_DAMAGES = res.TARGET_ORGAN_DAMAGES_CODE;
            lastData.COEXISTING_ASSOCIATED_DISEASES = res.COEXISTING_ASSOCIATED_DISEASES_CODE;
        });
    }


    function init() {
        var dict_type_code_list = [
            {
                "DICT_TYPE_CODE": "0009",//性别
                "LIST_NAME": "residentSexList"
            },
            {
                "DICT_TYPE_CODE": "0007001",//居住类型
                "LIST_NAME": "livingTypeList"
            },
            {
                "DICT_TYPE_CODE": "0026",//居民服药依从性编码
                "LIST_NAME": "drugComplianceList"
            },
            {
                "DICT_TYPE_CODE": "0031",//心血管病危险因素类型编码
                "LIST_NAME": "cardiovascularRiskFactorsList"
            },
            {
                "DICT_TYPE_CODE": "0032",//靶器官损害类型编码
                "LIST_NAME": "targetOrganDamagesList"
            },
            {
                "DICT_TYPE_CODE": "0033",//高血压并存相关疾病类型编码
                "LIST_NAME": "coexistingAssociatedDiseasesList"
            },
            {
                "DICT_TYPE_CODE": "0028",//血压分级类型编码
                "LIST_NAME": "bloodPressureGradingList"
            },
            {
                "DICT_TYPE_CODE": "0029",//血压分级管理类型编码
                "LIST_NAME": "gradingManagementList"
            },
            {
                "DICT_TYPE_CODE": "0030",//血压危险分级结果类型编码
                "LIST_NAME": "criticalityGradingList"
            }
        ];
        $rootScope.commonService('getDictList', {
            "DICT_TYPE_CODE_LIST": dict_type_code_list
        }, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    angular.forEach(dict_type_code_list, function (item) {
                        vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
                    });
                    getArchive();
                },
                function () {
                    $rootScope.alertDialog('获取列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取列表失败');
        });
    }

    vm.toggle = function (item, list) {
        var idx = list.indexOf(item);
        if (idx > -1) {
            list.splice(idx, 1);
        }
        else {
            list.push(item);
        }
    };

    vm.exists = function (item, list) {
        return list.indexOf(item) > -1;
    };

    vm.calculate = function () {
        if (!vm['archiveInfo']['SYSTOLIC_PRESSURE']) {
            $rootScope.alertDialog("请填写收缩压");
            return;
        }

        if (!vm['archiveInfo']['DIASTOLIC_PRESSURE']) {
            $rootScope.alertDialog("请填写舒张压");
            return;
        }
        var params={
            "SYSTOLIC_PRESSURE": vm['archiveInfo']['SYSTOLIC_PRESSURE'],
            "DIASTOLIC_PRESSURE": vm['archiveInfo']['DIASTOLIC_PRESSURE'],
            "lengthArray":[
                vm['CARDIOVASCULAR_RISK']['length'],
                vm['TARGET_ORGAN_DAMAGES']['length'],
                vm['COEXISTING_ASSOCIATED_DISEASES']['length']
            ]
        };
        var data = $rootScope.calculateHypertensionEvaluation(params);
        vm['BLOOD_PRESSURE_GRADING'] = $rootScope.selectItem(vm['bloodPressureGradingList'], 'DICT_VALUE_CODE', data['bloodPressureGradingCount']);
        vm['CRITICALITY_GRADING'] = $rootScope.selectItem(vm['criticalityGradingList'], 'DICT_VALUE_CODE', data['criticalityGradingCount']);
        vm['GRADING_MANAGEMENT'] = $rootScope.selectItem(vm['gradingManagementList'], 'DICT_VALUE_CODE', data['gradingManagementCount']);
    };

    vm.save = function(){
        if (!$rootScope.check(form)) {
            return;
        }

        function joinItem(list, key) {
            var arr = [];
            angular.forEach(list, function(item) {
                arr.push(item[key]);
            });
            return arr.join(',');
        }
        var params = {
            "HYPERTENSION_RECORD_KEY_ID": vm.archiveInfo.HYPERTENSION_RECORD_KEY_ID,
            "ASSESS_RECORD_KEY_ID": vm.archiveInfo.ASSESS_RECORD_KEY_ID,
            "FIRST_DATE_OF_ONSET": $filter('date')(vm.archiveInfo.FIRST_DATE_OF_ONSET, 'yyyy-MM-dd'),
            "DIAGNOSIS_TIME": $filter('date')(vm.archiveInfo.DIAGNOSIS_TIME, 'yyyy-MM-dd'),
            "DIAGNOSIS_DOCTOR_NAME": vm.archiveInfo.DIAGNOSIS_DOCTOR_NAME,
            "DIAGNOSIS_ORGANIZATION": vm.archiveInfo.DIAGNOSIS_ORGANIZATION,
            "TREATMENT_SITUATION": vm.archiveInfo.TREATMENT_SITUATION,
            "SYSTOLIC_PRESSURE": vm.archiveInfo.SYSTOLIC_PRESSURE,
            "DIASTOLIC_PRESSURE": vm.archiveInfo.DIASTOLIC_PRESSURE,
            "FASTING_BLOOD_GLUCOSE": vm.archiveInfo.FASTING_BLOOD_GLUCOSE,
            "SERUM_CREATININE": vm.archiveInfo.SERUM_CREATININE,
            "OTHER_ASSAY_INDEX": vm.archiveInfo.OTHER_ASSAY_INDEX,
            "TOTAL_CHOLESTEROL": vm.archiveInfo.TOTAL_CHOLESTEROL,
            "URINE_PROTEIN": vm.archiveInfo.URINE_PROTEIN,
            "DRUG_COMPLIANCE_CODE": vm['DRUG_COMPLIANCE'] ? vm['DRUG_COMPLIANCE'].DICT_VALUE_CODE : null,
            "DRUG_COMPLIANCE_NAME": vm['DRUG_COMPLIANCE'] ? vm['DRUG_COMPLIANCE'].DICT_VALUE_NAME : null,
            "CARDIOVASCULAR_RISK_FACTORS_CODE": vm.CARDIOVASCULAR_RISK.length ? joinItem(vm.CARDIOVASCULAR_RISK, 'DICT_VALUE_CODE') : null,
            "CARDIOVASCULAR_RISK_FACTORS_NAME": vm.CARDIOVASCULAR_RISK.length ? joinItem(vm.CARDIOVASCULAR_RISK, 'DICT_VALUE_NAME') : null,
            "TARGET_ORGAN_DAMAGES_CODE": vm.TARGET_ORGAN_DAMAGES.length ? joinItem(vm.TARGET_ORGAN_DAMAGES, 'DICT_VALUE_CODE') : null,
            "TARGET_ORGAN_DAMAGES_NAME": vm.TARGET_ORGAN_DAMAGES.length ? joinItem(vm.TARGET_ORGAN_DAMAGES, 'DICT_VALUE_NAME') : null,
            "IS_HAS_DIABETES": +vm.archiveInfo.IS_HAS_DIABETES,
            "COEXISTING_ASSOCIATED_DISEASES_CODE": vm.COEXISTING_ASSOCIATED_DISEASES.length ? joinItem(vm.COEXISTING_ASSOCIATED_DISEASES, 'DICT_VALUE_CODE') : null,
            "COEXISTING_ASSOCIATED_DISEASES_NAME": vm.COEXISTING_ASSOCIATED_DISEASES.length ? joinItem(vm.COEXISTING_ASSOCIATED_DISEASES, 'DICT_VALUE_NAME') : null,
            "FIRST_BLOOD_PRESSURE_GRADING_CODE": vm['BLOOD_PRESSURE_GRADING'].DICT_VALUE_CODE,
            "FIRST_BLOOD_PRESSURE_GRADING_NAME": vm['BLOOD_PRESSURE_GRADING'].DICT_VALUE_NAME,
            "FIRST_CRITICALITY_GRADING_CODE": vm['CRITICALITY_GRADING'].DICT_VALUE_CODE,
            "FIRST_CRITICALITY_GRADING_NAME": vm['CRITICALITY_GRADING'].DICT_VALUE_NAME,
            "FIRST_GRADING_MANAGEMENT_CODE": vm['GRADING_MANAGEMENT'].DICT_VALUE_CODE,
            "FIRST_GRADING_MANAGEMENT_NAME": vm['GRADING_MANAGEMENT'].DICT_VALUE_NAME,
            "OVERALL_EVALUATION": vm.archiveInfo.OVERALL_EVALUATION
        };
        hypertensionService.editArchive(
            params, function() {
                vm.edit = false;
                $rootScope.alertDialog('保存成功');
                getArchive();
            });
    };

    function multiChange() {
        function judgeEqual(key) {
            var arr1;
            var arr2 = [];
            lastData[key] = lastData[key] || '';
            arr1 = lastData[key].split(',');
            angular.forEach(vm[key], function(item) {
                arr2.push(item['DICT_VALUE_CODE']);
            });
            arr1.sort();
            arr2.sort();
            return arr1.join(',') === arr2.join(',');
        }

        if (!judgeEqual('CARDIOVASCULAR_RISK')) {
            return true;
        }
        if (!judgeEqual('TARGET_ORGAN_DAMAGES')) {
            return true;
        }
        if (!judgeEqual('COEXISTING_ASSOCIATED_DISEASES')) {
            return true;
        }
        return false;
    }

    vm.cancel = function(info) {
        if (info.$dirty || multiChange()) {
            $rootScope.confirmDialog(
                '是否放弃已经编辑的内容?',
                function () {
                    vm.edit = false;
                },
                function () {

                }
            );
        } else {
            vm.edit = false;
        }
    };

    function cancelGo() {
        if($rootScope.isContains($state.current.name,'main.special')){
            $state.go('main.special.hypertensionList');
        } else {
            getArchive();
        }
    }

    vm.clickEdit = function(form) {
        vm.edit = true;
        form.$setPristine();
        form.$setUntouched();
    };

    init();
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('hypertensionListCtrl', hypertensionListCtrl);
hypertensionListCtrl.$inject = ['$rootScope', '$state', '$mdPanel', 'hypertensionService', '$filter'];
function hypertensionListCtrl($rootScope, $state, $mdPanel, hypertensionService, $filter) {
    var vm = this;
    vm.initSelect = function() {
        var dict_type_code_list = [
            {
                "DICT_TYPE_CODE": "0028",//血压分级
                "LIST_NAME": "bloodPressureGradingList"
            },
            {
                "DICT_TYPE_CODE": "0029",//分级管理
                "LIST_NAME": "gradingManagementList"
            }
        ];
        $rootScope.commonService('getDictList', {
            "DICT_TYPE_CODE_LIST": dict_type_code_list
        }, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    angular.forEach(dict_type_code_list, function (item) {
                        vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
                    });
                },
                function () {
                    $rootScope.alertDialog('获取列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取列表失败');
        });
    };
    vm.tableDataHtml = function () {
        var params = {
            "SEARCH_CONDITION": vm.searchCondition, //居民姓名或身份证号
            "LAST_FOLLOW_UP_BEGIN_TIME": vm.lastFollowUpBeginTime? $filter('date')(vm.lastFollowUpBeginTime, 'yyyy-MM-dd') + ' 00:00:00': null, //上次随访日期开始时间
            "LAST_FOLLOW_UP_END_TIME": vm.lastFollowUpEndTime ? $filter('date')(vm.lastFollowUpEndTime, 'yyyy-MM-dd') + ' 23:59:59': null, //上次随访日期截止时间
            "NEXT_FOLLOW_UP_BEGIN_TIME": vm.nextFollowUpBeginTime ? $filter('date')(vm.nextFollowUpBeginTime, 'yyyy-MM-dd') + ' 00:00:00': null, //下次随访日期开始时间
            "NEXT_FOLLOW_UP_END_TIME": vm.nextFollowUpEndTime ? $filter('date')(vm.nextFollowUpEndTime, 'yyyy-MM-dd') + ' 23:59:59': null, //下次随访日期截止时间
            "BLOOD_PRESSURE_GRADING_CODE": !vm.bloodPressureGrading || vm.bloodPressureGrading === '-1'? null : vm.bloodPressureGrading.DICT_VALUE_CODE, //血压分级编码
            "BLOOD_PRESSURE_GRADING_NAME": !vm.bloodPressureGrading || vm.bloodPressureGrading === '-1'? null : vm.bloodPressureGrading.DICT_VALUE_NAME, //血压分级名称
            "GRADING_MANAGEMENT_CODE": !vm.gradingManagement || vm.gradingManagement === '-1'? null : vm.gradingManagement.DICT_VALUE_CODE,   //分级管理编码
            "GRADING_MANAGEMENT_NAME": !vm.gradingManagement || vm.gradingManagement === '-1'? null : vm.gradingManagement.DICT_VALUE_NAME,  //分级管理名称
            "NEXT_FOLLOW_UP_TYPE": !vm.nextFollowUpType || vm.nextFollowUpType === '-1'? null : vm.nextFollowUpType   //下次随访
        };
        hypertensionService.hypertensionList(vm, params);
    };

    vm.searchTermChange = function() {
        vm.tableDataHtml();
    };

    vm.create = function() {
        SMS.CONTROLLERS.controller('DialogAddHyController', DialogAddHyController);
        DialogAddHyController.$inject = ['$scope', 'mdPanelRef', 'hypertensionService'];

        function DialogAddHyController($scope, mdPanelRef, hypertensionService) {
            $scope.$on('panelClose',
                function () {
                    mdPanelRef.close();
                }
            );
            $scope.hide = function () {
                mdPanelRef.close();
            };
            $scope.cancel = function () {
                mdPanelRef.close();
            };
            $scope.findResident = function() {
                hypertensionService.findResident({
                    RESIDENT_ID_NO: $scope.idNo
                }, function(res) {
                    $scope.residentInfo = res;
                    if (!res) {
                        $rootScope.alertDialog('没有数据');
                    }
                    $scope.flag = true;
                });
            };
            $scope.ensureResident = function() {
                mdPanelRef.close().then(function(){
                    $state.go('main.special.hypertensionAdd', {RESIDENT_KEY_ID: $scope.residentInfo.RESIDENT_KEY_ID});
                });
            };
        }

        var position = $mdPanel.newPanelPosition().absolute().center();
        var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
        var config = {
            animation: animation,
            attachTo: angular.element(document.body),
            controller: DialogAddHyController,
            templateUrl: 'template/special/hypertension/_add.html',
            position: position,
            trapFocus: true,
            disableParentScroll: true,
            clickOutsideToClose: false,
            clickEscapeToClose: true,
            hasBackdrop: true,
            fullscreen: vm['customFullscreen']
        };
        $mdPanel.open(config);
    };

    vm.initSelect();
    vm.tableDataHtml();
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('hypertensionSidebarCtrl', hypertensionSidebarCtrl);
hypertensionSidebarCtrl.$inject = ['$rootScope', '$state', 'hypertensionService'];
function hypertensionSidebarCtrl($rootScope, $state, hypertensionService) {
    var vm = this;
    vm.jumpTo = function(type) {
        switch(type) {
            case 'basic':
                $state.go('main.special.hypertensionSidebar.detail.hypertensionEdit', {
                    RESIDENT_KEY_ID: $state.params.RESIDENT_KEY_ID,
                    HYPERTENSION_RECORD_KEY_ID: $state.params.HYPERTENSION_RECORD_KEY_ID
                });
                break;
            case 'blood':
                $state.go('main.special.hypertensionSidebar.detail.bloodPressureList',{
                    RESIDENT_KEY_ID: $state.params.RESIDENT_KEY_ID,
                    HYPERTENSION_RECORD_KEY_ID: $state.params.HYPERTENSION_RECORD_KEY_ID
                });
                break;
            case 'follow':
                $state.go('main.special.hypertensionSidebar.detail.followupList',{HYPERTENSION_RECORD_KEY_ID:$state.params.HYPERTENSION_RECORD_KEY_ID});
                break;
            case 'eval':
                $state.go('main.special.hypertensionSidebar.detail.evaluationList', {HYPERTENSION_RECORD_KEY_ID:$state.params.HYPERTENSION_RECORD_KEY_ID});
                break;
            default:
                $state.go('main.special.hypertensionSidebar.detail.hypertensionEdit', {
                    RESIDENT_KEY_ID: $state.params.RESIDENT_KEY_ID,
                    HYPERTENSION_RECORD_KEY_ID: $state.params.HYPERTENSION_RECORD_KEY_ID
                });
        }
    };

    function init() {
        hypertensionService.getSidebarInfo({
            RESIDENT_KEY_ID: $state.params.RESIDENT_KEY_ID
        }, function(res) {
            vm.sideInfo = res;
        });
    }
    init();
    return vm;
}
"use strict";
SMS.SERVICES.service('hypertensionService', hypertensionService);
hypertensionService.$inject = ['$rootScope', '$filter', '$state', 'Hypertension', 'bootstrapTable'];
function hypertensionService($rootScope, $filter, $state, Hypertension, bootstrapTable) {
    var vm = this;
    vm.hypertensionList = function($vm, params) {
        var list = {
            dataFunction: getList,
            dataParams: params,
            columns: [{
                field: 'RESIDENT_NAME',
                title: '居民姓名',
                align: 'center',
                formatter: function (val) {
                    return "<div class='edit' style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click .edit': function (e, val, row) {
                        $state.go('main.special.hypertensionSidebar.detail.hypertensionEdit', {
                            RESIDENT_KEY_ID: row.RESIDENT_KEY_ID,
                            HYPERTENSION_RECORD_KEY_ID:row.HYPERTENSION_RECORD_KEY_ID});
                    }
                }
            }, {
                field: 'LAST_BLOOD_PRESSURE_RECORD',
                title: '最近血压(mmHg)',
                align: 'center'
            }, {
                field: 'BLOOD_PRESSURE_GRADING_NAME',
                title: '血压分级',
                align: 'center'
            }, {
                field: 'GRADING_MANAGEMENT_NAME',
                title: '分级管理',
                align: 'center'
            }, {
                field: 'LAST_FOLLOW_UP_DATE',
                title: '上次随访日期',
                align: 'center',
                formatter: function (val) {
                    return val ? $filter('date')(new Date(val), 'yyyy-MM-dd') : '-';
                }
            }, {
                field: 'NEXT_FOLLOW_UP_DATE',
                title: '下次随访日期',
                align: 'center',
                formatter: function (val) {
                    if (val) {
                        return val ? $filter('date')(new Date(val), 'yyyy-MM-dd') : '-';
                    }
                }
            }, {
                title: '操作',
                align: 'center',
                formatter: function () {
                    return "<span class='interview' style='color: #428bca;cursor: pointer;'>随访</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class='judge' style='color: #428bca;cursor: pointer;'>评估</span>";
                },
                events: {
                    'click .interview': function (e, val, row) {
                        $state.go('main.special.hypertensionSidebar.detail.followupAdd', {"RESIDENT_KEY_ID": row.RESIDENT_KEY_ID, "HYPERTENSION_RECORD_KEY_ID": row.HYPERTENSION_RECORD_KEY_ID});
                    },
                    'click .judge': function (e, val, row) {
                        $state.go('main.special.hypertensionSidebar.detail.evaluationAdd', {
                            "HYPERTENSION_RECORD_KEY_ID": row['HYPERTENSION_RECORD_KEY_ID'],
                            "RESIDENT_KEY_ID": row['RESIDENT_KEY_ID']
                        });
                    }
                }
            }]
        };

        function getList(param, successFunction, failedFunction) {
            Hypertension.getHypertensionList(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.tableHyData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };

    vm.addArchive = function(params, callback) {
        Hypertension.addArchive(JSON.stringify(params)).$promise
            .then(function (res) {
                $rootScope.handleMessage(res, function () {
                    callback(res.value);
                }, function () {
                    $rootScope.alertDialog("创建高血压档案失败");
                });
            }, function () {
                $rootScope.alertDialog("创建高血压档案失败");
            });
    };

    vm.editArchive = function(params, callback) {
        Hypertension.editArchive(JSON.stringify(params)).$promise
            .then(function (res) {
                $rootScope.handleMessage(res, function () {
                    callback(res.value);
                }, function () {
                    $rootScope.alertDialog("编辑高血压档案失败");
                });
            }, function () {
                $rootScope.alertDialog("编辑高血压档案失败");
            });
    };

    vm.getDetailedArchives = function(params, callback) {
        Hypertension.getDetailedArchives(JSON.stringify(params)).$promise
            .then(function (res) {
                $rootScope.handleMessage(res, function () {
                    callback(res.value);
                }, function () {
                    $rootScope.alertDialog("获取信息失败");
                });
            }, function () {
                $rootScope.alertDialog("获取信息失败");
            });
    };

    vm.getSidebarInfo = function(params, callback) {
        Hypertension.getSidebarInfo(JSON.stringify(params)).$promise
            .then(function (res) {
                $rootScope.handleMessage(res, function () {
                    callback(res.value);
                }, function () {
                    $rootScope.alertDialog("获取信息失败");
                });
            }, function () {
                $rootScope.alertDialog("获取信息失败");
            });
    };

    vm.findResident = function(params, okFun) {
        Hypertension.getResidentByIdNo(JSON.stringify(params)).$promise
            .then(function (res) {
                $rootScope.handleMessage(res, function () {
                    okFun(res.value);
                }, function () {
                    $rootScope.alertDialog("获取信息失败");
                });
            }, function () {
                $rootScope.alertDialog("获取信息失败");
            });

    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('doctorIndividualSignRecordCtrl', doctorIndividualSignRecordCtrl);
doctorIndividualSignRecordCtrl.$inject = ['$rootScope', '$state', 'familyArchivesService'];
function doctorIndividualSignRecordCtrl($rootScope, $state, familyArchivesService) {
    var vm = this;
    
    vm.FAMILY_DOCTOR_KEY_ID = $state.params.FAMILY_DOCTOR_KEY_ID;

    //签约记录
    function getSignedRecordList() {
        var data = {
            "DOCTOR_KEY_ID": vm.FAMILY_DOCTOR_KEY_ID
        };
        familyArchivesService.getSignedRecordList(vm, data, $state);
    }
    getSignedRecordList();

    return vm;
}

"use strict";
SMS.CONTROLLERS.controller('signedFamilyListCtrl', signedFamilyListCtrl);
signedFamilyListCtrl.$inject = ['$rootScope', '$scope', '$state', 'doctorIndividualService', '$mdDialog', '$filter','$mdPanel'];
function signedFamilyListCtrl($rootScope, $scope, $state, doctorIndividualService, $mdDialog, $filter,$mdPanel) {
    var vm = this;

    vm.DOCTOR_NAME = $state.params.DOCTOR_NAME;
    vm.FAMILY_DOCTOR_KEY_ID = $state.params.FAMILY_DOCTOR_KEY_ID;

    //获取医生信息
    doctorIndividualService.getDoctorInfoById(
        {"FAMILY_DOCTOR_KEY_ID": vm.FAMILY_DOCTOR_KEY_ID},
        function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    vm.IS_ONLINE = data.IS_ONLINE;
                },
                function () {
                    $rootScope.alertDialog('获取医生信息失败');
                }
            );
        },
        function () {
            $rootScope.alertDialog('获取医生信息失败');
        }
    );

    vm.signingHomeTable = function () {
        var data = {
            "DOCTOR_KEY_ID": vm.FAMILY_DOCTOR_KEY_ID
        };
        doctorIndividualService.showSingingHomeTable(vm, data, $state);
    };

    vm.signingHomeTable();

    /*
    * 按钮事件
    */
    //返回
    vm.back = function () {
        $state.go('main.doctor.doctorIndividualList');
    };
    //选择家庭签约
    vm.searchHome = function () {
        SMS.CONTROLLERS.controller('DialogUnSignController', DialogUnSignController);
        DialogUnSignController.$inject = ['$scope', 'mdPanelRef', 'doctorIndividualService'];
        function DialogUnSignController($scope, mdPanelRef, doctorIndividualService) {
            $scope.unsigningHomeTableData = false;
            $scope.total = true;
            $scope.FAMILY_DOCTOR_KEY_ID = vm.FAMILY_DOCTOR_KEY_ID;
            $scope.hide = function () {
                mdPanelRef.close();
            };
            $scope.cancel = function () {
                mdPanelRef.close();
            };
            $scope.search = function () {
                var data = {
                    "SEARCH_CONDITION": $scope.searchCondition || ''
                };
                doctorIndividualService.showUnsingingHomeTable($scope, data, $state);
            };

            $scope.signEnsureShow = function (row) {
                SMS.CONTROLLERS.controller('DialogEnsureController', DialogEnsureController);
                DialogEnsureController.$inject = ['$scope', '$mdDialog', 'doctorIndividualService'];
                function DialogEnsureController($scope, $mdDialog, doctorIndividualService) {
                    $scope.hide = function () {
                        $mdDialog.hide();
                    };
                    $scope.cancel = function () {
                        $mdDialog.cancel();
                    };

                    $scope.ensure = function () {
                        doctorIndividualService.ensureSign({
                                "FAMILY_KEY_ID": row.FAMILY_KEY_ID,
                                "DOCTOR_KEY_ID": vm.FAMILY_DOCTOR_KEY_ID,
                                "DOCTOR_NAME": vm.DOCTOR_NAME
                            },
                            function (response) {
                                $rootScope.handleMessage(
                                    response,
                                    function () {
                                        vm.signingHomeTableData.bsTableControl.operat = 'refresh';
                                        $rootScope.alertDialog('签约成功！').then(mdPanelRef.close());
                                    },
                                    function () {
                                        $rootScope.alertDialog('签约失败');
                                    }
                                );
                            },
                            function () {
                                $rootScope.alertDialog('签约失败');
                            });
                    };

                    $scope.change = function () {
                        doctorIndividualService.updateFamilyDoctorBatch(
                            {
                                "FAMILY_LIST": [
                                    {
                                        "FAMILY_KEY_ID": row.FAMILY_KEY_ID
                                    }
                                ],
                                "RESPONSIBLE_DOCTOR_ID": vm.FAMILY_DOCTOR_KEY_ID,
                                "RESPONSIBLE_DOCTOR_NAME": vm.DOCTOR_NAME,
                                "BEFORE_DOCTOR_ID": row.FAMILY_DOCTOR_KEY_ID
                            },
                            function (response) {
                                $rootScope.handleMessage(
                                    response,
                                    function () {
                                        vm.signingHomeTableData.bsTableControl.operat = 'refresh';
                                        $rootScope.alertDialog('更换签约成功！');
                                    },
                                    function () {
                                        $rootScope.alertDialog('更换签约医生失败');
                                    }
                                );
                            },
                            function () {
                                $rootScope.alertDialog('更换签约医生失败');
                            });
                    };
                    function init() {
                        var data = {
                            "FAMILY_KEY_ID": row.FAMILY_KEY_ID
                        };
                        doctorIndividualService.showHomeMemberTable($scope, data, $state);
                        $scope.editView = row.IS_SIGNED;
                        $scope.signDoctor = row.DOCTOR_NAME;
                        $scope.signedDoctor = vm.DOCTOR_NAME;
                        $scope.signTime = $filter('date')(row.BEGIN_TIME, 'yyyy年MM月dd日') + ' - ' + $filter('date')(row.END_TIME, 'yyyy年MM月dd日');

                    };
                    init();
                }

                $mdDialog.show({
                    controller: DialogEnsureController,
                    templateUrl: 'template/doctor/doctorIndividual/signManage/_signEnsure.html',
                    parent: angular.element(document.body),
                    clickOutsideToClose: false,
                    fullscreen: vm.customFullscreen // Only for -xs, -sm breakpoints.
                });
            };
            $scope.$on('panelClose',
                function () {
                    mdPanelRef.close();
                }
            );
        }

        var position = $mdPanel.newPanelPosition().absolute().center();
        var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
        var config = {
            animation: animation,
            attachTo: angular.element(document.body),
            controller: DialogUnSignController,
            templateUrl: 'template/doctor/doctorIndividual/signManage/_searchHome.html',
            position: position,
            trapFocus: true,
            disableParentScroll: true,
            clickOutsideToClose: false,
            clickEscapeToClose: true,
            hasBackdrop: true,
            fullscreen: false
        };
        $mdPanel.open(config);
    };
    //解除签约
    vm.removeSign = function (model) {
        vm.signingHomeTableData.bsTableControl.getSelectionsBack = function (data) {
            if(data.length === 0 && model === 0){
                $rootScope.alertDialog('请先选中家庭');
            }else {
                removeSignHomeSelected(model, data);
            }
        };
        vm.signingHomeTableData.bsTableControl.operat = 'getSelections';

        //解除签约操作
        function removeSignHomeSelected(model, data) {
            SMS.CONTROLLERS.controller('DialogRemoveSignEnsureController', DialogRemoveSignEnsureController);
            DialogRemoveSignEnsureController.$inject = ['$scope', '$mdDialog', 'mdPanelRef', 'doctorIndividualService'];
            function DialogRemoveSignEnsureController($scope, $mdDialog, mdPanelRef, doctorIndividualService) {
                $scope.data = data;
                $scope.hide = function () {
                    mdPanelRef.close();
                };
                $scope.cancel = function () {
                    mdPanelRef.close();
                };

                $scope.ensure = function (form) {
                    if (!$rootScope.check(form)) {
                        return;
                    }
                    var params = {
                        "BEFORE_DOCTOR_ID": vm.FAMILY_DOCTOR_KEY_ID,
                        "REMARK": $scope.remark
                    };
                    if(model === 0){//批量
                        params.FAMILY_LIST = [];
                        for(var i = 0; i < $scope.data.length; i++){
                            params.FAMILY_LIST.push({
                                "FAMILY_KEY_ID": $scope.data[i].FAMILY_KEY_ID
                            });
                        }
                    }else{//全部
                        params.DOCTOR_KEY_ID = vm.FAMILY_DOCTOR_KEY_ID;
                    }
                    
                    doctorIndividualService.terminateBatch(
                        params,
                        function (response) {
                            $rootScope.handleMessage(
                                response,
                                function () {
                                    vm.signingHomeTableData.bsTableControl.operat = 'refresh';
                                    $rootScope.alertDialog('解约成功！').then(mdPanelRef.close());
                                },
                                function () {
                                    $rootScope.alertDialog('解约失败');
                                }
                            );
                        },
                        function () {
                            $rootScope.alertDialog('解约失败');
                        });
                };
                
                function init() {
                    $scope.signedDoctor = vm.DOCTOR_NAME;
                    $scope.remark = "";
                    $scope.doctorModel = true;
                };
                init();

                $scope.$on('panelClose',
                    function () {
                        mdPanelRef.close();
                    }
                );
            }

            var position = $mdPanel.newPanelPosition().absolute().center();
            var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
            var config = {
                animation: animation,
                attachTo: angular.element(document.body),
                controller: DialogRemoveSignEnsureController,
                templateUrl: 'template/doctor/doctorIndividual/signManage/_removeSignEnsure.html',
                position: position,
                trapFocus: true,
                disableParentScroll: true,
                clickOutsideToClose: false,
                clickEscapeToClose: true,
                hasBackdrop: true,
                fullscreen: false
            };
            $mdPanel.open(config);
        }
    };
    //更换签约
    vm.changeSign = function(model){
        //model: 0  表示批量
        //model: 1  表示全部
        vm.signingHomeTableData.bsTableControl.getSelectionsBack = function (data) {
            if(data.length === 0 && model === 0){
                $rootScope.alertDialog('请先选中家庭');
            }else {
                changeSignHomeSelected(model, data);
            }
        };
        vm.signingHomeTableData.bsTableControl.operat = 'getSelections';

        //更换签约操作
        function changeSignHomeSelected(model, data) {
            SMS.CONTROLLERS.controller('selectDoctorController', selectDoctorController);
            selectDoctorController.$inject = ['$rootScope', '$scope', 'mdPanelRef', '$filter', 'doctorIndividualService'];
            function selectDoctorController($rootScope, $scope, mdPanelRef, $filter, doctorIndividualService) {
                $scope.data = data;
                $scope.searched = false;
                function callback(row) {
                    $scope.searched = true;
                    doctorIndividualService.getselectedDoctorList(
                        $scope,
                        {},
                        {
                            "total": 1,
                            "rows": [row]
                        }
                    );
                    $scope['row'] = row;
                    $rootScope.getCurrentDateTime(
                        function (data) {
                            if (vm['beginTimeFormat'] === undefined) {
                                vm['beginTimeFormat'] = data;
                                vm['beginTime'] = $filter('commonDate')(vm['beginTimeFormat']);
                                var tempEndTime = new Date(new Date(vm['beginTimeFormat']).getTime());
                                tempEndTime.setFullYear(tempEndTime.getFullYear() + 1);
                                tempEndTime.setDate(tempEndTime.getDate() - 1);
                                vm['endTimeFormat'] = tempEndTime;
                                vm['endTime'] = $filter('commonDate')(vm['endTimeFormat']);
                            }
                            if ($scope['beginTime'] === undefined) {
                                $scope['beginTime'] = $filter('commonDate')(vm['beginTimeFormat'], 'yyyy年MM月dd日');
                                $scope['endTime'] = $filter('commonDate')(vm['endTimeFormat'], 'yyyy年MM月dd日');
                            }
                        }
                    );
                }

                $scope.hide = function () {
                    mdPanelRef.close();
                };
                $scope.cancel = function () {
                    mdPanelRef.close();
                };
                $scope.back = function () {
                    $scope.searched = false;
                };
                $scope.changeDoctor = function () {
                    var params = {
                        "RESPONSIBLE_DOCTOR_ID": $scope['row']['FAMILY_DOCTOR_KEY_ID'],//责任医生ID
                        "RESPONSIBLE_DOCTOR_NAME": $scope['row']['DOCTOR_NAME'],//责任医生姓名
                        "BEFORE_DOCTOR_ID": vm.FAMILY_DOCTOR_KEY_ID
                    };
                    if(model === 0){//批量
                        params.FAMILY_LIST = [];
                        for(var i = 0; i < $scope.data.length; i++){
                            params.FAMILY_LIST.push({
                                "FAMILY_KEY_ID": $scope.data[i].FAMILY_KEY_ID
                            });
                        }
                    }else{//全部
                        params.DOCTOR_KEY_ID = vm.FAMILY_DOCTOR_KEY_ID;
                    }

                    doctorIndividualService.updateFamilyDoctorBatch(
                        params,
                        function (response) {
                            $rootScope.handleMessage(
                                response,
                                function () {
                                    vm.signingHomeTableData.bsTableControl.operat = 'refresh';
                                    $rootScope.alertDialog('已成功更换家庭的签约！').then(mdPanelRef.close());
                                },
                                function () {
                                    $rootScope.alertDialog('更换签约失败');
                                }
                            );
                        },
                        function () {
                            $rootScope.alertDialog('更换签约失败');
                        }
                    );
                };
                $scope.search = function () {
                    $scope.getDoctorList();
                };
                $scope.getDoctorList = function () {
                    var params = {
                        "SEARCH_DOCTOR": $scope.searchValue
                    };
                    doctorIndividualService.getDoctorList($scope, params, callback);
                };
                $scope.$on('panelClose',
                    function () {
                        mdPanelRef.close();
                    }
                );
            }

            var position = $mdPanel.newPanelPosition().absolute().center();
            var animation = $mdPanel.newPanelAnimation().withAnimation($mdPanel.animation.FADE);
            var config = {
                animation: animation,
                attachTo: angular.element(document.body),
                controller: selectDoctorController,
                templateUrl: 'template/doctor/doctorIndividual/signManage/_changeSignEnsure.html',
                position: position,
                trapFocus: true,
                disableParentScroll: true,
                clickOutsideToClose: false,
                clickEscapeToClose: true,
                hasBackdrop: true,
                fullscreen: false
            };
            $mdPanel.open(config);
        }
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('physicalExaminationEditCtrl', physicalExaminationEditCtrl);
physicalExaminationEditCtrl.$inject = ['$rootScope', '$state', '$location', '$anchorScroll', 'physicalExaminationService', 'residentArchivesService', '$filter'];
function physicalExaminationEditCtrl($rootScope, $state, $location, $anchorScroll, physicalExaminationService, residentArchivesService, $filter) {
    var vm = this;

    function init() {
        vm.data = {};

        //控制显示隐藏和判断
        vm.editable = false;
        vm.residentKeyId = $state.params.RESIDENT_KEY_ID;//居民ID

        vm.physicalRecordKeyId = $state.params.PHYSICAL_RECORD_KEY_ID;//体检ID

        vm.isResident = $rootScope.isContains($state.current.name, 'resident');

        definedData();
        getDictList();
    }

    //获取字典表
    function getDictList() {
        var dict_type_code_list = physicalExaminationService.dictTypeCodeList;

        $rootScope.commonService(
            'getDictList',
            {
                "DICT_TYPE_CODE_LIST": dict_type_code_list
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        angular.forEach(dict_type_code_list, function (item) {
                            vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
                        });
                        getPhysicalExaminationDetail();
                    },
                    function () {
                        $rootScope.alertDialog('获取字典列表失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取字典列表失败');
            }
        );
    }

    function getPhysicalExaminationDetail() {
        physicalExaminationService.getDetail(
            {PHYSICAL_RECORD_KEY_ID: vm.physicalRecordKeyId},
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        transformData(data);
                        vm.dataBak = data;
                    },
                    function () {
                        $rootScope.alertDialog("查询体检档案失败");
                    }
                );
            },
            function () {
                $rootScope.alertDialog("查询体检档案失败");
            }
        );
    }

    //职业病危害因素接触史下的选项设置默认值
    vm.changeZybwhsjcs = function() {
        if (vm.shenghuoZybwhsjcs === 1) {
            vm.shenghuoFcfhcs = 0;
            vm.shenghuoFswzcs = 0;
            vm.shenghuoWlysfhcs = 0;
            vm.shenghuoHxwzfhcs = 0;
            vm.shenghuoQtfhcs = 0;
        }
    };

    //转换数据
    function transformData(data) {
        vm.residentInfo = {};
        vm.residentInfo.RESIDENT_ID_NO = data.RESIDENT_ID_NO;
        vm.residentInfo.RESIDENT_NAME = data.RESIDENT_NAME;
        vm.residentInfo.RESIDENT_SEX_NAME = data.RESIDENT_SEX_NAME;
        vm.residentInfo.RESIDENT_PHONE_NO = data.RESIDENT_PHONE_NO;
        vm.residentInfo.LIVING_TYPE_NAME = data.LIVING_TYPE_NAME;
        vm.residentInfo.HOUSE_ADDRESS = data.HOUSE_ADDRESS;
        vm.residentInfo.RESPONSIBLE_DOCTOR_NAME = data.RESPONSIBLE_DOCTOR_NAME;
        vm.residentInfo.BIRTHDAY = $filter('commonDate')(data.BIRTHDAY);

        mutiplySelectItem(vm['ZYZZSelected'], vm['ZYZZList'], data['ZHENGZHUANG_ZYZZ_CODE']);//主要症状编码
        vm.zhengzhuangQtzz = data.ZHENGZHUANG_QTZZ;
        vm.yibanTw = data.YIBAN_TW;
        vm.yibanMl = data.YIBAN_ML;
        vm.yibanHxpl = data.YIBAN_HXPL;
        vm.yibanZcssy = data.YIBAN_ZCSSY;
        vm.yibanZcszy = data.YIBAN_ZCSZY;
        vm.yibanYcssy = data.YIBAN_YCSSY;
        vm.yibanYcszy = data.YIBAN_YCSZY;
        vm.yibanSg = data.YIBAN_SG;
        vm.yibanTz = data.YIBAN_TZ;
        vm.yibanYw = data.YIBAN_YW;
        vm.yibanRzzs = data.YIBAN_RZZS;
        vm.LNRJKZTZWPG = ifNullItem($rootScope.selectItem(vm.LNRJKZTZWPGList, 'DICT_VALUE_CODE', data['YIBAN_LNRJKZTZWPG_CODE']));//老年人健康状态自我评估编码
        vm.LNRSHZLNLZWPG = ifNullItem($rootScope.selectItem(vm.LNRSHZLNLZWPGList, 'DICT_VALUE_CODE', data['YIBAN_LNRSHZLNLZWPG_CODE']));//老年人生活自理能力自我评估编码
        vm.RZGN = ifNullItem($rootScope.selectItem(vm.RZGNList, 'DICT_VALUE_CODE', data['YIBAN_RZGN_CODE']));//认知功能编码
        vm.yibanJlzzzljczf = data.YIBAN_JLZZZLJCZF;//简易状态智力检查总分
        vm.QGZZ = ifNullItem($rootScope.selectItem(vm.QGZZList, 'DICT_VALUE_CODE', data['YIABN_QGZZ_CODE']));//情感状态编码
        vm.yibanYypfjczf = data.YIBAN_YYPFJCZF;//抑郁评分检查总分
        vm.DLPL = ifNullItem($rootScope.selectItem(vm.DLPLList, 'DICT_VALUE_CODE', data['SHENGHUO_DLPL_CODE']));//锻炼频率编码
        vm.shenghuoMcdlsj = data.SHENGHUO_MCDLSJ;//每次锻炼时间
        vm.shenghuoJcdlsj = data.SHENGHUO_JCDLSJ;//坚持锻炼时间
        vm.shenghuoDlfs = data.SHENGHUO_DLFS;//锻炼方式
        mutiplySelectItem(vm['YSXGSelected'], vm['YSXGList'], data['SHENGHUO_YSXG_CODE']);//饮食习惯编码
        vm.XYZK = ifNullItem($rootScope.selectItem(vm.XYZKList, 'DICT_VALUE_CODE', data['SHENGHUO_XYZK_CODE']));//吸烟状况编码
        vm.shenghuoRxyl = data.SHENGHUO_RXYL;//日吸烟量
        vm.shenghuoKsxynl = data.SHENGHUO_KSXYNL;//开始吸烟年龄
        vm.shenghuoJynl = data.SHENGHUO_JYNL;//戒烟年龄
        vm.YJPL = ifNullItem($rootScope.selectItem(vm.YJPLList, 'DICT_VALUE_CODE', data['SHENGHUO_YJPL_CODE']));//饮酒频率编码
        vm.shenghuoRyjl = data.SHENGHUO_RYJL;//日饮酒量
        vm.shenghuoSfjj = data.SHENGHUO_SFJJ;//是否戒酒
        vm.shenghuoJjnl = data.SHENGHUO_JJNL;//戒酒年龄
        vm.shenghuoKsyjnl = data.SHENGHUO_KSYJNL;//开始饮酒年龄
        vm.shenghuoJyynsfczj = data.SHENGHUO_JYNNSFCZJ;//近一年内是否曾醉酒
        mutiplySelectItem(vm['YJZLSelected'], vm['YJZLList'], data['SHENGHUO_YJZL_CODE']);//饮酒种类编码
        vm.shenghuoQtyjzl = data.SHENGHUO_QTYJZL;//近一年内是否曾醉酒
        vm.shenghuoZybwhsjcs = data.SHENGHUO_ZYBWHYSJCS;//职业病危害因素接触史
        vm.shenghuoGz = data.SHENGHUO_GZ;//工种
        vm.shenghuoCysj = data.SHENGHUO_CYSJ;//从业时间
        vm.shenghuoFc = data.SHENGHUO_FC;//粉尘
        vm.shenghuoFcfhcs = data.SHENGHUO_FCFHCS;//粉尘防护措施
        vm.shenghuoFcfhcsms = data.SHENGHUO_FCFHCSMS;//粉尘防护措施描述
        vm.shenghuoFswz = data.SHENGHUO_FSWZ;//放射物质
        vm.shenghuoFswzcs = data.SHENGHUO_FSWZCS;//放射防护物质措施
        vm.shenghuoFswzcsms = data.SHENGHUO_FSWZCSMS;//放射物质防护措施描述
        vm.shenghuoWlys = data.SHENGHUO_WLYS;//物理因素
        vm.shenghuoWlysfhcs = data.SHENGHUO_WLYSFHCS;//物理因素防护措施
        vm.shenghuoWlysfhcsms = data.SHENGHUO_WLYSFHCSMS;//物理因素防护措施描述
        vm.shenghuoHxwz = data.SHENGHUO_HXWZ;//化学物质
        vm.shenghuoHxwzfhcs = data.SHENGHUO_HXWZFHCS;//化学物质防护措施
        vm.shenghuoHxwzfhcsms = data.SHENGHUO_HXWZFHCSMS;//化学物质防护措施描述
        vm.shenghuoQt = data.SHENGHUO_QT;//其他
        vm.shenghuoQtfhcs = data.SHENGHUO_QTFHCS;//其他防护措施
        vm.shenghuoQtfhcsms = data.SHENGHUO_QTFHCSMS;//其他防护措施描述
        vm.KCTJJG = ifNullItem($rootScope.selectItem(vm.KCTJJGList, 'DICT_VALUE_CODE', data['ZANGQI_KCTJJG_CODE']));//口唇体检结果编码
        vm.CLTJJG = ifNullItem($rootScope.selectItem(vm.CLTJJGList, 'DICT_VALUE_CODE', data['ZANGQI_CLTJJG_CODE']));//齿列体检结果编码
        vm.YBTJJG = ifNullItem($rootScope.selectItem(vm.YBTJJGList, 'DICT_VALUE_CODE', data['ZANGQI_YBTJJG_CODE']));//咽部体检结果编码
        vm.zangqiZysl = data.ZANGQI_ZYSL;//左眼
        vm.zangqiYysl = data.ZANGQI_YYSL;//右眼
        vm.zangqiZyjz = data.ZANGQI_ZYJZ;//左眼矫正
        vm.zangqiYyjz = data.ZANGQI_YYJZ;//右眼矫正
        vm.TLTJJG = ifNullItem($rootScope.selectItem(vm.TLTJJGList, 'DICT_VALUE_CODE', data['ZANGQI_TLTJJG_CODE']));//听力体检结果编码
        vm.YDGNTJJG = ifNullItem($rootScope.selectItem(vm.YDGNTJJGList, 'DICT_VALUE_CODE', data['ZANGQI_YDGNTJJG_CODE']));//运动功能体检结果编码
        vm.YDTJJG = ifNullItem($rootScope.selectItem(vm.YDTJJGList, 'DICT_VALUE_CODE', data['CHATI_YDTJJG_CODE']));//眼底编码
        vm.chatiYdycms = data.CHATI_YDYCMS;//眼底异常描述
        vm.PFTJJG = ifNullItem($rootScope.selectItem(vm.PFTJJGList, 'DICT_VALUE_CODE', data['CHATI_PFTJJG_CODE']));//皮肤编码
        vm.chatiPfqt = data.CHATI_PFQT;//皮肤其他
        vm.GMTJJG = ifNullItem($rootScope.selectItem(vm.GMTJJGList, 'DICT_VALUE_CODE', data['CHATI_GMTJJG_CODE']));//巩膜编码
        vm.chatiGmqt = data.CHATI_GMQT;//巩膜其他
        vm.LBJTJJG = ifNullItem($rootScope.selectItem(vm.LBJTJJGList, 'DICT_VALUE_CODE', data['CHATI_LBJTJJG_CODE']));//淋巴结编码
        vm.chatiLbjqt = data.CHATI_LBJQT;//淋巴结其他
        vm.chatiSfstzx = data.CHATI_SFSTZX;//桶状胸
        vm.chatiHxysfyc = data.CHATI_HXYSFYC;//呼吸音
        vm.chatiHxyycms = data.CHATI_HXYYCMS;//呼吸音异常描述
        vm.LMYTJJG = ifNullItem($rootScope.selectItem(vm.LMYTJJGList, 'DICT_VALUE_CODE', data['CHATI_LMYTJJG_CODE']));//罗音体检结果编码
        vm.chatiLmyqt = data.CHATI_LMYQT;//罗音其他
        vm.chatiXl = data.CHATI_XL;//心率
        vm.XLTJJG = ifNullItem($rootScope.selectItem(vm.XLTJJGList, 'DICT_VALUE_CODE', data['CHATI_XLTJJG_CODE']));//心律体检结果编码
        vm.chatiSfyzy = data.CHATI_SFYZY;//杂音
        vm.chatiZyms = data.CHATI_ZYMS;//杂音描述
        vm.chatiSfyyt = data.CHATI_SFYYT;//压痛
        vm.chatiYtms = data.CHATI_YTMS;//压痛描述
        vm.chatiSfybk = data.CHATI_SFYBK;//包块
        vm.chatiBkms = data.CHATI_BKMS;//包块描述
        vm.chatiSfygd = data.CHATI_SFYGD;//肝大
        vm.chatiGdms = data.CHATI_GDMS;//肝大描述
        vm.chatiSfypd = data.CHATI_SFYPD;//脾大
        vm.chatiPdms = data.CHATI_PDMS;//脾大描述
        vm.chatiSfyydxzy = data.CHATI_SFYYDXZY;//移动性浊音
        vm.chatiYdxzyms = data.CHATI_YDXZYMS;//移动性浊音描述
        vm.XZSZTJJG = ifNullItem($rootScope.selectItem(vm.XZSZTJJGList, 'DICT_VALUE_CODE', data['CHATI_XZSZTJJG_CODE']));//下肢水肿体检结果编码
        vm.ZBDMBDTJJG = ifNullItem($rootScope.selectItem(vm.ZBDMBDTJJGList, 'DICT_VALUE_CODE', data['CHATI_ZBDMBDTJJG_CODE']));//足背动脉搏动体检结果编码
        vm.GMTZTJJG = ifNullItem($rootScope.selectItem(vm.GMTZTJJGList, 'DICT_VALUE_CODE', data['CHATI_GMTZTJJG_CODE']));//肛门特诊体检结果编码
        vm.chatiGmtzqt = data.CHATI_GMTZQT;//肛门特诊其他
        mutiplySelectItem(vm['RXTJJGSelected'], vm['RXTJJGList'], data['CHATI_RXTJJG_CODE']);//乳腺体检编码
        vm.chatiRxqt = data.CHATI_RXQT;//乳腺其他
        vm.chatiWysfyc = data.CHATI_WYSFYC;//外阴是否异常
        vm.chatiWyycms = data.CHATI_WYYCMS;//外阴异常描述
        vm.chatiYdsfyc = data.CHATI_YDSFYC;//阴道是否异常
        vm.chatiYindycms = data.CHATI_YINDYCMS;//阴道异常描述
        vm.chatiGgsfyc = data.CHATI_GGSFYC;//宫颈是否异常
        vm.chatiGgycms = data.CHATI_GGYCMS;//宫颈异常描述
        vm.chatiGtsfyc = data.CHATI_GTSFYC;//宫体是否异常
        vm.chatiGtycms = data.CHATI_GTYCMS;//宫体异常描述
        vm.chatiFjsfyc = data.CHATI_FJSFYC;//附件是否异常
        vm.chatiFjycms = data.CHATI_FJYCMS;//附件异常描述
        vm.chatiQtjc = data.CHATI_QTJC;//其他检查
        vm.fuzhuXhdb = data.FUZHU_XHDB;//血红蛋白
        vm.fuzhuBxb = data.FUZHU_BXB;//白细胞
        vm.fuzhuXxb = data.FUZHU_XXB;//血小板
        vm.fuzhuXcgqt = data.FUZHU_XCGQT;//血常规其他
        vm.fuzhuNdb = data.FUZHU_NDB;//尿蛋白
        vm.fuzhuNt = data.FUZHU_NT;//尿糖
        vm.fuzhuNtt = data.FUZHU_NTT;//尿酮体
        vm.fuzhuNtx = data.FUZHU_NTX;//尿潜血
        vm.fuzhuNcgqt = data.FUZHU_NCGQT;//尿常规其他
        vm.fuzhuKfxtMmol = data.FUZHU_KFXT_MMOL;//空腹血糖mmol
        vm.fuzhuKfxtMg = data.FUZHU_KFXT_MG;//空腹血糖mg
        vm.fuzhuChxt = data.FUZHU_CHXT;//餐后血糖
        vm.fuzhuXdtsfyc = data.FUZHU_XDTSFYC;//心电图是否异常
        vm.fuzhuXdtycms = data.FUZHU_XDTYCMS;//心电图异常描述
        vm.fuzhuNwlbdb = data.FUZHU_NWLBDB;//尿微量白蛋白
        vm.DBQXTJJG = ifNullItem($rootScope.selectItem(vm.DBQXTJJGList, 'DICT_VALUE_CODE', data['FUZHU_DBQXTJJG_CODE']));//大便潜血体检结果编码
        vm.fuzhuThxhdb = data.FUZHU_THXHDB;//糖化血红蛋白
        vm.YXGYBMKYTJJG = ifNullItem($rootScope.selectItem(vm.YXGYBMKYTJJGList, 'DICT_VALUE_CODE', data['FUZHU_YXGYBMKYTJJG_CODE']));//乙型肝炎表面抗原体检结果编码
        vm.fuzhuGbzam = data.FUZHU_GBZAM;//谷丙转氨酶
        vm.fuzhuXqgczam = data.FUZHU_XQGCZAM;//血清谷草转氨酶
        vm.fuzhuBdb = data.FUZHU_BDB;//白蛋白
        vm.fuzhuZdhs = data.FUZHU_ZDHS;//总胆红素
        vm.fuzhuJhdhs = data.FUZHU_JHDHS;//结合胆红素
        vm.fuzhuXqjg = data.FUZHU_XQJG;//血清肌酐
        vm.fuzhuXnsd = data.FUZHU_XNSD;//血尿素氮
        vm.fuzhuXjnd = data.FUZHU_XJND;//血钾浓度
        vm.fuzhuXnnd = data.FUZHU_XNND;//血钠浓度
        vm.fuzhuZdgc = data.FUZHU_ZDGC;//总胆固醇
        vm.fuzhuGysz = data.FUZHU_GYSZ;//甘油三酯
        vm.fuzhuXqdmdzdbdgc = data.FUZHU_XQDMDZDBDGC;//血清低密度脂蛋白胆固醇
        vm.fuzhuXqgmdzdbdgc = data.FUZHU_XQGMDZDBDGC;//血清高密度脂蛋白胆固醇
        vm.fuzhuXbxxpsfyc = data.FUZHU_XBXXPSFYC;//胸部X线片是否异常
        vm.fuzhuXbxxpycms = data.FUZHU_XBXXPYCMS;//胸部X线片异常描述
        vm.fuzhuBcsfyc = data.FUZHU_BCSFYC;//B超是否异常
        vm.fuzhuBcycms = data.FUZHU_BCYCMS;//B超异常描述
        vm.fuzhuGgtpsfyc = data.FUZHU_GGTPSFYC;//宫颈涂片是否异常
        vm.fuzhuGgtuycms = data.FUZHU_GGTUYCMS;//宫颈涂片异常描述
        vm.fuzhuQtjc = data.FUZHU_QTJC;//辅助检查其他检查
        vm.constitutionNormal = data.NORMAL_CONSTITUTION;//平和质辨识
        vm.constitutionQiDeficiency = data.QI_DEFICIENCY_CONSTITUTION;//气虚质辨识
        vm.constitutionYangDeficiency = data.YANG_DEFICIENCY_CONSTITUTION;//阳虚质辨识
        vm.constitutionYinDeficiency = data.YIN_DEFICIENCY_CONSTITUTION;//阴虚质辨识
        vm.constitutionPhlegmDampness = data.PHLEGM_DAMPNESS_CONSTITUTION;//痰湿质辨识
        vm.constitutionDampHeat = data.DAMP_HEAT_CONSTITUTION;//湿热质辨识
        vm.constitutionBloodStasis = data.BLOOD_STASIS_CONSTITUTION;//血瘀质辨识
        vm.constitutionQiStagnation = data.QI_STAGNATION_CONSTITUTION;//气郁质辨识
        vm.constitutionSpecial = data.SPECIAL_CONSTITUTION;//特禀质辨识
        mutiplySelectItem(vm['NXGJBSelected'], vm['NXGJBList'], data['WENTI_NXGJB_CODE']);//脑血管疾病编码
        vm.wentiNxgjbqt = data.WENTI_NXGJBQT;//脑血管疾病其他
        mutiplySelectItem(vm['SZJBSelected'], vm['SZJBList'], data['WENTI_SZJB_CODE']);//肾脏疾病编码
        vm.wentiSzjbqt = data.WENTI_SZJBQT;//肾脏疾病其他
        mutiplySelectItem(vm['XZJBSelected'], vm['XZJBList'], data['WENTI_XZJB_CODE']);//心脏疾病编码
        vm.wentiXzjbqt = data.WENTI_XZJBQT;//心脏疾病其他
        mutiplySelectItem(vm['XGJBSelected'], vm['XGJBList'], data['WENTI_XGJB_CODE']);//血管疾病编码
        vm.wentiXgjbqt = data.WENTI_XGJBQT;//血管疾病其他
        mutiplySelectItem(vm['YBJBSelected'], vm['YBJBList'], data['WENTI_YBJB_CODE']);//眼部疾病编码
        vm.wentiYbjbqt = data.WENTI_YBJBQT;//眼部疾病其他
        vm.wentiSfysjxtjb = data.WENTI_SFYSJXTJB;//是否有神经系统疾病
        vm.wentiSjxtjbms = data.WENTI_SJXTJBMS;//神经系统疾病描述
        vm.wentiSfyqtxtjb = data.WENTI_SFYQTXTJB;//是否有其他系统疾病
        vm.wentiQtxtjbms = data.WENTI_QTXTJBMS;//其他系统疾病描述
        mutiplySelectItem(vm['JKZDSelected'], vm['JKZDList'], data['ZHIDAO_JKZD_CODE']);//健康指导编码
        mutiplySelectItem(vm['WXYSKZSelected'], vm['WXYSKZList'], data['ZHIDAO_WXYSKZ_CODE']);//危险因素控制编码
        vm.zhidaoMbtz = data.ZHIDAO_MBTZ;//目标体重
        vm.zhidaoJyjzym = data.ZHIDAO_JYJZYM;//建议接种疫苗
        vm.zhidaoJkzdqt = data.ZHIDAO_JKZDQT;//健康指导其他
        //体检日期
        if (data.PHYSICAL_DATE !== undefined
            && data.PHYSICAL_DATE !== ''
            && data.PHYSICAL_DATE !== null) {
            vm.physicalDate = new Date(data.PHYSICAL_DATE);
        }
        //录入日期
        if (data.CREATE_TIME !== undefined
            && data.CREATE_TIME !== ''
            && data.CREATE_TIME !== null) {
            vm.createTime = new Date(data.CREATE_TIME);
        }
        vm.physicalOrganization = data.PHYSICAL_ORGANIZATION;//体检机构
        vm.inputPerson = data.INPUT_PERSON;//录入人

        vm.hospitalization_history_list = data.HOSPITALIZATION_HISTORY_LIST;//住院史
        vm.family_bed_history_list = data.FAMILY_BED_HISTORY_LIST;//家庭病床史
        vm.medication_record_list = data.MEDICATION_RECORD_LIST;//主要用药情况
        vm.nonimmune_vaccination_history_list = data.NONIMMUNE_VACCINATION_HISTORY_LIST;//非免疫规划预防接种史

        angular.forEach(vm.hospitalization_history_list, function (item) {
            item.HOSPITALIZATION_DATE = transformToDate(item.HOSPITALIZATION_DATE);
            item.DISCHARGE_DATE = transformToDate(item.DISCHARGE_DATE);
        });

        angular.forEach(vm.family_bed_history_list, function (item) {
            item.DATE_OF_CONSTRUCTION = transformToDate(item.DATE_OF_CONSTRUCTION);
            item.DATE_OF_WITHDRAWAL = transformToDate(item.DATE_OF_WITHDRAWAL);
        });

        angular.forEach(vm.medication_record_list, function (item) {
            item.MEDICATION_TIME = transformToDate(item.MEDICATION_TIME);
            angular.forEach(vm.drugComplianceList, function(item2) {
                if (item2.DICT_VALUE_CODE === item.DRUG_COMPLIANCE_CODE) {
                    item['DRUG_COMPLIANCE'] = item2;
                }
            });
        });

        angular.forEach(vm.nonimmune_vaccination_history_list, function (item) {
            item.VACCINATION_DATE = transformToDate(item.VACCINATION_DATE);
        });

        //健康评价下的异常记录
        vm.abnormal_record_list = data.ABNORMAL_RECORD_LIST;
        if (vm.abnormal_record_list.length > 0) {
            vm.abnormal_record_state = true;
        } else {
            vm.abnormal_record_state = false;
        }

    }

    function definedData() {
        //初始化多选
        vm['ZYZZSelected'] = [];
        vm['YSXGSelected'] = [];
        vm['YJZLSelected'] = [];
        vm['RXTJJGSelected'] = [];
        vm['NXGJBSelected'] = [];
        vm['SZJBSelected'] = [];
        vm['XZJBSelected'] = [];
        vm['XGJBSelected'] = [];
        vm['YBJBSelected'] = [];
        vm['JKZDSelected'] = [];
        vm['WXYSKZSelected'] = [];

        //初始化单选
        vm['LNRJKZTZWPG'] = {};
        vm['LNRSHZLNLZWPG'] = {};
        vm['RZGN'] = {};
        vm['QGZZ'] = {};
        vm['DLPL'] = {};
        vm['XYZK'] = {};
        vm['YJPL'] = {};
        vm['KCTJJG'] = {};
        vm['CLTJJG'] = {};
        vm['YBTJJG'] = {};
        vm['TLTJJG'] = {};
        vm['YDGNTJJG'] = {};
        vm['YDTJJG'] = {};
        vm['PFTJJG'] = {};
        vm['GMTJJG'] = {};
        vm['LBJTJJG'] = {};
        vm['LMYTJJG'] = {};
        vm['XLTJJG'] = {};
        vm['XZSZTJJG'] = {};
        vm['ZBDMBDTJJG'] = {};
        vm['GMTZTJJG'] = {};
        vm['DBQXTJJG'] = {};
        vm['YXGYBMKYTJJG'] = {};

        vm.hospitalization_history_list = [];//住院史
        vm.family_bed_history_list = [];//家庭病床史
        vm.medication_record_list = [];//主要用药情况
        vm.nonimmune_vaccination_history_list = [];//非免疫规划预防接种史
        vm.abnormal_record_list = [];//健康评价下的异常记录
    }

    //职业病危害因素接触史下的选项设置默认值
    vm.changeZybwhsjcs = function () {
        if (vm.shenghuoZybwhsjcs === 1) {
            vm.shenghuoFcfhcs = 0;
            vm.shenghuoFswzcs = 0;
            vm.shenghuoWlysfhcs = 0;
            vm.shenghuoHxwzfhcs = 0;
            vm.shenghuoQtfhcs = 0;
        }
    };

    //添加历史
    vm.addHistory = function (type) {
        switch(type) {
            case 1:
                vm.hospitalization_history_list.push({
                    "HOSPITALIZATION_DATE": null,
                    "DISCHARGE_DATE": null,
                    "REASON": "",
                    "ORGANIZATION_NAME": "",
                    "MEDICAL_RECORD_NUMBER": ""
                });
                break;
            case 2:
                vm.family_bed_history_list.push({
                    "DATE_OF_CONSTRUCTION": null,
                    "DATE_OF_WITHDRAWAL": null,
                    "REASON": "",
                    "ORGANIZATION_NAME": "",
                    "MEDICAL_RECORD_NUMBER": ""
                });
                break;
            case 3:
                vm.medication_record_list.push({
                    "MEDICATION_NAME": "",
                    "MEDICATION_USAGE": "",
                    "DOSAGE": "",
                    "MEDICATION_TIME": null,
                    "DRUG_COMPLIANCE_CODE": "",
                    "DRUG_COMPLIANCE_NAME": ""
                });
                break;
            case 4:
                vm.nonimmune_vaccination_history_list.push({
                    "VACCINATION_NAME": "",
                    "VACCINATION_DATE": null,
                    "VACCINATION_ORGANIZATION_NAME": ""
                });
                break;
            case 5:
                vm.abnormal_record_list.push({
                    "ABNORMAL_DESCRIPTION": ""
                });
                break;
            default:
                break;
        }

    };

    vm.calculateBMI = function () {
        if (!!vm.yibanSg && !!vm.yibanTz) {
            var temp1 = (vm.yibanTz * 100000/(vm.yibanSg * vm.yibanSg)).toFixed(0);
            vm.yibanRzzs = parseInt(temp1) / 10;
        }
    };

    vm.abnormal_record_state_change = function () {
        if (vm.abnormal_record_state === 0) {
            vm.abnormal_record_list = [];
        } else if (vm.abnormal_record_state === 1) {
            vm.addHistory(5);
        }
    };

    function ifNullItem(item) {
        if (item === undefined || item === null || item === '') {
            return {
                "DICT_VALUE_CODE": "",
                "DICT_VALUE_NAME": ""
            };
        } else {
            return item;
        }
    }

    //返回
    vm.goBack = function () {
        $rootScope.back();
    };

    vm.remove = physicalExaminationService.remove;

    vm.exists = physicalExaminationService.exists;

    vm.toggle = physicalExaminationService.toggle;

    vm.listContainsCode = physicalExaminationService.listContainsCode;

    vm.isEmptyObject = physicalExaminationService.isEmptyObject;

    vm.scrollTo = function (target) {
        $location.hash(target);
        $anchorScroll();
    };

    function mutiplySelectItem(list, dict, code) {
        if (code === undefined || code === null || code === '') {
            return;
        }
        var codeList = code.split(',');
        angular.forEach(codeList, function (item) {
            list.push($rootScope.selectItem(dict, 'DICT_VALUE_CODE', item));
        });
    }

    function transformToDate(str) {
        if (str !== undefined
            && str !== ''
            && str !== null) {
            str = new Date(str);
        }
        return str;
    }

    init();

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('residentExaminationListCtrl', residentExaminationListCtrl);
residentExaminationListCtrl.$inject = ['$state', '$stateParams', 'physicalExaminationService'];
function residentExaminationListCtrl($state, $stateParams, physicalExaminationService) {
    var vm = this;
    vm.residentKeyId = $stateParams.RESIDENT_KEY_ID;
    physicalExaminationService.getPhysicalExaminationListByResident(vm, {'RESIDENT_KEY_ID':vm.residentKeyId}, $state);
    return vm;
}
"use strict";
SMS.SERVICES.service('physicalExaminationService', physicalExaminationService);
physicalExaminationService.$inject = ['$rootScope', 'PhysicalExamination', 'bootstrapTable'];
function physicalExaminationService($rootScope, PhysicalExamination, bootstrapTable) {
    var vm = this;

    vm.dictTypeCodeList = [
        {
            "DICT_TYPE_CODE": "0026",//居民服药依从性编码
            "LIST_NAME": "drugComplianceList"
        },
        {
            "DICT_TYPE_CODE": "0034001",//体检症状
            "LIST_NAME": "ZYZZList"
        },
        {
            "DICT_TYPE_CODE": "0034002",//老年人健康状态自我评估
            "LIST_NAME": "LNRJKZTZWPGList"
        },
        {
            "DICT_TYPE_CODE": "0034003",//老年人生活自理能力自我评估
            "LIST_NAME": "LNRSHZLNLZWPGList"
        },
        {
            "DICT_TYPE_CODE": "0034004",//认知功能
            "LIST_NAME": "RZGNList"
        },
        {
            "DICT_TYPE_CODE": "0034005",//情感状态
            "LIST_NAME": "QGZZList"
        },
        {
            "DICT_TYPE_CODE": "0034006",//锻炼频率
            "LIST_NAME": "DLPLList"
        },
        {
            "DICT_TYPE_CODE": "0034007",//饮食习惯
            "LIST_NAME": "YSXGList"
        },
        {
            "DICT_TYPE_CODE": "0034008",//吸烟状况
            "LIST_NAME": "XYZKList"
        },
        {
            "DICT_TYPE_CODE": "0034009",//饮酒频率
            "LIST_NAME": "YJPLList"
        },
        {
            "DICT_TYPE_CODE": "0034010",//饮酒种类
            "LIST_NAME": "YJZLList"
        },
        {
            "DICT_TYPE_CODE": "0034011",//口唇体检结果
            "LIST_NAME": "KCTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034012",//齿列体检结果
            "LIST_NAME": "CLTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034013",//咽部体检结果
            "LIST_NAME": "YBTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034014",//听力体检结果
            "LIST_NAME": "TLTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034015",//运动功能体检结果
            "LIST_NAME": "YDGNTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034016",//眼底体检结果编码
            "LIST_NAME": "YDTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034017",//皮肤体检结果
            "LIST_NAME": "PFTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034018",//巩膜体检结果
            "LIST_NAME": "GMTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034019",//淋巴结体检结果
            "LIST_NAME": "LBJTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034020",//罗音体检结果
            "LIST_NAME": "LMYTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034021",//心律体检结果
            "LIST_NAME": "XLTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034022",//下肢水肿体检结果
            "LIST_NAME": "XZSZTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034023",//足背动脉搏动体检结果
            "LIST_NAME": "ZBDMBDTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034024",//肛门特诊体检结果
            "LIST_NAME": "GMTZTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034025",//乳腺体检结果
            "LIST_NAME": "RXTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034026",//大便潜血体检结果
            "LIST_NAME": "DBQXTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034027",//乙型肝炎表面抗原体检结果
            "LIST_NAME": "YXGYBMKYTJJGList"
        },
        {
            "DICT_TYPE_CODE": "0034028",//脑血管疾病
            "LIST_NAME": "NXGJBList"
        },
        {
            "DICT_TYPE_CODE": "0034029",//肾脏疾病
            "LIST_NAME": "SZJBList"
        },
        {
            "DICT_TYPE_CODE": "0034030",//心脏疾病
            "LIST_NAME": "XZJBList"
        },
        {
            "DICT_TYPE_CODE": "0034031",//血管疾病
            "LIST_NAME": "XGJBList"
        },
        {
            "DICT_TYPE_CODE": "0034032",//眼部疾病
            "LIST_NAME": "YBJBList"
        },
        {
            "DICT_TYPE_CODE": "0034033",//健康指导
            "LIST_NAME": "JKZDList"
        },
        {
            "DICT_TYPE_CODE": "0034034",//危险因素控制
            "LIST_NAME": "WXYSKZList"
        }
    ];

    vm.remove = function (index, list) {
        list.splice(index, 1);
    };

    vm.exists = function (item, list) {
        return list.indexOf(item) > -1;
    };

    vm.isEmptyObject = function (obj) {
        if(isNaN(obj)) {
            for (var n in obj) {
                return false
            }
            return true;
        }
        return false;
    };

    //主要症状,乳腺,脑血管疾病,肾脏疾病,心脏疾病,血管疾病,眼部疾病
    var DICT_VALUE_CODE_NONE_LIST = ['0034001000010','0034025000010','0034028000010','0034029000010','0034030000010','0034031000010','0034032000010'];
    vm.toggle = function (item, list) {
        var none_idx = DICT_VALUE_CODE_NONE_LIST.indexOf(item['DICT_VALUE_CODE']);
        if (none_idx > -1) {//如果点击的是无，清空所有，只选择了无
            //添加选项
            var idx = list.indexOf(item);
            if (idx > -1) {
                list.splice(idx, 1);
            }
            else {
                list.splice(0, list.length);
                list.push(item);
            }
        } else {//如果选中了其他的，取消无的选中
            angular.forEach(list, function (item) {
                var none_index = DICT_VALUE_CODE_NONE_LIST.indexOf(item['DICT_VALUE_CODE']);
                if (none_index > -1) {//有这个无的选项
                    var dict_index = $rootScope.selectIndex(list, 'DICT_VALUE_CODE', item['DICT_VALUE_CODE']);
                    list.splice(dict_index, 1);
                    return false;
                }
            });
            //添加选项
            var idx = list.indexOf(item);
            if (idx > -1) {
                list.splice(idx, 1);
            }
            else {
                list.push(item);
            }
        }
    };

    vm.listContainsCode = function (list, code) {
        for (var i=0; i<list.length; i++) {
            if (list[i]['DICT_VALUE_CODE'] === code) {
                return true;
            }
        }
        return false;
    };

    vm.getPhysicalExaminationListByResident = function($vm, params, $state) {
        var list = {
            dataFunction: getList,
            dataParams: params,
            columns: [{
                field: 'PHYSICAL_DATE',
                title: '体检日期',
                align: 'center',
                formatter: function (val) {
                    return "<div class='edit' style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click .edit': function (e, val, row) {
                        $state.go('main.resident.residentArchivesSidebar.detail.physicalExaminationEdit',{
                            RESIDENT_KEY_ID: $state.params.RESIDENT_KEY_ID,
                            RESIDENT_ID_NO: $state.params.RESIDENT_ID_NO,
                            PHYSICAL_RECORD_KEY_ID: row.PHYSICAL_RECORD_KEY_ID
                        });
                    }
                }
            },{
                field: 'PHYSICAL_ORGANIZATION',
                title: '体检机构',
                align: 'center'
            }, {
                field: 'CREATOR_NAME',
                title: '录入人',
                align: 'center'
            }]
        };

        function getList(param, successFunction, failedFunction) {
            PhysicalExamination.getPhysicalExaminationListByResident(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.physicalExaminationData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };

    vm.getDetail = function (params, successFunction, failedFunction) {
        return PhysicalExamination.getDetail(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('physicalIdentificationEditCtrl', physicalIdentificationEditCtrl);
physicalIdentificationEditCtrl.$inject = ['$rootScope', '$state', '$stateParams', '$mdDialog', 'physicalIdentificationService'];
function physicalIdentificationEditCtrl($rootScope, $state, $stateParams, $mdDialog, physicalIdentificationService) {
    var vm = this;
    vm.editable = false;
    vm.tcmConstitutionRecordKeyId = $stateParams.TCM_CONSTITUTION_RECORD_KEY_ID;
    vm.residentKeyId = $stateParams.RESIDENT_KEY_ID;
    vm.exists = function (item, list) {
        return list.indexOf(item) > -1;
    };

    vm.isResident= $rootScope.isContains($state.current.name,'resident');

    vm.toggle = function (item, list) {
        var idx = list.indexOf(item);
        if (idx > -1) {
            list.splice(idx, 1);
        }
        else {
            list.push(item);
        }
    };

    //初始化本地字典
    vm.ConstitutionTypeTable=physicalIdentificationService.ConstitutionTypeTable;
    vm.ConstitutionTypeScoreMap=physicalIdentificationService.ConstitutionTypeScoreMap;
    vm.MainConstitutionMap=physicalIdentificationService.MainConstitutionMap;
    vm.PreferConstitutionMap=physicalIdentificationService.PreferConstitutionMap;

    function definedData() {
        //初始化多选数组
        vm['mainConstitutionSelected'] = [];
        vm['preferConstitutionSelected'] = [];
        vm['guideSelected'] = [];
        //初始化变量
        vm.questions=[];
        vm.residentName='';
        vm.residentIdNo='';
        vm.residentSexName='';
        vm.residentSexCode='';
        vm.assessDoctor='';
        vm.assessDate=new Date();
        vm.constitutionTypeScoreObject=angular.copy(physicalIdentificationService.ConstitutionTypeScoreObject);
    }

    var dict_type_code_list=[
        {
            "DICT_TYPE_CODE": "0009",//性别
            "LIST_NAME": "sexCodeName"
        },
        {
            "DICT_TYPE_CODE": "0035",//中医保健指导
            "LIST_NAME": "guideList"
        }
    ];

    //获取字典列表
    function getDictList() {
        $rootScope.commonService(
            "getDictList",
            {"DICT_TYPE_CODE_LIST": dict_type_code_list},
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.dictList = data;
                        eachDictValue(data);
                        eachModelValue(vm.originData);
                    },
                    function () {
                        $rootScope.alertDialog('获取字典列表失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取字典列表失败');
            }
        );
    }
    //获取详细信息
    vm.detail = function () {
        physicalIdentificationService.detail(
            {"TCM_CONSTITUTION_RECORD_KEY_ID": vm.tcmConstitutionRecordKeyId,"RESIDENT_KEY_ID": vm.residentKeyId},
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        vm.originData=data;
                        getDictList();
                    },
                    function () {
                        $rootScope.alertDialog('获取个人信息失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('获取个人信息失败');
            }
        );
    };

    //单个赋值
    function eachDictValue(data) {
        angular.forEach(dict_type_code_list, function (item) {
            vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
        });
    }

    vm.reEvaluate=function(){
        computeScore();
        evaluateConstitution();
    };
    //计算体质得分
    function computeScore(){
        vm.constitutionTypeScoreObject['QI_DEFICIENCY_CONSTITUTION_SCORE']=computeBiasedScore([2,3,4,14]);
        vm.constitutionTypeScoreObject['YANG_DEFICIENCY_CONSTITUTION_SCORE']=computeBiasedScore([11,12,13,29]);
        vm.constitutionTypeScoreObject['YIN_DEFICIENCY_CONSTITUTION_SCORE']=computeBiasedScore([10,21,26,31]);
        vm.constitutionTypeScoreObject['PHLEGM_DAMPNESS_CONSTITUTION_SCORE']=computeBiasedScore([9,16,28,32]);
        vm.constitutionTypeScoreObject['DAMP_HEAT_CONSTITUTION_SCORE']=computeBiasedScore([23,25,27,30]);
        vm.constitutionTypeScoreObject['BLOOD_STASIS_CONSTITUTION_SCORE']=computeBiasedScore([19,22,24,33]);
        vm.constitutionTypeScoreObject['QI_STAGNATION_CONSTITUTION_SCORE']=computeBiasedScore([5,6,7,8]);
        vm.constitutionTypeScoreObject['SPECIAL_CONSTITUTION_SCORE']=computeBiasedScore([15,17,18,20]);
        vm.constitutionTypeScoreObject['NORMAL_CONSTITUTION_SCORE']=computeNoarmalScore([1,2,4,5,13]);
    }
    //计算偏颇质得分
    function computeBiasedScore(array){
        var score=0;
        angular.forEach(array,function(item){
            if(vm.questions[item-1].score){
                score+=vm.questions[item-1].score.BIASED_CONSTITUTION_SCORE;
            }
        });
        return score;
    }
    //计算平和质得分
    function computeNoarmalScore(array){
        var score=0;
        angular.forEach(array,function(item){
            if(vm.questions[item-1].score){
                score+=vm.questions[item-1].score.NORMAL_CONSTITUTION_SCORE;
            }
        });
        return score;
    }
    var mainPrefix='IS_MAIN_';
    var preferPrefix='IS_PREFER_';
    //体质评估
    function evaluateConstitution(){
        var biasedScoreLT8=true;//偏颇质得分是否都小于8
        var biasedScoreLT10=true;//偏颇质得分是否都小于10
        vm['mainConstitutionSelected'] = [];
        vm['preferConstitutionSelected'] = [];
        for (var scoreObject in vm.constitutionTypeScoreObject) {
            if((scoreObject+'')!=='NORMAL_CONSTITUTION_SCORE'){//不是平和质的都是偏颇体质
                if(vm.constitutionTypeScoreObject[scoreObject]>=11){//>=11是主要体质
                    vm['mainConstitutionSelected'].push(mainPrefix+scoreObject.substring(0,scoreObject.length-6));
                }else if(vm.constitutionTypeScoreObject[scoreObject]>=9){//9,10是倾向体质
                    vm['preferConstitutionSelected'].push(preferPrefix+scoreObject.substring(0,scoreObject.length-6));
                }
                if(vm.constitutionTypeScoreObject[scoreObject]>=10){
                    biasedScoreLT10=false; biasedScoreLT8=false;
                }else if(vm.constitutionTypeScoreObject[scoreObject]>=8){
                    biasedScoreLT8=false;
                }
            }
        }
        if(vm.constitutionTypeScoreObject['NORMAL_CONSTITUTION_SCORE']>=17){//平和质>=17
            if(biasedScoreLT8){
                vm['mainConstitutionSelected'].push(mainPrefix+'NORMAL_CONSTITUTION');
            }else if(biasedScoreLT10){
                vm['preferConstitutionSelected'].push(preferPrefix+'NORMAL_CONSTITUTION');
            }
        }
    }

    vm.back = function () {
        $rootScope.back();
    };


    vm.failedTip = function (text) {
        $mdDialog.show(
            $mdDialog.alert()
                .clickOutsideToClose(true)
                .title('提示')
                .textContent(text)
                .ok('确定')
        );
    };
    //返回是否主要体质和倾向体质数组
    function getConstituionArray(map,data){
        var array=[];
        for(var key in map){
            if(data[key]==1){
                array.push(key);
            }
        }
        return array;
    }
    //每个model赋值
    function eachModelValue(data) {
        vm.residentKeyId=data.RESIDENT_KEY_ID;
        vm.residentName=data.RESIDENT_NAME;
        vm.residentIdNo=data.RESIDENT_ID_NO;
        vm.residentSexName=data.RESIDENT_SEX_NAME;
        vm.residentSexCode=data.RESIDENT_SEX_CODE;
        vm.dateOfBirth = new Date(data.BIRTHDAY);
        vm.questions = data.ASSESS_ITEM_LIST;
        vm.assessDoctor=data.ASSESS_DOCTOR;
        vm.assessDate=new Date(data.ASSESS_DATE);
        vm.creatorName=data.CREATOR_NAME;
        vm.createTime=new Date(data.CREATE_TIME);
        vm.updateTime=new Date(data.UPDATE_TIME);
        vm.sexItem = $rootScope.selectItem(vm.sexCodeName, 'DICT_VALUE_CODE', vm.residentSexCode);
        //医药费支付方式
        var tcmHealthGuidanceCodeArray = data.TCM_HEALTH_GUIDANCE_CODE ? data.TCM_HEALTH_GUIDANCE_CODE.split(',') : [];
        if (tcmHealthGuidanceCodeArray.length<1) {
            vm.guideSelected = [];
        } else {
            vm.guideSelected = physicalIdentificationService.getItemArrByCodeArr(vm.guideList, tcmHealthGuidanceCodeArray, 'DICT_VALUE_CODE');
        }
        vm['mainConstitutionSelected'] = getConstituionArray(vm.MainConstitutionMap,data);
        vm['preferConstitutionSelected'] = getConstituionArray(vm.PreferConstitutionMap,data);
        angular.forEach(vm.questions,function(item){
            angular.forEach(item.ASSESS_ITEM_OPTION_LIST,function(subItem){
               if(subItem.IS_OPTION_SELECTED==1){
                   item.score=subItem;
               }
            });
        });
        //将得分赋值
        for(var key in vm.constitutionTypeScoreObject){
            vm.constitutionTypeScoreObject[key]=data[key];
        }
    }
    definedData();
    vm.detail();

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('residentIdentificationListCtrl', residentIdentificationListCtrl);
residentIdentificationListCtrl.$inject = ['$rootScope', '$state', '$stateParams', 'residentArchivesService', 'physicalIdentificationService'];
function residentIdentificationListCtrl($rootScope, $state, $stateParams, residentArchivesService, physicalIdentificationService) {
    var vm = this;
    vm.residentKeyId = $stateParams.RESIDENT_KEY_ID;
    vm.create = function () {
        $state.go('main.resident.residentArchivesSidebar.detail.physicalIdentificationAdd', {RESIDENT_KEY_ID: vm.residentKeyId});
    };
    physicalIdentificationService.showResidentTable(vm, {'RESIDENT_KEY_ID': vm.residentKeyId}, $state);
    return vm;
}
"use strict";
SMS.SERVICES.service('physicalIdentificationService', physicalIdentificationService);
physicalIdentificationService.$inject = ['$rootScope', '$state', 'ResidentArchives', 'bootstrapTable'];
function physicalIdentificationService($rootScope, $state, ResidentArchives, bootstrapTable) {
    var vm = this;
    vm.ConstitutionTypeTable=['气虚质','阳虚质','	阴虚质','痰湿质','湿热质','血瘀质','气郁质','特禀质','平和质'];
    vm.ConstitutionTypeScoreObject={
        'QI_DEFICIENCY_CONSTITUTION_SCORE':0,
        'YANG_DEFICIENCY_CONSTITUTION_SCORE':0,
        'YIN_DEFICIENCY_CONSTITUTION_SCORE':0,
        'PHLEGM_DAMPNESS_CONSTITUTION_SCORE':0,
        'DAMP_HEAT_CONSTITUTION_SCORE':0,
        'BLOOD_STASIS_CONSTITUTION_SCORE':0,
        'QI_STAGNATION_CONSTITUTION_SCORE':0,
        'SPECIAL_CONSTITUTION_SCORE':0,
        'NORMAL_CONSTITUTION_SCORE':0
    };
    vm.ConstitutionTypeScoreMap={
        'QI_DEFICIENCY_CONSTITUTION_SCORE':'气虚质',
        'YANG_DEFICIENCY_CONSTITUTION_SCORE':'阳虚质',
        'YIN_DEFICIENCY_CONSTITUTION_SCORE':'阴虚质',
        'PHLEGM_DAMPNESS_CONSTITUTION_SCORE':'痰湿质',
        'DAMP_HEAT_CONSTITUTION_SCORE':'湿热质',
        'BLOOD_STASIS_CONSTITUTION_SCORE':'血瘀质',
        'QI_STAGNATION_CONSTITUTION_SCORE':'气郁质',
        'SPECIAL_CONSTITUTION_SCORE':'特禀质',
        'NORMAL_CONSTITUTION_SCORE':'平和质'
    };
    vm.MainConstitutionMap={
        'IS_MAIN_NORMAL_CONSTITUTION':'平和质',
        'IS_MAIN_QI_DEFICIENCY_CONSTITUTION':'气虚质',
        'IS_MAIN_YANG_DEFICIENCY_CONSTITUTION':'阳虚质',
        'IS_MAIN_YIN_DEFICIENCY_CONSTITUTION':'阴虚质',
        'IS_MAIN_PHLEGM_DAMPNESS_CONSTITUTION':'痰湿质',
        'IS_MAIN_DAMP_HEAT_CONSTITUTION':'湿热质',
        'IS_MAIN_BLOOD_STASIS_CONSTITUTION':'血瘀质',
        'IS_MAIN_QI_STAGNATION_CONSTITUTION':'气郁质',
        'IS_MAIN_SPECIAL_CONSTITUTION':'特禀质'
    };
    vm.PreferConstitutionMap={
        'IS_PREFER_NORMAL_CONSTITUTION':'平和质',
        'IS_PREFER_QI_DEFICIENCY_CONSTITUTION':'气虚质',
        'IS_PREFER_YANG_DEFICIENCY_CONSTITUTION':'阳虚质',
        'IS_PREFER_YIN_DEFICIENCY_CONSTITUTION':'阴虚质',
        'IS_PREFER_PHLEGM_DAMPNESS_CONSTITUTION':'痰湿质',
        'IS_PREFER_DAMP_HEAT_CONSTITUTION':'湿热质',
        'IS_PREFER_BLOOD_STASIS_CONSTITUTION':'血瘀质',
        'IS_PREFER_QI_STAGNATION_CONSTITUTION':'气郁质',
        'IS_PREFER_SPECIAL_CONSTITUTION':'特禀质'
    };

    vm.isEmptyObject = function (obj) {
        for (var n in obj) {
            return false
        }
        return true;
    };
    vm.contains=function(array, obj) {
        for (var i = 0; i < array.length; i++) {
            if (array[i] === obj) {
                return 1;
            }
        }
        return 0;
    };
    vm.objectToString = function (obj) {
        var nameArr = [];
        var codeArr = [];
        angular.forEach(obj, function (item) {
            nameArr.push(item.DICT_VALUE_NAME);
            codeArr.push(item.DICT_VALUE_CODE);
        });
        return {
            "NAME": nameArr.toString(),
            "CODE": codeArr.toString()
        };
    };

    vm.detail = function (params, successFunction, failedFunction) {
        ResidentArchives.getResidentTCMConstitutionDetail(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };

    //得到主要体质的拼接字符串
    function getMainConstitutionString(row){
        var result=[];
        for(var key in vm.MainConstitutionMap){
            if(row[key]==1){
                result.push(vm.MainConstitutionMap[key]);
            }
        }
        return result.toString();
    }
    //得到倾向体质的拼接字符串
    function getPreferConstitutionString(row){
        var result=[];
        for(var key in vm.PreferConstitutionMap){
            if(row[key]==1){
                result.push(vm.PreferConstitutionMap[key]);
            }
        }
        return result.toString();
    }
    //得到复选框的item
    vm.getItemArrByCodeArr = function (items, codes, key) {
        var result = [];
        if (codes[0] === "") {
            return [];
        }
        for (var i = 0; i < codes.length; i++) {
            result.push($rootScope.selectItem(items, key, codes[i]));
        }
        return result;
    };

    //显示居民个人档案列表
    vm.showResidentTable = function ($vm, params, $state) {
        var list = {
            dataFunction: getResidentTCMConstitutionList,
            dataParams: params,
            columns: [{
                field: 'ASSESS_DATE',
                title: '评估日期',
                align: 'center',
                formatter: function (val) {
                    return "<div  style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click div': function (e, vlaue, row) {
                        $state.go('main.resident.residentArchivesSidebar.detail.physicalIdentificationEdit', {"TCM_CONSTITUTION_RECORD_KEY_ID": row.TCM_CONSTITUTION_RECORD_KEY_ID,"RESIDENT_KEY_ID": $vm.residentKeyId});
                    }
                }
            }, {
                field: 'IS_MAIN_YANG_DEFICIENCY_CONSTITUTION',
                title: '主要体质',
                align: 'center',
                formatter: function (val,row) {
                    return getMainConstitutionString(row);
                }
            }, {
                field: 'IS_PREFER_NORMAL_CONSTITUTION',
                title: '倾向体质',
                align: 'center',
                formatter: function (val,row) {
                    return getPreferConstitutionString(row);
                }
            }, {
                field: 'TCM_HEALTH_GUIDANCE_NAME',
                title: '保健指导',
                align: 'center'
            }, {
                field: 'ASSESS_DOCTOR',
                title: '评估医生',
                align: 'center'
            }]
        };

        function getResidentTCMConstitutionList(param, successFunction, failedFunction) {
            ResidentArchives.getResidentTCMConstitutionList(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function () {
                        successFunction(res.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取中医体质辨识列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取中医体质辨识列表信息失败");
                    failedFunction();
                });
        }

        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('diabetesBloodGlucoseEditCtrl', diabetesBloodGlucoseEditCtrl);
diabetesBloodGlucoseEditCtrl.$inject = ['$rootScope', '$state', '$filter', 'diabetesBloodGlucoseRecordService'];
function diabetesBloodGlucoseEditCtrl($rootScope, $state, $filter, diabetesBloodGlucoseRecordService) {
    var vm = this;
    vm.isEdit = true;
    vm.delectable = true;

    function getDetailById() {
        diabetesBloodGlucoseRecordService.getDetailById({
            "BLOOD_GLUCOSE_RECORD_KEY_ID": $state.params.RECORD_KEY_ID
        }, function(res) {
            vm.FASTING_BLOOD_GLUCOSE = res.FASTING_BLOOD_GLUCOSE;
            vm.POSTPRANDIAL_BLOOD_GLUCOSE = res.POSTPRANDIAL_BLOOD_GLUCOSE;
            vm.MEASURE_DATE = new Date(res.MEASURE_DATE);
            vm.recordDoctor = res.MEASURE_DOCTOR;
            vm.MEASURE_TYPE_NAME = res.MEASURE_TYPE_NAME;
        });
    }

    function init() {
        judgePage();
        getDetailById();
    }

    vm.saveBloodGlucose = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }

        var param={
            "BLOOD_GLUCOSE_RECORD_KEY_ID": $state.params.RECORD_KEY_ID,
            "DIABETES_RECORD_KEY_ID": $state.params.DIABETES_RECORD_KEY_ID,
            "FASTING_BLOOD_GLUCOSE": vm.FASTING_BLOOD_GLUCOSE,
            "POSTPRANDIAL_BLOOD_GLUCOSE": vm.POSTPRANDIAL_BLOOD_GLUCOSE,
            "MEASURE_TYPE_CODE": vm.recordType.DICT_VALUE_CODE,
            "MEASURE_TYPE_NAME": vm.recordType.DICT_VALUE_NAME,
            "MEASURE_DATE": $filter('commonDate')(vm.MEASURE_DATE),
            "MEASURE_DOCTOR": vm.recordDoctor? vm.recordDoctor: null
        };
        diabetesBloodGlucoseRecordService.editBloodGlucose(param, function (response) {
            $rootScope.handleMessage(
                response,
                function () {
                    $rootScope.alertDialog('保存成功');
                    $state.go(vm.statePre + 'bloodGlucoseList', {
                        RESIDENT_KEY_ID: $state.params.RESIDENT_KEY_ID,
                        DIABETES_RECORD_KEY_ID : $state.params.DIABETES_RECORD_KEY_ID
                    });
                },
                function () {
                    $rootScope.alertDialog('保存失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('保存失败');
        });

    };

    vm.changeType=function () {
        if(vm.recordType.DICT_VALUE_CODE==='0027000040'){
            vm.recordDoctor='';
        }
    };

    vm.returnBack=function (form) {
        if(form.$dirty){
            $rootScope.confirmDialog(
                '是否放弃已经编辑的内容?',
                function () {
                    vm.isEdit = true;
                    getDetailById();
                },
                function () {

                }
            );
        }else{
            vm.isEdit = true;
        }
    };

    vm.goBack=function () {
        $state.go(vm.statePre + 'bloodGlucoseList', {
            RESIDENT_KEY_ID: $state.params.RESIDENT_KEY_ID,
            DIABETES_RECORD_KEY_ID : $state.params.DIABETES_RECORD_KEY_ID
        });
    };

    vm.editBloodGlucose = function (form) {
        vm.isEdit = false;
        form.$setPristine();
        form.$setUntouched();
    };

    function judgePage() {
        if($rootScope.isContains($state.current.name,'main.special')){
            vm.statePre ='main.special.diabetesSidebar.detail.';
        }else if($rootScope.isContains($state.current.name,'main.resident')){
            vm.statePre ='main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.';
        }
    }

    init();
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('diabetesBloodGlucoseListCtrl', diabetesBloodGlucoseListCtrl);
diabetesBloodGlucoseListCtrl.$inject = ['$rootScope', '$state', 'diabetesBloodGlucoseRecordService'];
function diabetesBloodGlucoseListCtrl($rootScope, $state, diabetesBloodGlucoseRecordService) {
    var vm = this;
    vm.addRecord=function () {
        $state.go(vm.statePre + 'bloodGlucoseAdd',{
            RESIDENT_KEY_ID: $state.params.RESIDENT_KEY_ID,
            DIABETES_RECORD_KEY_ID: $state.params.DIABETES_RECORD_KEY_ID
        });
    };

    vm.showReport=function () {
        $state.go(vm.statePre + 'bloodGlucoseReport',{
            RESIDENT_KEY_ID: $state.params.RESIDENT_KEY_ID,
            DIABETES_RECORD_KEY_ID: $state.params.DIABETES_RECORD_KEY_ID
        });
    };

    function init() {
        judgePage();
        diabetesBloodGlucoseRecordService.getBloodGlucoseList(vm, {
            DIABETES_RECORD_KEY_ID: $state.params.DIABETES_RECORD_KEY_ID
        }, vm.statePre);
    }
    function judgePage() {
        if($rootScope.isContains($state.current.name,'main.special')){
            vm.statePre ='main.special.diabetesSidebar.detail.';
        }else if($rootScope.isContains($state.current.name,'main.resident')){
            vm.statePre ='main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.';
        }
    }
    init();
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('diabetesBloodGlucoseReportCtrl', diabetesBloodGlucoseReportCtrl);
diabetesBloodGlucoseReportCtrl.$inject = ['$rootScope', '$state', 'diabetesBloodGlucoseRecordService'];
function diabetesBloodGlucoseReportCtrl($rootScope, $state, diabetesBloodGlucoseRecordService) {
    var vm = this;
    vm.returnBack=function () {
        $state.go(vm.statePre + 'bloodGlucoseList', {
            RESIDENT_KEY_ID: $state.params.RESIDENT_KEY_ID,
            DIABETES_RECORD_KEY_ID : $state.params.DIABETES_RECORD_KEY_ID
        });
    };

    function init() {
        judgePage();
        diabetesBloodGlucoseRecordService.getBloodGlucoseCurveList({
            "DIABETES_RECORD_KEY_ID": $state.params.DIABETES_RECORD_KEY_ID,
            "RESIDENT_KEY_ID": $state.params.RESIDENT_KEY_ID
        }, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    initReport(data);
                },
                function () {
                    $rootScope.alertDialog('获取血糖曲线信息失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取血糖曲线信息失败');
        });
    };

    function initReport(bloodGlucoseData) {

        var timeList = [];
        var fastingList = [];
        var postprandialList = [];
        for(var i = 0; i < bloodGlucoseData.length; i++){
            timeList.push(bloodGlucoseData[i].MEASURE_DATE);
            fastingList.push(bloodGlucoseData[i].FASTING_BLOOD_GLUCOSE);
            postprandialList.push(bloodGlucoseData[i].POSTPRANDIAL_BLOOD_GLUCOSE);
        }

        vm.reportData={
            tooltip : {
                trigger: 'axis',
                formatter:function (a) {
                    if (!a || a.length==null || a.length===0 || a[0].name==="") {
                        return;
                    }
                    return [
                        "<div><span>" + a[0].name + "</span><br/>",
                        "<span>" + a[0].seriesName + ":" + a[0].value + "mmol/L</span><br/>",
                        "<span>" + a[1].seriesName + ":" + a[1].value + "mmol/L</span><br/>",
                        "<span>空腹血糖低值：3.9mmol/L</span><br/>",
                        "<span>空腹血糖高值：6.1mmol/L</span><br/>",
                        "<span>餐后血糖正常值：7.8mmol/L</span><br/>",
                        "<span>餐后血糖高值：11.1mmol/L</span>"
                    ].join('');
                }
            },
            legend: {
                data:['空腹血糖曲线','餐后血糖曲线']
            },
            grid: {
                left: '8%',
                right: '18%',
                bottom: '5%',
                containLabel: true
            },
            xAxis : [
                {
                    type : 'category',
                    axisLabel:{
                        interval:0,
                        rotate: 30
                    },
                    boundaryGap : false,
                    data : timeList
                }
            ],
            yAxis : [
                {
                    type : 'value'
                }
            ],
            series : [{
                name:'空腹血糖曲线',
                type:'line',
                symbol:'emptyRect',
                symbolSize:6,
                connectNulls:true,
                markLine:{
                    symbol:'none',
                    label:{
                        normal:{
                            show:true,
                            formatter:'{b}'
                        }
                    },
                    data:[{
                        name:'空腹血糖低值',
                        yAxis:3.9
                    },{
                        name:'空腹血糖高值',
                        yAxis:6.1
                    }]
                },
                data:fastingList
            },{
                name:'餐后血糖曲线',
                type:'line',
                symbol:'emptyRect',
                symbolSize:6,
                connectNulls:true,
                markLine:{
                    symbol:'none',
                    label:{
                        normal:{
                            show:true,
                            formatter:'{b}'
                        }
                    },
                    data:[{
                        name:'餐后血糖正常值',
                        yAxis:7.8
                    },{
                        name:'餐后血糖高值',
                        yAxis:11.1
                    }]
                },
                data:postprandialList
            },  {
                name:'空腹血糖低值',
                type:'line',
                symbol:'none',
                data: [3.9]
            }, {
                name:'空腹血糖高值',
                type:'line',
                symbol:'none',
                data: [6.1]
            }, {
                name:'餐后血糖正常值',
                type:'line',
                symbol:'none',
                data: [7.8]
            }, {
                name:'餐后血糖高值',
                type:'line',
                symbol:'none',
                data: [11.1]
            }]
        };
    }
    function judgePage() {
        if($rootScope.isContains($state.current.name,'main.special')){
            vm.statePre ='main.special.diabetesSidebar.detail.';
        }else if($rootScope.isContains($state.current.name,'main.resident')){
            vm.statePre ='main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.';
        }
    }

    init();
    return vm;
}
"use strict";
SMS.CONTROLLERS.service('diabetesBloodGlucoseRecordService', diabetesBloodGlucoseRecordService);
diabetesBloodGlucoseRecordService.$inject = ['Diabetes','bootstrapTable','$rootScope', '$state'];
function diabetesBloodGlucoseRecordService(Diabetes, bootstrapTable, $rootScope, $state) {
    var vm = this;
    vm.getBloodGlucoseList = function ($vm, params, toStatePre) {
        var list = {
            dataFunction: getList,
            dataParams: params,
            columns: [{
                field: 'MEASURE_DATE',
                title: '测量日期',
                align: 'center',
                width: 298,
                formatter: function (val) {
                    return "<div  style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click div': function (e,value, row) {
                        if (row.MEASURE_TYPE_CODE === '0027000010') { //随访测量
                            $state.go(toStatePre + 'followupEdit', {
                                RESIDENT_KEY_ID: $state.params.RESIDENT_KEY_ID,
                                DIABETES_RECORD_KEY_ID: $state.params.DIABETES_RECORD_KEY_ID,
                                FOLLOW_UP_RECORD_KEY_ID: row.RECORD_KEY_ID
                            });
                        } else if(row.MEASURE_TYPE_CODE==="0027000060"){//体检测量
                            if(toStatePre === "main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail."){
                                $state.go('main.resident.residentArchivesSidebar.detail.physicalExaminationEdit', {
                                    "RESIDENT_KEY_ID": $state.params.RESIDENT_KEY_ID,
                                    "RESIDENT_ID_NO": row.RESIDENT_ID_NO,
                                    "PHYSICAL_RECORD_KEY_ID": row.RECORD_KEY_ID
                                });
                            }else{
                                $state.go('main.physicalExaminationEdit', {
                                    "RESIDENT_KEY_ID": $state.params.RESIDENT_KEY_ID,
                                    "RESIDENT_ID_NO": row.RESIDENT_ID_NO,
                                    "PHYSICAL_RECORD_KEY_ID": row.RECORD_KEY_ID
                                });
                            }
                        } else {
                            $state.go(toStatePre + 'bloodGlucoseEdit', {
                                RESIDENT_KEY_ID: $state.params.RESIDENT_KEY_ID,
                                DIABETES_RECORD_KEY_ID: $state.params.DIABETES_RECORD_KEY_ID,
                                RECORD_KEY_ID: row.RECORD_KEY_ID
                            });
                        }
                    }
                }
            }, {
                field: 'FASTING_BLOOD_GLUCOSE',
                title: '空腹血糖(mmol/L)',
                width: 238,
                align: 'center'
            }, {
                field: 'POSTPRANDIAL_BLOOD_GLUCOSE',
                title: '餐后血糖(mmol/L)',
                width: 366,
                align: 'center'
            }, {
                field: 'MEASURE_TYPE_NAME',
                title: '测量类型',
                width: 298,
                align: 'center'
            }, {
                field: 'MEASURE_DOCTOR',
                title: '测量医生',
                width: 298,
                align: 'center',
                formatter:function (val) {
                    return val ? val: '-';
                }
            }]
        };

        function getList(param, successFunction, failedFunction) {
            Diabetes.getBloodGlucoseList(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function (data) {
                        successFunction(data || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.bloodGlucoseTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };
    

    vm.createBloodGlucose = function (param, successFunction, failedFunction) {
        Diabetes.createBloodGlucose(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getBloodGlucoseCurveList = function (param, successFunction, failedFunction) {
        Diabetes.getBloodGlucoseCurveList(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getDetailById = function(params, okFun) {
        Diabetes.getDetailById(JSON.stringify(params)).$promise
            .then(function (res) {
                $rootScope.handleMessage(res, function (data) {
                    okFun(data || {});
                }, function () {
                    $rootScope.alertDialog("获取血糖信息失败");
                });
            }, function () {
                $rootScope.alertDialog("获取血糖信息失败");
            });
    };

    vm.editBloodGlucose = function (param, successFunction, failedFunction) {
        Diabetes.editBloodGlucose(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('diabetesFollowupEditCtrl', diabetesFollowupEditCtrl);
diabetesFollowupEditCtrl.$inject = ['$rootScope', '$state', '$stateParams', 'diabetesFollowupRecordService', 'SessionStorage'];
function diabetesFollowupEditCtrl($rootScope, $state, $stateParams, diabetesFollowupRecordService, SessionStorage) {
    var vm = this;

    vm.editable = false;
    var RESIDENT_KEY_ID = $stateParams.RESIDENT_KEY_ID;
    var DIABETES_RECORD_KEY_ID = $stateParams.DIABETES_RECORD_KEY_ID;
    var FOLLOW_UP_RECORD_KEY_ID = $stateParams.FOLLOW_UP_RECORD_KEY_ID;

    //特殊字符06
    var SPLIT_06 = "";

    judgePage();
    getFollowUpRecordInfo();
    //获取模版数据
    function getFollowUpRecordInfo() {
        diabetesFollowupRecordService.getFollowUpRecordInfo(
            {
                "SUITABLE_CROWD_CODE": "0020000020",
                "FOLLOW_UP_RECORD_KEY_ID": FOLLOW_UP_RECORD_KEY_ID
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        SPLIT_06 = data.SPLIT_06;
                        var result = handleData(data);
                        vm.templateInfo = result;
                        vm.TITLE_LIST = result.TITLE_LIST;
                        handleFieldValue(vm.TITLE_LIST);
                    },
                    function () {
                        $rootScope.alertDialog('随访模版信息获取失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('随访模版信息获取失败');
            }
        );
    }

    //对数据中的多选填空处理,加上一些默认值
    function handleData(data) {
        for (var i = 0; i < data.TITLE_LIST.length; i++) {
            for (var j = 0; j < data.TITLE_LIST[i].FIELD_LIST.length; j++) {
                if (data.TITLE_LIST[i].FIELD_LIST[j].FIELD_TYPE_CODE === '0022000070') {
                    for (var k = 0; k < data.TITLE_LIST[i].FIELD_LIST[j].FIELD_DETAILED_LIST.length; k++) {
                        var temp = data.TITLE_LIST[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT.split("");
                        var obj = [];
                        for (var m = 0; m < temp.length; m++) {
                            obj.push({
                                "TEMP_NAME": temp[m]
                            });
                        }
                        data.TITLE_LIST[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT = obj;
                    }
                }

                //随访医生默认填写当前帐号医生
                if(data.TITLE_LIST[i].FIELD_LIST[j].FIELD_TYPE_CODE === '0022000010' && data.TITLE_LIST[i].FIELD_LIST[j].SYSTEM_FIELD_CODE === '0010001'){
                    data.TITLE_LIST[i].FIELD_LIST[j].MODEL = SessionStorage.get('loginInfo').username;
                }

                //随访方式默认填写门诊
                if(data.TITLE_LIST[i].FIELD_LIST[j].FIELD_TYPE_CODE === '0022000050' && data.TITLE_LIST[i].FIELD_LIST[j].SYSTEM_FIELD_CODE === '0010002'){
                    data.TITLE_LIST[i].FIELD_LIST[j].MODEL = data.TITLE_LIST[i].FIELD_LIST[j].FIELD_DETAILED_LIST[0];
                }

                //随访日期默认选择今日日期, 下次随访日期默认填写3个月后的日期
                if(data.TITLE_LIST[i].FIELD_LIST[j].FIELD_TYPE_CODE === '0022000030' && data.TITLE_LIST[i].FIELD_LIST[j].SYSTEM_FIELD_CODE === '0010003'){
                    data.TITLE_LIST[i].FIELD_LIST[j].MODEL = new Date();
                }
                if(data.TITLE_LIST[i].FIELD_LIST[j].FIELD_TYPE_CODE === '0022000030' && data.TITLE_LIST[i].FIELD_LIST[j].SYSTEM_FIELD_CODE === '0010004'){
                    var a = new Date();
                    a.setMonth(a.getMonth()+3);
                    data.TITLE_LIST[i].FIELD_LIST[j].MODEL = a;
                }
            }
        }

        return data;
    }

    vm.calculateBMI = function (SYSTEM_FIELD_CODE) {
        if(SYSTEM_FIELD_CODE === "0010007"){//身高
            doCount("0010007", "0010008", "0010010");
        }else if(SYSTEM_FIELD_CODE === "0010008"){//体重
            doCount("0010007", "0010008", "0010010");
        }else if(SYSTEM_FIELD_CODE === "0010009"){//下次预期体重
            doCount("0010007", "0010009", "0010011");
        }else{
            return;
        }
    };

    function doCount(height_code, weight_code, bmi_code) {
        var height = getModelValue(vm.templateInfo, height_code);
        if(height === null || height === undefined){
            return;
        }

        var weight = getModelValue(vm.templateInfo, weight_code);
        if(weight === null || weight === undefined){
            return;
        }

        var temp1 = (weight/height/height*100000).toFixed(0);
        var temp2 = parseInt(temp1)/10;
        setModelValue(vm.templateInfo, bmi_code, temp2);
    }

    function getModelValue(data, code) {
        for (var i = 0; i < data.TITLE_LIST.length; i++) {
            for (var j = 0; j < data.TITLE_LIST[i].FIELD_LIST.length; j++) {
                //数字类型
                if (data.TITLE_LIST[i].FIELD_LIST[j].FIELD_TYPE_CODE === '0022000020' && data.TITLE_LIST[i].FIELD_LIST[j].SYSTEM_FIELD_CODE === code) {
                    return data.TITLE_LIST[i].FIELD_LIST[j].MODEL;
                }
            }
        }
        return undefined;
    }

    function setModelValue(data, code, value) {
        for (var i = 0; i < data.TITLE_LIST.length; i++) {
            for (var j = 0; j < data.TITLE_LIST[i].FIELD_LIST.length; j++) {
                //数字类型
                if (data.TITLE_LIST[i].FIELD_LIST[j].FIELD_TYPE_CODE === '0022000020' && data.TITLE_LIST[i].FIELD_LIST[j].SYSTEM_FIELD_CODE === code) {
                    data.TITLE_LIST[i].FIELD_LIST[j].MODEL = value;
                }
            }
        }
    }

    vm.toggle = function (item, obj, form) {
        if (obj.MODEL === undefined) {
            obj.MODEL = [];
        }
        var idx = obj.MODEL.indexOf(item);
        if (idx > -1) {
            obj.MODEL.splice(idx, 1);
        }
        else {
            obj.MODEL.push(item);
        }
        form.$dirty = true;
    };

    vm.exists = function (item, obj) {
        if (obj.MODEL === undefined) {
            obj.MODEL = [];
        }
        return obj.MODEL.indexOf(item) > -1;
    };

    //给每个字段赋值
    function handleFieldValue(data) {
        for(var i = 0; i < data.length; i++){
            for(var j = 0; j < data[i].FIELD_LIST.length; j++){
                //文本
                if(data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000010"){
                    if(data[i].FIELD_LIST[j].FIELD_VALUE === "" || data[i].FIELD_LIST[j].FIELD_VALUE === undefined){
                        data[i].FIELD_LIST[j].MODEL = undefined;
                    }else {
                        data[i].FIELD_LIST[j].MODEL = data[i].FIELD_LIST[j].FIELD_VALUE;
                    }
                }
                //数字
                if(data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000020"){
                    if(data[i].FIELD_LIST[j].FIELD_VALUE === "" || data[i].FIELD_LIST[j].FIELD_VALUE === undefined){
                        data[i].FIELD_LIST[j].MODEL = undefined;
                    }else {
                        data[i].FIELD_LIST[j].MODEL = +data[i].FIELD_LIST[j].FIELD_VALUE;
                    }
                }
                //日期
                if(data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000030"){
                    if(data[i].FIELD_LIST[j].FIELD_VALUE === "" || data[i].FIELD_LIST[j].FIELD_VALUE === undefined){
                        data[i].FIELD_LIST[j].MODEL = undefined;
                    }else {
                        data[i].FIELD_LIST[j].MODEL = new Date(data[i].FIELD_LIST[j].FIELD_VALUE);
                    }
                }
                //按钮单选、下拉单选
                if(data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000040" || data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000050"){
                    if(data[i].FIELD_LIST[j].FIELD_VALUE === "" || data[i].FIELD_LIST[j].FIELD_VALUE === undefined){
                        data[i].FIELD_LIST[j].MODEL = undefined;
                    }else{
                        data[i].FIELD_LIST[j].MODEL = $rootScope.selectItem(data[i].FIELD_LIST[j].FIELD_DETAILED_LIST, "FIELD_DETAILED_KEY_ID", parseInt(data[i].FIELD_LIST[j].FIELD_VALUE));
                        if(data[i].FIELD_LIST[j].FIELD_ADDITIONAL_VALUE !== ""){
                            data[i].FIELD_LIST[j].MODEL.MODEL = data[i].FIELD_LIST[j].FIELD_ADDITIONAL_VALUE;
                        }
                    }
                }
                //多选
                if(data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000060"){
                    if(data[i].FIELD_LIST[j].FIELD_VALUE === "" || data[i].FIELD_LIST[j].FIELD_VALUE === undefined){
                        data[i].FIELD_LIST[j].MODEL = undefined;
                    }else{
                        data[i].FIELD_LIST[j].FIELD_VALUE = data[i].FIELD_LIST[j].FIELD_VALUE.split(SPLIT_06);
                        data[i].FIELD_LIST[j].FIELD_ADDITIONAL_VALUE = data[i].FIELD_LIST[j].FIELD_ADDITIONAL_VALUE ? data[i].FIELD_LIST[j].FIELD_ADDITIONAL_VALUE.split(SPLIT_06) : "";
                        data[i].FIELD_LIST[j].MODEL = [];
                        data[i].FIELD_LIST[j].VIEW_VALUE = '';
                        for(var k = 0; k < data[i].FIELD_LIST[j].FIELD_VALUE.length; k++){
                            var tmp = $rootScope.selectItem(data[i].FIELD_LIST[j].FIELD_DETAILED_LIST, "FIELD_DETAILED_KEY_ID", parseInt(data[i].FIELD_LIST[j].FIELD_VALUE[k]));
                            if(tmp.IS_HAS_TEXT_SUFFIX === 1){
                                tmp.MODEL = data[i].FIELD_LIST[j].FIELD_ADDITIONAL_VALUE[k];
                            }
                            data[i].FIELD_LIST[j].MODEL.push(tmp);
                        }
                        for(var m = 0; m < data[i].FIELD_LIST[j].MODEL.length; m++){
                            if(m === 0){
                                if(data[i].FIELD_LIST[j].MODEL[m].MODEL !== undefined){
                                    data[i].FIELD_LIST[j].VIEW_VALUE += (data[i].FIELD_LIST[j].MODEL[m].FIELD_DETAILED_CONTENT + ":" + data[i].FIELD_LIST[j].MODEL[m].MODEL);
                                }else{
                                    data[i].FIELD_LIST[j].VIEW_VALUE += data[i].FIELD_LIST[j].MODEL[m].FIELD_DETAILED_CONTENT;
                                }
                            }else{
                                if(data[i].FIELD_LIST[j].MODEL[m].MODEL !== undefined){
                                    data[i].FIELD_LIST[j].VIEW_VALUE += (";" + data[i].FIELD_LIST[j].MODEL[m].FIELD_DETAILED_CONTENT + ":" + data[i].FIELD_LIST[j].MODEL[m].MODEL);
                                }else{
                                    data[i].FIELD_LIST[j].VIEW_VALUE += (";" + data[i].FIELD_LIST[j].MODEL[m].FIELD_DETAILED_CONTENT);
                                }
                            }
                        }
                    }
                }
                //多项填空
                if(data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000070"){
                    for(var k = 0; k < data[i].FIELD_LIST[j].FIELD_VALUE_DETAILED_LIST.length; k++){
                        for(var m = 0;  m < data[i].FIELD_LIST[j].FIELD_VALUE_DETAILED_LIST[k].FIELD_VALUE_DETAIL_LIST.length; m++){
                            data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT[m].MODEL = data[i].FIELD_LIST[j].FIELD_VALUE_DETAILED_LIST[k].FIELD_VALUE_DETAIL_LIST[m];
                        }
                    }
                }
            }
        }
    }

    //按钮事件
    vm.delete = function () {
        $rootScope.confirmDialog(
            "您确定要删除该随访记录吗?",
            function () {
                diabetesFollowupRecordService.deleteFollowUpRecordCascaded(
                    {
                        "FOLLOW_UP_RECORD_KEY_ID": FOLLOW_UP_RECORD_KEY_ID
                    },
                    function (response) {
                        $rootScope.handleMessage(
                            response,
                            function () {
                                $rootScope.back();
                            },
                            function () {
                                $rootScope.alertDialog('删除随访失败');
                            }
                        );
                    },
                    function () {
                        $rootScope.alertDialog('删除随访失败');
                    }
                );
            },
            function () {

            }
        );
    };
    
    vm.goBack=function () {
        $state.go(vm.statePre + 'followupList', {
            RESIDENT_KEY_ID: $state.params.RESIDENT_KEY_ID,
            DIABETES_RECORD_KEY_ID : $state.params.DIABETES_RECORD_KEY_ID
        });
    };
    
    vm.edit = function () {
        vm.editable = true;
    };

    vm.cancel = function (form) {
        if(form.$dirty){
            $rootScope.confirmDialog(
                '是否放弃已经编辑的内容',
                function () {
                    vm.editable = false;
                    getFollowUpRecordInfo();
                    form.$dirty = false;
                },
                function () {

                });
        }else{
            vm.editable = false;
            getFollowUpRecordInfo();
            form.$dirty = false;
        }
    };

    vm.save = function () {
        //判断必答和生成数据
        var data = diabetesFollowupRecordService.getSaveData(vm.TITLE_LIST);
        if(data ===  undefined){
            return;
        }

        diabetesFollowupRecordService.editFollowUpRecord(
            {
                "RESIDENT_KEY_ID": RESIDENT_KEY_ID,
                "FOLLOW_UP_RECORD_KEY_ID": FOLLOW_UP_RECORD_KEY_ID,
                "FIELD_VALUE_LIST": data
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        getFollowUpRecordInfo();
                        vm.editable = false;
                    },
                    function () {
                        $rootScope.alertDialog('编辑随访失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('编辑随访失败');
            }
        );
    };

    function judgePage() {
        if($rootScope.isContains($state.current.name,'main.special')){
            vm.statePre ='main.special.diabetesSidebar.detail.';
        }else if($rootScope.isContains($state.current.name,'main.resident')){
            vm.statePre ='main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.';
        }
    }
    
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('diabetesFollowupListCtrl', diabetesFollowupListCtrl);
diabetesFollowupListCtrl.$inject = ['$rootScope', '$state', '$stateParams', 'diabetesFollowupRecordService'];
function diabetesFollowupListCtrl($rootScope, $state, $stateParams, diabetesFollowupRecordService) {
    var vm = this;

    judgePage();
    diabetesFollowupRecordService.showTable(vm, {"DIABETES_RECORD_KEY_ID": $stateParams.DIABETES_RECORD_KEY_ID}, $state , vm.statePre + 'followupEdit');
    
    vm.createFollowUpRecord = function () {
        $state.go(vm.statePre + "followupAdd", {
            "RESIDENT_KEY_ID": $stateParams.RESIDENT_KEY_ID,
            "DIABETES_RECORD_KEY_ID": $stateParams.DIABETES_RECORD_KEY_ID
        });
    };

    function judgePage() {
        if($rootScope.isContains($state.current.name,'main.special')){
            vm.statePre ='main.special.diabetesSidebar.detail.';
        }else if($rootScope.isContains($state.current.name,'main.resident')){
            vm.statePre ='main.resident.residentArchivesSidebar.detail.diabetesHeadBar.detail.';
        }
    }
    
    return vm;
}
"use strict";
SMS.CONTROLLERS.service('diabetesFollowupRecordService', diabetesFollowupRecordService);
diabetesFollowupRecordService.$inject = ['$rootScope', '$state', 'Diabetes', 'bootstrapTable'];
function diabetesFollowupRecordService($rootScope, $state, Diabetes, bootstrapTable) {
    var vm = this;

    vm.showTable = function ($vm, params, $state, toState) {
        var list = {
            dataFunction: ajaxRequest,
            dataParams: params,
            columns: [{
                field: 'FOLLOW_UP_DATE',
                title: '随访日期',
                align: 'center',
                valign: 'middle',
                formatter: dateFormat,
                events: {
                    'click .flag': function (e, value, row) {
                        $state.go(toState, {
                            "RESIDENT_KEY_ID": $state.params.RESIDENT_KEY_ID,
                            "DIABETES_RECORD_KEY_ID": $state.params.DIABETES_RECORD_KEY_ID,
                            "FOLLOW_UP_RECORD_KEY_ID": row.FOLLOW_UP_RECORD_KEY_ID
                        });
                    }
                }
            }, {
                field: 'FASTING_GLUCOSE',
                title: '空腹血糖(mmol/L)',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'POSTPRANDIAL_GLUCOSE',
                title: '餐后血糖(mmol/L)',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'FOLLOW_UP_TYPE',
                title: '随访方式',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'FOLLOW_UP_CLASSIFICATION',
                title: '随访结果',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'FOLLOW_UP_DOCTOR',
                title: '随访医生',
                align: 'center',
                valign: 'middle',
                formatter:function (val) {
                    return val ? val: '-';
                }
            }]
        };
        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };

        function dateFormat(value) {
            return '<div class="flag" style="color: #428bca">' + value + '</div>';
        }

        return $vm;
    };

    function ajaxRequest(params, successFunction, failedFunction) {
        Diabetes.getFollowUpRecordList(JSON.stringify(params)).$promise
            .then(function (response) {
                $rootScope.handleMessage(response, function () {
                    successFunction(response.value || {total: 0, rows: []});
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                });
            }, function () {
                $rootScope.alertDialog("获取列表信息失败");
                failedFunction();
            });
    }

    vm.getFollowUpRecordInfo = function (param, successFunction, failedFunction) {
        Diabetes.getFollowUpRecordInfo(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.createFollowUpRecord = function (param, successFunction, failedFunction) {
        Diabetes.createFollowUpRecord(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.editFollowUpRecord = function (param, successFunction, failedFunction) {
        Diabetes.editFollowUpRecord(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.deleteFollowUpRecordCascaded = function (param, successFunction, failedFunction) {
        Diabetes.deleteFollowUpRecordCascaded(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getSaveData = function (data) {
        var result = [];
        //小标题层
        for (var i = 0; i < data.length; i++) {
            //具体字段
            for (var j = 0; j < data[i].FIELD_LIST.length; j++) {
                //文本
                if (data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000010") {
                    if (data[i].FIELD_LIST[j].IS_REQUIRED === 1 && data[i].FIELD_LIST[j].MODEL === undefined) {
                        $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                        return undefined;
                    }else {
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL || "",
                            "FIELD_ADDITIONAL_VALUE": "",
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    }
                }
                //数字
                if (data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000020") {
                    if (data[i].FIELD_LIST[j].IS_REQUIRED === 1 && data[i].FIELD_LIST[j].MODEL === undefined) {
                        $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                        return undefined;
                    }else {
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL === undefined ? "" :  data[i].FIELD_LIST[j].MODEL,
                            "FIELD_ADDITIONAL_VALUE": "",
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    }
                }
                //日期
                if (data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000030") {
                    if (data[i].FIELD_LIST[j].IS_REQUIRED === 1 && data[i].FIELD_LIST[j].MODEL === undefined) {
                        $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                        return undefined;
                    }else {
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL ? $filter('commonDate')(data[i].FIELD_LIST[j].MODEL) : "",
                            "FIELD_ADDITIONAL_VALUE": "",
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    }
                }
                //按钮单选
                if (data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000040") {
                    if (data[i].FIELD_LIST[j].IS_REQUIRED === 1 && data[i].FIELD_LIST[j].MODEL === undefined) {
                        $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                        return undefined;
                    }else if(data[i].FIELD_LIST[j].MODEL === undefined) {
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_VALUE": '',
                            "FIELD_ADDITIONAL_VALUE": "",
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_VALUE_LIST": [
                                {
                                    "FIELD_VALUE": "",
                                    "FIELD_ADDITIONAL_VALUE": "",
                                    "FIELD_VALUE_ORDER": ""
                                }
                            ],
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_CN": "",
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    }else{
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL.FIELD_DETAILED_KEY_ID,
                            "FIELD_ADDITIONAL_VALUE": data[i].FIELD_LIST[j].MODEL.MODEL ? data[i].FIELD_LIST[j].MODEL.MODEL : "",
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_VALUE_LIST": [
                                {
                                    "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL.FIELD_DETAILED_KEY_ID,
                                    "FIELD_ADDITIONAL_VALUE": data[i].FIELD_LIST[j].MODEL.MODEL ? data[i].FIELD_LIST[j].MODEL.MODEL : "",
                                    "FIELD_VALUE_ORDER": data[i].FIELD_LIST[j].MODEL.FIELD_DETAILED_ORDER
                                }
                            ],
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_CN": data[i].FIELD_LIST[j].MODEL.FIELD_DETAILED_CONTENT,
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    }
                }
                //下拉单选
                if (data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000050") {
                    if (data[i].FIELD_LIST[j].IS_REQUIRED === 1 && data[i].FIELD_LIST[j].MODEL === undefined) {
                        $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                        return undefined;
                    }else {
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL ? data[i].FIELD_LIST[j].MODEL.FIELD_DETAILED_KEY_ID : "",
                            "FIELD_ADDITIONAL_VALUE": "",
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_VALUE_LIST": [
                                {
                                    "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL.FIELD_DETAILED_KEY_ID,
                                    "FIELD_ADDITIONAL_VALUE": "",
                                    "FIELD_VALUE_ORDER": data[i].FIELD_LIST[j].MODEL.FIELD_DETAILED_ORDER
                                }
                            ],
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    }
                }
                //多选
                if (data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000060") {
                    if (data[i].FIELD_LIST[j].IS_REQUIRED === 1 && data[i].FIELD_LIST[j].MODEL === undefined) {
                        $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                        return undefined;
                    } else if (data[i].FIELD_LIST[j].MODEL === undefined) {
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_VALUE_LIST": [
                                {
                                    "FIELD_VALUE": "",
                                    "FIELD_ADDITIONAL_VALUE": "",
                                    "FIELD_VALUE_ORDER": ""
                                }
                            ],
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    } else {
                        var temp = [];
                        for(var k = 0; k < data[i].FIELD_LIST[j].MODEL.length; k++){
                            temp.push({
                                "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL[k].FIELD_DETAILED_KEY_ID,
                                "FIELD_ADDITIONAL_VALUE": data[i].FIELD_LIST[j].MODEL[k].MODEL || "",
                                "FIELD_VALUE_ORDER": data[i].FIELD_LIST[j].MODEL[k].FIELD_DETAILED_ORDER
                            });
                        }
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_VALUE_LIST": temp,
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    }
                }
                //多项填空
                if (data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000070") {
                    var temp1 = [];
                    for(var k = 0; k < data[i].FIELD_LIST[j].FIELD_DETAILED_LIST.length; k++){
                        var temp2 = {
                            "FIELD_VALUE_DETAIL_LIST": [],
                            "FIELD_VALUE_ORDER": data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_ORDER
                        };
                        if(data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].IS_HAS_TEXT_SUFFIX === 1){
                            for(var m = 0; m < data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT.length; m++){
                                if(data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT[m].MODEL === undefined && data[i].FIELD_LIST[j].IS_REQUIRED === 1){
                                    $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                                    return undefined;
                                }
                                temp2.FIELD_VALUE_DETAIL_LIST.push({
                                    "FIELD_VALUE": data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT[m].MODEL || ''
                                });
                            }
                        }else{
                            for(var m = 0; m < data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT.length - 1; m++){
                                if(data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT[m].MODEL === undefined && data[i].FIELD_LIST[j].IS_REQUIRED === 1){
                                    $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                                    return undefined;
                                }
                                temp2.FIELD_VALUE_DETAIL_LIST.push({
                                    "FIELD_VALUE": data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT[m].MODEL || ''
                                });
                            }
                        }
                        temp1.push(temp2);
                    }
                    result.push({
                        "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                        "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                        "FIELD_VALUE_LIST": temp1,
                        "FIELD_VALUE_ORDER": data[i].FIELD_LIST[j].TEMPLATE_FIELD_ORDER,
                        "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                        "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                        "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                        "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                    });
                }

            }
        }

        return result;
    };
    
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('hypertensionBloodPressureEditCtrl', hypertensionBloodPressureEditCtrl);
hypertensionBloodPressureEditCtrl.$inject = ['$rootScope', '$state','$stateParams', 'hypertensionBloodPressureService','$filter'];
function hypertensionBloodPressureEditCtrl($rootScope, $state,$stateParams, hypertensionBloodPressureService,$filter) {
    var vm = this;
    var lastData=null;
    vm.isEdit=true;
    vm.delectable=true;
    vm.pressureLevels= [{
        "DICT_VALUE_NAME": "血压正常",
        "DICT_VALUE_CODE": "0028000010"
    }, {
        "DICT_VALUE_NAME": "血压偏高",
        "DICT_VALUE_CODE": "0028000020"
    }, {
        "DICT_VALUE_NAME": "1级高血压",
        "DICT_VALUE_CODE": "0028000030"
    }, {
        "DICT_VALUE_NAME": "2级高血压",
        "DICT_VALUE_CODE": "0028000040"
    }, {
        "DICT_VALUE_NAME": "3级高血压",
        "DICT_VALUE_CODE": "0028000050"
    }];

    hypertensionBloodPressureService.getBloodPressureDetailById({
        BLOOD_PRESSURE_RECORD_KEY_ID:$stateParams.BLOOD_PRESSURE_RECORD_KEY_ID
    }, function (response) {
        $rootScope.handleMessage(
            response,
            function (data) {
                initBloodPressureRecord(data);
            },
            function () {
                $rootScope.alertDialog('获取血压记录信息失败！');
            }
        );
    }, function () {
        $rootScope.alertDialog('获取血压记录信息失败！');
    });

    vm.editBloodPressureRecord=function () {
        var param={
            "HYPERTENSION_RECORD_KEY_ID":$stateParams.HYPERTENSION_RECORD_KEY_ID,
            "SYSTOLIC_PRESSURE":vm.systolicPressure,
            "DIASTOLIC_PRESSURE":vm.diastolicPressure,
            "BLOOD_PRESSURE_GRADING_CODE":vm.pressureLevel.DICT_VALUE_CODE,
            "BLOOD_PRESSURE_GRADING_NAME":vm.pressureLevel.DICT_VALUE_NAME,
            "MEASURE_TYPE_CODE":vm.recordType.MEASURE_TYPE_CODE,
            "MEASURE_TYPE_NAME":vm.recordType.MEASURE_TYPE_NAME,
            "MEASURE_DATE":$filter('commonDate')(vm.recordDate),
            "MEASURE_DOCTOR":vm.recordDoctor,
            "BLOOD_PRESSURE_RECORD_KEY_ID":$stateParams.BLOOD_PRESSURE_RECORD_KEY_ID
        };
        hypertensionBloodPressureService.editBloodPressureRecord(param, function (response) {
            $rootScope.handleMessage(
                response,
                function () {
                    $rootScope.alertDialog('保存成功');
                },
                function () {
                    $rootScope.alertDialog('保存失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('保存失败');
        });
    };



    function initBloodPressureRecord(recordData) {
        lastData=recordData;
        // "HYPERTENSION_RECORD_KEY_ID":$stateParams.HYPERTENSION_RECORD_KEY_ID,
        //     "SYSTOLIC_PRESSURE":vm.systolicPressure,
        //     "":,
        //     "BLOOD_PRESSURE_GRADING_CODE":vm.pressureLevel.DICT_VALUE_CODE,
        //     "BLOOD_PRESSURE_GRADING_NAME":vm.pressureLevel.DICT_VALUE_NAME,
        //     "MEASURE_TYPE_CODE":vm.recordType.MEASURE_TYPE_CODE,
        //     "MEASURE_TYPE_NAME":vm.recordType.MEASURE_TYPE_NAME,
        //     "":,
        //     "":,
        //     "BLOOD_PRESSURE_RECORD_KEY_ID":$stateParams.BLOOD_PRESSURE_RECORD_KEY_ID



        vm.systolicPressure=recordData.SYSTOLIC_PRESSURE;
        vm.diastolicPressure=recordData.DIASTOLIC_PRESSURE;
        vm.recordDoctor=recordData.MEASURE_DOCTOR;
        vm.recordDate=new Date(recordData.MEASURE_DATE);
        vm.recordType=recordData.MEASURE_TYPE_NAME;
        for(var i=0;i<vm.pressureLevels.length;i++){
            if(vm.pressureLevels[i].DICT_VALUE_CODE===recordData.BLOOD_PRESSURE_GRADING_CODE){
                vm.pressureLevel=vm.pressureLevels[i];
                break;
            }
        }

    }

    vm.setPressureLevel=function () {
        if(vm.diastolicPressure===undefined || vm.systolicPressure===undefined){
            return;
        }

       
        if(vm.systolicPressure>=180  || vm.diastolicPressure>=110){
            vm.pressureLevel=vm.pressureLevels[4];
            return;
        }

        if((vm.systolicPressure>=160 && vm.systolicPressure<180 )|| (vm.diastolicPressure>=100 && vm.diastolicPressure<110)){
            vm.pressureLevel=vm.pressureLevels[3];
            return;
        }

        if((vm.systolicPressure>=140 && vm.systolicPressure<160) || (vm.diastolicPressure>=90 && vm.diastolicPressure<100)){
            vm.pressureLevel=vm.pressureLevels[2];
            return;
        }

        if((vm.systolicPressure>=120 && vm.systolicPressure<140 )||(vm.diastolicPressure>=80 && vm.diastolicPressure<90)){
            vm.pressureLevel=vm.pressureLevels[1];
            return;
        }

        if(vm.systolicPressure<120 && vm.diastolicPressure<80){
            vm.pressureLevel=vm.pressureLevels[0];
            return;
        }
    };

    vm.changeType=function () {
        if(vm.recordType.DICT_VALUE_CODE==='0027000040'){
            vm.recordDoctor='';
        }
    };

    vm.returnBack=function (form) {
        if(form.$dirty){
            $rootScope.confirmDialog(
                '是否放弃已经编辑的内容?',
                function () {
                    vm.recordType=vm.recordTypes[lastData.recordTypeNum];
                    vm.systolicPressure=lastData.SYSTOLIC_PRESSURE;
                    vm.diastolicPressure=lastData.DIASTOLIC_PRESSURE;
                    vm.recordDoctor=lastData.MEASURE_DOCTOR;
                    vm.recordDate=new Date(lastData.MEASURE_DATE);
                    vm.setPressureLevel();
                    vm.isEdit=true;
                },
                function () {

                }
            );
        }else{
            vm.isEdit=true;
        }
    };

    vm.saveBloodPressure = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }

        var param={
            "HYPERTENSION_RECORD_KEY_ID":$stateParams.HYPERTENSION_RECORD_KEY_ID,
            "BLOOD_PRESSURE_RECORD_KEY_ID":$stateParams.BLOOD_PRESSURE_RECORD_KEY_ID,
            "SYSTOLIC_PRESSURE":vm.systolicPressure,
            "DIASTOLIC_PRESSURE":vm.diastolicPressure,
            "BLOOD_PRESSURE_GRADING_CODE":vm.pressureLevel.DICT_VALUE_CODE,
            "BLOOD_PRESSURE_GRADING_NAME":vm.pressureLevel.DICT_VALUE_NAME,
            "MEASURE_TYPE_CODE":vm.recordType.DICT_VALUE_CODE,
            "MEASURE_TYPE_NAME":vm.recordType.DICT_VALUE_NAME,
            "MEASURE_DATE":$filter('commonDate')(vm.recordDate),
            "MEASURE_DOCTOR":vm.recordDoctor
        };
        hypertensionBloodPressureService.editBloodPressureRecord (param, function (response) {
            $rootScope.handleMessage(
                response,
                function () {
                    vm.isEdit=true;
                },
                function () {
                    $rootScope.alertDialog('保存失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('保存失败');
        });

    };

    vm.goBack=function () {
        $state.go(vm.statePre + 'bloodPressureList',{HYPERTENSION_RECORD_KEY_ID:$state.params.HYPERTENSION_RECORD_KEY_ID});
    };

    vm.editBloodPressure=function () {
      vm.isEdit=false;
    };

    vm.deleteBloodPressure=function () {
        $rootScope.confirmDialog(
            '是否删除本次血压测量记录?',
            function () {
                var param={
                    "BLOOD_PRESSURE_RECORD_KEY_ID":$stateParams.BLOOD_PRESSURE_RECORD_KEY_ID
                };
                hypertensionBloodPressureService.deleteBloodPressureRecord(param, function (response) {
                    $rootScope.handleMessage(
                        response,
                        function () {
                            $rootScope.alertDialog('删除成功');
                            $state.go(vm.statePre + 'bloodPressureList',{HYPERTENSION_RECORD_KEY_ID:$state.params.HYPERTENSION_RECORD_KEY_ID});
                        },
                        function () {
                            $rootScope.alertDialog('删除失败');
                        }
                    );
                }, function () {
                    $rootScope.alertDialog('删除失败');
                });
            },
            function () {

            }
        );
    };

    function judgePage() {
        if($rootScope.isContains($state.current.name,'main.special')){
            vm.statePre ='main.special.hypertensionSidebar.detail.';
        }else if($rootScope.isContains($state.current.name,'main.resident')){
            vm.statePre ='main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.';
        }
    }
    judgePage();
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('hypertensionBloodPressureListCtrl', hypertensionBloodPressureListCtrl);
hypertensionBloodPressureListCtrl.$inject = ['$rootScope', '$state', 'hypertensionBloodPressureService','$stateParams'];
function hypertensionBloodPressureListCtrl($rootScope, $state, hypertensionBloodPressureService,$stateParams) {
    var vm = this;
    
    vm.newRecord=function () {
      $state.go(vm.statePre + 'bloodPressureAdd',{
          HYPERTENSION_RECORD_KEY_ID:$stateParams.HYPERTENSION_RECORD_KEY_ID
      });  
    };
    
    vm.showBloodPressureReport=function () {
        $state.go(vm.statePre + 'bloodPressureReport',{
            HYPERTENSION_RECORD_KEY_ID:$stateParams.HYPERTENSION_RECORD_KEY_ID
        });
    };

    vm.bloodPressureTable=function(){
        hypertensionBloodPressureService.getBloodPressureList(vm,{
            HYPERTENSION_RECORD_KEY_ID:$stateParams.HYPERTENSION_RECORD_KEY_ID
        }, $state, vm.statePre);
    };
    judgePage();
    vm.bloodPressureTable();
    function judgePage() {
        if($rootScope.isContains($state.current.name,'main.special')){
            vm.statePre ='main.special.hypertensionSidebar.detail.';
        }else if($rootScope.isContains($state.current.name,'main.resident')){
            vm.statePre ='main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.';
        }
    }
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('hypertensionBloodPressureReportCtrl', hypertensionBloodPressureReportCtrl);
hypertensionBloodPressureReportCtrl.$inject = ['$rootScope', '$state', '$stateParams','hypertensionBloodPressureService'];
function hypertensionBloodPressureReportCtrl($rootScope, $state,$stateParams, hypertensionBloodPressureService) {
    var vm = this;

    vm.returnBack=function () {
      $state.go(vm.statePre + 'bloodPressureList',{
          "HYPERTENSION_RECORD_KEY_ID":$stateParams.HYPERTENSION_RECORD_KEY_ID
      });
    };
    
    function getBloodPressureCurveList() {
        hypertensionBloodPressureService.getBloodPressureCurveList({
            "HYPERTENSION_RECORD_KEY_ID":$stateParams.HYPERTENSION_RECORD_KEY_ID,
            "RESIDENT_KEY_ID": $state.params.RESIDENT_KEY_ID
        }, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    initReport(data);
                },
                function () {

                    $rootScope.alertDialog('获取血压曲线信息失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取血压曲线信息失败');
        });
    };

    function initReport(bloodPressureData) {
        var timeList=[];
        var systolicPressureList=[];
        var diastolicPressureList=[];


        for(var i=0;i<bloodPressureData.length;i++){
            timeList.push(bloodPressureData[i].MEASURE_DATE);
            systolicPressureList.push(bloodPressureData[i].SYSTOLIC_PRESSURE);
            diastolicPressureList.push(bloodPressureData[i].DIASTOLIC_PRESSURE);
        }

        vm.reportData={
            tooltip : {
                trigger: 'axis',
                formatter:function (a) {
                        if (!a || a.length==null || a.length===0 || a[0].name==='') {
                            return;
                        }
                        return "<div><span>" + a[0].name + "</span><br/><span>" + a[0].seriesName + ":" + a[0].value + "mmHg</span><br/><span>" + a[1].seriesName + ":" + a[1].value + "mmHg</span><br/><span>参考收缩压：140mmHg</span><br/><span>参考舒张压：90mmHg</span>";
                }
            },
            legend: {
                data:['收缩压','舒张压','参考收缩压','参考舒张压']
            },
            grid: {
                left: '6%',
                right: '13%',
                bottom: '5%',
                containLabel: true
            },
            xAxis : [
                {
                    type : 'category',
                    axisLabel:{
                        interval:0,
                        rotate: 30
                    },
                    boundaryGap : false,
                    data : timeList
                }
            ],
            yAxis : [
                {
                    type : 'value'
                }
            ],
            series : [
                {
                    name:'收缩压',
                    type:'line',
                    symbol:'emptyRect',
                    symbolSize:6,
                    markLine:{
                        symbol:'none',
                        label:{
                            normal:{
                                show:true,
                                formatter:'参考收缩压'
                            }
                        },
                        data:[{
                            name:'参考收缩压',
                            yAxis:140
                        }]
                    },
                    connectNulls:true,
                    data:systolicPressureList
                },
                {
                    name:'舒张压',
                    type:'line',
                    symbol:'emptyRect',
                    symbolSize:6,
                    markLine:{
                        symbol:'none',
                        label:{
                            normal:{
                                show:true,
                                formatter:'参考舒张压'
                            }
                        },
                        data:[{
                            name:'参考舒张压',
                            yAxis:90
                        }]
                    },
                    connectNulls:true,
                    data:diastolicPressureList
                },
                {
                    name:'参考收缩压',
                    type:'line',
                    symbol:'none',
                    symbolSize:6,
                    data:[140]
                },
                {
                    name:'参考舒张压',
                    type:'line',
                    symbol:'none',
                    symbolSize:6,
                    data:[90]
                }
            ]
        };
    }
    judgePage();
    getBloodPressureCurveList();
    function judgePage() {
        if($rootScope.isContains($state.current.name,'main.special')){
            vm.statePre ='main.special.hypertensionSidebar.detail.';
        }else if($rootScope.isContains($state.current.name,'main.resident')){
            vm.statePre ='main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.';
        }
    }

    return vm;
}
"use strict";
SMS.CONTROLLERS.service('hypertensionBloodPressureService', hypertensionBloodPressureService);
hypertensionBloodPressureService.$inject = ['Hypertension','bootstrapTable','$rootScope'];
function hypertensionBloodPressureService(Hypertension,bootstrapTable,$rootScope) {
    var vm = this;

    vm.getBloodPressureList = function ($vm, listPara, $state, toStatePre) {
        var list = {
            dataFunction: getList,
            dataParams: listPara,
            columns: [{
                field: 'MEASURE_DATE',
                title: '测量日期',
                align: 'center',
                width: 298,
                formatter: function (val) {
                    return "<div  style='color: #428bca;cursor: pointer;'>" + val + "</div>";
                },
                events: {
                    'click div': function (e,value, row) {
                        if(row.MEASURE_TYPE_CODE==="0027000010"){
                            $state.go(toStatePre+ 'followupEdit',{
                                "RESIDENT_KEY_ID":$state.params.RESIDENT_KEY_ID,
                                "HYPERTENSION_RECORD_KEY_ID":listPara.HYPERTENSION_RECORD_KEY_ID,
                                "FOLLOW_UP_RECORD_KEY_ID": row.RECORD_KEY_ID
                            });
                        }else if(row.MEASURE_TYPE_CODE==="0027000060"){//体检测量
                            if(toStatePre === "main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail."){
                                $state.go('main.resident.residentArchivesSidebar.detail.physicalExaminationEdit', {
                                    "RESIDENT_KEY_ID": $state.params.RESIDENT_KEY_ID,
                                    "RESIDENT_ID_NO": row.RESIDENT_ID_NO,
                                    "PHYSICAL_RECORD_KEY_ID": row.RECORD_KEY_ID
                                });
                            }else{
                                $state.go('main.physicalExaminationEdit', {
                                    "RESIDENT_KEY_ID": $state.params.RESIDENT_KEY_ID,
                                    "RESIDENT_ID_NO": row.RESIDENT_ID_NO,
                                    "PHYSICAL_RECORD_KEY_ID": row.RECORD_KEY_ID
                                });
                            }
                        }else{
                            $state.go(toStatePre + 'bloodPressureEdit', {
                                "BLOOD_PRESSURE_RECORD_KEY_ID":row.RECORD_KEY_ID,
                                "HYPERTENSION_RECORD_KEY_ID":listPara.HYPERTENSION_RECORD_KEY_ID
                            });
                        }
                    }
                }
            }, {
                field: 'PRESSURE',
                title: '收缩压/舒张压(mmHg)',
                width: 238,
                align: 'center',
                formatter:function (val,row) {
                    var result1=(row.SYSTOLIC_PRESSURE===undefined||row.SYSTOLIC_PRESSURE===null)?'-':row.SYSTOLIC_PRESSURE;
                    var result2=(row.DIASTOLIC_PRESSURE===undefined||row.DIASTOLIC_PRESSURE===null)?'-':row.DIASTOLIC_PRESSURE;

                    return result1+'/'+result2;
                }
            }, {
                field: 'MEASURE_TYPE_NAME',
                title: '测量类型',
                width: 366,
                align: 'center'
            }, {
                field: 'BLOOD_PRESSURE_GRADING_NAME',
                title: '血压分级',
                width: 298,
                align: 'center'
            }, {
                field: 'MEASURE_DOCTOR',
                title: '测量医生',
                width: 298,
                align: 'center',
                formatter:function (val) {
                    return val ? val: '-';
                }
            }]
        };

        function getList(param, successFunction, failedFunction) {
            Hypertension.getBloodPressureList(JSON.stringify(param)).$promise
                .then(function (res) {
                    $rootScope.handleMessage(res, function (data) {
                        successFunction(data || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.bloodPressureTableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
    };


    vm.createBloodPressure = function (param, successFunction, failedFunction) {
        Hypertension.createBloodPressure(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getBloodPressureMeasureType = function (param, successFunction, failedFunction) {
        Hypertension.getBloodPressureMeasureType (JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getBloodPressureCurveList = function (param, successFunction, failedFunction) {
        Hypertension.getBloodPressureCurveList(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getBloodPressureLevelList = function (param, successFunction, failedFunction) {
        Hypertension.getBloodPressureLevelList(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.editBloodPressureRecord = function (param, successFunction, failedFunction) {
        Hypertension.editBloodPressureRecord(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getBloodPressureDetailById = function (param, successFunction, failedFunction) {
        Hypertension.getBloodPressureDetailById(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.deleteBloodPressureRecord = function (param, successFunction, failedFunction) {
        Hypertension.deleteBloodPressureRecord(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('hypertensionEvaluationEditCtrl', hypertensionEvaluationEditCtrl);
hypertensionEvaluationEditCtrl.$inject = ['$rootScope', '$state', '$filter', 'hypertensionEvaluationRecordService'];
function hypertensionEvaluationEditCtrl($rootScope, $state, $filter, hypertensionEvaluationRecordService) {
    var vm = this;
    vm.edit = true;
    vm.editable = false;
    var dataBak = {};

    //复选框
    function setCheckBoxVal(list, key, str) {
        if (typeof str !== 'string') {
            return;
        }
        var array = str.split(',');
        angular.forEach(list, function(item) {
            angular.forEach(array, function(code) {
                if (item.DICT_VALUE_CODE === code) {
                    vm[key].push(item);
                }
            });
        });
    }

    //转换数据
    function transformData(data) {
        vm['SYSTOLIC_PRESSURE'] = data['SYSTOLIC_PRESSURE'];
        vm['DIASTOLIC_PRESSURE'] = data['DIASTOLIC_PRESSURE'];
        setCheckBoxVal(vm['cardiovascularRiskFactorsList'], 'CARDIOVASCULAR_RISK', data['CARDIOVASCULAR_RISK_FACTORS_CODE']);
        setCheckBoxVal(vm['targetOrganDamagesList'], 'TARGET_ORGAN_DAMAGES', data['TARGET_ORGAN_DAMAGES_CODE']);
        setCheckBoxVal(vm['coexistingAssociatedDiseasesList'], 'COEXISTING_ASSOCIATED_DISEASES', data['COEXISTING_ASSOCIATED_DISEASES_CODE']);
        vm['IS_HAS_DIABETES'] = data['IS_HAS_DIABETES'];
        vm['BLOOD_PRESSURE_GRADING'] = $rootScope.selectItem(vm['bloodPressureGradingList'], 'DICT_VALUE_CODE', data['BLOOD_PRESSURE_GRADING_CODE']);
        vm['CRITICALITY_GRADING'] = $rootScope.selectItem(vm['criticalityGradingList'], 'DICT_VALUE_CODE', data['CRITICALITY_GRADING_CODE']);
        vm['GRADING_MANAGEMENT'] = $rootScope.selectItem(vm['gradingManagementList'], 'DICT_VALUE_CODE', data['GRADING_MANAGEMENT_CODE']);
        vm['OVERALL_EVALUATION'] = data['OVERALL_EVALUATION'];
        vm['CREATE_TIME'] = new Date(data['CREATE_TIME']);
        vm['CREATOR_NAME'] = data['CREATOR_NAME'];
    }

    function getEvaluationRecord(){
        hypertensionEvaluationRecordService.searchEvaluationRecord(
            {
                "ASSESS_RECORD_KEY_ID": $state['params']['ASSESS_RECORD_KEY_ID']
            },function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        transformData(data);
                        dataBak = angular.copy(data);
                    },
                    function () {
                        $rootScope.alertDialog('获取高血压评估失败');
                    }
                );
            }, function () {
                $rootScope.alertDialog('获取高血压评估失败');
            }
        )
    }

    function init() {
        judgePage();
        vm.CARDIOVASCULAR_RISK = [];
        vm.TARGET_ORGAN_DAMAGES = [];
        vm.COEXISTING_ASSOCIATED_DISEASES = [];
        vm.BLOOD_PRESSURE_GRADING = {};
        vm.CRITICALITY_GRADING = {};
        vm.GRADING_MANAGEMENT = {};
        vm.cardiovascularRiskFactorsList = [];
        vm.targetOrganDamagesList = [];
        vm.coexistingAssociatedDiseasesList = [];
        vm.bloodPressureGradingList = [];
        vm.gradingManagementList = [];
        vm.criticalityGradingList = [];
        var dict_type_code_list = [
            {
                "DICT_TYPE_CODE": "0031",//心血管病危险因素类型编码
                "LIST_NAME": "cardiovascularRiskFactorsList"
            },
            {
                "DICT_TYPE_CODE": "0032",//靶器官损害类型编码
                "LIST_NAME": "targetOrganDamagesList"
            },
            {
                "DICT_TYPE_CODE": "0033",//高血压并存相关疾病类型编码
                "LIST_NAME": "coexistingAssociatedDiseasesList"
            },
            {
                "DICT_TYPE_CODE": "0028",//血压分级类型编码
                "LIST_NAME": "bloodPressureGradingList"
            },
            {
                "DICT_TYPE_CODE": "0029",//血压分级管理类型编码
                "LIST_NAME": "gradingManagementList"
            },
            {
                "DICT_TYPE_CODE": "0030",//血压危险分级结果类型编码
                "LIST_NAME": "criticalityGradingList"
            }
        ];
        $rootScope.commonService('getDictList', {
            "DICT_TYPE_CODE_LIST": dict_type_code_list
        }, function (response) {
            $rootScope.handleMessage(
                response,
                function (data) {
                    angular.forEach(dict_type_code_list, function (item) {
                        vm[item['LIST_NAME']] = $rootScope.selectItem(data, "DICT_TYPE_CODE", item['DICT_TYPE_CODE'])['DICT_CODE_LIST'];
                    });
                    getEvaluationRecord();
                },
                function () {
                    $rootScope.alertDialog('获取列表失败');
                }
            );
        }, function () {
            $rootScope.alertDialog('获取列表失败');
        });
    }

    init();
    function joinItem(list, key) {
        var arr = [];
        angular.forEach(list, function (item) {
            arr.push(item[key]);
        });
        return arr.join(',');
    }

    vm.calculate = function () {
        if (!vm['SYSTOLIC_PRESSURE']) {
            $rootScope.alertDialog("请填写收缩压");
            return;
        }

        if (!vm['DIASTOLIC_PRESSURE']) {
            $rootScope.alertDialog("请填写舒张压");
            return;
        }
        var params = {
            "SYSTOLIC_PRESSURE": vm['SYSTOLIC_PRESSURE'],
            "DIASTOLIC_PRESSURE": vm['DIASTOLIC_PRESSURE'],
            "lengthArray": [
                vm['CARDIOVASCULAR_RISK']['length'],
                vm['TARGET_ORGAN_DAMAGES']['length'],
                vm['COEXISTING_ASSOCIATED_DISEASES']['length']
            ]
        };
        var data = $rootScope.calculateHypertensionEvaluation(params);
        vm['BLOOD_PRESSURE_GRADING'] = $rootScope.selectItem(vm['bloodPressureGradingList'], 'DICT_VALUE_CODE', data['bloodPressureGradingCount']);
        vm['CRITICALITY_GRADING'] = $rootScope.selectItem(vm['criticalityGradingList'], 'DICT_VALUE_CODE', data['criticalityGradingCount']);
        vm['GRADING_MANAGEMENT'] = $rootScope.selectItem(vm['gradingManagementList'], 'DICT_VALUE_CODE', data['gradingManagementCount']);
    };

    vm.goBack=function () {
        $state.go(vm.statePre + 'evaluationList', {
            HYPERTENSION_RECORD_KEY_ID : $state.params.HYPERTENSION_RECORD_KEY_ID
        });
    };

    vm.edit = function(form){
        form.$setPristine();
        form.$setUntouched();
        vm.editable = true;
    };

    vm.save = function (form) {
        if (!$rootScope.check(form)) {
            return;
        }

        var params = {
            "HYPERTENSION_RECORD_KEY_ID": $state['params']['HYPERTENSION_RECORD_KEY_ID'],
            "ASSESS_RECORD_KEY_ID": $state['params']['ASSESS_RECORD_KEY_ID'],
            "SYSTOLIC_PRESSURE": vm['SYSTOLIC_PRESSURE'],
            "DIASTOLIC_PRESSURE": vm['DIASTOLIC_PRESSURE'],
            "CARDIOVASCULAR_RISK_FACTORS_CODE": vm['CARDIOVASCULAR_RISK'] ? joinItem(vm['CARDIOVASCULAR_RISK'], 'DICT_VALUE_CODE') : null,
            "CARDIOVASCULAR_RISK_FACTORS_NAME": vm['CARDIOVASCULAR_RISK'] ? joinItem(vm['CARDIOVASCULAR_RISK'], 'DICT_VALUE_NAME') : null,
            "TARGET_ORGAN_DAMAGES_CODE": vm['TARGET_ORGAN_DAMAGES'] ? joinItem(vm['TARGET_ORGAN_DAMAGES'], 'DICT_VALUE_CODE') : null,
            "TARGET_ORGAN_DAMAGES_NAME": vm['TARGET_ORGAN_DAMAGES'] ? joinItem(vm['TARGET_ORGAN_DAMAGES'], 'DICT_VALUE_NAME') : null,
            "IS_HAS_DIABETES": vm['IS_HAS_DIABETES'],
            "COEXISTING_ASSOCIATED_DISEASES_CODE": vm['COEXISTING_ASSOCIATED_DISEASES'] ? joinItem(vm['COEXISTING_ASSOCIATED_DISEASES'], 'DICT_VALUE_CODE') : null,
            "COEXISTING_ASSOCIATED_DISEASES_NAME": vm['COEXISTING_ASSOCIATED_DISEASES'] ? joinItem(vm['COEXISTING_ASSOCIATED_DISEASES'], 'DICT_VALUE_NAME') : null,
            "BLOOD_PRESSURE_GRADING_CODE": vm['BLOOD_PRESSURE_GRADING']['DICT_VALUE_CODE'],
            "BLOOD_PRESSURE_GRADING_NAME": vm['BLOOD_PRESSURE_GRADING']['DICT_VALUE_NAME'],
            "CRITICALITY_GRADING_CODE": vm['CRITICALITY_GRADING']['DICT_VALUE_CODE'],
            "CRITICALITY_GRADING_NAME": vm['CRITICALITY_GRADING']['DICT_VALUE_NAME'],
            "GRADING_MANAGEMENT_CODE": vm['GRADING_MANAGEMENT']['DICT_VALUE_CODE'],
            "GRADING_MANAGEMENT_NAME": vm['GRADING_MANAGEMENT']['DICT_VALUE_NAME'],
            "OVERALL_EVALUATION": vm['OVERALL_EVALUATION']
        };
        hypertensionEvaluationRecordService.updateEvaluationRecord(
            params,
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        vm.editable = false;
                    },
                    function (response) {
                        $rootScope.alertDialog(response.message);
                    }
                );
            },
            function () {
                $rootScope.alertDialog('保存血压评估失败');
            });
    };

    vm.delete = function () {
        $rootScope.confirmDialog(
            '是否确定删除这条评估记录？',
            function () {
                hypertensionEvaluationRecordService.deleteEvaluationRecord(
                    {
                        "ASSESS_RECORD_KEY_ID": $state['params']['ASSESS_RECORD_KEY_ID']
                    },function (response) {
                        $rootScope.handleMessage(
                            response,
                            function () {
                                $state.go(vm.statePre + 'evaluationList',
                                    {HYPERTENSION_RECORD_KEY_ID: $state.params.HYPERTENSION_RECORD_KEY_ID}
                                );
                            },
                            function () {
                                $rootScope.alertDialog(response.message);
                            }
                        );
                    }, function () {
                        $rootScope.alertDialog('删除高血压评估记录失败');
                    }
                )
            },
            function () {

            }
        );

    };

    vm.cancel = function (evaluationInfo) {
        if (evaluationInfo.$dirty) {
            $rootScope.confirmDialog(
                '您确定要放弃保存吗?',
                function () {
                    resetData();
                    vm.editable = false;
                },
                function () {

                }
            );
        } else {
            vm.editable = false;
        }
        function resetData() {
            var data = angular.copy(dataBak);
            transformData(data);
        }
    };

    vm.goBack = function () {
        $state.go(vm.statePre + 'evaluationList',
            {HYPERTENSION_RECORD_KEY_ID: $state['params']['HYPERTENSION_RECORD_KEY_ID']}
        );
    };

    vm.toggle = function (item, list) {
        var idx = list.indexOf(item);
        if (idx > -1) {
            list.splice(idx, 1);
        }
        else {
            list.push(item);
        }
    };

    vm.exists = function (item, list) {
        return list.indexOf(item) > -1;
    };

    function judgePage() {
        if($rootScope.isContains($state.current.name,'main.special')){
            vm.statePre ='main.special.hypertensionSidebar.detail.';
        }else if($rootScope.isContains($state.current.name,'main.resident')){
            vm.statePre ='main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.';
        }
    }

    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('hypertensionEvaluationListCtrl', hypertensionEvaluationListCtrl);
hypertensionEvaluationListCtrl.$inject = ['$rootScope', '$state', '$stateParams', 'hypertensionEvaluationRecordService', 'bootstrapTable'];
function hypertensionEvaluationListCtrl($rootScope, $state, $stateParams, hypertensionEvaluationRecordService, bootstrapTable) {
    var vm = this;

    vm.showTable = function ($vm, params, $state) {
        var list = {
            dataFunction: ajaxRequest,
            dataParams: params,
            columns: [{
                field: 'CREATE_TIME',
                title: '评估日期',
                align: 'center',
                width: 298,
                valign: 'middle',
                formatter: roleFormat,
                events: {
                    'click .flag': function (e, value, row) {
                        $state.go(vm.statePre + 'evaluationEdit', {
                            "HYPERTENSION_RECORD_KEY_ID": $stateParams['HYPERTENSION_RECORD_KEY_ID'],
                            "ASSESS_RECORD_KEY_ID": row['ASSESS_RECORD_KEY_ID']
                        });
                    }
                }
            }, {
                field: 'BLOOD_PRESSURE',
                title: '收缩压/舒张压(mmHg)',
                align: 'center',
                width: 100,
                valign: 'middle'
            }, {
                field: 'BLOOD_PRESSURE_GRADING_NAME',
                title: '血压分级',
                align: 'center',
                width: 100,
                valign: 'middle'
            }, {
                field: 'CRITICALITY_GRADING_NAME',
                title: '危险分层',
                align: 'center',
                width: 100,
                valign: 'middle'
            }, {
                field: 'GRADING_MANAGEMENT_NAME',
                title: '分级管理',
                align: 'center',
                width: 100,
                valign: 'middle'
            }, {
                field: 'CREATOR_NAME',
                title: '评估医生',
                align: 'center',
                width: 100,
                valign: 'middle'
            }]
        };

        function roleFormat(value) {
            return '<div class="flag" style="color: #428bca;cursor:pointer;">' + value + '</div>';
        }

        function ajaxRequest(params, successFunction, failedFunction) {
            hypertensionEvaluationRecordService.getEvaluationRecordList(
                params,
                function (response) {
                    $rootScope.handleMessage(response, function () {
                        successFunction(response.value || {total: 0, rows: []});
                    }, function () {
                        $rootScope.alertDialog("获取列表信息失败");
                    });
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                    failedFunction();
                });
        }

        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };
        return $vm;
    };

    vm.getEvaluationRecordList = function () {
        var params = {
            "RESIDENT_KEY_ID": $state.params.RESIDENT_KEY_ID
        };
        vm.showTable(vm, params, $state);
    };
    judgePage();
    vm.getEvaluationRecordList();

    vm.newRecord = function () {
        $state.go(vm.statePre + 'evaluationAdd', {
            "HYPERTENSION_RECORD_KEY_ID": $stateParams['HYPERTENSION_RECORD_KEY_ID']
        });
    };

    function judgePage() {
        if($rootScope.isContains($state.current.name,'main.special')){
            vm.statePre ='main.special.hypertensionSidebar.detail.';
        }else if($rootScope.isContains($state.current.name,'main.resident')){
            vm.statePre ='main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.';
        }
    }

    return vm;
}
"use strict";
SMS.CONTROLLERS.service('hypertensionEvaluationRecordService', hypertensionEvaluationRecordService);
hypertensionEvaluationRecordService.$inject = ['$rootScope', 'Hypertension'];
function hypertensionEvaluationRecordService($rootScope, Hypertension) {
    var vm = this;
    vm.getEvaluationRecordList = function (params, successFunction, failedFunction) {
        return Hypertension.getEvaluationRecordList(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    vm.addEvaluationRecord = function (params, successFunction, failedFunction) {
        return Hypertension.addEvaluationRecord(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    vm.searchEvaluationRecord = function (params, successFunction, failedFunction) {
        return Hypertension.searchEvaluationRecord(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    vm.updateEvaluationRecord = function (params, successFunction, failedFunction) {
        return Hypertension.updateEvaluationRecord(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    vm.deleteEvaluationRecord = function (params, successFunction, failedFunction) {
        return Hypertension.deleteEvaluationRecord(JSON.stringify(params)).$promise
            .then(successFunction, failedFunction);
    };
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('hypertensionFollowupEditCtrl', hypertensionFollowupEditCtrl);
hypertensionFollowupEditCtrl.$inject = ['$rootScope', '$state', '$stateParams', 'hypertensionFollowupRecordService', 'SessionStorage'];
function hypertensionFollowupEditCtrl($rootScope, $state, $stateParams, hypertensionFollowupRecordService, SessionStorage) {
    var vm = this;

    vm.editable = false;
    var RESIDENT_KEY_ID = $stateParams.RESIDENT_KEY_ID;
    var HYPERTENSION_RECORD_KEY_ID = $stateParams.HYPERTENSION_RECORD_KEY_ID;
    var FOLLOW_UP_RECORD_KEY_ID = $stateParams.FOLLOW_UP_RECORD_KEY_ID;
    
    //特殊字符06
    var SPLIT_06 = "";

    judgePage();
    getFollowUpRecordInfo();
    //获取模版数据
    function getFollowUpRecordInfo() {
        hypertensionFollowupRecordService.getFollowUpRecordInfo(
            {
                "SUITABLE_CROWD_CODE": "0020000010",
                "FOLLOW_UP_RECORD_KEY_ID": FOLLOW_UP_RECORD_KEY_ID
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function (data) {
                        SPLIT_06 = data.SPLIT_06;
                        var result = handleData(data);
                        vm.templateInfo = result;
                        vm.TITLE_LIST = result.TITLE_LIST;
                        handleFieldValue(vm.TITLE_LIST);
                    },
                    function () {
                        $rootScope.alertDialog('随访模版信息获取失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('随访模版信息获取失败');
            }
        );
    }

    //对数据中的多选填空处理,加上一些默认值
    function handleData(data) {
        for (var i = 0; i < data.TITLE_LIST.length; i++) {
            for (var j = 0; j < data.TITLE_LIST[i].FIELD_LIST.length; j++) {
                if (data.TITLE_LIST[i].FIELD_LIST[j].FIELD_TYPE_CODE === '0022000070') {
                    for (var k = 0; k < data.TITLE_LIST[i].FIELD_LIST[j].FIELD_DETAILED_LIST.length; k++) {
                        var temp = data.TITLE_LIST[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT.split("");
                        var obj = [];
                        for (var m = 0; m < temp.length; m++) {
                            obj.push({
                                "TEMP_NAME": temp[m]
                            });
                        }
                        data.TITLE_LIST[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT = obj;
                    }
                }

                //随访医生默认填写当前帐号医生
                if(data.TITLE_LIST[i].FIELD_LIST[j].FIELD_TYPE_CODE === '0022000010' && data.TITLE_LIST[i].FIELD_LIST[j].SYSTEM_FIELD_CODE === '0010001'){
                    data.TITLE_LIST[i].FIELD_LIST[j].MODEL = SessionStorage.get('loginInfo').username;
                }

                //随访方式默认填写门诊
                if(data.TITLE_LIST[i].FIELD_LIST[j].FIELD_TYPE_CODE === '0022000050' && data.TITLE_LIST[i].FIELD_LIST[j].SYSTEM_FIELD_CODE === '0010002'){
                    data.TITLE_LIST[i].FIELD_LIST[j].MODEL = data.TITLE_LIST[i].FIELD_LIST[j].FIELD_DETAILED_LIST[0];
                }

                //随访日期默认选择今日日期, 下次随访日期默认填写3个月后的日期
                if(data.TITLE_LIST[i].FIELD_LIST[j].FIELD_TYPE_CODE === '0022000030' && data.TITLE_LIST[i].FIELD_LIST[j].SYSTEM_FIELD_CODE === '0010003'){
                    data.TITLE_LIST[i].FIELD_LIST[j].MODEL = new Date();
                }
                if(data.TITLE_LIST[i].FIELD_LIST[j].FIELD_TYPE_CODE === '0022000030' && data.TITLE_LIST[i].FIELD_LIST[j].SYSTEM_FIELD_CODE === '0010004'){
                    var a = new Date();
                    a.setMonth(a.getMonth()+3);
                    data.TITLE_LIST[i].FIELD_LIST[j].MODEL = a;
                }
            }
        }

        return data;
    }

    vm.calculateBMI = function (SYSTEM_FIELD_CODE) {
        if(SYSTEM_FIELD_CODE === "0010007"){//身高
            doCount("0010007", "0010008", "0010010");
        }else if(SYSTEM_FIELD_CODE === "0010008"){//体重
            doCount("0010007", "0010008", "0010010");
        }else if(SYSTEM_FIELD_CODE === "0010009"){//下次预期体重
            doCount("0010007", "0010009", "0010011");
        }else{
            return;
        }
    };

    function doCount(height_code, weight_code, bmi_code) {
        var height = getModelValue(vm.templateInfo, height_code);
        if(height === null || height === undefined){
            return;
        }

        var weight = getModelValue(vm.templateInfo, weight_code);
        if(weight === null || weight === undefined){
            return;
        }

        var temp1 = (weight/height/height*100000).toFixed(0);
        var temp2 = parseInt(temp1)/10;
        setModelValue(vm.templateInfo, bmi_code, temp2);
    }

    function getModelValue(data, code) {
        for (var i = 0; i < data.TITLE_LIST.length; i++) {
            for (var j = 0; j < data.TITLE_LIST[i].FIELD_LIST.length; j++) {
                //数字类型
                if (data.TITLE_LIST[i].FIELD_LIST[j].FIELD_TYPE_CODE === '0022000020' && data.TITLE_LIST[i].FIELD_LIST[j].SYSTEM_FIELD_CODE === code) {
                    return data.TITLE_LIST[i].FIELD_LIST[j].MODEL;
                }
            }
        }
        return undefined;
    }

    function setModelValue(data, code, value) {
        for (var i = 0; i < data.TITLE_LIST.length; i++) {
            for (var j = 0; j < data.TITLE_LIST[i].FIELD_LIST.length; j++) {
                //数字类型
                if (data.TITLE_LIST[i].FIELD_LIST[j].FIELD_TYPE_CODE === '0022000020' && data.TITLE_LIST[i].FIELD_LIST[j].SYSTEM_FIELD_CODE === code) {
                    data.TITLE_LIST[i].FIELD_LIST[j].MODEL = value;
                }
            }
        }
    }

    vm.toggle = function (item, obj, form) {
        if (obj.MODEL === undefined) {
            obj.MODEL = [];
        }
        var idx = obj.MODEL.indexOf(item);
        if (idx > -1) {
            obj.MODEL.splice(idx, 1);
        }
        else {
            obj.MODEL.push(item);
        }
        form.$dirty = true;
    };

    vm.exists = function (item, obj) {
        if (obj.MODEL === undefined) {
            obj.MODEL = [];
        }
        return obj.MODEL.indexOf(item) > -1;
    };

    //给每个字段赋值
    function handleFieldValue(data) {
        for(var i = 0; i < data.length; i++){
            for(var j = 0; j < data[i].FIELD_LIST.length; j++){
                //文本
                if(data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000010"){
                    if(data[i].FIELD_LIST[j].FIELD_VALUE === "" || data[i].FIELD_LIST[j].FIELD_VALUE === undefined){
                        data[i].FIELD_LIST[j].MODEL = undefined;
                    }else {
                        data[i].FIELD_LIST[j].MODEL = data[i].FIELD_LIST[j].FIELD_VALUE;
                    }
                }
                //数字
                if(data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000020"){
                    if(data[i].FIELD_LIST[j].FIELD_VALUE === "" || data[i].FIELD_LIST[j].FIELD_VALUE === undefined){
                        data[i].FIELD_LIST[j].MODEL = undefined;
                    }else {
                        data[i].FIELD_LIST[j].MODEL = +data[i].FIELD_LIST[j].FIELD_VALUE;
                    }
                }
                //日期
                if(data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000030"){
                    if(data[i].FIELD_LIST[j].FIELD_VALUE === "" || data[i].FIELD_LIST[j].FIELD_VALUE === undefined){
                        data[i].FIELD_LIST[j].MODEL = undefined;
                    }else {
                        data[i].FIELD_LIST[j].MODEL = new Date(data[i].FIELD_LIST[j].FIELD_VALUE);
                    }
                }
                //按钮单选、下拉单选
                if(data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000040" || data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000050"){
                    if(data[i].FIELD_LIST[j].FIELD_VALUE === "" || data[i].FIELD_LIST[j].FIELD_VALUE === undefined){
                        data[i].FIELD_LIST[j].MODEL = undefined;
                    }else{
                        data[i].FIELD_LIST[j].MODEL = $rootScope.selectItem(data[i].FIELD_LIST[j].FIELD_DETAILED_LIST, "FIELD_DETAILED_KEY_ID", parseInt(data[i].FIELD_LIST[j].FIELD_VALUE));
                        if(data[i].FIELD_LIST[j].FIELD_ADDITIONAL_VALUE !== ""){
                            data[i].FIELD_LIST[j].MODEL.MODEL = data[i].FIELD_LIST[j].FIELD_ADDITIONAL_VALUE;
                        }
                    }
                }
                //多选
                if(data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000060"){
                    if(data[i].FIELD_LIST[j].FIELD_VALUE === "" || data[i].FIELD_LIST[j].FIELD_VALUE === undefined){
                        data[i].FIELD_LIST[j].MODEL = undefined;
                    }else{
                        data[i].FIELD_LIST[j].FIELD_VALUE = data[i].FIELD_LIST[j].FIELD_VALUE.split(SPLIT_06);
                        data[i].FIELD_LIST[j].FIELD_ADDITIONAL_VALUE = data[i].FIELD_LIST[j].FIELD_ADDITIONAL_VALUE ? data[i].FIELD_LIST[j].FIELD_ADDITIONAL_VALUE.split(SPLIT_06) : "";
                        data[i].FIELD_LIST[j].MODEL = [];
                        data[i].FIELD_LIST[j].VIEW_VALUE = '';
                        for(var k = 0; k < data[i].FIELD_LIST[j].FIELD_VALUE.length; k++){
                            var tmp = $rootScope.selectItem(data[i].FIELD_LIST[j].FIELD_DETAILED_LIST, "FIELD_DETAILED_KEY_ID", parseInt(data[i].FIELD_LIST[j].FIELD_VALUE[k]));
                            if(tmp.IS_HAS_TEXT_SUFFIX === 1){
                                tmp.MODEL = data[i].FIELD_LIST[j].FIELD_ADDITIONAL_VALUE[k];
                            }
                            data[i].FIELD_LIST[j].MODEL.push(tmp);
                        }
                        for(var m = 0; m < data[i].FIELD_LIST[j].MODEL.length; m++){
                            if(m === 0){
                                if(data[i].FIELD_LIST[j].MODEL[m].MODEL !== undefined){
                                    data[i].FIELD_LIST[j].VIEW_VALUE += (data[i].FIELD_LIST[j].MODEL[m].FIELD_DETAILED_CONTENT + ":" + data[i].FIELD_LIST[j].MODEL[m].MODEL);
                                }else{
                                    data[i].FIELD_LIST[j].VIEW_VALUE += data[i].FIELD_LIST[j].MODEL[m].FIELD_DETAILED_CONTENT; 
                                }
                            }else{
                                if(data[i].FIELD_LIST[j].MODEL[m].MODEL !== undefined){
                                    data[i].FIELD_LIST[j].VIEW_VALUE += (";" + data[i].FIELD_LIST[j].MODEL[m].FIELD_DETAILED_CONTENT + ":" + data[i].FIELD_LIST[j].MODEL[m].MODEL);
                                }else{
                                    data[i].FIELD_LIST[j].VIEW_VALUE += (";" + data[i].FIELD_LIST[j].MODEL[m].FIELD_DETAILED_CONTENT);
                                }
                            }
                        }
                    }
                }
                //多项填空
                if(data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000070"){
                    for(var k = 0; k < data[i].FIELD_LIST[j].FIELD_VALUE_DETAILED_LIST.length; k++){
                        for(var m = 0;  m < data[i].FIELD_LIST[j].FIELD_VALUE_DETAILED_LIST[k].FIELD_VALUE_DETAIL_LIST.length; m++){
                            data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT[m].MODEL = data[i].FIELD_LIST[j].FIELD_VALUE_DETAILED_LIST[k].FIELD_VALUE_DETAIL_LIST[m];
                        }
                    }
                }
            }
        }
    }

    //按钮事件
    vm.delete = function () {
        $rootScope.confirmDialog(
            '您确定要删除该随访记录吗?',
            function () {
                hypertensionFollowupRecordService.deleteFollowUpRecordCascaded(
                    {
                        "FOLLOW_UP_RECORD_KEY_ID": FOLLOW_UP_RECORD_KEY_ID
                    },
                    function (response) {
                        $rootScope.handleMessage(
                            response,
                            function () {
                                $rootScope.back();
                            },
                            function () {
                                $rootScope.alertDialog('删除随访失败');
                            }
                        );
                    },
                    function () {
                        $rootScope.alertDialog('删除随访失败');
                    }
                );
            },
            function () {

            }
        );
    };

    vm.goBack=function () {
        $state.go(vm.statePre + 'followupList', {
            RESIDENT_KEY_ID: $state.params.RESIDENT_KEY_ID,
            HYPERTENSION_RECORD_KEY_ID : $state.params.HYPERTENSION_RECORD_KEY_ID
        });
    };

    vm.edit = function () {
        vm.editable = true;
    };

    vm.cancel = function (form) {
        if(form.$dirty){
            $rootScope.confirmDialog(
                '是否放弃已经编辑的内容',
                function () {
                    vm.editable = false;
                    getFollowUpRecordInfo();
                    form.$dirty = false;
                },
                function () {

                });
        }else{
            vm.editable = false;
            getFollowUpRecordInfo();
            form.$dirty = false;
        }
    };

    vm.save = function () {
        //判断必答和生成数据
        var data = hypertensionFollowupRecordService.getSaveData(vm.TITLE_LIST);
        if(data ===  undefined){
            return;
        }

        hypertensionFollowupRecordService.editFollowUpRecord(
            {
                "RESIDENT_KEY_ID": RESIDENT_KEY_ID,
                "FOLLOW_UP_RECORD_KEY_ID": FOLLOW_UP_RECORD_KEY_ID,
                "FIELD_VALUE_LIST": data
            },
            function (response) {
                $rootScope.handleMessage(
                    response,
                    function () {
                        getFollowUpRecordInfo();
                        vm.editable = false;
                    },
                    function () {
                        $rootScope.alertDialog('编辑随访失败');
                    }
                );
            },
            function () {
                $rootScope.alertDialog('编辑随访失败');
            }
        );
    };

    function judgePage() {
        if($rootScope.isContains($state.current.name,'main.special')){
            vm.statePre ='main.special.hypertensionSidebar.detail.';
        }else if($rootScope.isContains($state.current.name,'main.resident')){
            vm.statePre ='main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.';
        }
    }
    
    return vm;
}
"use strict";
SMS.CONTROLLERS.controller('hypertensionFollowupListCtrl', hypertensionFollowupListCtrl);
hypertensionFollowupListCtrl.$inject = ['$rootScope', '$state', '$stateParams', 'hypertensionFollowupRecordService'];
function hypertensionFollowupListCtrl($rootScope, $state, $stateParams, hypertensionFollowupRecordService) {
    var vm = this;
    judgePage();
    hypertensionFollowupRecordService.showTable(vm, {"HYPERTENSION_RECORD_KEY_ID": $stateParams.HYPERTENSION_RECORD_KEY_ID}, $state, vm.statePre + 'followupEdit');

    vm.createFollowUpRecord = function () {
        $state.go(vm.statePre + "followupAdd", {
            "RESIDENT_KEY_ID": $stateParams.RESIDENT_KEY_ID,
            "HYPERTENSION_RECORD_KEY_ID": $stateParams.HYPERTENSION_RECORD_KEY_ID
        });
    };

    function judgePage() {
        if($rootScope.isContains($state.current.name,'main.special')){
            vm.statePre ='main.special.hypertensionSidebar.detail.';
        }else if($rootScope.isContains($state.current.name,'main.resident')){
            vm.statePre ='main.resident.residentArchivesSidebar.detail.hypertensionHeadBar.detail.';
        }
    }
    
    return vm;
}
"use strict";
SMS.CONTROLLERS.service('hypertensionFollowupRecordService', hypertensionFollowupRecordService);
hypertensionFollowupRecordService.$inject = ['$rootScope', '$state', 'Hypertension', 'bootstrapTable'];
function hypertensionFollowupRecordService($rootScope, $state, Hypertension, bootstrapTable) {
    var vm = this;

    vm.showTable = function ($vm, params, $state, toState) {
        var list = {
            dataFunction: ajaxRequest,
            dataParams: params,
            columns: [{
                field: 'FOLLOW_UP_DATE',
                title: '随访日期',
                align: 'center',
                valign: 'middle',
                formatter: dateFormat,
                events: {
                    'click .flag': function (e, value, row) {
                        $state.go(toState, {
                            "RESIDENT_KEY_ID": $state.params.RESIDENT_KEY_ID,
                            "HYPERTENSION_RECORD_KEY_ID": $state.params.HYPERTENSION_RECORD_KEY_ID,
                            "FOLLOW_UP_RECORD_KEY_ID": row.FOLLOW_UP_RECORD_KEY_ID
                        });
                    }
                }
            }, {
                field: 'BLOOD_PRESSURE',
                title: '收缩压/舒张压(mmHg)',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'FOLLOW_UP_TYPE',
                title: '随访方式',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'PRESSURE_GRADE',
                title: '血压分级',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'FOLLOW_UP_CLASSIFICATION',
                title: '随访结果',
                align: 'center',
                valign: 'middle'
            }, {
                field: 'FOLLOW_UP_DOCTOR',
                title: '随访医生',
                align: 'center',
                valign: 'middle',
                formatter:function (val) {
                    return val ? val: '-';
                }
            }]
        };
        $vm.tableData = {
            bsTableControl: {
                options: bootstrapTable.initOption(list)
            }
        };

        function dateFormat(value) {
            return '<div class="flag" style="color: #428bca">' + value + '</div>';
        }

        return $vm;
    };

    function ajaxRequest(params, successFunction, failedFunction) {
        Hypertension.getFollowUpRecordList(JSON.stringify(params)).$promise
            .then(function (response) {
                $rootScope.handleMessage(response, function () {
                    successFunction(response.value || {total: 0, rows: []});
                }, function () {
                    $rootScope.alertDialog("获取列表信息失败");
                });
            }, function () {
                $rootScope.alertDialog("获取列表信息失败");
                failedFunction();
            });
    }

    vm.getFollowUpRecordInfo = function (param, successFunction, failedFunction) {
        Hypertension.getFollowUpRecordInfo(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };
    
    vm.createFollowUpRecord = function (param, successFunction, failedFunction) {
        Hypertension.createFollowUpRecord(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };
    
    vm.editFollowUpRecord = function (param, successFunction, failedFunction) {
        Hypertension.editFollowUpRecord(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };
    
    vm.deleteFollowUpRecordCascaded = function (param, successFunction, failedFunction) {
        Hypertension.deleteFollowUpRecordCascaded(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };
    
    vm.getLastHeight = function (param, successFunction, failedFunction) {
        Hypertension.getLastHeight(JSON.stringify(param)).$promise
            .then(successFunction, failedFunction);
    };

    vm.getSaveData = function (data) {
        var result = [];
        //小标题层
        for (var i = 0; i < data.length; i++) {
            //具体字段
            for (var j = 0; j < data[i].FIELD_LIST.length; j++) {
                //文本
                if (data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000010") {
                    if (data[i].FIELD_LIST[j].IS_REQUIRED === 1 && data[i].FIELD_LIST[j].MODEL === undefined) {
                        $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                        return undefined;
                    }else {
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL || "",
                            "FIELD_ADDITIONAL_VALUE": "",
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    }
                }
                //数字
                if (data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000020") {
                    if (data[i].FIELD_LIST[j].IS_REQUIRED === 1 && data[i].FIELD_LIST[j].MODEL === undefined) {
                        $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                        return undefined;
                    }else {
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL === undefined ? "" :  data[i].FIELD_LIST[j].MODEL,
                            "FIELD_ADDITIONAL_VALUE": "",
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    }
                }
                //日期
                if (data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000030") {
                    if (data[i].FIELD_LIST[j].IS_REQUIRED === 1 && data[i].FIELD_LIST[j].MODEL === undefined) {
                        $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                        return undefined;
                    }else {
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL ? $filter('commonDate')(data[i].FIELD_LIST[j].MODEL) : "",
                            "FIELD_ADDITIONAL_VALUE": "",
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    }
                }
                //按钮单选
                if (data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000040") {
                    if (data[i].FIELD_LIST[j].IS_REQUIRED === 1 && data[i].FIELD_LIST[j].MODEL === undefined) {
                        $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                        return undefined;
                    }else if(data[i].FIELD_LIST[j].MODEL === undefined) {
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_VALUE": '',
                            "FIELD_ADDITIONAL_VALUE": "",
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_VALUE_LIST": [
                                {
                                    "FIELD_VALUE": "",
                                    "FIELD_ADDITIONAL_VALUE": "",
                                    "FIELD_VALUE_ORDER": ""
                                }
                            ],
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_CN": "",
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    }else{
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL.FIELD_DETAILED_KEY_ID,
                            "FIELD_ADDITIONAL_VALUE": data[i].FIELD_LIST[j].MODEL.MODEL ? data[i].FIELD_LIST[j].MODEL.MODEL : "",
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_VALUE_LIST": [
                                {
                                    "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL.FIELD_DETAILED_KEY_ID,
                                    "FIELD_ADDITIONAL_VALUE": data[i].FIELD_LIST[j].MODEL.MODEL ? data[i].FIELD_LIST[j].MODEL.MODEL : "",
                                    "FIELD_VALUE_ORDER": data[i].FIELD_LIST[j].MODEL.FIELD_DETAILED_ORDER
                                }
                            ],
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_CN": data[i].FIELD_LIST[j].MODEL.FIELD_DETAILED_CONTENT,
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    }
                }
                //下拉单选
                if (data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000050") {
                    if (data[i].FIELD_LIST[j].IS_REQUIRED === 1 && data[i].FIELD_LIST[j].MODEL === undefined) {
                        $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                        return undefined;
                    }else {
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL ? data[i].FIELD_LIST[j].MODEL.FIELD_DETAILED_KEY_ID : "",
                            "FIELD_ADDITIONAL_VALUE": "",
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_VALUE_LIST": [
                                {
                                    "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL.FIELD_DETAILED_KEY_ID,
                                    "FIELD_ADDITIONAL_VALUE": "",
                                    "FIELD_VALUE_ORDER": data[i].FIELD_LIST[j].MODEL.FIELD_DETAILED_ORDER
                                }
                            ],
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    }
                }
                //多选
                if (data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000060") {
                    if (data[i].FIELD_LIST[j].IS_REQUIRED === 1 && data[i].FIELD_LIST[j].MODEL === undefined) {
                        $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                        return undefined;
                    } else if (data[i].FIELD_LIST[j].MODEL === undefined) {
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_VALUE_LIST": [
                                {
                                    "FIELD_VALUE": "",
                                    "FIELD_ADDITIONAL_VALUE": "",
                                    "FIELD_VALUE_ORDER": ""
                                }
                            ],
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    } else {
                        var temp = [];
                        for(var k = 0; k < data[i].FIELD_LIST[j].MODEL.length; k++){
                            temp.push({
                                "FIELD_VALUE": data[i].FIELD_LIST[j].MODEL[k].FIELD_DETAILED_KEY_ID,
                                "FIELD_ADDITIONAL_VALUE": data[i].FIELD_LIST[j].MODEL[k].MODEL || "",
                                "FIELD_VALUE_ORDER": data[i].FIELD_LIST[j].MODEL[k].FIELD_DETAILED_ORDER
                            });
                        }
                        result.push({
                            "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                            "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                            "FIELD_VALUE_LIST": temp,
                            "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                            "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                            "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                            "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                        });
                    }
                }
                //多项填空
                if (data[i].FIELD_LIST[j].FIELD_TYPE_CODE === "0022000070") {
                    var temp1 = [];
                    for(var k = 0; k < data[i].FIELD_LIST[j].FIELD_DETAILED_LIST.length; k++){
                        var temp2 = {
                            "FIELD_VALUE_DETAIL_LIST": [],
                            "FIELD_VALUE_ORDER": data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_ORDER
                        };
                        if(data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].IS_HAS_TEXT_SUFFIX === 1){
                            for(var m = 0; m < data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT.length; m++){
                                if(data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT[m].MODEL === undefined && data[i].FIELD_LIST[j].IS_REQUIRED === 1){
                                    $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                                    return undefined;
                                }
                                temp2.FIELD_VALUE_DETAIL_LIST.push({
                                    "FIELD_VALUE": data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT[m].MODEL || ''
                                });
                            }
                        }else{
                            for(var m = 0; m < data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT.length - 1; m++){
                                if(data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT[m].MODEL === undefined && data[i].FIELD_LIST[j].IS_REQUIRED === 1){
                                    $rootScope.alertDialog(data[i].FIELD_LIST[j].FIELD_NAME + '为必填字段');
                                    return undefined;
                                }
                                temp2.FIELD_VALUE_DETAIL_LIST.push({
                                    "FIELD_VALUE": data[i].FIELD_LIST[j].FIELD_DETAILED_LIST[k].FIELD_DETAILED_CONTENT[m].MODEL || ''
                                });
                            }
                        }
                        temp1.push(temp2);
                    }
                    result.push({
                        "TEMPLATE_FIELD_KEY_ID": data[i].FIELD_LIST[j].TEMPLATE_FIELD_KEY_ID,
                        "FIELD_TYPE_CODE": data[i].FIELD_LIST[j].FIELD_TYPE_CODE,
                        "FIELD_VALUE_LIST": temp1,
                        "FIELD_VALUE_ORDER": data[i].FIELD_LIST[j].TEMPLATE_FIELD_ORDER,
                        "FIELD_NAME": data[i].FIELD_LIST[j].FIELD_NAME,
                        "FIELD_PROPERTY_NAME": data[i].FIELD_LIST[j].FIELD_PROPERTY_NAME,
                        "SYSTEM_FIELD_CODE": data[i].FIELD_LIST[j].SYSTEM_FIELD_CODE || "",
                        "FIELD_VALUE_KEY_ID": data[i].FIELD_LIST[j].FIELD_VALUE_KEY_ID
                    });
                }

            }
        }
        
        return result;
    };

    return vm;
}